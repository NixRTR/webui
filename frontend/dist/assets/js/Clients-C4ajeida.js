import{j as e,a as x,C as q,T as G,H as K,S as L,b as l,c as y,d as Q,B as p}from"./ui-vendor-BWxpC62h.js";import{u as W,r as c}from"./react-vendor-DKKOAuGG.js";import{u as X,S as Z,N as ee}from"./useMetrics-1-lvv4cN.js";import{a as se}from"./index-ChXH1R9y.js";import"./http-vendor-B9ygI19o.js";function ie(){const i=localStorage.getItem("access_token"),H=localStorage.getItem("username")||"Unknown",N=W(),[m,$]=c.useState(""),[g,B]=c.useState("all"),[j,F]=c.useState("all"),[o,w]=c.useState("all"),[k,h]=c.useState([]),[E,u]=c.useState([]),[I,C]=c.useState([]),[S,D]=c.useState(!1),{connectionStatus:M}=X(i),P=async()=>{await se.logout(),N("/login")};c.useEffect(()=>{const s=async()=>{if(i)try{const a=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${i}`}});if(a.ok){const t=await a.json();h(t)}}catch(a){console.error("Failed to fetch devices:",a)}};s();const r=setInterval(s,1e4);return()=>clearInterval(r)},[i]),c.useEffect(()=>{const s=async()=>{if(i)try{const a=await fetch("/api/devices/blocked",{headers:{Authorization:`Bearer ${i}`}});if(a.ok){const t=await a.json();u(t.ipv4||[]),C((t.macs||[]).map(n=>n.toLowerCase()))}}catch{}};s();const r=setInterval(s,1e4);return()=>clearInterval(r)},[i]);const f=s=>s.mac_address&&I.includes(s.mac_address.toLowerCase())?!0:s.ip_address&&E.includes(s.ip_address),T=async s=>{if(!i)return;const r=!s.favorite;h(a=>a.map(t=>t.mac_address===s.mac_address?{...t,favorite:r}:t));try{await fetch("/api/devices/override",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({mac_address:s.mac_address,favorite:r})});const a=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${i}`}});a.ok&&h(await a.json())}catch{h(a=>a.map(t=>t.mac_address===s.mac_address?{...t,favorite:!r}:t))}},O=async s=>{if(!i)return;const r=s.nickname||"",a=window.prompt("Set nickname for this device:",r);if(a!==null){h(t=>t.map(n=>n.mac_address===s.mac_address?{...n,nickname:a}:n));try{await fetch("/api/devices/override",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({mac_address:s.mac_address,nickname:a})});const t=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${i}`}});t.ok&&h(await t.json())}catch{}}},A=async s=>{if(!i)return;const r=f(s),a=r?"/api/devices/unblock":"/api/devices/block",t={mac_address:s.mac_address};s.ip_address&&s.ip_address.includes(".")&&(t.ip_address=s.ip_address),r?(u(n=>n.filter(d=>d!==s.ip_address)),C(n=>n.filter(d=>d!==s.mac_address.toLowerCase()))):t.ip_address&&(u(n=>Array.from(new Set([...n,t.ip_address]))),C(n=>Array.from(new Set([...n,s.mac_address.toLowerCase()]))));try{await fetch(a,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify(t)})}catch{u(r?d=>Array.from(new Set([...d,s.ip_address])):d=>d.filter(v=>v!==s.ip_address))}},b=k.filter(s=>{const r=!m||s.hostname?.toLowerCase().includes(m.toLowerCase())||s.ip_address.includes(m)||s.mac_address.includes(m)||s.vendor?.toLowerCase().includes(m.toLowerCase()),a=g==="all"||g==="online"&&s.is_online||g==="offline"&&!s.is_online,t=j==="all"||j==="dhcp"&&s.is_dhcp||j==="static"&&!s.is_dhcp,n=o==="all"||s.network===o;return r&&a&&t&&n}),_=o==="all"?k:k.filter(s=>s.network===o),U=_.filter(s=>s.is_online).length,V=_.filter(s=>!s.is_online).length,z=_.length,J=s=>{const r=new Date(s),a=new Date,t=new Date(a.getFullYear(),a.getMonth(),a.getDate());if(new Date(r.getFullYear(),r.getMonth(),r.getDate()).getTime()===t.getTime())return r.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});{const d=(r.getMonth()+1).toString().padStart(2,"0"),v=r.getDate().toString().padStart(2,"0"),R=r.getFullYear().toString().slice(-2);return`${d}/${v}/${R}`}},Y=({text:s,maxLength:r=20})=>s.length<=r?e.jsx("span",{children:s}):e.jsx(y,{content:s,placement:"top",children:e.jsx("span",{className:"cursor-help truncate block max-w-[200px]",children:s})});return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Z,{onLogout:P,isOpen:S,onClose:()=>D(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(ee,{hostname:"nixos-router",username:H,connectionStatus:M,onMenuClick:()=>D(!S)}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 bg-gray-50 dark:bg-gray-900",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4 md:mb-6 gap-3",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Devices"}),e.jsxs("div",{className:"flex gap-2 md:gap-4",children:[e.jsxs(x,{color:"success",size:"sm",className:"md:text-base",children:[U," Online"]}),e.jsxs(x,{color:"gray",size:"sm",className:"md:text-base",children:[V," Offline"]}),e.jsxs(x,{color:"info",size:"sm",className:"md:text-base",children:[z," Total"]})]})]}),e.jsxs(q,{children:[e.jsx("div",{className:"mb-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex space-x-1",role:"tablist",children:[e.jsx("button",{role:"tab","aria-selected":o==="all",onClick:()=>w("all"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${o==="all"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"All Networks"}),e.jsx("button",{role:"tab","aria-selected":o==="homelab",onClick:()=>w("homelab"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${o==="homelab"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"HOMELAB"}),e.jsx("button",{role:"tab","aria-selected":o==="lan",onClick:()=>w("lan"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${o==="lan"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"LAN"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsx("div",{children:e.jsx(G,{icon:K,placeholder:"Search...",value:m,onChange:s=>$(s.target.value)})}),e.jsx("div",{children:e.jsxs(L,{value:g,onChange:s=>B(s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"online",children:"Online Only"}),e.jsx("option",{value:"offline",children:"Offline Only"})]})}),e.jsx("div",{children:e.jsxs(L,{value:j,onChange:s=>F(s.target.value),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"dhcp",children:"DHCP Only"}),e.jsx("option",{value:"static",children:"Static Only"})]})})]}),e.jsxs("div",{className:"xl-custom:hidden mb-4 flex flex-wrap gap-4 text-xs text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Network:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsx("span",{children:"HOMELAB"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-purple-500"}),e.jsx("span",{children:"LAN"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Type:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-500"}),e.jsx("span",{children:"Static"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsx("span",{children:"DHCP"})]})]})]}),e.jsx("div",{className:"hidden min-[1000px]:block overflow-x-auto",children:e.jsxs(l,{children:[e.jsxs(l.Head,{children:[e.jsx(l.HeadCell,{className:"w-12",children:"Status"}),e.jsx(l.HeadCell,{children:"Device"}),e.jsx(l.HeadCell,{children:"IP Address"}),e.jsx(l.HeadCell,{className:"hidden lg:table-cell",children:"MAC Address"}),e.jsx(l.HeadCell,{className:"hidden xl:table-cell",children:"Vendor"}),e.jsx(l.HeadCell,{className:"w-12",children:"Network"}),e.jsx(l.HeadCell,{className:"w-12",children:"Type"}),e.jsx(l.HeadCell,{className:"w-24",children:"Last Seen"}),e.jsx(l.HeadCell,{children:"Actions"})]}),e.jsx(l.Body,{className:"divide-y",children:b.map(s=>e.jsxs(l.Row,{className:s.is_online?"":"opacity-50",children:[e.jsxs(l.Cell,{children:[e.jsx("div",{className:"hidden xl-custom:block",children:e.jsx(x,{color:s.is_online?"success":"gray",size:"sm",children:s.is_online?"ONLINE":"OFFLINE"})}),e.jsx("div",{className:"xl-custom:hidden",children:e.jsx(y,{content:s.is_online?"Online":"Offline",placement:"top",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${s.is_online?"bg-green-500":"bg-gray-400"}`})})})]}),e.jsx(l.Cell,{className:"font-medium max-w-[200px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-yellow-500 hover:text-yellow-400 flex-shrink-0",title:s.favorite?"Unfavorite":"Favorite",onClick:()=>T(s),children:s.favorite?"★":"☆"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 flex-shrink-0",title:"Edit nickname",onClick:()=>O(s),children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx(Y,{text:s.nickname||s.hostname||"Unknown",maxLength:20})]})}),e.jsx(l.Cell,{className:"font-mono text-sm",children:s.ip_address}),e.jsx(l.Cell,{className:"font-mono text-sm hidden lg:table-cell",children:s.mac_address}),e.jsx(l.Cell,{className:"text-sm text-gray-600 hidden xl:table-cell",children:s.vendor||"—"}),e.jsxs(l.Cell,{children:[e.jsx("div",{className:"hidden xl-custom:block",children:e.jsx(x,{color:s.network==="homelab"?"info":"purple",size:"sm",children:s.network.toUpperCase()})}),e.jsx("div",{className:"xl-custom:hidden",children:e.jsx(y,{content:s.network.toUpperCase(),placement:"top",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${s.network==="homelab"?"bg-blue-500":"bg-purple-500"}`})})})]}),e.jsxs(l.Cell,{children:[e.jsx("div",{className:"hidden xl-custom:block",children:e.jsx(x,{color:s.is_dhcp?"warning":"gray",size:"sm",children:s.is_dhcp?"DHCP":"Static"})}),e.jsx("div",{className:"xl-custom:hidden",children:e.jsx(y,{content:s.is_dhcp?"DHCP":"Static",placement:"top",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${s.is_dhcp?"bg-yellow-500":"bg-gray-500"}`})})})]}),e.jsx(l.Cell,{className:"text-sm whitespace-nowrap",children:J(s.last_seen)}),e.jsx(l.Cell,{children:e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[e.jsx(p,{size:"xs",color:"gray",onClick:()=>N(`/devices/${s.ip_address}`),children:"Details"}),e.jsx(p,{size:"xs",color:f(s)?"success":"failure",onClick:()=>A(s),children:f(s)?"Enable":"Disable"})]})})]},s.mac_address))})]})}),e.jsx("div",{className:"min-[1000px]:hidden space-y-3",children:b.map(s=>e.jsxs("div",{className:`p-4 rounded-lg border ${s.is_online?"bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700":"bg-gray-50 border-gray-200 dark:bg-gray-900 dark:border-gray-700 opacity-60"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-lg mb-1",children:s.hostname||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.ip_address})]}),e.jsx(x,{color:s.is_online?"success":"gray",size:"sm",children:s.is_online?"● Online":"○ Offline"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"MAC:"}),e.jsx("span",{className:"font-mono",children:s.mac_address})]}),s.vendor&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Vendor:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:s.vendor})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Network:"}),e.jsx(x,{color:s.network==="homelab"?"info":"purple",size:"sm",children:s.network.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Nickname:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:s.nickname||"—"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Type:"}),e.jsx(x,{color:s.is_dhcp?s.is_static?"success":"warning":"gray",size:"sm",children:s.is_static?"Static DHCP":s.is_dhcp?"Dynamic":"Static IP"})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 pt-1 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("span",{children:"Last seen:"}),e.jsx("span",{children:new Date(s.last_seen).toLocaleString()})]}),e.jsxs("div",{className:"pt-3",children:[e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(p,{size:"xs",color:"gray",onClick:()=>N(`/devices/${s.ip_address}`),className:"flex-1",children:"Details"}),e.jsx(p,{size:"xs",color:f(s)?"success":"failure",onClick:()=>A(s),className:"flex-1",children:f(s)?"Enable":"Disable"})]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(p,{size:"xs",color:"light",className:"flex-1",onClick:()=>O(s),children:"Edit Nickname"}),e.jsx(p,{size:"xs",color:s.favorite?"warning":"light",onClick:()=>T(s),children:s.favorite?"★ Favorite":"☆ Favorite"})]})]})]})]},s.mac_address))}),b.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No devices found matching your filters"}),e.jsx("div",{className:"mt-4 text-xs md:text-sm text-gray-500 text-center md:text-left",children:e.jsxs("p",{children:["Showing ",b.length," of ",z," devices",o!=="all"&&` (${o.toUpperCase()} network)`,e.jsxs("span",{className:"hidden sm:inline",children:[" • ","Auto-refreshing every 10 seconds"]})]})})]})]})]})]})}export{ie as Clients};
