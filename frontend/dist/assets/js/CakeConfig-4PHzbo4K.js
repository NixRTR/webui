import{j as e,x as D,A as B,C as I,L as o,S as E,T as A,B as T}from"./ui-vendor-oyI-GA67.js";import{u as U,r as s}from"./react-vendor-DKKOAuGG.js";import{u as R,S as M,N as L}from"./useMetrics-CHU8WrXl.js";import{a as F}from"./index-B-w6U-he.js";import"./http-vendor-B9ygI19o.js";function J(){const i=localStorage.getItem("access_token"),d=localStorage.getItem("username")||"Unknown",c=U(),[l,n]=s.useState(!1),[K,u]=s.useState(!0),[x,g]=s.useState(!1),[h,t]=s.useState(null),[m,r]=s.useState(null),[f,v]=s.useState(!1),[p,j]=s.useState("auto"),[b,w]=s.useState(""),[y,C]=s.useState(""),{connectionStatus:S}=R(i);s.useEffect(()=>{if(!i){c("/login");return}N()},[i]);const N=async()=>{u(!0),t(null);try{const a=await F.getCakeConfig();v(a.enable),j(a.aggressiveness),w(a.uploadBandwidth||""),C(a.downloadBandwidth||"")}catch(a){t(a?.response?.data?.detail||a.message||"Failed to load CAKE configuration")}finally{u(!1)}},O=async()=>{g(!0),t(null),r(null);try{const a={enable:f,aggressiveness:p,uploadBandwidth:b||null,downloadBandwidth:y||null};await F.updateCakeConfig(a),r("CAKE configuration saved successfully"),await N()}catch(a){t(a?.response?.data?.detail||a.message||"Failed to save CAKE configuration")}finally{g(!1)}},k=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("username"),c("/login")};return K?e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(M,{onLogout:k,isOpen:l,onClose:()=>n(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(L,{hostname:"nixos-router",username:d,connectionStatus:S,onMenuClick:()=>n(!l)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"text-center text-gray-600 dark:text-gray-400",children:"Loading..."})})]})]}):e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(M,{onLogout:k,isOpen:l,onClose:()=>n(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(L,{hostname:"nixos-router",username:d,connectionStatus:S,onMenuClick:()=>n(!l)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(D,{className:"w-8 h-8 mr-3 text-blue-600 dark:text-blue-400"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"CAKE Traffic Shaping"})]}),h&&e.jsx(B,{color:"failure",className:"mb-4",onDismiss:()=>t(null),children:h}),m&&e.jsx(B,{color:"success",className:"mb-4",onDismiss:()=>r(null),children:m}),e.jsx(I,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"enable",className:"mb-2 block",children:"Enable CAKE"}),e.jsxs(E,{id:"enable",value:f?"true":"false",onChange:a=>v(a.target.value==="true"),children:[e.jsx("option",{value:"true",children:"Enabled"}),e.jsx("option",{value:"false",children:"Disabled"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"aggressiveness",className:"mb-2 block",children:"Aggressiveness"}),e.jsxs(E,{id:"aggressiveness",value:p,onChange:a=>j(a.target.value),children:[e.jsx("option",{value:"auto",children:"Auto (Recommended)"}),e.jsx("option",{value:"conservative",children:"Conservative"}),e.jsx("option",{value:"moderate",children:"Moderate"}),e.jsx("option",{value:"aggressive",children:"Aggressive"})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Controls how aggressively CAKE shapes traffic to reduce latency"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"uploadBandwidth",className:"mb-2 block",children:"Upload Bandwidth (Optional)"}),e.jsx(A,{id:"uploadBandwidth",type:"text",placeholder:"e.g., 190Mbit",value:b,onChange:a=>w(a.target.value)}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Set to ~95% of your actual upload speed (e.g., 190Mbit for 200Mbit)"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"downloadBandwidth",className:"mb-2 block",children:"Download Bandwidth (Optional)"}),e.jsx(A,{id:"downloadBandwidth",type:"text",placeholder:"e.g., 475Mbit",value:y,onChange:a=>C(a.target.value)}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Set to ~95% of your actual download speed (e.g., 475Mbit for 500Mbit)"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(T,{onClick:O,disabled:x,children:x?"Saving...":"Save Configuration"})})]})})]})})]})]})}export{J as CakeConfig};
