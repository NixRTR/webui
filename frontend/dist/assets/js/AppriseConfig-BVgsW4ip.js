import{j as e,y as O,A as E,C as n,L as l,S as U,T as r,p as o,B as K}from"./ui-vendor-BWxpC62h.js";import{u as _,r as i}from"./react-vendor-DKKOAuGG.js";import{u as R,S as M,N as L}from"./useMetrics-BkhBJvPf.js";import{a as z}from"./index-D3n_n9Gb.js";import"./http-vendor-B9ygI19o.js";function X(){const p=localStorage.getItem("access_token"),g=localStorage.getItem("username")||"Unknown",j=_(),[d,h]=i.useState(!1),[D,v]=i.useState(!0),[b,y]=i.useState(!1),[k,m]=i.useState(null),[N,f]=i.useState(null),[S,A]=i.useState(!0),[C,w]=i.useState(8001),[H,I]=i.useState(0),[s,a]=i.useState({}),{connectionStatus:F}=R(p);i.useEffect(()=>{if(!p){j("/login");return}P()},[p]);const P=async()=>{v(!0),m(null);try{const t=await z.getAppriseConfig();A(t.enable),w(t.port),I(t.attachSize);const x={email:{enable:!1,smtpHost:"smtp.gmail.com",smtpPort:587,username:"",to:"",from:""},homeAssistant:{enable:!1,host:"homeassistant.local",port:8123,useHttps:!1},discord:{enable:!1},slack:{enable:!1},telegram:{enable:!1,chatId:""},ntfy:{enable:!1,topic:"router-notifications",server:""}},u={};["email","homeAssistant","discord","slack","telegram","ntfy"].forEach(c=>{t.services&&t.services[c]?u[c]={...x[c],...t.services[c]}:u[c]={...x[c]}}),a(u)}catch(t){m(t?.response?.data?.detail||t.message||"Failed to load Apprise configuration")}finally{v(!1)}},B=async()=>{y(!0),m(null),f(null);try{const t={};s.email&&(t.email={enable:s.email.enable||!1,smtpHost:s.email.smtpHost||"smtp.gmail.com",smtpPort:s.email.smtpPort||587,username:s.email.username||"",to:s.email.to||""},s.email.from&&(t.email.from=s.email.from)),s.homeAssistant&&(t.homeAssistant={enable:s.homeAssistant.enable||!1,host:s.homeAssistant.host||"homeassistant.local",port:s.homeAssistant.port||8123},s.homeAssistant.useHttps!==void 0&&s.homeAssistant.useHttps!==null&&(t.homeAssistant.useHttps=s.homeAssistant.useHttps)),s.discord&&(t.discord={enable:s.discord.enable||!1}),s.slack&&(t.slack={enable:s.slack.enable||!1}),s.telegram&&(t.telegram={enable:s.telegram.enable||!1,chatId:s.telegram.chatId||""}),s.ntfy&&(t.ntfy={enable:s.ntfy.enable||!1,topic:s.ntfy.topic||"router-notifications"},s.ntfy.server&&(t.ntfy.server=s.ntfy.server));const x={enable:S,port:C,attachSize:H,services:t};await z.updateAppriseConfig(x),f("Apprise configuration saved successfully"),await P()}catch(t){m(t?.response?.data?.detail||t.message||"Failed to save Apprise configuration")}finally{y(!1)}},T=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("username"),j("/login")};return D?e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(M,{onLogout:T,isOpen:d,onClose:()=>h(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(L,{hostname:"nixos-router",username:g,connectionStatus:F,onMenuClick:()=>h(!d)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"text-center text-gray-600 dark:text-gray-400",children:"Loading..."})})]})]}):e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(M,{onLogout:T,isOpen:d,onClose:()=>h(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(L,{hostname:"nixos-router",username:g,connectionStatus:F,onMenuClick:()=>h(!d)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(O,{className:"w-8 h-8 mr-3 text-blue-600 dark:text-blue-400"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Apprise Notifications"})]}),k&&e.jsx(E,{color:"failure",className:"mb-4",onDismiss:()=>m(null),children:k}),N&&e.jsx(E,{color:"success",className:"mb-4",onDismiss:()=>f(null),children:N}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"enable",className:"mb-2 block",children:"Enable Apprise"}),e.jsxs(U,{id:"enable",value:S?"true":"false",onChange:t=>A(t.target.value==="true"),children:[e.jsx("option",{value:"true",children:"Enabled"}),e.jsx("option",{value:"false",children:"Disabled"})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"port",className:"mb-2 block",children:"Port"}),e.jsx(r,{id:"port",type:"number",value:C,onChange:t=>w(parseInt(t.target.value)||8001)})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"attachSize",className:"mb-2 block",children:"Maximum Attachment Size (MB)"}),e.jsx(r,{id:"attachSize",type:"number",value:H,onChange:t=>I(parseInt(t.target.value)||0)}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Set to 0 to disable attachments"})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6 mt-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Notification Services"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Configure individual notification services. Secrets (passwords, tokens) are stored in secrets/secrets.yaml."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Email (SMTP)"}),e.jsx(o,{checked:s.email?.enable||!1,onChange:t=>{a({...s,email:{...s.email,enable:t}})}})]}),s.email?.enable&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"email-smtpHost",children:"SMTP Host"}),e.jsx(r,{id:"email-smtpHost",value:s.email?.smtpHost||"",onChange:t=>{a({...s,email:{...s.email,smtpHost:t.target.value}})},placeholder:"smtp.gmail.com"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"email-smtpPort",children:"SMTP Port"}),e.jsx(r,{id:"email-smtpPort",type:"number",value:s.email?.smtpPort||"",onChange:t=>{a({...s,email:{...s.email,smtpPort:parseInt(t.target.value)||587}})},placeholder:"587"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"email-username",children:"Username"}),e.jsx(r,{id:"email-username",value:s.email?.username||"",onChange:t=>{a({...s,email:{...s.email,username:t.target.value}})},placeholder:"your-email@gmail.com"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"email-to",children:"To"}),e.jsx(r,{id:"email-to",value:s.email?.to||"",onChange:t=>{a({...s,email:{...s.email,to:t.target.value}})},placeholder:"recipient@example.com"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"email-from",children:"From (optional)"}),e.jsx(r,{id:"email-from",value:s.email?.from||"",onChange:t=>{a({...s,email:{...s.email,from:t.target.value}})},placeholder:"your-email@gmail.com"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:'Password stored in sops secrets as "apprise-email-password"'})]})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Home Assistant"}),e.jsx(o,{checked:s.homeAssistant?.enable||!1,onChange:t=>{a({...s,homeAssistant:{...s.homeAssistant,enable:t}})}})]}),s.homeAssistant?.enable&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"ha-host",children:"Host"}),e.jsx(r,{id:"ha-host",value:s.homeAssistant?.host||"",onChange:t=>{a({...s,homeAssistant:{...s.homeAssistant,host:t.target.value}})},placeholder:"homeassistant.local"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"ha-port",children:"Port"}),e.jsx(r,{id:"ha-port",type:"number",value:s.homeAssistant?.port||"",onChange:t=>{a({...s,homeAssistant:{...s.homeAssistant,port:parseInt(t.target.value)||8123}})},placeholder:"8123"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{checked:s.homeAssistant?.useHttps||!1,onChange:t=>{a({...s,homeAssistant:{...s.homeAssistant,useHttps:t}})}}),e.jsx(l,{htmlFor:"ha-useHttps",children:"Use HTTPS"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:'Access token stored in sops secrets as "apprise-homeassistant-token"'})]})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Discord"}),e.jsx(o,{checked:s.discord?.enable||!1,onChange:t=>{a({...s,discord:{...s.discord,enable:t}})}})]}),s.discord?.enable&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Webhook ID and token stored in sops secrets:",e.jsx("br",{}),'- "apprise-discord-webhook-id"',e.jsx("br",{}),'- "apprise-discord-webhook-token"']})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Slack"}),e.jsx(o,{checked:s.slack?.enable||!1,onChange:t=>{a({...s,slack:{...s.slack,enable:t}})}})]}),s.slack?.enable&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Tokens stored in sops secrets:",e.jsx("br",{}),'- "apprise-slack-token-a"',e.jsx("br",{}),'- "apprise-slack-token-b"',e.jsx("br",{}),'- "apprise-slack-token-c"']})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Telegram"}),e.jsx(o,{checked:s.telegram?.enable||!1,onChange:t=>{a({...s,telegram:{...s.telegram,enable:t}})}})]}),s.telegram?.enable&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"telegram-chatId",children:"Chat ID"}),e.jsx(r,{id:"telegram-chatId",value:s.telegram?.chatId||"",onChange:t=>{a({...s,telegram:{...s.telegram,chatId:t.target.value}})},placeholder:"123456789"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:'Bot token stored in sops secrets as "apprise-telegram-bot-token"'})]})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"ntfy"}),e.jsx(o,{checked:s.ntfy?.enable||!1,onChange:t=>{a({...s,ntfy:{...s.ntfy,enable:t}})}})]}),s.ntfy?.enable&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"ntfy-topic",children:"Topic"}),e.jsx(r,{id:"ntfy-topic",value:s.ntfy?.topic||"",onChange:t=>{a({...s,ntfy:{...s.ntfy,topic:t.target.value}})},placeholder:"router-notifications"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"ntfy-server",children:"Server (optional)"}),e.jsx(r,{id:"ntfy-server",value:s.ntfy?.server||"",onChange:t=>{a({...s,ntfy:{...s.ntfy,server:t.target.value}})},placeholder:"https://ntfy.sh"})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Username and password stored in sops secrets:",e.jsx("br",{}),'- "apprise-ntfy-username"',e.jsx("br",{}),'- "apprise-ntfy-password"']})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(K,{onClick:B,disabled:b,children:b?"Saving...":"Save Configuration"})})]})})]})})]})]})}export{X as AppriseConfig};
