import{j as e,L as i,S as z,B as S,T as c,k as ye,l as ts,A as $,M as T,m as be,f as as,C as Q,b as y,a as re,n as rs,o as ns,p as is,q as os}from"./ui-vendor-B64yKeUt.js";import{a as x,u as ls}from"./react-vendor-4URc7N9U.js";import{u as cs,S as ds,N as hs}from"./useMetrics-Cg51oHeC.js";import{a as _}from"./index-JDH3Ux20.js";import"./http-vendor-B9ygI19o.js";function ps({onServiceSaved:F}={}){const[C,w]=x.useState(""),[t,O]=x.useState({}),[H,ee]=x.useState(""),[ne,R]=x.useState(!1),[he,q]=x.useState(!1),[K,Y]=x.useState(""),[J,se]=x.useState(""),[V,B]=x.useState(!1),[X,W]=x.useState(null),[ie,m]=x.useState(!1),[f,oe]=x.useState("custom"),A=[{value:"email",label:"Email (SMTP)",category:"Email"},{value:"discord",label:"Discord",category:"Chat"},{value:"slack",label:"Slack",category:"Chat"},{value:"telegram",label:"Telegram",category:"Chat"},{value:"matrix",label:"Matrix",category:"Chat"},{value:"mattermost",label:"Mattermost",category:"Chat"},{value:"rocketchat",label:"Rocket.Chat",category:"Chat"},{value:"msteams",label:"Microsoft Teams",category:"Chat"},{value:"googlechat",label:"Google Chat",category:"Chat"},{value:"zulip",label:"Zulip",category:"Chat"},{value:"line",label:"Line",category:"Chat"},{value:"pushover",label:"Pushover",category:"Push"},{value:"pushbullet",label:"Pushbullet",category:"Push"},{value:"gotify",label:"Gotify",category:"Push"},{value:"ntfy",label:"ntfy",category:"Push"},{value:"prowl",label:"Prowl",category:"Push"},{value:"join",label:"Join",category:"Push"},{value:"homeassistant",label:"Home Assistant",category:"Home Automation"},{value:"twilio",label:"Twilio (SMS)",category:"SMS"},{value:"awssns",label:"AWS SNS",category:"Cloud"},{value:"gcm",label:"Google Cloud Messaging",category:"Cloud"},{value:"fcm",label:"Firebase Cloud Messaging",category:"Cloud"},{value:"webhook",label:"Generic Webhook",category:"Webhook"},{value:"json",label:"JSON Webhook",category:"Webhook"},{value:"ifttt",label:"IFTTT",category:"Other"},{value:"xmpp",label:"XMPP",category:"Other"},{value:"kodi",label:"Kodi",category:"Other"},{value:"apprise",label:"Apprise API",category:"Other"}],g=s=>encodeURIComponent(s),P=()=>{if(!C)return;let s="";switch(C){case"email":{const n=String(t.username||""),d=String(t.password||""),u=String(t.to||""),v=String(t.from||n);if(f!=="custom"){const I={gmail:"gmail.com",yahoo:"yahoo.com",hotmail:"hotmail.com",live:"live.com",fastmail:"fastmail.com",zoho:"zoho.com",yandex:"yandex.com",sendgrid:"sendgrid.com",qq:"qq.com",163:"163.com",custom:""}[f];if(f==="sendgrid"){const E=v||n;s=`mailto://${g(n)}:${g(d)}@${I}?from=${g(E)}`}else s=`mailto://${g(n)}:${g(d)}@${I}`}else{const k=String(t.smtpHost||""),I=String(t.port||"587");s=`${I==="465"?"mailtos":"mailto"}://${g(n)}:${g(d)}@${k}:${I}?to=${g(u)}&from=${g(v)}`}break}case"homeassistant":{const n=String(t.host||""),d=String(t.port||(t.useHttps?"443":"8123")),u=String(t.token||"");s=`${!!t.useHttps?"hassios":"hassio"}://${n}:${d}/${u}`;break}case"discord":{const n=String(t.webhookId||""),d=String(t.webhookToken||"");s=`discord://${n}/${d}`;break}case"slack":{const n=String(t.tokenA||""),d=String(t.tokenB||""),u=String(t.tokenC||"");s=`slack://${n}/${d}/${u}`;break}case"telegram":{const n=String(t.botToken||""),d=String(t.chatId||"");s=`tgram://${n}/${d}`;break}case"ntfy":{const n=String(t.topic||""),d=String(t.server||"ntfy.sh");if(t.username&&t.password){const u=String(t.username),v=String(t.password);s=`ntfy://${g(u)}:${g(v)}@${d}/${n}`}else s=`ntfy://${d}/${n}`;break}case"pushover":{const n=String(t.userKey||""),d=String(t.token||"");s=`pover://${n}@${d}`;break}case"pushbullet":{const n=String(t.token||""),d=String(t.deviceId||"");d?s=`pbul://${n}/${d}`:s=`pbul://${n}`;break}case"gotify":{const n=String(t.host||""),d=String(t.token||""),u=String(t.port||"80");s=`${!!t.useHttps?"gotifys":"gotify"}://${n}:${u}/${d}`;break}case"matrix":{const n=String(t.host||""),d=String(t.token||""),u=String(t.room||""),k=!!t.useHttps?"matrixs":"matrix";u?s=`${k}://${n}/${u}?token=${g(d)}`:s=`${k}://${n}?token=${g(d)}`;break}case"mattermost":{const n=String(t.host||""),d=String(t.token||""),u=String(t.channel||""),k=!!t.useHttps?"mmosts":"mmost";u?s=`${k}://${n}/${u}?token=${g(d)}`:s=`${k}://${n}?token=${g(d)}`;break}case"rocketchat":{const n=String(t.host||""),d=String(t.user||""),u=String(t.password||""),v=String(t.channel||""),I=!!t.useHttps?"rockets":"rocket";v?s=`${I}://${g(d)}:${g(u)}@${n}/${v}`:s=`${I}://${g(d)}:${g(u)}@${n}`;break}case"msteams":{const n=String(t.webhookUrl||"");n.startsWith("http")?s=`msteams://${n.replace(/^https?:\/\//,"")}`:s=`msteams://${n}`;break}case"googlechat":{const n=String(t.webhookUrl||"");n.startsWith("http")?s=`gchat://${n.replace(/^https?:\/\//,"")}`:s=`gchat://${n}`;break}case"zulip":{const n=String(t.host||""),d=String(t.botEmail||""),u=String(t.botKey||""),v=String(t.stream||""),k=String(t.topic||""),E=!!t.useHttps?"zulips":"zulip";let te=`bot=${g(d)}&key=${g(u)}`;v&&(te+=`&stream=${g(v)}`),k&&(te+=`&topic=${g(k)}`),s=`${E}://${n}?${te}`;break}case"line":{s=`line://${String(t.token||"")}`;break}case"prowl":{const n=String(t.apikey||""),d=String(t.providerKey||"");d?s=`prowl://${n}@${d}`:s=`prowl://${n}`;break}case"join":{const n=String(t.deviceId||""),d=String(t.apikey||"");s=`join://${n}?apikey=${g(d)}`;break}case"twilio":{const n=String(t.accountSid||""),d=String(t.authToken||""),u=String(t.fromNumber||""),v=String(t.toNumber||"");s=`twilio://${n}:${g(d)}@${u}/${v}`;break}case"awssns":{const n=String(t.region||"us-east-1"),d=String(t.topicArn||""),u=String(t.accessKeyId||""),v=String(t.secretAccessKey||"");s=`sns://${g(u)}:${g(v)}@${n}/${d}`;break}case"gcm":{const n=String(t.projectId||""),d=String(t.apiKey||""),u=String(t.registrationId||"");s=`gcm://${g(d)}@${n}/${u}`;break}case"fcm":{const n=String(t.projectId||""),d=String(t.apikey||""),u=String(t.deviceToken||"");s=`fcm://${g(d)}@${n}/${u}`;break}case"webhook":{const n=String(t.url||""),d=String(t.method||"POST").toUpperCase();n.startsWith("http")?s=`webhook${d==="GET"?"s":""}://${n.replace(/^https?:\/\//,"")}`:s=`webhook${d==="GET"?"s":""}://${n}`;break}case"json":{const n=String(t.url||"");n.startsWith("http")?s=`json://${n.replace(/^https?:\/\//,"")}`:s=`json://${n}`;break}case"ifttt":{const n=String(t.webhookId||""),d=String(t.eventName||"");s=`ifttt://${n}/${d}`;break}case"xmpp":{const n=String(t.user||""),d=String(t.password||""),u=String(t.host||""),v=String(t.target||"");v?s=`xmpp://${g(n)}:${g(d)}@${u}/${v}`:s=`xmpp://${g(n)}:${g(d)}@${u}`;break}case"kodi":{const n=String(t.host||""),d=String(t.port||"8080"),u=String(t.user||""),v=String(t.password||"");u&&v?s=`kodi://${g(u)}:${g(v)}@${n}:${d}`:s=`kodi://${n}:${d}`;break}case"apprise":{const n=String(t.host||""),d=String(t.port||"8000"),u=String(t.token||""),k=!!t.useHttps?"apprises":"apprise";u?s=`${k}://${n}:${d}/${u}`:s=`${k}://${n}:${d}`;break}}ee(s),R(!1)},le=async()=>{H&&(await navigator.clipboard.writeText(H),R(!0),setTimeout(()=>R(!1),2e3))},l=(s,n)=>{O(d=>({...d,[s]:n}))},j=()=>{w(""),O({}),ee(""),R(!1)},G=()=>{if(!C)return null;switch(C){case"email":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"emailProvider",children:"Email Provider"}),e.jsxs(z,{id:"emailProvider",value:f,onChange:s=>{oe(s.target.value),O({})},children:[e.jsx("option",{value:"custom",children:"Custom SMTP Server"}),e.jsx("option",{value:"gmail",children:"Gmail"}),e.jsx("option",{value:"yahoo",children:"Yahoo"}),e.jsx("option",{value:"hotmail",children:"Hotmail"}),e.jsx("option",{value:"live",children:"Live.com"}),e.jsx("option",{value:"fastmail",children:"Fastmail"}),e.jsx("option",{value:"zoho",children:"Zoho"}),e.jsx("option",{value:"yandex",children:"Yandex"}),e.jsx("option",{value:"sendgrid",children:"SendGrid"}),e.jsx("option",{value:"qq",children:"QQ Mail"}),e.jsx("option",{value:"163",children:"163 Mail"})]})]}),f==="gmail"&&e.jsx($,{color:"info",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Note:"})," Google users using 2-Step Verification will be required to generate an"," ",e.jsx("a",{href:"https://myaccount.google.com/apppasswords",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 underline",children:"app password"})," ","that you can use in the password field."]})}),f==="yahoo"&&e.jsx($,{color:"info",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Note:"})," Yahoo users will be required to generate an"," ",e.jsx("a",{href:"https://login.yahoo.com/account/security/app-passwords",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 underline",children:"app password"})," ","that you can use in the password field."]})}),f==="fastmail"&&e.jsx($,{color:"info",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Note:"})," Fastmail users are required to generate a custom App password before connecting. You must assign the ",e.jsx("strong",{children:"SMTP"})," option to the new App you generate. This Fastmail plugin supports 116 domains - just make sure you identify the email address you're using when building the URL."]})}),f==="custom"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"smtpHost",children:"SMTP Host"}),e.jsx(c,{id:"smtpHost",type:"text",placeholder:"smtp.gmail.com",value:String(t.smtpHost||""),onChange:s=>l("smtpHost",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"port",children:"Port"}),e.jsx(c,{id:"port",type:"text",placeholder:"587",value:String(t.port||"587"),onChange:s=>l("port",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Use 465 for SSL/TLS, 587 for STARTTLS"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"to",children:"To (Recipient Email)"}),e.jsx(c,{id:"to",type:"email",placeholder:"recipient@example.com",value:String(t.to||""),onChange:s=>l("to",s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"username",children:f==="custom"?"Username":"Email Address"}),e.jsx(c,{id:"username",type:"text",placeholder:f==="custom"?"user@example.com":"user@provider.com",value:String(t.username||""),onChange:s=>l("username",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"password",children:f==="gmail"||f==="yahoo"||f==="fastmail"?"App Password":"Password"}),e.jsx(c,{id:"password",type:"password",placeholder:f==="gmail"||f==="yahoo"||f==="fastmail"?"App password (not your regular password)":"Your password",value:String(t.password||""),onChange:s=>l("password",s.target.value)})]}),f==="sendgrid"&&e.jsxs("div",{children:[e.jsx(i,{htmlFor:"from",children:"From Email (Required for SendGrid)"}),e.jsx(c,{id:"from",type:"email",placeholder:"noreply@your-validated-domain.com",value:String(t.from||""),onChange:s=>l("from",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Must use a validated domain from your SendGrid account"})]}),f==="custom"&&e.jsxs("div",{children:[e.jsx(i,{htmlFor:"from",children:"From (Sender Email - Optional)"}),e.jsx(c,{id:"from",type:"email",placeholder:"sender@example.com",value:String(t.from||""),onChange:s=>l("from",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Defaults to username if not provided"})]})]});case"homeassistant":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"host",children:"Home Assistant Host"}),e.jsx(c,{id:"host",type:"text",placeholder:"homeassistant.local",value:String(t.host||""),onChange:s=>l("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"port",children:"Port"}),e.jsx(c,{id:"port",type:"text",placeholder:"8123",value:String(t.port||""),onChange:s=>l("port",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Default: 8123 (HTTP) or 443 (HTTPS)"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"token",children:"Long-lived Access Token"}),e.jsx(c,{id:"token",type:"password",placeholder:"Enter access credential",value:String(t.token||""),onChange:s=>l("token",s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"useHttps",checked:!!t.useHttps,onChange:s=>l("useHttps",s.target.checked),className:"rounded"}),e.jsx(i,{htmlFor:"useHttps",children:"Use HTTPS"})]})]});case"discord":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"webhookId",children:"Webhook ID"}),e.jsx(c,{id:"webhookId",type:"text",placeholder:"123456789012345678",value:String(t.webhookId||""),onChange:s=>l("webhookId",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"webhookToken",children:"Webhook Token"}),e.jsx(c,{id:"webhookToken",type:"password",placeholder:"Enter webhook credential",value:String(t.webhookToken||""),onChange:s=>l("webhookToken",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get these from Discord: Server Settings → Integrations → Webhooks"})]})]});case"slack":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"tokenA",children:"Token A"}),e.jsx(c,{id:"tokenA",type:"password",placeholder:"Enter first credential",value:String(t.tokenA||""),onChange:s=>l("tokenA",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"tokenB",children:"Token B"}),e.jsx(c,{id:"tokenB",type:"password",placeholder:"Enter second credential",value:String(t.tokenB||""),onChange:s=>l("tokenB",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"tokenC",children:"Token C"}),e.jsx(c,{id:"tokenC",type:"password",placeholder:"Enter third credential",value:String(t.tokenC||""),onChange:s=>l("tokenC",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get credentials from Slack: Apps → Your App → OAuth & Permissions"})]})]});case"telegram":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"botToken",children:"Bot Token"}),e.jsx(c,{id:"botToken",type:"password",placeholder:"Enter bot credential from @BotFather",value:String(t.botToken||""),onChange:s=>l("botToken",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from @BotFather on Telegram"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"chatId",children:"Chat ID"}),e.jsx(c,{id:"chatId",type:"text",placeholder:"123456789",value:String(t.chatId||""),onChange:s=>l("chatId",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Your Telegram user ID or group ID"})]})]});case"ntfy":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"server",children:"Server"}),e.jsx(c,{id:"server",type:"text",placeholder:"ntfy.sh",value:String(t.server||"ntfy.sh"),onChange:s=>l("server",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Default: ntfy.sh (public server)"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"topic",children:"Topic"}),e.jsx(c,{id:"topic",type:"text",placeholder:"my-topic",value:String(t.topic||""),onChange:s=>l("topic",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Topic name (no spaces, use hyphens)"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"username",children:"Username (Optional)"}),e.jsx(c,{id:"username",type:"text",placeholder:"username",value:String(t.username||""),onChange:s=>l("username",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"password",children:"Password (Optional)"}),e.jsx(c,{id:"password",type:"password",placeholder:"password",value:String(t.password||""),onChange:s=>l("password",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Only required for private topics"})]})]});case"pushover":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"userKey",children:"User Key"}),e.jsx(c,{id:"userKey",type:"text",placeholder:"Enter user key",value:String(t.userKey||""),onChange:s=>l("userKey",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from pushover.net"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"token",children:"Application Token"}),e.jsx(c,{id:"token",type:"password",placeholder:"Enter application token",value:String(t.token||""),onChange:s=>l("token",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Create an application at pushover.net"})]})]});case"pushbullet":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"token",children:"Access Token"}),e.jsx(c,{id:"token",type:"password",placeholder:"Enter access token",value:String(t.token||""),onChange:s=>l("token",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from pushbullet.com → Settings → Access Tokens"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"deviceId",children:"Device ID (Optional)"}),e.jsx(c,{id:"deviceId",type:"text",placeholder:"device_iden",value:String(t.deviceId||""),onChange:s=>l("deviceId",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Leave empty to send to all devices"})]})]});case"gotify":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"host",children:"Gotify Server Host"}),e.jsx(c,{id:"host",type:"text",placeholder:"gotify.example.com",value:String(t.host||""),onChange:s=>l("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"port",children:"Port"}),e.jsx(c,{id:"port",type:"text",placeholder:"80",value:String(t.port||"80"),onChange:s=>l("port",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"token",children:"Application Token"}),e.jsx(c,{id:"token",type:"password",placeholder:"Enter application token",value:String(t.token||""),onChange:s=>l("token",s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"useHttps",checked:!!t.useHttps,onChange:s=>l("useHttps",s.target.checked),className:"rounded"}),e.jsx(i,{htmlFor:"useHttps",children:"Use HTTPS"})]})]});case"matrix":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"host",children:"Matrix Server"}),e.jsx(c,{id:"host",type:"text",placeholder:"matrix.example.com",value:String(t.host||""),onChange:s=>l("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"token",children:"Access Token"}),e.jsx(c,{id:"token",type:"password",placeholder:"Enter access token",value:String(t.token||""),onChange:s=>l("token",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"room",children:"Room ID (Optional)"}),e.jsx(c,{id:"room",type:"text",placeholder:"!roomid:example.com",value:String(t.room||""),onChange:s=>l("room",s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"useHttps",checked:!!t.useHttps,onChange:s=>l("useHttps",s.target.checked),className:"rounded"}),e.jsx(i,{htmlFor:"useHttps",children:"Use HTTPS"})]})]});case"mattermost":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"host",children:"Mattermost Server"}),e.jsx(c,{id:"host",type:"text",placeholder:"mattermost.example.com",value:String(t.host||""),onChange:s=>l("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"token",children:"Personal Access Token"}),e.jsx(c,{id:"token",type:"password",placeholder:"Enter access token",value:String(t.token||""),onChange:s=>l("token",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"channel",children:"Channel Name (Optional)"}),e.jsx(c,{id:"channel",type:"text",placeholder:"general",value:String(t.channel||""),onChange:s=>l("channel",s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"useHttps",checked:!!t.useHttps,onChange:s=>l("useHttps",s.target.checked),className:"rounded"}),e.jsx(i,{htmlFor:"useHttps",children:"Use HTTPS"})]})]});case"rocketchat":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"host",children:"Rocket.Chat Server"}),e.jsx(c,{id:"host",type:"text",placeholder:"rocketchat.example.com",value:String(t.host||""),onChange:s=>l("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"user",children:"Username"}),e.jsx(c,{id:"user",type:"text",placeholder:"bot_user",value:String(t.user||""),onChange:s=>l("user",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"password",children:"Password"}),e.jsx(c,{id:"password",type:"password",placeholder:"Enter password",value:String(t.password||""),onChange:s=>l("password",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"channel",children:"Channel (Optional)"}),e.jsx(c,{id:"channel",type:"text",placeholder:"#general",value:String(t.channel||""),onChange:s=>l("channel",s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"useHttps",checked:!!t.useHttps,onChange:s=>l("useHttps",s.target.checked),className:"rounded"}),e.jsx(i,{htmlFor:"useHttps",children:"Use HTTPS"})]})]});case"msteams":return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(i,{htmlFor:"webhookUrl",children:"Webhook URL"}),e.jsx(c,{id:"webhookUrl",type:"text",placeholder:"https://outlook.office.com/webhook/...",value:String(t.webhookUrl||""),onChange:s=>l("webhookUrl",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from Teams: Channel → Connectors → Incoming Webhook"})]})});case"googlechat":return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(i,{htmlFor:"webhookUrl",children:"Webhook URL"}),e.jsx(c,{id:"webhookUrl",type:"text",placeholder:"https://chat.googleapis.com/v1/spaces/...",value:String(t.webhookUrl||""),onChange:s=>l("webhookUrl",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from Google Chat: Space → Configure Webhooks"})]})});case"zulip":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"host",children:"Zulip Server"}),e.jsx(c,{id:"host",type:"text",placeholder:"zulip.example.com",value:String(t.host||""),onChange:s=>l("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"botEmail",children:"Bot Email"}),e.jsx(c,{id:"botEmail",type:"email",placeholder:"bot@example.com",value:String(t.botEmail||""),onChange:s=>l("botEmail",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"botKey",children:"Bot API Key"}),e.jsx(c,{id:"botKey",type:"password",placeholder:"Enter bot API key",value:String(t.botKey||""),onChange:s=>l("botKey",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"stream",children:"Stream Name (Optional)"}),e.jsx(c,{id:"stream",type:"text",placeholder:"general",value:String(t.stream||""),onChange:s=>l("stream",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"topic",children:"Topic (Optional)"}),e.jsx(c,{id:"topic",type:"text",placeholder:"notifications",value:String(t.topic||""),onChange:s=>l("topic",s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"useHttps",checked:!!t.useHttps,onChange:s=>l("useHttps",s.target.checked),className:"rounded"}),e.jsx(i,{htmlFor:"useHttps",children:"Use HTTPS"})]})]});case"line":return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(i,{htmlFor:"token",children:"Channel Access Token"}),e.jsx(c,{id:"token",type:"password",placeholder:"Enter channel access token",value:String(t.token||""),onChange:s=>l("token",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from Line Developers Console"})]})});case"prowl":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"apikey",children:"API Key"}),e.jsx(c,{id:"apikey",type:"password",placeholder:"Enter API key",value:String(t.apikey||""),onChange:s=>l("apikey",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from prowlapp.com"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"providerKey",children:"Provider Key (Optional)"}),e.jsx(c,{id:"providerKey",type:"password",placeholder:"Enter provider key",value:String(t.providerKey||""),onChange:s=>l("providerKey",s.target.value)})]})]});case"join":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"deviceId",children:"Device ID"}),e.jsx(c,{id:"deviceId",type:"text",placeholder:"device_iden",value:String(t.deviceId||""),onChange:s=>l("deviceId",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from joinjoaomgcd.app → My Devices"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"apikey",children:"API Key"}),e.jsx(c,{id:"apikey",type:"password",placeholder:"Enter API key",value:String(t.apikey||""),onChange:s=>l("apikey",s.target.value)})]})]});case"twilio":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"accountSid",children:"Account SID"}),e.jsx(c,{id:"accountSid",type:"text",placeholder:"ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",value:String(t.accountSid||""),onChange:s=>l("accountSid",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"authToken",children:"Auth Token"}),e.jsx(c,{id:"authToken",type:"password",placeholder:"Enter auth token",value:String(t.authToken||""),onChange:s=>l("authToken",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"fromNumber",children:"From Phone Number"}),e.jsx(c,{id:"fromNumber",type:"text",placeholder:"+1234567890",value:String(t.fromNumber||""),onChange:s=>l("fromNumber",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Your Twilio phone number (E.164 format)"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"toNumber",children:"To Phone Number"}),e.jsx(c,{id:"toNumber",type:"text",placeholder:"+1234567890",value:String(t.toNumber||""),onChange:s=>l("toNumber",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Recipient phone number (E.164 format)"})]})]});case"awssns":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"region",children:"AWS Region"}),e.jsx(c,{id:"region",type:"text",placeholder:"us-east-1",value:String(t.region||"us-east-1"),onChange:s=>l("region",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"topicArn",children:"Topic ARN"}),e.jsx(c,{id:"topicArn",type:"text",placeholder:"arn:aws:sns:us-east-1:123456789012:MyTopic",value:String(t.topicArn||""),onChange:s=>l("topicArn",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"accessKeyId",children:"Access Key ID"}),e.jsx(c,{id:"accessKeyId",type:"text",placeholder:"Enter access key ID",value:String(t.accessKeyId||""),onChange:s=>l("accessKeyId",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"secretAccessKey",children:"Secret Access Key"}),e.jsx(c,{id:"secretAccessKey",type:"password",placeholder:"Enter secret access key",value:String(t.secretAccessKey||""),onChange:s=>l("secretAccessKey",s.target.value)})]})]});case"gcm":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"projectId",children:"Project ID"}),e.jsx(c,{id:"projectId",type:"text",placeholder:"my-project-id",value:String(t.projectId||""),onChange:s=>l("projectId",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"apiKey",children:"API Key"}),e.jsx(c,{id:"apiKey",type:"password",placeholder:"Enter API key",value:String(t.apiKey||""),onChange:s=>l("apiKey",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"registrationId",children:"Registration ID"}),e.jsx(c,{id:"registrationId",type:"text",placeholder:"Enter registration ID",value:String(t.registrationId||""),onChange:s=>l("registrationId",s.target.value)})]})]});case"fcm":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"projectId",children:"Project ID"}),e.jsx(c,{id:"projectId",type:"text",placeholder:"my-project-id",value:String(t.projectId||""),onChange:s=>l("projectId",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"apikey",children:"Server Key"}),e.jsx(c,{id:"apikey",type:"password",placeholder:"Enter server key",value:String(t.apikey||""),onChange:s=>l("apikey",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"deviceToken",children:"Device Token"}),e.jsx(c,{id:"deviceToken",type:"text",placeholder:"Enter device token",value:String(t.deviceToken||""),onChange:s=>l("deviceToken",s.target.value)})]})]});case"webhook":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"url",children:"Webhook URL"}),e.jsx(c,{id:"url",type:"text",placeholder:"https://example.com/webhook",value:String(t.url||""),onChange:s=>l("url",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"method",children:"HTTP Method"}),e.jsxs(z,{id:"method",value:String(t.method||"POST"),onChange:s=>l("method",s.target.value),children:[e.jsx("option",{value:"POST",children:"POST"}),e.jsx("option",{value:"GET",children:"GET"}),e.jsx("option",{value:"PUT",children:"PUT"}),e.jsx("option",{value:"PATCH",children:"PATCH"})]})]})]});case"json":return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(i,{htmlFor:"url",children:"JSON Webhook URL"}),e.jsx(c,{id:"url",type:"text",placeholder:"https://example.com/webhook",value:String(t.url||""),onChange:s=>l("url",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"URL that accepts JSON POST requests"})]})});case"ifttt":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"webhookId",children:"Webhook ID"}),e.jsx(c,{id:"webhookId",type:"text",placeholder:"Enter webhook ID",value:String(t.webhookId||""),onChange:s=>l("webhookId",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from ifttt.com → My Applets → Webhooks → Settings"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"eventName",children:"Event Name"}),e.jsx(c,{id:"eventName",type:"text",placeholder:"notification",value:String(t.eventName||""),onChange:s=>l("eventName",s.target.value)})]})]});case"xmpp":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"host",children:"XMPP Server"}),e.jsx(c,{id:"host",type:"text",placeholder:"xmpp.example.com",value:String(t.host||""),onChange:s=>l("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"user",children:"Username (JID)"}),e.jsx(c,{id:"user",type:"text",placeholder:"user@example.com",value:String(t.user||""),onChange:s=>l("user",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"password",children:"Password"}),e.jsx(c,{id:"password",type:"password",placeholder:"Enter password",value:String(t.password||""),onChange:s=>l("password",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"target",children:"Target JID (Optional)"}),e.jsx(c,{id:"target",type:"text",placeholder:"recipient@example.com",value:String(t.target||""),onChange:s=>l("target",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Leave empty to send to yourself"})]})]});case"kodi":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"host",children:"Kodi Host"}),e.jsx(c,{id:"host",type:"text",placeholder:"192.168.1.100",value:String(t.host||""),onChange:s=>l("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"port",children:"Port"}),e.jsx(c,{id:"port",type:"text",placeholder:"8080",value:String(t.port||"8080"),onChange:s=>l("port",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"user",children:"Username (Optional)"}),e.jsx(c,{id:"user",type:"text",placeholder:"kodi",value:String(t.user||""),onChange:s=>l("user",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"password",children:"Password (Optional)"}),e.jsx(c,{id:"password",type:"password",placeholder:"Enter password",value:String(t.password||""),onChange:s=>l("password",s.target.value)})]})]});case"apprise":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"host",children:"Apprise API Host"}),e.jsx(c,{id:"host",type:"text",placeholder:"apprise.example.com",value:String(t.host||""),onChange:s=>l("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"port",children:"Port"}),e.jsx(c,{id:"port",type:"text",placeholder:"8000",value:String(t.port||"8000"),onChange:s=>l("port",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"token",children:"Token (Optional)"}),e.jsx(c,{id:"token",type:"password",placeholder:"Enter token",value:String(t.token||""),onChange:s=>l("token",s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"useHttps",checked:!!t.useHttps,onChange:s=>l("useHttps",s.target.checked),className:"rounded"}),e.jsx(i,{htmlFor:"useHttps",children:"Use HTTPS"})]})]});default:return null}},p=A.reduce((s,n)=>{const d=n.category||"Other";return s[d]||(s[d]=[]),s[d].push(n),s},{});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"serviceType",children:"Service Type"}),e.jsxs(z,{id:"serviceType",value:C,onChange:s=>{w(s.target.value),O({}),ee("")},children:[e.jsx("option",{value:"",children:"Select a service..."}),Object.entries(p).map(([s,n])=>e.jsx("optgroup",{label:s,children:n.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))},s))]})]}),C&&e.jsxs(e.Fragment,{children:[G(),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(S,{onClick:P,color:"blue",children:"Generate URL"}),e.jsx(S,{onClick:j,color:"gray",outline:!0,children:"Reset"})]})]}),H&&e.jsxs("div",{className:"mt-4",children:[e.jsx(i,{children:"Generated URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{type:"text",value:H,readOnly:!0,className:"font-mono text-sm"}),e.jsx(S,{onClick:le,color:ne?"success":"gray",size:"sm",children:ne?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-4 h-4 mr-1"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ts,{className:"w-4 h-4 mr-1"}),"Copy"]})}),e.jsx(S,{onClick:()=>{q(!0),Y(""),se(""),W(null),m(!1)},color:"blue",size:"sm",children:"Save Service"})]}),e.jsx($,{color:"info",className:"mt-2",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Note:"})," You can save this service to the database for easier management, or copy it to store in secrets.yaml."]})})]}),e.jsxs(T,{show:he,onClose:()=>q(!1),children:[e.jsx(T.Header,{children:"Save Apprise Service"}),e.jsx(T.Body,{children:e.jsxs("div",{className:"space-y-4",children:[X&&e.jsx($,{color:"failure",children:X}),ie&&e.jsx($,{color:"success",children:"Service saved successfully!"}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"saveName",value:"Service Name *"}),e.jsx(c,{id:"saveName",value:K,onChange:s=>Y(s.target.value),placeholder:"e.g., Discord Notifications",required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"saveDescription",value:"Description (optional)"}),e.jsx(be,{id:"saveDescription",value:J,onChange:s=>se(s.target.value),placeholder:"Optional description for this service",rows:3,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"saveUrl",value:"Service URL"}),e.jsx(c,{id:"saveUrl",readOnly:!0,value:H,className:"mt-1 font-mono text-sm"})]})]})}),e.jsxs(T.Footer,{children:[e.jsx(S,{color:"blue",onClick:async()=>{if(!K.trim()){W("Service name is required");return}B(!0),W(null),m(!1);try{await _.createAppriseService({name:K.trim(),description:J.trim()||null,url:H}),m(!0),setTimeout(()=>{q(!1),Y(""),se(""),m(!1),F&&F()},1500)}catch(s){W(s.response?.data?.detail||s.message||"Failed to save service")}finally{B(!1)}},disabled:V||!K.trim(),children:V?"Saving...":"Save"}),e.jsx(S,{color:"gray",onClick:()=>q(!1),children:"Cancel"})]})]})]})}function ms(F){return{homeAssistant:"Home Assistant",telegram:"Telegram",discord:"Discord",slack:"Slack",email:"Email",ntfy:"ntfy"}[F]||F.charAt(0).toUpperCase()+F.slice(1)}function Ie(F){return Object.entries(F.services||{}).filter(([C,w])=>w.enable===!0).map(([C,w])=>({id:C,name:ms(C),description:null,enabled:w.enable,originalName:C}))}const Se="{{ parameter_name }} is {{ current_value }} ({{ current_level | upper }})",fe={name:"",enabled:!0,parameter_type:"",parameter_config:{},threshold_info:"",threshold_warning:"",threshold_failure:"",comparison_operator:"gt",duration_seconds:60,cooldown_seconds:300,apprise_service_indices:[],message_template:Se},us=[{id:"cpu",label:"CPU Usage",paramType:"cpu_percent"},{id:"memory",label:"Memory Usage",paramType:"memory_percent"},{id:"load",label:"Load Average",subOptions:["1m","5m","15m"]},{id:"bandwidth",label:"Bandwidth Usage",requiresSubSelection:!0},{id:"temperature",label:"Temperature",requiresSubSelection:!0},{id:"service",label:"Service Status",requiresSubSelection:!0},{id:"speedtest",label:"Speedtest",subOptions:["download","upload","ping"]}],He=(F,C)=>{switch(F){case"cpu":return"cpu_percent";case"memory":return"memory_percent";case"load":{const w=C.loadPeriod;return w==="1m"?"load_avg_1m":w==="5m"?"load_avg_5m":w==="15m"?"load_avg_15m":"load_avg_1m"}case"bandwidth":{const w=C.bandwidthDirection;return w==="download"?"interface_rx_bytes":w==="upload"?"interface_tx_bytes":"interface_rx_bytes"}case"temperature":return"temperature_c";case"service":return"service_status";case"speedtest":{const w=C.speedtestType;return w==="download"?"speedtest_download":w==="upload"?"speedtest_upload":w==="ping"?"speedtest_ping":"speedtest_download"}default:return""}};function ys(){const F=localStorage.getItem("access_token"),C=localStorage.getItem("username")||"Unknown",{connectionStatus:w}=cs(F),t=ls(),[O,H]=x.useState([]),[ee,ne]=x.useState([]),[R,he]=x.useState([]),[q,K]=x.useState(!0),[Y,J]=x.useState(null),[se,V]=x.useState(!1),[B,X]=x.useState({open:!1,items:[],ruleName:""}),[W,ie]=x.useState(!1),[m,f]=x.useState(fe),[oe,A]=x.useState(null),[g,P]=x.useState(null),[le,l]=x.useState(null),[j,G]=x.useState(0),[p,s]=x.useState(null),[n,d]=x.useState({}),[u,v]=x.useState(null),[k,I]=x.useState(!1),[E,te]=x.useState([]),[Ae,ke]=x.useState(!1),[Pe,pe]=x.useState(!1),[L,we]=x.useState(""),[me,Ne]=x.useState(""),[ue,Ce]=x.useState("info"),[_e,Te]=x.useState(!1),[ce,ae]=x.useState(null),[Ee,de]=x.useState(new Set),[De,U]=x.useState(new Map);x.useEffect(()=>{(async()=>{try{K(!0);const[o,r,h]=await Promise.all([_.getNotificationRules(),_.getNotificationParameters(),_.getAppriseConfig()]);H(o),ne(r);const b=Ie(h);he(b)}catch(o){J(o?.response?.data?.detail||o.message||"Failed to load notifications")}finally{K(!1)}})(),$e()},[]);const $e=async()=>{try{const a=await _.getAppriseStatus();ke(a.enabled);const o=await _.getAppriseConfig(),r=Ie(o);te(r)}catch{ke(!1)}},Z=()=>{let a=5;return p&&((p==="load"||p==="speedtest")&&(a+=1),p==="bandwidth"&&(a+=2),p==="temperature"&&(a+=1),p==="service"&&(a+=2)),a},xe=a=>{if(a===0)return p!==null;if(!p)return!1;let o=0;if(p==="load"||p==="speedtest"||p==="temperature"?o=1:(p==="bandwidth"||p==="service")&&(o=2),a===1&&o>=1){if(p==="load")return n.loadPeriod!==void 0;if(p==="speedtest")return n.speedtestType!==void 0;if(p==="bandwidth")return n.bandwidthInterface!==void 0&&n.bandwidthInterface!=="";if(p==="temperature")return n.temperatureSensor!==void 0&&n.temperatureSensor!=="";if(p==="service")return n.serviceName!==void 0&&n.serviceName!==""}if(a===2&&o===2){if(p==="bandwidth")return n.bandwidthDirection!==void 0;if(p==="service")return n.serviceStateType!==void 0}const r=o+1;if(a===r)return m.threshold_info!==""||m.threshold_warning!==""||m.threshold_failure!=="";const h=r+1;if(a===h)return m.apprise_service_indices.length>0&&m.duration_seconds>0&&m.cooldown_seconds>=0;const b=h+1;return a===b?m.name.trim()!==""&&m.message_template.trim()!=="":!0},Ue=()=>{f(fe),A(null),P(null),l(null),G(0),s(null),d({}),v(null),V(!0)},Me=async()=>{await _.logout(),t("/login")},Oe=(a,o,r,h)=>{const b={};let N="";if(a==="cpu_percent")N="cpu";else if(a==="memory_percent")N="memory";else if(a.startsWith("load_avg_")){N="load";const M=a.replace("load_avg_","");b.loadPeriod=M==="1m"?"1m":M==="5m"?"5m":"15m"}else if(a==="interface_rx_bytes"||a==="interface_tx_bytes")N="bandwidth",b.bandwidthInterface=o.interface||"",b.bandwidthDirection=a==="interface_rx_bytes"?"download":"upload";else if(a==="temperature_c")N="temperature",b.temperatureSensor=o.sensor_name||"";else if(a==="service_status")N="service",b.serviceName=o.service_name||"",r==="gt"&&h&&Number(h)>0?b.serviceStateType="up":r==="lt"&&h&&Number(h)<1?b.serviceStateType="down":b.serviceStateType="change";else if(a.startsWith("speedtest_")){N="speedtest";const M=a.replace("speedtest_","");b.speedtestType=M}return{category:N,subSelection:b}},Re=a=>{const{category:o,subSelection:r}=Oe(a.parameter_type,a.parameter_config||{},a.comparison_operator,a.threshold_failure);f({id:a.id,name:a.name,enabled:a.enabled,parameter_type:a.parameter_type,parameter_config:Object.fromEntries(Object.entries(a.parameter_config||{}).map(([h,b])=>[h,String(b??"")])),threshold_info:a.threshold_info!==null&&a.threshold_info!==void 0?String(a.threshold_info):"",threshold_warning:a.threshold_warning!==null&&a.threshold_warning!==void 0?String(a.threshold_warning):"",threshold_failure:a.threshold_failure!==null&&a.threshold_failure!==void 0?String(a.threshold_failure):"",comparison_operator:a.comparison_operator,duration_seconds:a.duration_seconds,cooldown_seconds:a.cooldown_seconds,apprise_service_indices:[...a.apprise_service_indices||[]],message_template:a.message_template||Se}),G(0),s(o),d(r),v(null),A(null),P(null),l(null),V(!0)},ge=()=>{V(!1),f(fe),A(null),P(null),l(null),G(0),s(null),d({}),v(null)},Ke=()=>{if(xe(j)){if(p&&(j===0&&(p==="cpu"||p==="memory")||j>=1&&(p==="load"||p==="speedtest"||p==="temperature"||p==="bandwidth"&&j>=2||p==="service"&&j>=2))){const o=He(p,n);if(o){f(h=>({...h,parameter_type:o}));const r={};p==="bandwidth"&&n.bandwidthInterface&&(r.interface=n.bandwidthInterface),p==="temperature"&&n.temperatureSensor&&(r.sensor_name=n.temperatureSensor),p==="service"&&n.serviceName&&(r.service_name=n.serviceName,n.serviceStateType==="up"?f(h=>({...h,comparison_operator:"gt",threshold_failure:"1",threshold_warning:"",threshold_info:""})):n.serviceStateType==="down"&&f(h=>({...h,comparison_operator:"lt",threshold_failure:"0",threshold_warning:"",threshold_info:""}))),Object.keys(r).length>0&&f(h=>({...h,parameter_config:r}))}}const a=Z();j<a-1&&G(j+1)}},Be=()=>{j>0&&G(j-1)},D=(a,o)=>{f(r=>({...r,[a]:o}))},We=a=>{const o=E.findIndex(r=>r.originalName===a);o!==-1&&f(r=>{const b=r.apprise_service_indices.includes(o)?r.apprise_service_indices.filter(N=>N!==o):[...r.apprise_service_indices,o].sort((N,M)=>N-M);return{...r,apprise_service_indices:b}})},ve=a=>{if(a===""||a===null||a===void 0)return;const o=Number(a);return Number.isNaN(o)?void 0:o},je=async()=>{const a=await _.getNotificationRules();H(a)},Ge=async()=>{if(A(null),P(null),!m.parameter_type&&p){const o=He(p,n);if(o){f(h=>({...h,parameter_type:o}));const r={};p==="bandwidth"&&n.bandwidthInterface&&(r.interface=n.bandwidthInterface),p==="temperature"&&n.temperatureSensor&&(r.sensor_name=n.temperatureSensor),p==="service"&&n.serviceName&&(r.service_name=n.serviceName),Object.keys(r).length>0&&f(h=>({...h,parameter_config:r}))}}if(!m.parameter_type){A("Please select a parameter to monitor.");return}const a={name:m.name,enabled:m.enabled,parameter_type:m.parameter_type,parameter_config:m.parameter_config,threshold_info:ve(m.threshold_info),threshold_warning:ve(m.threshold_warning),threshold_failure:ve(m.threshold_failure),comparison_operator:m.comparison_operator,duration_seconds:m.duration_seconds,cooldown_seconds:m.cooldown_seconds,apprise_service_indices:m.apprise_service_indices,message_template:m.message_template||Se};try{m.id?(await _.updateNotificationRule(m.id,a),P("Notification rule updated.")):(await _.createNotificationRule(a),P("Notification rule created.")),await je(),setTimeout(ge,600)}catch(o){A(o?.response?.data?.detail||o.message||"Failed to save notification rule")}},Le=async a=>{await _.updateNotificationRule(a.id,{enabled:!a.enabled}),await je()},ze=async a=>{window.confirm(`Delete notification "${a.name}"? This cannot be undone.`)&&(await _.deleteNotificationRule(a.id),await je())},qe=async a=>{l(null);try{const o=await _.testNotificationRule(a.id);o.success?l(`Test sent (${o.level.toUpperCase()}): ${o.message}`):l(o.error||"Test failed to send")}catch(o){l(o?.response?.data?.detail||o.message||"Test failed")}},Ye=async a=>{try{const o=await _.getNotificationHistory(a.id);X({open:!0,items:o.items,ruleName:a.name})}catch(o){J(o?.response?.data?.detail||o.message||"Failed to load history")}},Fe=a=>a?new Date(a).toLocaleString():"—",Je=async()=>{if(!L.trim()){ae({success:!1,message:"Message body is required"});return}Te(!0),ae(null);try{const a=await _.sendAppriseNotification(L,me||void 0,ue||void 0);ae(a),a.success&&(we(""),Ne(""),Ce("info"))}catch(a){ae({success:!1,message:a.response?.data?.detail||a.message||"Failed to send notification"})}finally{Te(!1)}},Ve=async a=>{if(!L.trim()){U(o=>new Map(o).set(a,{success:!1,message:"Message body is required"}));return}de(o=>new Set(o).add(a)),U(o=>{const r=new Map(o);return r.delete(a),r});try{const o=await _.sendAppriseNotification(L,me||void 0,ue||void 0);if(U(r=>new Map(r).set(a,o)),!o.success){const r=o.details?`${o.message}: ${o.details}`:o.message;U(h=>new Map(h).set(a,{success:!1,message:r,details:o.details}))}}catch(o){const r=o.response?.data?.detail||o.message||"Failed to send notification";U(h=>new Map(h).set(a,{success:!1,message:r}))}finally{de(o=>{const r=new Set(o);return r.delete(a),r})}},Xe=async a=>{de(o=>new Set(o).add(a));try{const o=await _.testAppriseServiceByName(a);U(r=>new Map(r).set(a,o)),o.success||U(r=>new Map(r).set(a,{success:!1,message:o.message,details:o.details}))}catch(o){U(r=>new Map(r).set(a,{success:!1,message:o.response?.data?.detail||o.message}))}finally{de(o=>{const r=new Set(o);return r.delete(a),r})}},Ze=["br0","br1","ppp0","eth0","eth1","wlan0"],Qe=["dnsmasq-homelab","dnsmasq-lan","pppd-eno1","linode-dyndns","nginx","router-webui-backend","postgresql","speedtest"],es=()=>{const a=Z();if(j===0)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Select Parameter Type"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Choose what you want to monitor for notifications"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:us.map(r=>e.jsx(Q,{className:`cursor-pointer transition-all ${p===r.id?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/20":"hover:bg-gray-50 dark:hover:bg-gray-800"}`,onClick:()=>s(r.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:r.label}),p===r.id&&e.jsx(ye,{className:"w-5 h-5 text-blue-500"})]})},r.id))})]});if(j===1&&(p==="load"||p==="speedtest")){const r=p==="load"?["1m","5m","15m"]:["download","upload","ping"],h=p==="load"?"loadPeriod":"speedtestType",b=p==="load"?{"1m":"1 Minute","5m":"5 Minutes","15m":"15 Minutes"}:{download:"Download",upload:"Upload",ping:"Ping"};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:p==="load"?"Select Load Average Period":"Select Speedtest Metric"}),e.jsx("div",{className:"space-y-2",children:r.map(N=>e.jsxs("label",{className:`flex items-center gap-3 p-4 border rounded-lg cursor-pointer transition-all ${n[h]===N?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[e.jsx("input",{type:"radio",name:h,value:N,checked:n[h]===N,onChange:M=>d(ss=>({...ss,[h]:M.target.value})),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:b[N]||N})]},N))})]})}if(j===1&&p==="bandwidth")return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Select Network Interface"}),e.jsxs(z,{value:n.bandwidthInterface||"",onChange:r=>d(h=>({...h,bandwidthInterface:r.target.value})),children:[e.jsx("option",{value:"",children:"Select interface..."}),Ze.map(r=>e.jsx("option",{value:r,children:r},r))]})]});if(j===2&&p==="bandwidth")return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Select Direction"}),e.jsx("div",{className:"space-y-2",children:["download","upload"].map(r=>e.jsxs("label",{className:`flex items-center gap-3 p-4 border rounded-lg cursor-pointer transition-all ${n.bandwidthDirection===r?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[e.jsx("input",{type:"radio",name:"bandwidthDirection",value:r,checked:n.bandwidthDirection===r,onChange:h=>d(b=>({...b,bandwidthDirection:h.target.value})),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium capitalize",children:r})]},r))})]});if(j===1&&p==="temperature")return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Select Temperature Sensor"}),e.jsx(c,{value:n.temperatureSensor||"",onChange:r=>d(h=>({...h,temperatureSensor:r.target.value})),placeholder:"e.g., cpu_thermal, nvme0"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Enter the sensor name to monitor"})]});if(j===1&&p==="service")return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Select Service"}),e.jsxs(z,{value:n.serviceName||"",onChange:r=>d(h=>({...h,serviceName:r.target.value})),children:[e.jsx("option",{value:"",children:"Select service..."}),Qe.map(r=>e.jsx("option",{value:r,children:r},r))]})]});if(j===2&&p==="service")return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Select Notification Trigger"}),e.jsx("div",{className:"space-y-2",children:[{value:"change",label:"Change of State",desc:"Notify on any state change"},{value:"up",label:"Service Up",desc:"Notify when service becomes active"},{value:"down",label:"Service Down",desc:"Notify when service becomes inactive or fails"}].map(r=>e.jsxs("label",{className:`flex items-start gap-3 p-4 border rounded-lg cursor-pointer transition-all ${n.serviceStateType===r.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[e.jsx("input",{type:"radio",name:"serviceStateType",value:r.value,checked:n.serviceStateType===r.value,onChange:h=>d(b=>({...b,serviceStateType:h.target.value})),className:"w-4 h-4 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium block",children:r.label}),e.jsx("span",{className:"text-xs text-gray-500",children:r.desc})]})]},r.value))})]});let o=1;if(p==="load"||p==="speedtest"||p==="temperature"?o=2:(p==="bandwidth"||p==="service")&&(o=3),j===o)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Set Thresholds"}),e.jsxs("div",{children:[e.jsx(i,{value:"Comparison Operator"}),e.jsxs(z,{value:m.comparison_operator,onChange:r=>D("comparison_operator",r.target.value),children:[e.jsx("option",{value:"gt",children:"Greater than (>=)"}),e.jsx("option",{value:"lt",children:"Less than (<=)"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(i,{value:"Info threshold (optional)"}),e.jsx(c,{type:"number",value:m.threshold_info,onChange:r=>D("threshold_info",r.target.value),placeholder:"Optional"})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Warning threshold (optional)"}),e.jsx(c,{type:"number",value:m.threshold_warning,onChange:r=>D("threshold_warning",r.target.value),placeholder:"Optional"})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Failure threshold (optional)"}),e.jsx(c,{type:"number",value:m.threshold_failure,onChange:r=>D("threshold_failure",r.target.value),placeholder:"Optional"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"At least one threshold must be set. Lower severity thresholds are checked first."})]});if(j===o+1)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Timing and Notification Services"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(i,{value:"Duration (seconds)"}),e.jsx(c,{type:"number",min:5,value:m.duration_seconds,onChange:r=>D("duration_seconds",Number(r.target.value))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How long the condition must persist"})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Cooldown (seconds)"}),e.jsx(c,{type:"number",min:0,value:m.cooldown_seconds,onChange:r=>D("cooldown_seconds",Number(r.target.value))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Wait time between notifications"})]})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Notification Services"}),R.length===0?e.jsx("p",{className:"text-xs text-gray-500",children:"No Apprise services configured."}):e.jsx("div",{className:"grid gap-2 md:grid-cols-2 mt-2",children:R.map((r,h)=>e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(is,{checked:m.apprise_service_indices.includes(h),onChange:()=>We(r.originalName)}),e.jsx("span",{className:"font-semibold",children:r.name})]},r.id))})]})]});if(j===o+2){const r=ee.find(h=>h.type===m.parameter_type);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Rule Name and Message Template"}),e.jsxs("div",{children:[e.jsx(i,{value:"Rule Name"}),e.jsx(c,{value:m.name,onChange:h=>D("name",h.target.value),placeholder:"e.g., CPU usage alerts"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{checked:m.enabled,onChange:h=>D("enabled",h)}),e.jsx(i,{value:"Enabled"})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Message Template"}),e.jsx(be,{rows:4,value:m.message_template,onChange:h=>D("message_template",h.target.value)}),r?.variables&&r.variables.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Available variables:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.variables.map(h=>e.jsx(re,{color:"info",className:"text-xs",children:`{{ ${h} }}`},h))})]})]})]})}return j===a-1?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Test Notification (Optional)"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Send a test notification to see what it will look like before creating the rule."}),e.jsx(S,{color:"purple",onClick:async()=>{I(!0),v(null);try{if(m.id&&m.id>0){const r=await _.testNotificationRule(m.id);v({success:r.success,message:r.success?`Test sent (${r.level.toUpperCase()}): ${r.message}`:r.error||"Test failed to send"})}else v({success:!0,message:"Preview: Rule would be created with the current settings. Create the rule to send actual test notifications."})}catch(r){v({success:!1,message:r.response?.data?.detail||r.message||"Failed to send test notification"})}finally{I(!1)}},disabled:k||m.apprise_service_indices.length===0,children:k?"Sending Test...":"Send Test Notification"}),u&&e.jsx($,{color:u.success?"success":"failure",onDismiss:()=>v(null),children:u.message}),e.jsx("p",{className:"text-xs text-gray-500",children:"You can proceed to create the rule without testing, or test first to verify the notification format."})]}):e.jsx("div",{children:"Unknown step"})};return q?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsx(as,{size:"xl"})}):e.jsxs("div",{className:"flex h-screen",children:[e.jsx(ds,{onLogout:Me,isOpen:W,onClose:()=>ie(!1)}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(hs,{hostname:"nixos-router",username:C,connectionStatus:w,onMenuClick:()=>ie(!W)}),e.jsxs("main",{className:"flex-1 overflow-y-auto bg-gray-50 p-6 dark:bg-gray-900",children:[e.jsxs("div",{className:"mx-auto flex max-w-7xl items-center justify-between pb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Notifications"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Automatically send Apprise notifications when monitored metrics cross thresholds."})]}),e.jsx(S,{onClick:Ue,children:"New Rule"})]}),Y&&e.jsx($,{color:"failure",className:"mb-4",onDismiss:()=>J(null),children:Y}),e.jsxs(Q,{className:"mb-6",children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("h2",{className:"text-xl font-semibold",children:"Configured Rules"})}),O.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No notifications configured yet. Click “New Rule” to begin."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(y,{children:[e.jsxs(y.Head,{children:[e.jsx(y.HeadCell,{children:"Name"}),e.jsx(y.HeadCell,{children:"Parameter"}),e.jsx(y.HeadCell,{children:"Thresholds"}),e.jsx(y.HeadCell,{children:"Status"}),e.jsx(y.HeadCell,{children:"Last Notification"}),e.jsx(y.HeadCell,{children:"Actions"})]}),e.jsx(y.Body,{className:"divide-y",children:O.map(a=>e.jsxs(y.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsxs(y.Cell,{children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:a.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:["#",a.id]})]}),e.jsxs(y.Cell,{children:[e.jsx("div",{className:"text-sm font-medium",children:a.parameter_type}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Duration ",a.duration_seconds,"s · Cooldown ",a.cooldown_seconds,"s"]})]}),e.jsx(y.Cell,{children:e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("span",{className:"font-semibold",children:"Info:"})," ",a.threshold_info??"—"," · ",e.jsx("span",{className:"font-semibold",children:"Warn:"})," ",a.threshold_warning??"—"," · ",e.jsx("span",{className:"font-semibold",children:"Fail:"})," ",a.threshold_failure??"—"]})}),e.jsx(y.Cell,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{color:a.enabled?"success":"gray",children:a.enabled?"Enabled":"Disabled"}),a.current_level&&e.jsx(re,{color:a.current_level==="failure"?"failure":"warning",children:a.current_level.toUpperCase()})]})}),e.jsxs(y.Cell,{children:[e.jsx("div",{className:"text-xs text-gray-500",children:Fe(a.last_notification_at)}),e.jsx("div",{className:"text-xs text-gray-400",children:a.last_notification_level??""})]}),e.jsx(y.Cell,{children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(S,{size:"xs",onClick:()=>Re(a),children:"Edit"}),e.jsx(S,{size:"xs",color:"light",onClick:()=>Le(a),children:a.enabled?"Disable":"Enable"}),e.jsx(S,{size:"xs",color:"purple",onClick:()=>qe(a),children:"Test"}),e.jsx(S,{size:"xs",color:"info",onClick:()=>Ye(a),children:"History"}),e.jsx(S,{size:"xs",color:"failure",onClick:()=>ze(a),children:"Delete"})]})})]},a.id))})]})})]}),Ae&&e.jsxs(e.Fragment,{children:[e.jsxs(Q,{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Configured Services (",E.length,")"]}),e.jsx(S,{color:"blue",onClick:()=>pe(!0),children:"New Service"})]}),ce&&e.jsx($,{color:ce.success?"success":"failure",icon:ce.success?ye:rs,className:"mb-4",onDismiss:()=>ae(null),children:ce.message}),E.length===0?e.jsx($,{color:"info",icon:ns,children:'No notification services are configured. Use the "New Service" button to create a service.'}):e.jsxs(y,{children:[e.jsxs(y.Head,{children:[e.jsx(y.HeadCell,{children:"Name"}),e.jsx(y.HeadCell,{children:"Description"}),e.jsx(y.HeadCell,{children:"Status"}),e.jsx(y.HeadCell,{children:"Actions"})]}),e.jsx(y.Body,{className:"divide-y",children:E.map(a=>{const o=a.id||a.id.toString(),r=Ee.has(o),h=De.get(o);return e.jsxs(y.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx(y.Cell,{className:"whitespace-nowrap font-medium text-gray-900 dark:text-white",children:a.name}),e.jsx(y.Cell,{className:"text-gray-500 dark:text-gray-400",children:a.description||"-"}),e.jsx(y.Cell,{children:e.jsx(re,{color:a.enabled?"success":"gray",children:a.enabled?"Enabled":"Disabled"})}),e.jsx(y.Cell,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{size:"xs",color:"blue",onClick:()=>Ve(o),disabled:r||!L.trim()||!a.enabled,children:r?"Sending...":h?.success?"Send Again":"Send"}),e.jsx(S,{size:"xs",color:"gray",onClick:()=>Xe(o),disabled:!a.enabled,children:"Test"})]})})]},a.id)})})]})]}),e.jsxs(Q,{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Send Notification"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"apprise-title",value:"Title (optional)"}),e.jsx(c,{id:"apprise-title",type:"text",placeholder:"Notification title",value:me,onChange:a=>Ne(a.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"apprise-body",value:"Message Body *"}),e.jsx(be,{id:"apprise-body",placeholder:"Enter your notification message...",value:L,onChange:a=>we(a.target.value),rows:4,className:"mt-1",required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"apprise-type",value:"Notification Type"}),e.jsxs(z,{id:"apprise-type",value:ue,onChange:a=>Ce(a.target.value),className:"mt-1",children:[e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"warning",children:"Warning"}),e.jsx("option",{value:"failure",children:"Failure"})]})]}),e.jsx(S,{onClick:Je,disabled:_e||!L.trim(),className:"w-full sm:w-auto",children:_e?"Sending...":"Send to All Services"})]})]}),e.jsxs(Q,{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"How It Works"}),e.jsxs("div",{className:"space-y-3 text-gray-700 dark:text-gray-300",children:[e.jsxs("p",{children:["Apprise is integrated into the NixOS Router WebUI backend, allowing you to send notifications to multiple services configured in ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"router-config.nix"}),"."]}),e.jsx("p",{children:"Notifications can be sent to all configured services simultaneously, or to individual services."}),e.jsx("p",{children:e.jsx("strong",{children:"Notification Types:"})}),e.jsxs("ul",{className:"list-disc list-inside ml-4 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"info"})," - General information (default)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"success"})," - Success messages"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"warning"})," - Warning messages"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"failure"})," - Error/failure messages"]})]})]})]})]})]})]}),e.jsxs(T,{show:se,size:"4xl",onClose:ge,children:[e.jsxs(T.Header,{children:[m.id?"Edit Notification Rule":"Create Notification Rule",e.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:["Step ",j+1," of ",Z()]})]}),e.jsx(T.Body,{children:e.jsxs("div",{className:"space-y-4 max-h-[70vh] overflow-y-auto",children:[oe&&e.jsx($,{color:"failure",onDismiss:()=>A(null),children:oe}),g&&e.jsx($,{color:"success",onDismiss:()=>P(null),children:g}),le&&e.jsx($,{color:"info",onDismiss:()=>l(null),children:le}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex items-center justify-between",children:Array.from({length:Z()}).map((a,o)=>e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold ${o===j?"bg-blue-500 text-white":o<j?"bg-green-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,children:o<j?"✓":o+1}),o<Z()-1&&e.jsx("div",{className:`flex-1 h-1 mx-2 ${o<j?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}`})]},o))})}),es()]})}),e.jsx(T.Footer,{children:e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx(S,{color:"light",onClick:Be,disabled:j===0,children:"Previous"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{color:"light",onClick:ge,children:"Cancel"}),j===Z()-1?e.jsx(S,{onClick:Ge,disabled:!xe(j),children:m.id?"Save Changes":"Create Rule"}):e.jsx(S,{onClick:Ke,disabled:!xe(j),children:"Next"})]})]})})]}),e.jsxs(T,{show:B.open,onClose:()=>X({open:!1,items:[],ruleName:""}),children:[e.jsxs(T.Header,{children:["Notification History · ",B.ruleName]}),e.jsx(T.Body,{children:B.items.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No history recorded."}):e.jsx("div",{className:"space-y-3",children:B.items.map(a=>e.jsxs(Q,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:Fe(a.timestamp)}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Value: ",a.value]})]}),e.jsx(re,{color:a.sent_successfully?"success":"failure",children:a.level.toUpperCase()})]}),a.message&&e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:a.message})]},a.id))})}),e.jsx(T.Footer,{children:e.jsx(S,{color:"light",onClick:()=>X({open:!1,items:[],ruleName:""}),children:"Close"})})]}),e.jsxs(T,{show:Pe,onClose:()=>pe(!1),size:"6xl",children:[e.jsx(T.Header,{children:"Create New Apprise Service"}),e.jsx(T.Body,{className:"max-h-[80vh] overflow-y-auto",children:e.jsx("div",{children:e.jsx(ps,{onServiceSaved:()=>{pe(!1),$e()}})})})]})]})}export{ys as Notifications};
