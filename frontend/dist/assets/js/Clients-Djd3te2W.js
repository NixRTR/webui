import{j as s,a as h,C as re,T as te,H as le,S as M,b as n,c as ne,d as v,B as b}from"./ui-vendor-oyI-GA67.js";import{u as oe,r as m}from"./react-vendor-DKKOAuGG.js";import{u as ie,S as ce,N as de}from"./useMetrics-DBzvUFsd.js";import{a as me}from"./index-BS3QeivW.js";import"./http-vendor-B9ygI19o.js";function fe(){const i=localStorage.getItem("access_token"),U=localStorage.getItem("username")||"Unknown",S=oe(),[f,V]=m.useState(""),[w,J]=m.useState("all"),[N,R]=m.useState("all"),[d,D]=m.useState("all"),[A,j]=m.useState([]),[Y,x]=m.useState([]),[q,p]=m.useState([]),[z,B]=m.useState(!1),[L,G]=m.useState("ip"),[T,$]=m.useState("asc"),{connectionStatus:K}=ie(i),Q=async()=>{await me.logout(),S("/login")};m.useEffect(()=>{const e=async()=>{if(i)try{const a=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${i}`}});if(a.ok){const t=await a.json();j(t)}}catch(a){console.error("Failed to fetch devices:",a)}};e();const r=setInterval(e,1e4);return()=>clearInterval(r)},[i]),m.useEffect(()=>{const e=async()=>{if(i)try{const a=await fetch("/api/devices/blocked",{headers:{Authorization:`Bearer ${i}`}});if(a.ok){const t=await a.json();x(t.ipv4||[]),p((t.macs||[]).map(o=>o.toLowerCase()))}}catch{}};e();const r=setInterval(e,1e4);return()=>clearInterval(r)},[i]);const y=e=>e.mac_address&&q.includes(e.mac_address.toLowerCase())?!0:e.ip_address&&Y.includes(e.ip_address),H=async e=>{if(!i)return;const r=!e.favorite;j(a=>a.map(t=>t.mac_address===e.mac_address?{...t,favorite:r}:t));try{await fetch("/api/devices/override",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({mac_address:e.mac_address,favorite:r})});const a=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${i}`}});a.ok&&j(await a.json())}catch{j(a=>a.map(t=>t.mac_address===e.mac_address?{...t,favorite:!r}:t))}},F=async e=>{if(!i)return;const r=e.nickname||"",a=window.prompt("Set nickname for this device:",r);if(a!==null){j(t=>t.map(o=>o.mac_address===e.mac_address?{...o,nickname:a}:o));try{await fetch("/api/devices/override",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({mac_address:e.mac_address,nickname:a})});const t=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${i}`}});t.ok&&j(await t.json())}catch{}}},I=async e=>{if(!i)return;const r=y(e),a=r?"/api/devices/unblock":"/api/devices/block",t={mac_address:e.mac_address};e.ip_address&&e.ip_address.includes(".")&&(t.ip_address=e.ip_address),r?(e.ip_address&&x(o=>o.filter(l=>l!==e.ip_address)),p(o=>o.filter(l=>l!==e.mac_address.toLowerCase()))):(p(o=>Array.from(new Set([...o,e.mac_address.toLowerCase()]))),t.ip_address&&x(o=>Array.from(new Set([...o,t.ip_address]))));try{if((await fetch(a,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify(t)})).ok){await new Promise(c=>setTimeout(c,100));const l=await fetch("/api/devices/blocked",{headers:{Authorization:`Bearer ${i}`}});if(l.ok){const c=await l.json();x(c.ipv4||[]),p((c.macs||[]).map(k=>k.toLowerCase()))}else console.warn("Failed to refetch blocked list after block/unblock operation")}else r?(e.ip_address&&x(l=>Array.from(new Set([...l,e.ip_address]))),p(l=>Array.from(new Set([...l,e.mac_address.toLowerCase()])))):(e.ip_address&&x(l=>l.filter(c=>c!==e.ip_address)),p(l=>l.filter(c=>c!==e.mac_address.toLowerCase())))}catch{r?(e.ip_address&&x(l=>Array.from(new Set([...l,e.ip_address]))),p(l=>Array.from(new Set([...l,e.mac_address.toLowerCase()])))):(e.ip_address&&x(l=>l.filter(c=>c!==e.ip_address)),p(l=>l.filter(c=>c!==e.mac_address.toLowerCase())))}},W=A.filter(e=>{const r=!f||e.hostname?.toLowerCase().includes(f.toLowerCase())||e.ip_address.includes(f)||e.mac_address.includes(f)||e.vendor?.toLowerCase().includes(f.toLowerCase()),a=w==="all"||w==="online"&&e.is_online||w==="offline"&&!e.is_online,t=N==="all"||N==="dhcp"&&e.is_dhcp||N==="static"&&!e.is_dhcp,o=d==="all"||e.network===d;return r&&a&&t&&o}),O=d==="all"?A:A.filter(e=>e.network===d),X=O.filter(e=>e.is_online).length,Z=O.filter(e=>!e.is_online).length,P=O.length,C=e=>e.split(".").map(r=>r.padStart(3,"0")).join("."),g=e=>{L===e?$(T==="asc"?"desc":"asc"):(G(e),$("asc"))},u=e=>L!==e?null:T==="asc"?" ↑":" ↓",E=e=>e.nickname||e.hostname||"Unknown",_=[...W].sort((e,r)=>{let a=0;switch(L){case"ip":const t=C(e.ip_address),o=C(r.ip_address);a=t.localeCompare(o);break;case"device":a=E(e).toLowerCase().localeCompare(E(r).toLowerCase());break;case"mac":a=e.mac_address.localeCompare(r.mac_address);break;case"vendor":const l=e.vendor||"￿",c=r.vendor||"￿";a=l.toLowerCase().localeCompare(c.toLowerCase());break;case"network":a=e.network.localeCompare(r.network);break;case"status":a=(r.is_online?1:0)-(e.is_online?1:0);break;case"type":a=(r.is_dhcp?1:0)-(e.is_dhcp?1:0);break;case"lastSeen":const k=new Date(e.last_seen).getTime(),ae=new Date(r.last_seen).getTime();a=k-ae;break;default:a=C(e.ip_address).localeCompare(C(r.ip_address))}return T==="asc"?a:-a}),ee=e=>{const r=new Date(e),a=new Date,t=new Date(a.getFullYear(),a.getMonth(),a.getDate());if(new Date(r.getFullYear(),r.getMonth(),r.getDate()).getTime()===t.getTime())return r.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});{const l=(r.getMonth()+1).toString().padStart(2,"0"),c=r.getDate().toString().padStart(2,"0"),k=r.getFullYear().toString().slice(-2);return`${l}/${c}/${k}`}},se=({text:e,maxLength:r=20})=>e.length<=r?s.jsx("span",{children:e}):s.jsx(v,{content:e,placement:"top",children:s.jsx("span",{className:"cursor-help truncate block max-w-[200px]",children:e})});return s.jsxs("div",{className:"flex h-screen",children:[s.jsx(ce,{onLogout:Q,isOpen:z,onClose:()=>B(!1)}),s.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[s.jsx(de,{hostname:"nixos-router",username:U,connectionStatus:K,onMenuClick:()=>B(!z)}),s.jsxs("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 bg-gray-50 dark:bg-gray-900",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4 md:mb-6 gap-3",children:[s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Devices"}),s.jsxs("p",{className:"text-xs md:text-sm text-gray-500",children:["Showing ",_.length," of ",P," devices",d!=="all"&&` (${d.toUpperCase()} network)`,s.jsxs("span",{className:"hidden sm:inline",children:[" • ","Auto-refreshing every 10 seconds"]})]})]}),s.jsxs("div",{className:"flex gap-2 md:gap-4",children:[s.jsxs(h,{color:"success",size:"sm",className:"md:text-base",children:[X," Online"]}),s.jsxs(h,{color:"gray",size:"sm",className:"md:text-base",children:[Z," Offline"]}),s.jsxs(h,{color:"info",size:"sm",className:"md:text-base",children:[P," Total"]})]})]}),s.jsxs(re,{children:[s.jsxs("div",{className:"min-[1000px]:sticky min-[1000px]:top-0 min-[1000px]:z-20 min-[1000px]:bg-white min-[1000px]:dark:bg-gray-800",children:[s.jsx("div",{className:"mb-4 border-b border-gray-200 dark:border-gray-700",children:s.jsxs("div",{className:"flex space-x-1",role:"tablist",children:[s.jsx("button",{role:"tab","aria-selected":d==="all",onClick:()=>D("all"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${d==="all"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"All Networks"}),s.jsx("button",{role:"tab","aria-selected":d==="homelab",onClick:()=>D("homelab"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${d==="homelab"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"HOMELAB"}),s.jsx("button",{role:"tab","aria-selected":d==="lan",onClick:()=>D("lan"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${d==="lan"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"LAN"})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[s.jsx("div",{children:s.jsx(te,{icon:le,placeholder:"Search...",value:f,onChange:e=>V(e.target.value)})}),s.jsx("div",{children:s.jsxs(M,{value:w,onChange:e=>J(e.target.value),children:[s.jsx("option",{value:"all",children:"All Status"}),s.jsx("option",{value:"online",children:"Online Only"}),s.jsx("option",{value:"offline",children:"Offline Only"})]})}),s.jsx("div",{children:s.jsxs(M,{value:N,onChange:e=>R(e.target.value),children:[s.jsx("option",{value:"all",children:"All Types"}),s.jsx("option",{value:"dhcp",children:"DHCP Only"}),s.jsx("option",{value:"static",children:"Static Only"})]})})]})]}),s.jsxs("div",{className:"xl-custom:hidden mb-4 flex flex-wrap gap-4 text-xs text-gray-600 dark:text-gray-400",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-semibold",children:"Network:"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),s.jsx("span",{children:"HOMELAB"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:"w-3 h-3 rounded-full bg-purple-500"}),s.jsx("span",{children:"LAN"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-semibold",children:"Type:"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-500"}),s.jsx("span",{children:"Static"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),s.jsx("span",{children:"DHCP"})]})]})]}),s.jsx("div",{className:"hidden min-[1000px]:block overflow-x-auto",children:s.jsxs(n,{children:[s.jsxs(n.Head,{children:[s.jsxs(n.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>g("ip"),children:["IP Address",u("ip")]}),s.jsxs(n.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>g("device"),children:["Device",u("device")]}),s.jsxs(n.HeadCell,{className:"hidden lg:table-cell cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>g("mac"),children:["MAC Address",u("mac")]}),s.jsxs(n.HeadCell,{className:"hidden xl:table-cell cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>g("vendor"),children:["Vendor",u("vendor")]}),s.jsxs(n.HeadCell,{className:"w-12 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>g("network"),children:["Network",u("network")]}),s.jsxs(n.HeadCell,{className:"w-12 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>g("status"),children:["Status",u("status")]}),s.jsxs(n.HeadCell,{className:"w-12 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>g("type"),children:["Type",u("type")]}),s.jsxs(n.HeadCell,{className:"w-24 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>g("lastSeen"),children:["Last Seen",u("lastSeen")]}),s.jsx(n.HeadCell,{children:"Actions"})]}),s.jsx(n.Body,{className:"divide-y",children:_.map(e=>s.jsxs(n.Row,{className:e.is_online?"":"opacity-50",children:[s.jsx(n.Cell,{className:"font-mono text-sm",children:e.ip_address}),s.jsx(n.Cell,{className:"font-medium max-w-[200px]",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{className:"text-yellow-500 hover:text-yellow-400 flex-shrink-0",title:e.favorite?"Unfavorite":"Favorite",onClick:()=>H(e),children:e.favorite?"★":"☆"}),s.jsx("button",{className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 flex-shrink-0",title:"Edit nickname",onClick:()=>F(e),children:s.jsx(ne,{className:"w-4 h-4"})}),s.jsx(se,{text:e.nickname||e.hostname||"Unknown",maxLength:20})]})}),s.jsx(n.Cell,{className:"font-mono text-sm hidden lg:table-cell",children:e.mac_address}),s.jsx(n.Cell,{className:"text-sm text-gray-600 hidden xl:table-cell",children:e.vendor||"—"}),s.jsxs(n.Cell,{children:[s.jsx("div",{className:"hidden xl-custom:block",children:s.jsx(h,{color:e.network==="homelab"?"info":"purple",size:"sm",children:e.network.toUpperCase()})}),s.jsx("div",{className:"xl-custom:hidden",children:s.jsx(v,{content:e.network.toUpperCase(),placement:"top",children:s.jsx("div",{className:`w-3 h-3 rounded-full ${e.network==="homelab"?"bg-blue-500":"bg-purple-500"}`})})})]}),s.jsxs(n.Cell,{children:[s.jsx("div",{className:"hidden xl-custom:block",children:s.jsx(h,{color:e.is_online?"success":"gray",size:"sm",children:e.is_online?"ONLINE":"OFFLINE"})}),s.jsx("div",{className:"xl-custom:hidden",children:s.jsx(v,{content:e.is_online?"Online":"Offline",placement:"top",children:s.jsx("div",{className:`w-3 h-3 rounded-full ${e.is_online?"bg-green-500":"bg-gray-400"}`})})})]}),s.jsxs(n.Cell,{children:[s.jsx("div",{className:"hidden xl-custom:block",children:s.jsx(h,{color:e.is_dhcp?"warning":"gray",size:"sm",children:e.is_dhcp?"DHCP":"Static"})}),s.jsx("div",{className:"xl-custom:hidden",children:s.jsx(v,{content:e.is_dhcp?"DHCP":"Static",placement:"top",children:s.jsx("div",{className:`w-3 h-3 rounded-full ${e.is_dhcp?"bg-yellow-500":"bg-gray-500"}`})})})]}),s.jsx(n.Cell,{className:"text-sm whitespace-nowrap",children:ee(e.last_seen)}),s.jsx(n.Cell,{children:s.jsxs("div",{className:"flex gap-1 flex-wrap",children:[s.jsx(b,{size:"xs",color:"gray",onClick:()=>S(`/devices/${e.ip_address}`),children:"Details"}),s.jsx(b,{size:"xs",color:y(e)?"success":"failure",onClick:()=>I(e),children:y(e)?"Enable":"Disable"})]})})]},e.mac_address))})]})}),s.jsx("div",{className:"min-[1000px]:hidden space-y-3",children:_.map(e=>s.jsxs("div",{className:`p-4 rounded-lg border ${e.is_online?"bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700":"bg-gray-50 border-gray-200 dark:bg-gray-900 dark:border-gray-700 opacity-60"}`,children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-semibold text-lg mb-1",children:e.hostname||"Unknown"}),s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.ip_address})]}),s.jsx(h,{color:e.is_online?"success":"gray",size:"sm",children:e.is_online?"● Online":"○ Offline"})]}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500",children:"MAC:"}),s.jsx("span",{className:"font-mono",children:e.mac_address})]}),e.vendor&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500",children:"Vendor:"}),s.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:e.vendor})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-500",children:"Network:"}),s.jsx(h,{color:e.network==="homelab"?"info":"purple",size:"sm",children:e.network.toUpperCase()})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-500",children:"Nickname:"}),s.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:e.nickname||"—"})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-500",children:"Type:"}),s.jsx(h,{color:e.is_dhcp?e.is_static?"success":"warning":"gray",size:"sm",children:e.is_static?"Static DHCP":e.is_dhcp?"Dynamic":"Static IP"})]}),s.jsxs("div",{className:"flex justify-between text-xs text-gray-500 pt-1 border-t border-gray-200 dark:border-gray-700",children:[s.jsx("span",{children:"Last seen:"}),s.jsx("span",{children:new Date(e.last_seen).toLocaleString()})]}),s.jsxs("div",{className:"pt-3",children:[s.jsxs("div",{className:"flex gap-2 mb-2",children:[s.jsx(b,{size:"xs",color:"gray",onClick:()=>S(`/devices/${e.ip_address}`),className:"flex-1",children:"Details"}),s.jsx(b,{size:"xs",color:y(e)?"success":"failure",onClick:()=>I(e),className:"flex-1",children:y(e)?"Enable":"Disable"})]}),s.jsxs("div",{className:"mt-2 flex gap-2",children:[s.jsx(b,{size:"xs",color:"light",className:"flex-1",onClick:()=>F(e),children:"Edit Nickname"}),s.jsx(b,{size:"xs",color:e.favorite?"warning":"light",onClick:()=>H(e),children:e.favorite?"★ Favorite":"☆ Favorite"})]})]})]})]},e.mac_address))}),_.length===0&&s.jsx("div",{className:"text-center py-8 text-gray-500",children:"No devices found matching your filters"})]})]})]})]})}export{fe as Clients};
