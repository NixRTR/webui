import{j as e,a as p,C as _e,T as Ce,H as ve,S as ae,b as r,c as Se,d as b,B as x,M as Y,e as De}from"./ui-vendor-B64yKeUt.js";import{u as Le,a as i}from"./react-vendor-4URc7N9U.js";import{u as Pe,S as He,N as ze}from"./useMetrics-CxenEB0U.js";import{a as v}from"./index-q3DjzbF8.js";import{H as Te}from"./HostnameEditModal-HFzpYXP-.js";import"./http-vendor-B9ygI19o.js";function Ee(){const d=localStorage.getItem("access_token"),te=localStorage.getItem("username")||"Unknown",N=Le(),[k,re]=i.useState(""),[S,le]=i.useState("all"),[D,ne]=i.useState("all"),[h,B]=i.useState("all"),[L,_]=i.useState([]),[oe,u]=i.useState([]),[ce,f]=i.useState([]),[J,q]=i.useState(!1),[$,ie]=i.useState("ip"),[F,G]=i.useState("asc"),[de,P]=i.useState(!1),[c,E]=i.useState(null),[H,I]=i.useState(null),[xe,U]=i.useState(new Map),[me,z]=i.useState(!1),[w,K]=i.useState(null),[he,pe]=i.useState([]),{connectionStatus:ge}=Pe(d);i.useEffect(()=>{d&&v.getDhcpNetworks().then(pe).catch(()=>{})},[d]);const ue=async()=>{await v.logout(),N("/login")},Q=async s=>{if(d)try{z(!0),I(s);const a=await v.getDevicePortScan(s);E(a),U(t=>new Map(t).set(s.toLowerCase(),a.scan_status)),P(!0)}catch(a){a.response?.status===404?(I(s),E(null),P(!0)):(console.error("Failed to fetch port scan:",a),alert("Failed to load port scan results"))}finally{z(!1)}},T=async s=>{if(d)try{z(!0);const a=await v.triggerDevicePortScan(s);a.status==="queued"||a.status==="in_progress"?(U(t=>new Map(t).set(s.toLowerCase(),"pending")),setTimeout(()=>{Q(s)},2e3)):alert(a.message||"Failed to trigger scan")}catch(a){console.error("Failed to trigger port scan:",a),alert("Failed to trigger port scan")}finally{z(!1)}},W=s=>{const a=s.mac_address.toLowerCase(),t=xe.get(a),n=t==="pending"||t==="in_progress",l=t==="completed",o=t==="failed";return s.is_online?n?e.jsx(b,{content:"Port scan in progress",children:e.jsxs(x,{size:"xs",color:"gray",disabled:!0,children:[e.jsx(De,{className:"w-3 h-3 mr-1"}),"Scanning..."]})}):o?e.jsx(b,{content:"Last scan failed - click to retry",children:e.jsx(x,{size:"xs",color:"failure",onClick:()=>T(s.mac_address),children:"Ports (Failed)"})}):e.jsx(b,{content:l?"View port scan results":"Scan ports",children:e.jsxs(x,{size:"xs",color:"gray",onClick:()=>{l?Q(s.mac_address):T(s.mac_address)},children:["Ports",l&&c?` (${c.ports.length})`:""]})}):e.jsx(b,{content:"Device is offline",children:e.jsx(x,{size:"xs",color:"gray",disabled:!0,children:"Ports"})})};i.useEffect(()=>{const s=async()=>{if(d)try{const t=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${d}`}});if(t.ok){const n=await t.json();_(n);const l=n.filter(g=>g.is_online),o=new Map,m=10;for(let g=0;g<l.length;g+=m){const Ne=l.slice(g,g+m);await Promise.allSettled(Ne.map(async V=>{try{const O=await v.getDevicePortScan(V.mac_address);o.set(V.mac_address.toLowerCase(),O.scan_status)}catch(O){O.response?.status!==404&&console.debug(`Failed to fetch port scan for ${V.mac_address}:`,O)}}))}U(o)}}catch(t){console.error("Failed to fetch devices:",t)}};s();const a=setInterval(s,2e4);return()=>clearInterval(a)},[d]),i.useEffect(()=>{const s=async()=>{if(d)try{const t=await fetch("/api/devices/blocked",{headers:{Authorization:`Bearer ${d}`}});if(t.ok){const n=await t.json();u(n.ipv4||[]),f((n.macs||[]).map(l=>l.toLowerCase()))}}catch{}};s();const a=setInterval(s,2e4);return()=>clearInterval(a)},[d]);const C=s=>s.mac_address&&ce.includes(s.mac_address.toLowerCase())?!0:s.ip_address&&oe.includes(s.ip_address),X=async s=>{if(!d)return;const a=!s.favorite;_(t=>t.map(n=>n.mac_address===s.mac_address?{...n,favorite:a}:n));try{await fetch("/api/devices/override",{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({mac_address:s.mac_address,favorite:a})});const t=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${d}`}});t.ok&&_(await t.json())}catch{_(t=>t.map(n=>n.mac_address===s.mac_address?{...n,favorite:!a}:n))}},Z=s=>{K(s)},fe=async()=>{if(d)try{const s=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${d}`}});s.ok&&_(await s.json())}catch(s){console.error("Failed to refetch devices:",s)}},ee=async s=>{if(!d)return;const a=C(s),t=a?"/api/devices/unblock":"/api/devices/block",n={mac_address:s.mac_address};s.ip_address&&s.ip_address.includes(".")&&(n.ip_address=s.ip_address),a?(s.ip_address&&u(l=>l.filter(o=>o!==s.ip_address)),f(l=>l.filter(o=>o!==s.mac_address.toLowerCase()))):(f(l=>Array.from(new Set([...l,s.mac_address.toLowerCase()]))),n.ip_address&&u(l=>Array.from(new Set([...l,n.ip_address]))));try{if((await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify(n)})).ok){await new Promise(m=>setTimeout(m,100));const o=await fetch("/api/devices/blocked",{headers:{Authorization:`Bearer ${d}`}});if(o.ok){const m=await o.json();u(m.ipv4||[]),f((m.macs||[]).map(g=>g.toLowerCase()))}else console.warn("Failed to refetch blocked list after block/unblock operation")}else a?(s.ip_address&&u(o=>Array.from(new Set([...o,s.ip_address]))),f(o=>Array.from(new Set([...o,s.mac_address.toLowerCase()])))):(s.ip_address&&u(o=>o.filter(m=>m!==s.ip_address)),f(o=>o.filter(m=>m!==s.mac_address.toLowerCase())))}catch{a?(s.ip_address&&u(l=>Array.from(new Set([...l,s.ip_address]))),f(l=>Array.from(new Set([...l,s.mac_address.toLowerCase()])))):(s.ip_address&&u(l=>l.filter(o=>o!==s.ip_address)),f(l=>l.filter(o=>o!==s.mac_address.toLowerCase())))}},je=L.filter(s=>{const a=!k||(s.hostname||"").toLowerCase().includes(k.toLowerCase())||s.ip_address.includes(k)||s.mac_address.includes(k)||s.vendor?.toLowerCase().includes(k.toLowerCase()),t=S==="all"||S==="online"&&s.is_online||S==="offline"&&!s.is_online,n=D==="all"||D==="dhcp"&&s.is_dhcp||D==="static"&&!s.is_dhcp,l=h==="all"||s.network===h;return a&&t&&n&&l}),R=h==="all"?L:L.filter(s=>s.network===h),ye=R.filter(s=>s.is_online).length,be=R.filter(s=>!s.is_online).length,se=R.length,A=s=>s.split(".").map(a=>a.padStart(3,"0")).join("."),j=s=>{$===s?G(F==="asc"?"desc":"asc"):(ie(s),G("asc"))},y=s=>$!==s?null:F==="asc"?" ↑":" ↓",M=[...je].sort((s,a)=>{let t=0;switch($){case"ip":{const n=A(s.ip_address),l=A(a.ip_address);t=n.localeCompare(l);break}case"device":t=(s.hostname||"").toLowerCase().localeCompare((a.hostname||"").toLowerCase());break;case"mac":t=s.mac_address.localeCompare(a.mac_address);break;case"vendor":{const n=s.vendor||"￿",l=a.vendor||"￿";t=n.toLowerCase().localeCompare(l.toLowerCase());break}case"network":t=s.network.localeCompare(a.network);break;case"status":t=(a.is_online?1:0)-(s.is_online?1:0);break;case"type":t=(a.is_dhcp?1:0)-(s.is_dhcp?1:0);break;case"lastSeen":{const n=new Date(s.last_seen).getTime(),l=new Date(a.last_seen).getTime();t=n-l;break}default:t=A(s.ip_address).localeCompare(A(a.ip_address))}return F==="asc"?t:-t}),we=s=>{const a=new Date(s),t=new Date,n=new Date(t.getFullYear(),t.getMonth(),t.getDate());if(new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime()===n.getTime())return a.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});{const o=(a.getMonth()+1).toString().padStart(2,"0"),m=a.getDate().toString().padStart(2,"0"),g=a.getFullYear().toString().slice(-2);return`${o}/${m}/${g}`}},ke=({text:s,maxLength:a=20})=>s.length<=a?e.jsx("span",{children:s}):e.jsx(b,{content:s,placement:"top",children:e.jsx("span",{className:"cursor-help truncate block max-w-[200px]",children:s})});return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(He,{onLogout:ue,isOpen:J,onClose:()=>q(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(ze,{hostname:"nixos-router",username:te,connectionStatus:ge,onMenuClick:()=>q(!J)}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 bg-gray-50 dark:bg-gray-900",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4 md:mb-6 gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Devices"}),e.jsxs("p",{className:"text-xs md:text-sm text-gray-500",children:["Showing ",M.length," of ",se," devices",h!=="all"&&` (${h.toUpperCase()} network)`,e.jsxs("span",{className:"hidden sm:inline",children:[" • ","Auto-refreshing every 20 seconds"]})]})]}),e.jsxs("div",{className:"flex gap-2 md:gap-4",children:[e.jsxs(p,{color:"success",size:"sm",className:"md:text-base",children:[ye," Online"]}),e.jsxs(p,{color:"gray",size:"sm",className:"md:text-base",children:[be," Offline"]}),e.jsxs(p,{color:"info",size:"sm",className:"md:text-base",children:[se," Total"]})]})]}),e.jsxs(_e,{children:[e.jsxs("div",{className:"min-[1000px]:sticky min-[1000px]:top-0 min-[1000px]:z-20 min-[1000px]:bg-white min-[1000px]:dark:bg-gray-800",children:[e.jsx("div",{className:"mb-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex space-x-1",role:"tablist",children:[e.jsx("button",{role:"tab","aria-selected":h==="all",onClick:()=>B("all"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${h==="all"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"All Networks"}),e.jsx("button",{role:"tab","aria-selected":h==="homelab",onClick:()=>B("homelab"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${h==="homelab"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"HOMELAB"}),e.jsx("button",{role:"tab","aria-selected":h==="lan",onClick:()=>B("lan"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${h==="lan"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"LAN"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsx("div",{children:e.jsx(Ce,{icon:ve,placeholder:"Search...",value:k,onChange:s=>re(s.target.value)})}),e.jsx("div",{children:e.jsxs(ae,{value:S,onChange:s=>le(s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"online",children:"Online Only"}),e.jsx("option",{value:"offline",children:"Offline Only"})]})}),e.jsx("div",{children:e.jsxs(ae,{value:D,onChange:s=>ne(s.target.value),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"dhcp",children:"DHCP Only"}),e.jsx("option",{value:"static",children:"Static Only"})]})})]})]}),e.jsxs("div",{className:"xl-custom:hidden mb-4 flex flex-wrap gap-4 text-xs text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Network:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsx("span",{children:"HOMELAB"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-purple-500"}),e.jsx("span",{children:"LAN"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Type:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-500"}),e.jsx("span",{children:"Static"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsx("span",{children:"DHCP"})]})]})]}),e.jsx("div",{className:"hidden min-[1000px]:block overflow-x-auto",children:e.jsxs(r,{children:[e.jsxs(r.Head,{children:[e.jsxs(r.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>j("ip"),children:["IP Address",y("ip")]}),e.jsxs(r.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>j("device"),children:["Device",y("device")]}),e.jsxs(r.HeadCell,{className:"hidden lg:table-cell cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>j("mac"),children:["MAC Address",y("mac")]}),e.jsxs(r.HeadCell,{className:"hidden xl:table-cell cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>j("vendor"),children:["Vendor",y("vendor")]}),e.jsxs(r.HeadCell,{className:"w-12 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>j("network"),children:["Network",y("network")]}),e.jsxs(r.HeadCell,{className:"w-12 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>j("status"),children:["Status",y("status")]}),e.jsxs(r.HeadCell,{className:"w-12 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>j("type"),children:["Type",y("type")]}),e.jsxs(r.HeadCell,{className:"w-24 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>j("lastSeen"),children:["Last Seen",y("lastSeen")]}),e.jsx(r.HeadCell,{children:"Actions"})]}),e.jsx(r.Body,{className:"divide-y",children:M.map(s=>e.jsxs(r.Row,{className:s.is_online?"":"opacity-50",children:[e.jsx(r.Cell,{className:"font-mono text-sm",children:s.ip_address}),e.jsx(r.Cell,{className:"font-medium max-w-[200px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-yellow-500 hover:text-yellow-400 flex-shrink-0",title:s.favorite?"Unfavorite":"Favorite",onClick:()=>X(s),children:s.favorite?"★":"☆"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 flex-shrink-0",title:"Edit hostname",onClick:()=>Z(s),children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsx(ke,{text:s.hostname||"Unknown",maxLength:20})]})}),e.jsx(r.Cell,{className:"font-mono text-sm hidden lg:table-cell",children:s.mac_address}),e.jsx(r.Cell,{className:"text-sm text-gray-600 hidden xl:table-cell",children:s.vendor||"—"}),e.jsxs(r.Cell,{children:[e.jsx("div",{className:"hidden xl-custom:block",children:e.jsx(p,{color:s.network==="homelab"?"info":"purple",size:"sm",children:s.network.toUpperCase()})}),e.jsx("div",{className:"xl-custom:hidden",children:e.jsx(b,{content:s.network.toUpperCase(),placement:"top",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${s.network==="homelab"?"bg-blue-500":"bg-purple-500"}`})})})]}),e.jsxs(r.Cell,{children:[e.jsx("div",{className:"hidden xl-custom:block",children:e.jsx(p,{color:s.is_online?"success":"gray",size:"sm",children:s.is_online?"ONLINE":"OFFLINE"})}),e.jsx("div",{className:"xl-custom:hidden",children:e.jsx(b,{content:s.is_online?"Online":"Offline",placement:"top",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${s.is_online?"bg-green-500":"bg-gray-400"}`})})})]}),e.jsxs(r.Cell,{children:[e.jsx("div",{className:"hidden xl-custom:block",children:e.jsx(p,{color:s.is_dhcp?"warning":"gray",size:"sm",children:s.is_dhcp?"DHCP":"Static"})}),e.jsx("div",{className:"xl-custom:hidden",children:e.jsx(b,{content:s.is_dhcp?"DHCP":"Static",placement:"top",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${s.is_dhcp?"bg-yellow-500":"bg-gray-500"}`})})})]}),e.jsx(r.Cell,{className:"text-sm whitespace-nowrap",children:we(s.last_seen)}),e.jsx(r.Cell,{children:e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[e.jsx(x,{size:"xs",color:"gray",onClick:()=>N(`/devices/by-mac/${s.mac_address}`),children:"Details"}),e.jsx(x,{size:"xs",color:"gray",onClick:()=>N(`/devices/${s.ip_address}`),children:"Usage"}),e.jsx(x,{size:"xs",color:C(s)?"success":"failure",onClick:()=>ee(s),children:C(s)?"Enable":"Disable"}),W(s)]})})]},s.mac_address))})]})}),e.jsx("div",{className:"min-[1000px]:hidden space-y-3",children:M.map(s=>e.jsxs("div",{className:`p-4 rounded-lg border ${s.is_online?"bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700":"bg-gray-50 border-gray-200 dark:bg-gray-900 dark:border-gray-700 opacity-60"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-lg mb-1 text-gray-900 dark:text-white",children:s.hostname||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.ip_address})]}),e.jsx(p,{color:s.is_online?"success":"gray",size:"sm",children:s.is_online?"● Online":"○ Offline"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"MAC:"}),e.jsx("span",{className:"font-mono",children:s.mac_address})]}),s.vendor&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Vendor:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:s.vendor})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Network:"}),e.jsx(p,{color:s.network==="homelab"?"info":"purple",size:"sm",children:s.network.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Hostname:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:s.hostname||"—"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Type:"}),e.jsx(p,{color:s.is_dhcp?s.is_static?"success":"warning":"gray",size:"sm",children:s.is_static?"Static DHCP":s.is_dhcp?"Dynamic":"Static IP"})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 pt-1 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("span",{children:"Last seen:"}),e.jsx("span",{children:new Date(s.last_seen).toLocaleString()})]}),e.jsxs("div",{className:"pt-3",children:[e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(x,{size:"xs",color:"gray",onClick:()=>N(`/devices/by-mac/${s.mac_address}`),className:"flex-1",children:"Details"}),e.jsx(x,{size:"xs",color:"gray",onClick:()=>N(`/devices/${s.ip_address}`),className:"flex-1",children:"Usage"}),e.jsx(x,{size:"xs",color:C(s)?"success":"failure",onClick:()=>ee(s),className:"flex-1",children:C(s)?"Enable":"Disable"})]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(x,{size:"xs",color:"light",className:"flex-1",onClick:()=>Z(s),children:"Edit hostname"}),e.jsx(x,{size:"xs",color:s.favorite?"warning":"light",onClick:()=>X(s),children:s.favorite?"★ Favorite":"☆ Favorite"})]}),e.jsx("div",{className:"mt-2",children:W(s)})]})]})]},s.mac_address))}),M.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No devices found matching your filters"})]}),e.jsxs(Y,{show:de,onClose:()=>{P(!1),E(null),I(null)},size:"xl",children:[e.jsxs(Y.Header,{children:["Port Scan Results",c?e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:[c.mac_address," (",c.ip_address,")"]}):H?e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:H}):null]}),e.jsx(Y.Body,{children:me?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-gray-100"}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"Loading port scan results..."})]}):c?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(p,{color:c.scan_status==="completed"?"success":c.scan_status==="failed"?"failure":c.scan_status==="in_progress"?"warning":"gray",children:c.scan_status.toUpperCase()}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-400",children:["Started: ",new Date(c.scan_started_at).toLocaleString()]}),c.scan_completed_at&&e.jsxs("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-400",children:["Completed: ",new Date(c.scan_completed_at).toLocaleString()]})]}),e.jsx(x,{size:"xs",color:"gray",onClick:()=>{c&&T(c.mac_address)},children:"Refresh Scan"})]}),c.error_message&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded",children:e.jsxs("p",{className:"text-sm text-red-800 dark:text-red-200",children:[e.jsx("strong",{children:"Error:"})," ",c.error_message]})}),c.ports.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(r,{children:[e.jsxs(r.Head,{children:[e.jsx(r.HeadCell,{children:"Port"}),e.jsx(r.HeadCell,{children:"Protocol"}),e.jsx(r.HeadCell,{children:"State"}),e.jsx(r.HeadCell,{children:"Service"}),e.jsx(r.HeadCell,{children:"Version"}),e.jsx(r.HeadCell,{children:"Product"})]}),e.jsx(r.Body,{children:c.ports.map((s,a)=>e.jsxs(r.Row,{children:[e.jsx(r.Cell,{className:"font-mono",children:s.port}),e.jsx(r.Cell,{className:"uppercase",children:s.protocol}),e.jsx(r.Cell,{children:e.jsx(p,{color:s.state==="open"?"success":s.state==="closed"?"gray":s.state==="filtered"?"warning":"gray",size:"sm",children:s.state})}),e.jsx(r.Cell,{children:s.service_name||"—"}),e.jsx(r.Cell,{children:s.service_version||"—"}),e.jsx(r.Cell,{children:s.service_product||"—"})]},a))})]})}):c.scan_status==="completed"?e.jsx("p",{className:"text-center py-4 text-gray-600 dark:text-gray-400",children:"No open ports found"}):e.jsx("p",{className:"text-center py-4 text-gray-600 dark:text-gray-400",children:"Scan in progress or no results yet"})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"No port scan results available for this device."}),H&&e.jsx(x,{color:"gray",onClick:async()=>{const s=L.find(a=>a.mac_address.toLowerCase()===H.toLowerCase()&&a.is_online);s?await T(s.mac_address):P(!1)},children:"Start Port Scan"})]})})]}),w&&e.jsx(Te,{show:!!w,onClose:()=>K(null),currentHostname:w.hostname||"",dynamicDomain:he.find(s=>s.network===w.network)?.dynamic_domain??null,network:w.network,macAddress:w.mac_address,ipAddress:w.ip_address,onSaved:fe})]})]})]})}export{Ee as Clients};
