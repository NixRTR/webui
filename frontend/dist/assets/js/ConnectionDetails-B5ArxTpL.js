import{j as e,C as le,L as x,S as C,T as P,b as t,B,M}from"./ui-vendor-D-qqm1E2.js";import{i as ne,u as ie,r as o,L as de}from"./react-vendor-DKKOAuGG.js";import{u as ce,S as me,N as he}from"./useMetrics-C2INNNRD.js";import{a as I}from"./index-BaCGhgyP.js";import{R as ue,L as xe,C as pe,X as ve,Y as je,T as ge,a as be,b as U}from"./charts-_iF2RbR3.js";import"./http-vendor-B9ygI19o.js";function v(j){return/^(\d+)([mhdwMy])$/.test(j)}function ke({sourcePage:j}){const{ipAddress:l}=ne(),p=localStorage.getItem("access_token"),O=localStorage.getItem("username")||"Unknown",E=ie(),[K,G]=o.useState([]),[F,R]=o.useState(!1),[y,D]=o.useState(!1),[n,W]=o.useState(null),[X,Y]=o.useState([]),[d,q]=o.useState("1h"),[c,T]=o.useState(""),[w,J]=o.useState(5),[N,Q]=o.useState("raw"),[m,V]=o.useState("1h"),[i,L]=o.useState(""),[g,Z]=o.useState(null),[_,$]=o.useState("asc"),ee=s=>["download_mb","download_mbps","upload_mb","upload_mbps"].includes(s),{connectionStatus:se}=ce(p),te=async()=>{await I.logout(),E("/login")},H=async()=>{if(!(!p||!l))try{const s=m==="custom"&&i?i:m;if(m==="custom"&&!v(s))return;const a=await I.getClientConnections(l,s);G(a)}catch(s){console.error("Failed to fetch connections:",s)}};o.useEffect(()=>{H();const s=setInterval(H,5e3);return()=>clearInterval(s)},[p,l,m,i]);const z=async()=>{if(!(!p||!l||!n))try{const s=d==="custom"&&c?c:d;if(d==="custom"&&!v(s))return;const a=await I.getConnectionHistory(l,n.remoteIp,n.remotePort,s,N);Y(a.data||[])}catch(s){console.error("Failed to fetch chart data:",s)}};o.useEffect(()=>{if(y&&n){z();const s=setInterval(z,w*1e3);return()=>clearInterval(s)}},[p,l,n,d,c,N,w,y]);const A=s=>{W({remoteIp:s.remote_ip,remotePort:s.remote_port}),D(!0)},b=s=>{const a=s.split(".");if(a.length===4){const r=a[3].padStart(3,"0");return`${a[0]}.${a[1]}.${a[2]}.${r}`}return s},h=s=>{g===s?$(_==="asc"?"desc":"asc"):(Z(s),$(ee(s)?"desc":"asc"))},k=[...K].sort((s,a)=>{if(!g){const oe=b(s.remote_ip),re=b(a.remote_ip);return oe.localeCompare(re)}let r=0;switch(g){case"ip":r=b(s.remote_ip).localeCompare(b(a.remote_ip));break;case"hostname":r=(s.hostname||"").localeCompare(a.hostname||"");break;case"download_mb":r=s.download_mb-a.download_mb;break;case"download_mbps":r=s.download_mbps-a.download_mbps;break;case"upload_mb":r=s.upload_mb-a.upload_mb;break;case"upload_mbps":r=s.upload_mbps-a.upload_mbps;break;default:return 0}return _==="asc"?r:-r}),u=s=>g!==s?null:_==="asc"?" ↑":" ↓",S=X.map(s=>({time:new Date(s.timestamp).toLocaleTimeString(),download:s.rx_mbps||0,upload:s.tx_mbps||0})),f=s=>s<.01?"0.00":s<1?s.toFixed(2):s<1e3?s.toFixed(1):(s/1024).toFixed(2)+" GB",ae=j==="device-usage"?"Device Usage":"Devices";return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(me,{onLogout:te,isOpen:F,onClose:()=>R(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(he,{hostname:"nixos-router",username:O,connectionStatus:se,onMenuClick:()=>R(!F)}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 bg-gray-50 dark:bg-gray-900",children:[e.jsxs("div",{className:"mb-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(de,{to:`/${j}`,className:"hover:text-gray-900 dark:hover:text-gray-100",children:ae}),e.jsx("span",{className:"mx-2",children:"›"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:l})]}),e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold mb-4 md:mb-6",children:["Connection Details - ",l]}),e.jsxs(le,{children:[e.jsxs("div",{className:"mb-4 flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{className:"min-w-[150px]",children:[e.jsx(x,{htmlFor:"table-range",value:"Time Period"}),e.jsxs(C,{id:"table-range",value:m,onChange:s=>{V(s.target.value),s.target.value!=="custom"&&L("")},children:[e.jsx("option",{value:"1m",children:"1 minute"}),e.jsx("option",{value:"5m",children:"5 minutes"}),e.jsx("option",{value:"10m",children:"10 minutes"}),e.jsx("option",{value:"30m",children:"30 minutes"}),e.jsx("option",{value:"1h",children:"1 hour"}),e.jsx("option",{value:"3h",children:"3 hours"}),e.jsx("option",{value:"6h",children:"6 hours"}),e.jsx("option",{value:"12h",children:"12 hours"}),e.jsx("option",{value:"1d",children:"1 day"}),e.jsx("option",{value:"1w",children:"1 week"}),e.jsx("option",{value:"1M",children:"1 month"}),e.jsx("option",{value:"1y",children:"1 year"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),m==="custom"&&e.jsxs("div",{className:"min-w-[150px]",children:[e.jsx(x,{htmlFor:"table-custom",value:"Custom Range"}),e.jsx(P,{id:"table-custom",placeholder:"e.g., 45m, 2h, 3d",value:i,onChange:s=>L(s.target.value),color:i&&!v(i)?"failure":void 0,helperText:i&&!v(i)?"Format: 1m, 5m, 1h, 1d, 1w, 1M, 1y":void 0})]})]}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs(t,{children:[e.jsxs(t.Head,{children:[e.jsxs(t.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>h("ip"),children:["IP Address : Port",u("ip")]}),e.jsxs(t.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>h("hostname"),children:["Hostname",u("hostname")]}),e.jsxs(t.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>h("download_mb"),children:["Download",u("download_mb")]}),e.jsxs(t.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>h("download_mbps"),children:["Peak Download Mbit/s",u("download_mbps")]}),e.jsxs(t.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>h("upload_mb"),children:["Upload",u("upload_mb")]}),e.jsxs(t.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>h("upload_mbps"),children:["Peak Upload Mbit/s",u("upload_mbps")]}),e.jsx(t.HeadCell,{children:"Chart"})]}),e.jsx(t.Body,{className:"divide-y",children:k.map(s=>e.jsxs(t.Row,{children:[e.jsxs(t.Cell,{className:"font-mono text-sm",children:[s.remote_ip,":",s.remote_port]}),e.jsx(t.Cell,{children:s.hostname||"—"}),e.jsx(t.Cell,{className:"text-sm",children:f(s.download_mb)}),e.jsxs(t.Cell,{className:"text-sm",children:[s.download_mbps.toFixed(2)," Mbit/s"]}),e.jsx(t.Cell,{className:"text-sm",children:f(s.upload_mb)}),e.jsxs(t.Cell,{className:"text-sm",children:[s.upload_mbps.toFixed(2)," Mbit/s"]}),e.jsx(t.Cell,{children:e.jsx(B,{size:"xs",color:"blue",onClick:()=>A(s),children:"Chart"})})]},`${s.remote_ip}:${s.remote_port}`))})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:k.map(s=>e.jsxs("div",{className:"p-4 rounded-lg border bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700",children:[e.jsxs("div",{className:"font-semibold text-lg mb-2 font-mono",children:[s.remote_ip,":",s.remote_port]}),s.hostname&&e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:s.hostname}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Download"}),e.jsx("div",{children:f(s.download_mb)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.download_mbps.toFixed(2)," Mbit/s"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Upload"}),e.jsx("div",{children:f(s.upload_mb)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.upload_mbps.toFixed(2)," Mbit/s"]})]})]}),e.jsx(B,{size:"xs",color:"blue",onClick:()=>A(s),className:"w-full",children:"Chart"})]},`${s.remote_ip}:${s.remote_port}`))}),k.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No connections found for this time period."})]}),e.jsxs(M,{show:y,onClose:()=>D(!1),size:"xl",children:[e.jsxs(M.Header,{children:["Connection - ",n?`${n.remoteIp}:${n.remotePort}`:""]}),e.jsx(M.Body,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"min-w-[120px]",children:[e.jsx(x,{htmlFor:"chart-range",value:"Time Range",className:"text-xs mb-1"}),e.jsxs(C,{id:"chart-range",sizing:"sm",value:d,onChange:s=>{q(s.target.value),s.target.value!=="custom"&&T("")},children:[e.jsx("option",{value:"1m",children:"1 minute"}),e.jsx("option",{value:"5m",children:"5 minutes"}),e.jsx("option",{value:"10m",children:"10 minutes"}),e.jsx("option",{value:"30m",children:"30 minutes"}),e.jsx("option",{value:"1h",children:"1 hour"}),e.jsx("option",{value:"3h",children:"3 hours"}),e.jsx("option",{value:"6h",children:"6 hours"}),e.jsx("option",{value:"12h",children:"12 hours"}),e.jsx("option",{value:"1d",children:"1 day"}),e.jsx("option",{value:"1w",children:"1 week"}),e.jsx("option",{value:"1M",children:"1 month"}),e.jsx("option",{value:"1y",children:"1 year"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),d==="custom"&&e.jsxs("div",{className:"min-w-[100px]",children:[e.jsx(x,{htmlFor:"chart-custom",value:"Custom",className:"text-xs mb-1"}),e.jsx(P,{id:"chart-custom",sizing:"sm",placeholder:"e.g., 45m",value:c,onChange:s=>T(s.target.value),color:c&&!v(c)?"failure":void 0})]}),e.jsxs("div",{className:"min-w-[120px]",children:[e.jsx(x,{htmlFor:"chart-interval",value:"Interval",className:"text-xs mb-1"}),e.jsxs(C,{id:"chart-interval",sizing:"sm",value:N,onChange:s=>Q(s.target.value),children:[e.jsx("option",{value:"raw",children:"Raw"}),e.jsx("option",{value:"1m",children:"1 minute"}),e.jsx("option",{value:"5m",children:"5 minutes"}),e.jsx("option",{value:"1h",children:"1 hour"})]})]}),e.jsxs("div",{className:"min-w-[120px]",children:[e.jsx(x,{htmlFor:"chart-refresh",value:"Update Every",className:"text-xs mb-1"}),e.jsxs(C,{id:"chart-refresh",sizing:"sm",value:w,onChange:s=>J(Number(s.target.value)),children:[e.jsx("option",{value:1,children:"1 second"}),e.jsx("option",{value:5,children:"5 seconds"}),e.jsx("option",{value:10,children:"10 seconds"}),e.jsx("option",{value:30,children:"30 seconds"}),e.jsx("option",{value:60,children:"1 minute"})]})]})]}),S.length>0?e.jsx(ue,{width:"100%",height:300,children:e.jsxs(xe,{data:S,children:[e.jsx(pe,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"time",tick:{fontSize:12},interval:Math.floor(S.length/8)}),e.jsx(je,{tick:{fontSize:12},label:{value:"Mbit/s",angle:-90,position:"insideLeft"}}),e.jsx(ge,{}),e.jsx(be,{}),e.jsx(U,{type:"monotone",dataKey:"download",stroke:"#3b82f6",name:"Download (Mbit/s)",strokeWidth:2,dot:!1,isAnimationActive:!1}),e.jsx(U,{type:"monotone",dataKey:"upload",stroke:"#10b981",name:"Upload (Mbit/s)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No connection data available for this time range."})]})})]})]})]})]})}export{ke as ConnectionDetails};
