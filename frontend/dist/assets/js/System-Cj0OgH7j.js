import{j as e,L,S as $,T as ae,C as x,a as re}from"./ui-vendor-DPY0cfBY.js";import{u as ne,r}from"./react-vendor-DKKOAuGG.js";import{u as ie,S as oe,N as ce}from"./useMetrics-BqCvn1eY.js";import{a as le}from"./index-BC1wsQTL.js";import{R as p,L as j,C as y,X as v,Y as b,T as N,b as h,a as me}from"./charts-_iF2RbR3.js";import"./http-vendor-B9ygI19o.js";function pe(){const o=localStorage.getItem("access_token"),B=localStorage.getItem("username")||"Unknown",E=ne(),[R,_]=r.useState(!1),[i,U]=r.useState("30m"),[l,J]=r.useState(""),[d,P]=r.useState(10),[A,z]=r.useState([]),[I,T]=r.useState([]),[F,M]=r.useState([]),[X,O]=r.useState([]),[Y,K]=r.useState([]),[H,G]=r.useState([]),k=r.useRef(""),C=r.useRef(""),D=r.useRef(""),S=r.useRef(""),w=r.useRef(""),{connectionStatus:V}=ie(o),q=async()=>{await le.logout(),E("/login")};r.useEffect(()=>{const t=async()=>{if(o)try{const s=i==="custom"?l:i;if(!s||i==="custom"&&!l){z([]),T([]),M([]),k.current="",C.current="",D.current="";return}const n=await fetch(`/api/system/history?range=${s}`,{headers:{Authorization:`Bearer ${o}`}});if(n.ok){const c=await n.json(),m=JSON.stringify(c.data);m!==k.current&&(z(c.data),T(c.data),M(c.data),k.current=m,C.current=m,D.current=m)}}catch(s){console.error("Failed to fetch system history:",s)}};k.current="",C.current="",D.current="",t();const a=setInterval(t,d*1e3);return()=>clearInterval(a)},[i,l,d,o]),r.useEffect(()=>{const t=async()=>{if(o)try{const s=i==="custom"?l:i;if(!s||i==="custom"&&!l){O([]),S.current="";return}const n=await fetch(`/api/system/disk-io/history?range=${s}`,{headers:{Authorization:`Bearer ${o}`}});if(n.ok){const m=(await n.json()).filter(se=>!se.device.match(/\d$/)),W=JSON.stringify(m);W!==S.current&&(O(m),S.current=W)}}catch(s){console.error("Failed to fetch disk I/O history:",s)}};S.current="",t();const a=setInterval(t,d*1e3);return()=>clearInterval(a)},[i,l,d,o]),r.useEffect(()=>{const t=async()=>{if(o)try{const s=i==="custom"?l:i;if(!s||i==="custom"&&!l){K([]),w.current="";return}const n=await fetch(`/api/system/temperatures/history?range=${s}`,{headers:{Authorization:`Bearer ${o}`}});if(n.ok){const c=await n.json(),m=JSON.stringify(c);m!==w.current&&(K(c),w.current=m)}}catch(s){console.error("Failed to fetch temperature history:",s)}};w.current="",t();const a=setInterval(t,d*1e3);return()=>clearInterval(a)},[i,l,d,o]),r.useEffect(()=>{const t=async()=>{if(o)try{const s=await fetch("/api/system/clients",{headers:{Authorization:`Bearer ${o}`}});if(s.ok){const n=await s.json();G(n)}}catch(s){console.error("Failed to fetch client stats:",s)}};t();const a=setInterval(t,d*1e3);return()=>clearInterval(a)},[d,o]);const Q=t=>t.startsWith("nvme")?`NVMe ${t}`:t.startsWith("sd")?`Disk ${t.toUpperCase()}`:t,u=r.useMemo(()=>A.map(t=>({time:new Date(t.timestamp).toLocaleTimeString(),cpu:t.cpu_percent||0})),[A]),g=r.useMemo(()=>I.map(t=>({time:new Date(t.timestamp).toLocaleTimeString(),memory:t.memory_percent||0})),[I]),f=r.useMemo(()=>F.map(t=>({time:new Date(t.timestamp).toLocaleTimeString(),load:t.load_avg_1m||0})),[F]),Z=u.length>0?u[u.length-1].cpu:0,ee=g.length>0?g[g.length-1].memory:0,te=f.length>0?f[f.length-1].load:0;return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(oe,{onLogout:q,isOpen:R,onClose:()=>_(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(ce,{hostname:"nixos-router",username:B,connectionStatus:V,onMenuClick:()=>_(!R)}),e.jsx("div",{className:"sticky top-0 z-10 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 md:px-6 py-3 shadow-sm",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-3",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"System Monitoring"}),e.jsxs("div",{className:"flex flex-wrap gap-2 md:gap-4 items-end",children:[e.jsxs("div",{className:"min-w-[120px]",children:[e.jsx(L,{htmlFor:"global-range",value:"Time Range",className:"text-xs mb-1"}),e.jsxs($,{id:"global-range",sizing:"sm",value:i,onChange:t=>U(t.target.value),children:[e.jsx("option",{value:"10m",children:"10 minutes"}),e.jsx("option",{value:"30m",children:"30 minutes"}),e.jsx("option",{value:"1h",children:"1 hour"}),e.jsx("option",{value:"3h",children:"3 hours"}),e.jsx("option",{value:"6h",children:"6 hours"}),e.jsx("option",{value:"12h",children:"12 hours"}),e.jsx("option",{value:"1d",children:"1 day"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),i==="custom"&&e.jsxs("div",{className:"min-w-[100px]",children:[e.jsx(L,{htmlFor:"global-custom",value:"Custom",className:"text-xs mb-1"}),e.jsx(ae,{id:"global-custom",sizing:"sm",placeholder:"e.g., 45m",value:l,onChange:t=>J(t.target.value)})]}),e.jsxs("div",{className:"min-w-[120px]",children:[e.jsx(L,{htmlFor:"global-refresh",value:"Update Every",className:"text-xs mb-1"}),e.jsxs($,{id:"global-refresh",sizing:"sm",value:d,onChange:t=>P(Number(t.target.value)),children:[e.jsx("option",{value:1,children:"1 second"}),e.jsx("option",{value:5,children:"5 seconds"}),e.jsx("option",{value:10,children:"10 seconds"}),e.jsx("option",{value:30,children:"30 seconds"}),e.jsx("option",{value:60,children:"1 minute"})]})]})]})]})}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 bg-gray-50 dark:bg-gray-900",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(x,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"CPU Usage"}),e.jsx(p,{width:"100%",height:250,children:e.jsxs(j,{data:u,children:[e.jsx(y,{strokeDasharray:"3 3"}),e.jsx(v,{dataKey:"time",tick:{fontSize:12}}),e.jsx(b,{domain:[0,100],tick:{fontSize:12}}),e.jsx(N,{}),e.jsx(h,{type:"monotone",dataKey:"cpu",stroke:"#3b82f6",strokeWidth:2,dot:!1,name:"CPU %",isAnimationActive:!1})]})}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400 text-center",children:["Current: ",e.jsxs("strong",{children:[Z.toFixed(1),"%"]})," • ",u.length," points"]})]}),e.jsxs(x,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Memory Usage"}),e.jsx(p,{width:"100%",height:250,children:e.jsxs(j,{data:g,children:[e.jsx(y,{strokeDasharray:"3 3"}),e.jsx(v,{dataKey:"time",tick:{fontSize:12}}),e.jsx(b,{domain:[0,100],tick:{fontSize:12}}),e.jsx(N,{}),e.jsx(h,{type:"monotone",dataKey:"memory",stroke:"#10b981",strokeWidth:2,dot:!1,name:"Memory %",isAnimationActive:!1})]})}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400 text-center",children:["Current: ",e.jsxs("strong",{children:[ee.toFixed(1),"%"]})," • ",g.length," points"]})]}),e.jsxs(x,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Load Average"}),e.jsx(p,{width:"100%",height:250,children:e.jsxs(j,{data:f,children:[e.jsx(y,{strokeDasharray:"3 3"}),e.jsx(v,{dataKey:"time",tick:{fontSize:12}}),e.jsx(b,{tick:{fontSize:12}}),e.jsx(N,{}),e.jsx(h,{type:"monotone",dataKey:"load",stroke:"#f59e0b",strokeWidth:2,dot:!1,name:"Load (1m)",isAnimationActive:!1})]})}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400 text-center",children:["Current: ",e.jsx("strong",{children:te.toFixed(2)})," • ",f.length," points"]})]}),X.map(t=>{const a=t.data.map(c=>({time:new Date(c.timestamp).toLocaleTimeString(),read_mbps:c.read_mbps,write_mbps:c.write_mbps})),s=a.length>0?a[a.length-1].read_mbps:0,n=a.length>0?a[a.length-1].write_mbps:0;return e.jsxs(x,{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Disk I/O - ",Q(t.device)]}),e.jsx(p,{width:"100%",height:250,children:e.jsxs(j,{data:a,children:[e.jsx(y,{strokeDasharray:"3 3"}),e.jsx(v,{dataKey:"time",tick:{fontSize:12}}),e.jsx(b,{tick:{fontSize:12}}),e.jsx(N,{}),e.jsx(me,{}),e.jsx(h,{type:"monotone",dataKey:"read_mbps",stroke:"#3b82f6",strokeWidth:2,dot:!1,name:"Read",isAnimationActive:!1}),e.jsx(h,{type:"monotone",dataKey:"write_mbps",stroke:"#ef4444",strokeWidth:2,dot:!1,name:"Write",isAnimationActive:!1})]})}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400 text-center",children:["Current: ",e.jsxs("strong",{className:"text-blue-600",children:["↓ ",s.toFixed(2)," MB/s"]})," / ",e.jsxs("strong",{className:"text-red-600",children:["↑ ",n.toFixed(2)," MB/s"]})," • ",a.length," points"]})]},t.device)}),Y.map(t=>{const a=t.data.map(n=>({time:new Date(n.timestamp).toLocaleTimeString(),temperature:n.temperature_c})),s=a.length>0?a[a.length-1].temperature:0;return e.jsxs(x,{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Temperature - ",t.sensor_name]}),e.jsx(p,{width:"100%",height:250,children:e.jsxs(j,{data:a,children:[e.jsx(y,{strokeDasharray:"3 3"}),e.jsx(v,{dataKey:"time",tick:{fontSize:12}}),e.jsx(b,{tick:{fontSize:12}}),e.jsx(N,{}),e.jsx(h,{type:"monotone",dataKey:"temperature",stroke:s>=80?"#ef4444":s>=70?"#f59e0b":"#10b981",strokeWidth:2,dot:!1,name:"Temp °C",isAnimationActive:!1})]})}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400 text-center",children:["Current: ",e.jsxs("strong",{className:s>=80?"text-red-600":s>=70?"text-yellow-600":"text-green-600",children:[s.toFixed(1),"°C"]})," • ",a.length," points"]})]},t.sensor_name)})]}),H.length>0&&e.jsxs(x,{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Network Clients"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:H.map(t=>e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h4",{className:"font-semibold text-lg uppercase",children:t.network}),e.jsxs(re,{color:t.network==="homelab"?"info":"purple",children:[t.total_clients," Total"]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"DHCP Clients:"}),e.jsx("span",{className:"font-semibold",children:t.dhcp_clients})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Static Clients:"}),e.jsx("span",{className:"font-semibold",children:t.static_clients})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Online:"}),e.jsx("span",{className:"font-semibold text-green-600",children:t.online_clients})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Offline:"}),e.jsx("span",{className:"font-semibold text-gray-500",children:t.offline_clients})]})]})]},t.network))})]})]})]})]})}export{pe as System};
