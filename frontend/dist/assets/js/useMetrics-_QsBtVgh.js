import{j as e,E as c,F as E,G as C,I as R,J as A,K as L,N as M,x as D,w as T,r as W,D as G,z,u as B,y as F,n as N,O as $,Q as _,R as O,U as I,V as P,c as U,W as K,X as J,a as V}from"./ui-vendor-BWxpC62h.js";import{j as X,r as t,L as y}from"./react-vendor-DKKOAuGG.js";import{a as w}from"./index-B9r1D0hh.js";function ae({onLogout:d,isOpen:x,onClose:n}){const o=X(),[f,i]=t.useState(null),[h,m]=t.useState(!1),[S,j]=t.useState(!1),[l,g]=t.useState(!1);t.useEffect(()=>{(async()=>{try{const r=await w.getGitHubStats();i(r)}catch(r){console.error("Failed to fetch GitHub stats:",r),i({stars:0,forks:0})}})()},[]),t.useEffect(()=>{const s=async()=>{try{console.log("Checking CAKE status...");const a=await w.getCakeStatus();console.log("CAKE status response:",a),m(a.enabled)}catch(a){console.error("Failed to check CAKE status:",a),console.error("Error details:",a),m(!1)}};s();const r=setInterval(s,6e4);return()=>clearInterval(r)},[]),t.useEffect(()=>{const s=async()=>{try{console.log("Checking Apprise status...");const a=await w.getAppriseStatus();console.log("Apprise status response:",a),j(a.enabled)}catch(a){console.error("Failed to check Apprise status:",a),console.error("Error details:",a),j(!1)}};s();const r=setInterval(s,6e4);return()=>clearInterval(r)},[]);const u=()=>{window.innerWidth<1650&&n()},b=s=>o.pathname===s,v=(s,r)=>b(s)?!0:r?r.some(a=>o.pathname.startsWith(a.path)):!1,k=[...h?[{path:"/settings/cake",label:"CAKE",icon:D}]:[],{path:"/dhcp",label:"DHCP",icon:T},{path:"/dns",label:"DNS",icon:W},{path:"/settings/blocklists-whitelist",label:"DNS Blocklists",icon:G},{path:"/settings/port-forwarding",label:"Port Forwarding",icon:z},{path:"/settings/dyndns",label:"Dynamic DNS",icon:B},...S?[{path:"/settings/apprise",label:"Notifications",icon:F}]:[]],p=v("/settings",k)||b("/dns")||b("/dhcp")||b("/traffic-shaping")||b("/notifications");return t.useEffect(()=>{p&&g(!0)},[p]),e.jsxs(e.Fragment,{children:[x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 xl-custom:hidden",onClick:n}),e.jsx("div",{className:`
          fixed xl-custom:static inset-y-0 left-0 z-50
          transform transition-transform duration-300 ease-in-out
          xl-custom:transform-none
          ${x?"translate-x-0":"-translate-x-full xl-custom:translate-x-0"}
        `,children:e.jsx(c,{"aria-label":"Sidebar with navigation",className:"h-full",children:e.jsxs(c.Items,{children:[e.jsxs(c.ItemGroup,{children:[e.jsx(c.Item,{as:y,to:"/dashboard",icon:E,active:o.pathname==="/dashboard",onClick:u,children:"Dashboard"}),e.jsx(c.Item,{as:y,to:"/network",icon:C,active:o.pathname==="/network",onClick:u,children:"Network"}),e.jsx(c.Item,{as:y,to:"/devices",icon:R,active:o.pathname==="/devices",onClick:u,children:"Devices"}),e.jsx(c.Item,{as:y,to:"/device-usage",icon:C,active:o.pathname==="/device-usage",onClick:u,children:"Device Usage"}),e.jsx(c.Item,{as:y,to:"/system",icon:A,active:o.pathname==="/system",onClick:u,children:"System"}),e.jsx(c.Item,{as:y,to:"/speedtest",icon:L,active:o.pathname==="/speedtest",onClick:u,children:"Speedtest"}),e.jsxs("li",{children:[e.jsxs("button",{type:"button",onClick:()=>g(!l),className:`flex items-center w-full p-2 rounded-lg ${p?"text-blue-600 bg-blue-50 dark:text-blue-500 dark:bg-gray-700":"text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"}`,children:[e.jsx(M,{className:"w-5 h-5 mr-3"}),e.jsx("span",{children:"Settings"})]}),l&&e.jsx("ul",{className:"ml-6 mt-2 space-y-1",children:k.map(s=>{const r=s.icon;return e.jsx("li",{children:e.jsxs(y,{to:s.path,onClick:u,className:`flex items-center p-2 rounded-lg text-sm ${b(s.path)?"text-blue-600 bg-blue-50 dark:text-blue-500 dark:bg-gray-700":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(r,{className:"w-4 h-4 mr-2"}),s.label]})},s.path)})})]})]}),e.jsxs(c.ItemGroup,{children:[e.jsx(c.Item,{as:y,to:"/system-info",icon:N,active:o.pathname==="/system-info",onClick:u,children:"System Info"}),e.jsx(c.Item,{icon:$,style:{cursor:"pointer"},onClick:()=>{u(),d()},children:"Logout"})]}),e.jsxs(c.ItemGroup,{children:[e.jsx(c.Item,{href:"/docs",target:"_blank",rel:"noopener noreferrer",icon:_,as:"a",onClick:u,children:"Documentation"}),e.jsx(c.Item,{href:"https://github.com/NixRTR/nixos-router",target:"_blank",rel:"noopener noreferrer",icon:O,as:"a",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:"GitHub"}),f!==null&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap",children:["â­ ",f.stars," ðŸ´ ",f.forks]})]})}),e.jsx(c.Item,{href:"https://github.com/NixRTR/nixos-router/issues",target:"_blank",rel:"noopener noreferrer",icon:N,as:"a",children:"Issues"})]})]})})})]})}function ne({hostname:d,username:x,connectionStatus:n,onMenuClick:o}){const f=()=>{const h=document.documentElement;if(h.classList.contains("dark")){h.classList.remove("dark");try{localStorage.setItem("theme","light")}catch{}}else{h.classList.add("dark");try{localStorage.setItem("theme","dark")}catch{}}},i=()=>{switch(n){case"connected":return"success";case"connecting":return"warning";case"error":return"failure";default:return"gray"}};return e.jsxs(I,{fluid:!0,className:"border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:o,className:"p-2 text-gray-500 rounded-lg xl-custom:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600","aria-label":"Toggle menu",children:e.jsx(P,{className:"w-6 h-6"})}),e.jsx(I.Brand,{children:e.jsxs("span",{className:"flex items-center gap-2 self-center whitespace-nowrap text-xl font-semibold text-gray-900 dark:text-white",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 128 128",className:"w-6 h-6 dark:opacity-90 flex-shrink-0",preserveAspectRatio:"xMidYMid meet",children:[e.jsx("path",{fill:"#7EBAE4",d:"M50.732 43.771L20.525 96.428l-7.052-12.033 8.14-14.103-16.167-.042L2 64.237l3.519-6.15 23.013.073 8.27-14.352 13.93-.037zm2.318 42.094l60.409.003-6.827 12.164-16.205-.045 8.047 14.115-3.45 6.01-7.05.008-11.445-20.097-16.483-.034-6.996-12.124zm35.16-23.074l-30.202-52.66L71.888 10l8.063 14.148 8.12-14.072 6.897.002 3.532 6.143-11.57 20.024 8.213 14.386-6.933 12.16z",clipRule:"evenodd",fillRule:"evenodd"}),e.jsx("path",{fill:"#5277C3",d:"M39.831 65.463l30.202 52.66-13.88.131-8.063-14.148-8.12 14.072-6.897-.002-3.532-6.143 11.57-20.024-8.213-14.386 6.933-12.16zm35.08-23.207l-60.409-.003L21.33 30.09l16.204.045-8.047-14.115 3.45-6.01 7.051-.01 11.444 20.097 16.484.034 6.996 12.124zm2.357 42.216l30.207-52.658 7.052 12.034-8.141 14.102 16.168.043L126 64.006l-3.519 6.15-23.013-.073-8.27 14.352-13.93.037z",clipRule:"evenodd",fillRule:"evenodd"})]}),e.jsxs("span",{children:["NixOS Router (",d,")"]})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsx(U,{content:"Toggle theme",placement:"bottom",children:e.jsxs("button",{type:"button",onClick:f,className:"p-2 rounded-lg text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:focus:ring-gray-600","aria-label":"Toggle theme",title:"Toggle theme",children:[e.jsx("span",{className:"hidden dark:inline-block",children:e.jsx(K,{className:"w-5 h-5"})}),e.jsx("span",{className:"inline-block dark:hidden",children:e.jsx(J,{className:"w-5 h-5"})})]})}),e.jsxs(V,{color:i(),size:"sm",className:"md:text-base",children:[e.jsx("span",{className:"hidden sm:inline",children:n.charAt(0).toUpperCase()+n.slice(1)}),e.jsx("span",{className:"sm:hidden",children:"â—"})]}),e.jsxs("span",{className:"text-xs md:text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:"Logged in as: "}),e.jsx("strong",{children:x})]})]})]})}const Y=`ws://${window.location.host}/ws`;function Q(d){const[x,n]=t.useState("disconnected"),[o,f]=t.useState(null),i=t.useRef(null),h=t.useRef(null),m=t.useRef(0),S=t.useCallback(()=>{if(!(!d||i.current?.readyState===WebSocket.OPEN)){n("connecting");try{const l=new WebSocket(`${Y}?token=${encodeURIComponent(d)}`);l.onopen=()=>{console.log("WebSocket connected"),n("connected"),m.current=0},l.onmessage=g=>{f(g)},l.onerror=g=>{console.error("WebSocket error:",g),n("error")},l.onclose=()=>{if(console.log("WebSocket disconnected"),n("disconnected"),i.current=null,d){const g=Math.min(1e3*Math.pow(2,m.current),3e4);m.current+=1,h.current=window.setTimeout(()=>{console.log(`Reconnecting WebSocket (attempt ${m.current})...`),S()},g)}},i.current=l}catch(l){console.error("Failed to create WebSocket:",l),n("error")}}},[d]),j=t.useCallback(l=>{i.current?.readyState===WebSocket.OPEN&&i.current.send(l)},[]);return t.useEffect(()=>(d&&S(),()=>{h.current&&clearTimeout(h.current),i.current&&i.current.close()}),[d,S]),{connectionStatus:x,lastMessage:o,sendMessage:j}}const q=60;function re(d){const{connectionStatus:x,lastMessage:n}=Q(d),[o,f]=t.useState(null),[i,h]=t.useState([]),[m,S]=t.useState([]),[j,l]=t.useState([]),[g,u]=t.useState([]),[b,v]=t.useState(new Map);return t.useEffect(()=>{if(n)try{const k=JSON.parse(n.data);if(k.type==="metrics"&&k.data){const p=k.data;f(p.system),h(p.interfaces),S(p.services),l(p.dhcp_clients),u(p.dns_stats),v(s=>{const r=new Map(s);return p.interfaces.forEach(a=>{const H=[...r.get(a.interface)||[],a].slice(-q);r.set(a.interface,H)}),r})}}catch(k){console.error("Failed to parse WebSocket message:",k)}},[n]),{connectionStatus:x,system:o,interfaces:i,services:m,dhcpClients:j,dnsStats:g,interfaceHistory:b}}export{ne as N,ae as S,re as u};
