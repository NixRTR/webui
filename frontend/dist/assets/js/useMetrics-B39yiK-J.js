import{j as e,e as a,f as H,g as y,h as T,i as M,k as S,l as W,m as L,F as R,N as j,n as G,c as E,o as D,p as _,a as $}from"./ui-vendor-h9jYZGP7.js";import{j as B,r as s,L as f}from"./react-vendor-DKKOAuGG.js";import{a as F}from"./index-lYj-93Kr.js";function X({onLogout:c,isOpen:u,onClose:n}){const o=B(),[l,r]=s.useState(null);s.useEffect(()=>{(async()=>{try{const d=await F.getGitHubStats();r(d)}catch(d){console.error("Failed to fetch GitHub stats:",d),r({stars:0,forks:0})}})()},[]);const t=()=>{window.innerWidth<1650&&n()};return e.jsxs(e.Fragment,{children:[u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 xl-custom:hidden",onClick:n}),e.jsx("div",{className:`
          fixed xl-custom:static inset-y-0 left-0 z-50
          transform transition-transform duration-300 ease-in-out
          xl-custom:transform-none
          ${u?"translate-x-0":"-translate-x-full xl-custom:translate-x-0"}
        `,children:e.jsx(a,{"aria-label":"Sidebar with navigation",className:"h-full",children:e.jsxs(a.Items,{children:[e.jsxs(a.ItemGroup,{children:[e.jsx(a.Item,{as:f,to:"/dashboard",icon:H,active:o.pathname==="/dashboard",onClick:t,children:"Dashboard"}),e.jsx(a.Item,{as:f,to:"/network",icon:y,active:o.pathname==="/network",onClick:t,children:"Network"}),e.jsx(a.Item,{as:f,to:"/devices",icon:T,active:o.pathname==="/devices",onClick:t,children:"Devices"}),e.jsx(a.Item,{as:f,to:"/device-usage",icon:y,active:o.pathname==="/device-usage",onClick:t,children:"Device Usage"}),e.jsx(a.Item,{as:f,to:"/system",icon:M,active:o.pathname==="/system",onClick:t,children:"System"})]}),e.jsxs(a.ItemGroup,{children:[e.jsx(a.Item,{as:f,to:"/system-info",icon:S,active:o.pathname==="/system-info",onClick:t,children:"System Info"}),e.jsx(a.Item,{icon:W,style:{cursor:"pointer"},onClick:()=>{t(),c()},children:"Logout"})]}),e.jsxs(a.ItemGroup,{children:[e.jsx(a.Item,{href:"/docs",target:"_blank",rel:"noopener noreferrer",icon:L,as:"a",onClick:t,children:"Documentation"}),e.jsx(a.Item,{href:"https://github.com/BeardedTek/nixos-router",target:"_blank",rel:"noopener noreferrer",icon:R,as:"a",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:"GitHub"}),l!==null&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap",children:["â­ ",l.stars," ðŸ´ ",l.forks]})]})}),e.jsx(a.Item,{href:"https://github.com/BeardedTek/nixos-router/issues",target:"_blank",rel:"noopener noreferrer",icon:S,as:"a",children:"Issues"})]})]})})})]})}function Y({hostname:c,username:u,connectionStatus:n,onMenuClick:o}){const l=()=>{const t=document.documentElement;if(t.classList.contains("dark")){t.classList.remove("dark");try{localStorage.setItem("theme","light")}catch{}}else{t.classList.add("dark");try{localStorage.setItem("theme","dark")}catch{}}},r=()=>{switch(n){case"connected":return"success";case"connecting":return"warning";case"error":return"failure";default:return"gray"}};return e.jsxs(j,{fluid:!0,className:"border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:o,className:"p-2 text-gray-500 rounded-lg xl-custom:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600","aria-label":"Toggle menu",children:e.jsx(G,{className:"w-6 h-6"})}),e.jsx(j.Brand,{children:e.jsx("span",{className:"self-center whitespace-nowrap text-xl font-semibold",children:c})})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsx(E,{content:"Toggle theme",placement:"bottom",children:e.jsxs("button",{type:"button",onClick:l,className:"p-2 rounded-lg text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:focus:ring-gray-600","aria-label":"Toggle theme",title:"Toggle theme",children:[e.jsx("span",{className:"hidden dark:inline-block",children:e.jsx(D,{className:"w-5 h-5"})}),e.jsx("span",{className:"inline-block dark:hidden",children:e.jsx(_,{className:"w-5 h-5"})})]})}),e.jsxs($,{color:r(),size:"sm",className:"md:text-base",children:[e.jsx("span",{className:"hidden sm:inline",children:n.charAt(0).toUpperCase()+n.slice(1)}),e.jsx("span",{className:"sm:hidden",children:"â—"})]}),e.jsxs("span",{className:"text-xs md:text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:"Logged in as: "}),e.jsx("strong",{children:u})]})]})]})}const O=`ws://${window.location.host}/ws`;function U(c){const[u,n]=s.useState("disconnected"),[o,l]=s.useState(null),r=s.useRef(null),t=s.useRef(null),m=s.useRef(0),d=s.useCallback(()=>{if(!(!c||r.current?.readyState===WebSocket.OPEN)){n("connecting");try{const i=new WebSocket(`${O}?token=${encodeURIComponent(c)}`);i.onopen=()=>{console.log("WebSocket connected"),n("connected"),m.current=0},i.onmessage=h=>{l(h)},i.onerror=h=>{console.error("WebSocket error:",h),n("error")},i.onclose=()=>{if(console.log("WebSocket disconnected"),n("disconnected"),r.current=null,c){const h=Math.min(1e3*Math.pow(2,m.current),3e4);m.current+=1,t.current=window.setTimeout(()=>{console.log(`Reconnecting WebSocket (attempt ${m.current})...`),d()},h)}},r.current=i}catch(i){console.error("Failed to create WebSocket:",i),n("error")}}},[c]),p=s.useCallback(i=>{r.current?.readyState===WebSocket.OPEN&&r.current.send(i)},[]);return s.useEffect(()=>(c&&d(),()=>{t.current&&clearTimeout(t.current),r.current&&r.current.close()}),[c,d]),{connectionStatus:u,lastMessage:o,sendMessage:p}}const P=60;function q(c){const{connectionStatus:u,lastMessage:n}=U(c),[o,l]=s.useState(null),[r,t]=s.useState([]),[m,d]=s.useState([]),[p,i]=s.useState([]),[h,w]=s.useState([]),[N,v]=s.useState(new Map);return s.useEffect(()=>{if(n)try{const x=JSON.parse(n.data);if(x.type==="metrics"&&x.data){const g=x.data;l(g.system),t(g.interfaces),d(g.services),i(g.dhcp_clients),w(g.dns_stats),v(I=>{const b=new Map(I);return g.interfaces.forEach(k=>{const C=[...b.get(k.interface)||[],k].slice(-P);b.set(k.interface,C)}),b})}}catch(x){console.error("Failed to parse WebSocket message:",x)}},[n]),{connectionStatus:u,system:o,interfaces:r,services:m,dhcpClients:p,dnsStats:h,interfaceHistory:N}}export{Y as N,X as S,q as u};
