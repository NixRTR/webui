import{j as e,G as f,I,J as W,K as z,e as B,x as M,N as O,o as _,O as P,Q as U,y as F,r as J,E as Y,D as K,u as V,z as A,R as X,U as Q,V as Z,W as T,X as q,d as ee,Y as te,Z as se,a as ae}from"./ui-vendor-D62cCOC9.js";import{k as ne,a as s,L as N}from"./react-vendor-DIDCmA_u.js";import{a as re}from"./index-oaSaWqJi.js";const D="webui-sidebar-expanded";function L(){try{const o=localStorage.getItem(D);if(o){const m=JSON.parse(o);return{network:!!m.network,system:!!m.system,config:!!m.config}}}catch{}return{network:!1,system:!1,config:!1}}function x(o){try{localStorage.setItem(D,JSON.stringify(o))}catch{}}function ge({onLogout:o,isOpen:m,onClose:c}){const n=ne(),[h,i]=s.useState(null),[u,d]=s.useState(()=>L().network),[p,g]=s.useState(()=>L().system),[y,r]=s.useState(()=>L().config);s.useEffect(()=>{(async()=>{try{const a=await re.getGitHubStats();i(a)}catch(a){console.error("Failed to fetch GitHub stats:",a),i({stars:0,forks:0})}})()},[]);const l=()=>{window.innerWidth<1650&&c()},j=t=>n.pathname===t,H=(t,a)=>j(t)?!0:a?a.some(R=>n.pathname.startsWith(R.path)||(R.path.includes("?")?!1:n.pathname===R.path)):!1,k=[{path:"/network",label:"Charts",icon:W},{path:"/devices",label:"Devices",icon:z},{path:"/device-usage",label:"Usage",icon:I}],b=[{path:"/system",label:"Charts",icon:I},{path:"/settings/worker-status",label:"Worker Status",icon:M},{path:"/speedtest",label:"Speedtest",icon:O},{path:"/system-info",label:"System Info",icon:_},{path:"/system/logs",label:"Logs",icon:P}],v=[{path:"/settings/cake",label:"CAKE",icon:F},{path:"/settings/dhcp",label:"DHCP",icon:M},{path:"/settings/dns",label:"DNS",icon:J},{path:"/settings/blocklists-whitelist",label:"Blocklists",icon:Y},{path:"/settings/port-forwarding",label:"Port Forwarding",icon:K},{path:"/settings/dyndns",label:"Dynamic DNS",icon:V},{path:"/settings/apprise",label:"Apprise",icon:A}],w=["/network","/devices","/device-usage"].some(t=>n.pathname===t||t!=="/network"&&n.pathname.startsWith(t)),S=n.pathname==="/system"||n.pathname==="/system-info"||n.pathname==="/speedtest"||n.pathname==="/settings/worker-status"||n.pathname.startsWith("/system/logs"),C=H("/settings",v);s.useEffect(()=>{w?(d(!0),g(!1),r(!1),x({network:!0,system:!1,config:!1})):S?(d(!1),g(!0),r(!1),x({network:!1,system:!0,config:!1})):C&&(d(!1),g(!1),r(!0),x({network:!1,system:!1,config:!0}))},[w,S,C]);const E=()=>{d(t=>{const a=!t;return a?(g(!1),r(!1),x({network:!0,system:!1,config:!1})):x({network:!1,system:p,config:y}),a})},$=()=>{g(t=>{const a=!t;return a?(d(!1),r(!1),x({network:!1,system:!0,config:!1})):x({network:u,system:!1,config:y}),a})},G=()=>{r(t=>{const a=!t;return a?(d(!1),g(!1),x({network:!1,system:!1,config:!0})):x({network:u,system:p,config:!1}),a})};return e.jsxs(e.Fragment,{children:[m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 xl-custom:hidden",onClick:c}),e.jsx("div",{className:`
          fixed xl-custom:static inset-y-0 left-0 z-50
          transform transition-transform duration-300 ease-in-out
          xl-custom:transform-none
          ${m?"translate-x-0":"-translate-x-full xl-custom:translate-x-0"}
        `,children:e.jsx(f,{"aria-label":"Sidebar with navigation",className:"h-full",children:e.jsxs(f.Items,{children:[e.jsxs(f.ItemGroup,{children:[e.jsx(f.Item,{as:N,to:"/dashboard",icon:I,active:n.pathname==="/dashboard",onClick:l,children:"Dashboard"}),e.jsxs("li",{children:[e.jsxs("button",{type:"button",onClick:E,className:`flex items-center w-full p-2 rounded-lg ${w?"text-blue-600 bg-blue-50 dark:text-blue-500 dark:bg-gray-700":"text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"}`,children:[e.jsx(W,{className:"w-5 h-5 mr-3"}),e.jsx("span",{children:"Network"})]}),u&&e.jsx("ul",{className:"ml-6 mt-2 space-y-1",children:k.map(t=>{const a=t.icon;return e.jsx("li",{children:e.jsxs(N,{to:t.path,onClick:l,className:`flex items-center p-2 rounded-lg text-sm ${j(t.path)?"text-blue-600 bg-blue-50 dark:text-blue-500 dark:bg-gray-700":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(a,{className:"w-4 h-4 mr-2"}),t.label]})},t.path)})})]}),e.jsxs("li",{children:[e.jsxs("button",{type:"button",onClick:$,className:`flex items-center w-full p-2 rounded-lg ${S?"text-blue-600 bg-blue-50 dark:text-blue-500 dark:bg-gray-700":"text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"}`,children:[e.jsx(B,{className:"w-5 h-5 mr-3"}),e.jsx("span",{children:"System"})]}),p&&e.jsx("ul",{className:"ml-6 mt-2 space-y-1",children:b.map(t=>{const a=t.icon;return e.jsx("li",{children:e.jsxs(N,{to:t.path,onClick:l,className:`flex items-center p-2 rounded-lg text-sm ${j(t.path)||t.path==="/system/logs"&&n.pathname.startsWith("/system/logs")?"text-blue-600 bg-blue-50 dark:text-blue-500 dark:bg-gray-700":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(a,{className:"w-4 h-4 mr-2"}),t.label]})},t.path)})})]}),e.jsxs("li",{children:[e.jsxs("button",{type:"button",onClick:G,className:`flex items-center w-full p-2 rounded-lg ${C?"text-blue-600 bg-blue-50 dark:text-blue-500 dark:bg-gray-700":"text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"}`,children:[e.jsx(U,{className:"w-5 h-5 mr-3"}),e.jsx("span",{children:"Settings"})]}),y&&e.jsx("ul",{className:"ml-6 mt-2 space-y-1",children:v.map(t=>{const a=t.icon;return e.jsx("li",{children:e.jsxs(N,{to:t.path,onClick:l,className:`flex items-center p-2 rounded-lg text-sm ${j(t.path)?"text-blue-600 bg-blue-50 dark:text-blue-500 dark:bg-gray-700":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(a,{className:"w-4 h-4 mr-2"}),t.label]})},t.path)})})]}),e.jsx(f.Item,{as:N,to:"/notifications",icon:A,active:n.pathname==="/notifications",onClick:l,children:"Notifications"})]}),e.jsxs(f.ItemGroup,{children:[e.jsx(f.Item,{icon:X,style:{cursor:"pointer"},onClick:()=>{l(),o()},children:"Logout"}),e.jsx(f.Item,{href:"/docs",target:"_blank",rel:"noopener noreferrer",icon:Q,as:"a",onClick:l,children:"Documentation"}),e.jsx(f.Item,{href:"https://github.com/NixRTR/nixos-router",target:"_blank",rel:"noopener noreferrer",icon:Z,as:"a",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:"GitHub"}),h!==null&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap",children:["â­ ",h.stars," ðŸ´ ",h.forks]})]})})]})]})})})]})}function me({hostname:o,username:m,connectionStatus:c,onMenuClick:n}){const h=()=>{const u=document.documentElement;if(u.classList.contains("dark")){u.classList.remove("dark");try{localStorage.setItem("theme","light")}catch{}}else{u.classList.add("dark");try{localStorage.setItem("theme","dark")}catch{}}},i=()=>{switch(c){case"connected":return"success";case"connecting":return"warning";case"error":return"failure";default:return"gray"}};return e.jsxs(T,{fluid:!0,className:"border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:n,className:"p-2 text-gray-500 rounded-lg xl-custom:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600","aria-label":"Toggle menu",children:e.jsx(q,{className:"w-6 h-6"})}),e.jsx(T.Brand,{children:e.jsxs("span",{className:"flex items-center gap-2 self-center whitespace-nowrap text-xl font-semibold text-gray-900 dark:text-white",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 128 128",className:"w-6 h-6 dark:opacity-90 flex-shrink-0",preserveAspectRatio:"xMidYMid meet",children:[e.jsx("path",{fill:"#7EBAE4",d:"M50.732 43.771L20.525 96.428l-7.052-12.033 8.14-14.103-16.167-.042L2 64.237l3.519-6.15 23.013.073 8.27-14.352 13.93-.037zm2.318 42.094l60.409.003-6.827 12.164-16.205-.045 8.047 14.115-3.45 6.01-7.05.008-11.445-20.097-16.483-.034-6.996-12.124zm35.16-23.074l-30.202-52.66L71.888 10l8.063 14.148 8.12-14.072 6.897.002 3.532 6.143-11.57 20.024 8.213 14.386-6.933 12.16z",clipRule:"evenodd",fillRule:"evenodd"}),e.jsx("path",{fill:"#5277C3",d:"M39.831 65.463l30.202 52.66-13.88.131-8.063-14.148-8.12 14.072-6.897-.002-3.532-6.143 11.57-20.024-8.213-14.386 6.933-12.16zm35.08-23.207l-60.409-.003L21.33 30.09l16.204.045-8.047-14.115 3.45-6.01 7.051-.01 11.444 20.097 16.484.034 6.996 12.124zm2.357 42.216l30.207-52.658 7.052 12.034-8.141 14.102 16.168.043L126 64.006l-3.519 6.15-23.013-.073-8.27 14.352-13.93.037z",clipRule:"evenodd",fillRule:"evenodd"})]}),e.jsxs("span",{children:["NixOS Router (",o,")"]})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsx(ee,{content:"Toggle theme",placement:"bottom",children:e.jsxs("button",{type:"button",onClick:h,className:"p-2 rounded-lg text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:focus:ring-gray-600","aria-label":"Toggle theme",title:"Toggle theme",children:[e.jsx("span",{className:"hidden dark:inline-block",children:e.jsx(te,{className:"w-5 h-5"})}),e.jsx("span",{className:"inline-block dark:hidden",children:e.jsx(se,{className:"w-5 h-5"})})]})}),e.jsxs(ae,{color:i(),size:"sm",className:"md:text-base",children:[e.jsx("span",{className:"hidden sm:inline",children:c.charAt(0).toUpperCase()+c.slice(1)}),e.jsx("span",{className:"sm:hidden",children:"â—"})]}),e.jsxs("span",{className:"text-xs md:text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:"Logged in as: "}),e.jsx("strong",{children:m})]})]})]})}const oe=`ws://${window.location.host}/ws`;function ce(o){const[m,c]=s.useState("disconnected"),[n,h]=s.useState(null),i=s.useRef(null),u=s.useRef(null),d=s.useRef(0),p=s.useRef(()=>{}),g=s.useCallback(()=>{if(!(!o||i.current?.readyState===WebSocket.OPEN)){c("connecting");try{const r=new WebSocket(`${oe}?token=${encodeURIComponent(o)}`);r.onopen=()=>{console.log("WebSocket connected"),c("connected"),d.current=0},r.onmessage=l=>{h(l)},r.onerror=l=>{console.error("WebSocket error:",l),c("error")},r.onclose=()=>{if(console.log("WebSocket disconnected"),c("disconnected"),i.current=null,o){const l=Math.min(1e3*Math.pow(2,d.current),3e4);d.current+=1,u.current=window.setTimeout(()=>{console.log(`Reconnecting WebSocket (attempt ${d.current})...`),p.current()},l)}},i.current=r}catch(r){console.error("Failed to create WebSocket:",r),c("error")}}},[o]);s.useEffect(()=>{p.current=g},[g]);const y=s.useCallback(r=>{i.current?.readyState===WebSocket.OPEN&&i.current.send(r)},[]);return s.useEffect(()=>(o&&g(),()=>{u.current&&clearTimeout(u.current),i.current&&i.current.close()}),[o,g]),{connectionStatus:m,lastMessage:n,sendMessage:y}}const le=60;function he(o){const{connectionStatus:m,lastMessage:c}=ce(o),[n,h]=s.useState(null),[i,u]=s.useState([]),[d,p]=s.useState([]),[g,y]=s.useState([]),[r,l]=s.useState([]),[j,H]=s.useState(new Map);return s.useEffect(()=>{if(c)try{const k=JSON.parse(c.data);if(k.type==="metrics"&&k.data){const b=k.data;h(b.system),u(b.interfaces),p(b.services),y(b.dhcp_clients),l(b.dns_stats),H(v=>{const w=new Map(v);return b.interfaces.forEach(S=>{const E=[...w.get(S.interface)||[],S].slice(-le);w.set(S.interface,E)}),w})}}catch(k){console.error("Failed to parse WebSocket message:",k)}},[c]),{connectionStatus:m,system:n,interfaces:i,services:d,dhcpClients:g,dnsStats:r,interfaceHistory:j}}export{me as N,ge as S,he as u};
