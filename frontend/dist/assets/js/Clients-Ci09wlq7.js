import{j as e,a as m,C as q,T as G,H as K,S as $,b as n,c as w,d as Q,B as g}from"./ui-vendor-BWxpC62h.js";import{u as W,r as x}from"./react-vendor-DKKOAuGG.js";import{u as X,S as Z,N as ee}from"./useMetrics-38sOVjdv.js";import{a as se}from"./index-C4NMJ9I1.js";import"./http-vendor-B9ygI19o.js";function ie(){const o=localStorage.getItem("access_token"),H=localStorage.getItem("username")||"Unknown",k=W(),[f,B]=x.useState(""),[b,F]=x.useState("all"),[y,E]=x.useState("all"),[c,C]=x.useState("all"),[_,u]=x.useState([]),[I,h]=x.useState([]),[M,p]=x.useState([]),[A,D]=x.useState(!1),{connectionStatus:P}=X(o),U=async()=>{await se.logout(),k("/login")};x.useEffect(()=>{const s=async()=>{if(o)try{const a=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${o}`}});if(a.ok){const r=await a.json();u(r)}}catch(a){console.error("Failed to fetch devices:",a)}};s();const t=setInterval(s,1e4);return()=>clearInterval(t)},[o]),x.useEffect(()=>{const s=async()=>{if(o)try{const a=await fetch("/api/devices/blocked",{headers:{Authorization:`Bearer ${o}`}});if(a.ok){const r=await a.json();h(r.ipv4||[]),p((r.macs||[]).map(i=>i.toLowerCase()))}}catch{}};s();const t=setInterval(s,1e4);return()=>clearInterval(t)},[o]);const j=s=>s.mac_address&&M.includes(s.mac_address.toLowerCase())?!0:s.ip_address&&I.includes(s.ip_address),L=async s=>{if(!o)return;const t=!s.favorite;u(a=>a.map(r=>r.mac_address===s.mac_address?{...r,favorite:t}:r));try{await fetch("/api/devices/override",{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({mac_address:s.mac_address,favorite:t})});const a=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${o}`}});a.ok&&u(await a.json())}catch{u(a=>a.map(r=>r.mac_address===s.mac_address?{...r,favorite:!t}:r))}},T=async s=>{if(!o)return;const t=s.nickname||"",a=window.prompt("Set nickname for this device:",t);if(a!==null){u(r=>r.map(i=>i.mac_address===s.mac_address?{...i,nickname:a}:i));try{await fetch("/api/devices/override",{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({mac_address:s.mac_address,nickname:a})});const r=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${o}`}});r.ok&&u(await r.json())}catch{}}},O=async s=>{if(!o)return;const t=j(s),a=t?"/api/devices/unblock":"/api/devices/block",r={mac_address:s.mac_address};s.ip_address&&s.ip_address.includes(".")&&(r.ip_address=s.ip_address),t?(h(i=>i.filter(l=>l!==s.ip_address)),p(i=>i.filter(l=>l!==s.mac_address.toLowerCase()))):r.ip_address&&(h(i=>Array.from(new Set([...i,r.ip_address]))),p(i=>Array.from(new Set([...i,s.mac_address.toLowerCase()]))));try{if((await fetch(a,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify(r)})).ok){const l=await fetch("/api/devices/blocked",{headers:{Authorization:`Bearer ${o}`}});if(l.ok){const d=await l.json();h(d.ipv4||[]),p((d.macs||[]).map(S=>S.toLowerCase()))}}else t?(h(l=>Array.from(new Set([...l,s.ip_address]))),p(l=>Array.from(new Set([...l,s.mac_address.toLowerCase()])))):(h(l=>l.filter(d=>d!==s.ip_address)),p(l=>l.filter(d=>d!==s.mac_address.toLowerCase())))}catch{t?(h(l=>Array.from(new Set([...l,s.ip_address]))),p(l=>Array.from(new Set([...l,s.mac_address.toLowerCase()])))):(h(l=>l.filter(d=>d!==s.ip_address)),p(l=>l.filter(d=>d!==s.mac_address.toLowerCase())))}},N=_.filter(s=>{const t=!f||s.hostname?.toLowerCase().includes(f.toLowerCase())||s.ip_address.includes(f)||s.mac_address.includes(f)||s.vendor?.toLowerCase().includes(f.toLowerCase()),a=b==="all"||b==="online"&&s.is_online||b==="offline"&&!s.is_online,r=y==="all"||y==="dhcp"&&s.is_dhcp||y==="static"&&!s.is_dhcp,i=c==="all"||s.network===c;return t&&a&&r&&i}),v=c==="all"?_:_.filter(s=>s.network===c),V=v.filter(s=>s.is_online).length,J=v.filter(s=>!s.is_online).length,z=v.length,R=s=>{const t=new Date(s),a=new Date,r=new Date(a.getFullYear(),a.getMonth(),a.getDate());if(new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()===r.getTime())return t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});{const l=(t.getMonth()+1).toString().padStart(2,"0"),d=t.getDate().toString().padStart(2,"0"),S=t.getFullYear().toString().slice(-2);return`${l}/${d}/${S}`}},Y=({text:s,maxLength:t=20})=>s.length<=t?e.jsx("span",{children:s}):e.jsx(w,{content:s,placement:"top",children:e.jsx("span",{className:"cursor-help truncate block max-w-[200px]",children:s})});return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Z,{onLogout:U,isOpen:A,onClose:()=>D(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(ee,{hostname:"nixos-router",username:H,connectionStatus:P,onMenuClick:()=>D(!A)}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 bg-gray-50 dark:bg-gray-900",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4 md:mb-6 gap-3",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Devices"}),e.jsxs("div",{className:"flex gap-2 md:gap-4",children:[e.jsxs(m,{color:"success",size:"sm",className:"md:text-base",children:[V," Online"]}),e.jsxs(m,{color:"gray",size:"sm",className:"md:text-base",children:[J," Offline"]}),e.jsxs(m,{color:"info",size:"sm",className:"md:text-base",children:[z," Total"]})]})]}),e.jsxs(q,{children:[e.jsx("div",{className:"mb-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex space-x-1",role:"tablist",children:[e.jsx("button",{role:"tab","aria-selected":c==="all",onClick:()=>C("all"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${c==="all"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"All Networks"}),e.jsx("button",{role:"tab","aria-selected":c==="homelab",onClick:()=>C("homelab"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${c==="homelab"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"HOMELAB"}),e.jsx("button",{role:"tab","aria-selected":c==="lan",onClick:()=>C("lan"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${c==="lan"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"LAN"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsx("div",{children:e.jsx(G,{icon:K,placeholder:"Search...",value:f,onChange:s=>B(s.target.value)})}),e.jsx("div",{children:e.jsxs($,{value:b,onChange:s=>F(s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"online",children:"Online Only"}),e.jsx("option",{value:"offline",children:"Offline Only"})]})}),e.jsx("div",{children:e.jsxs($,{value:y,onChange:s=>E(s.target.value),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"dhcp",children:"DHCP Only"}),e.jsx("option",{value:"static",children:"Static Only"})]})})]}),e.jsxs("div",{className:"xl-custom:hidden mb-4 flex flex-wrap gap-4 text-xs text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Network:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsx("span",{children:"HOMELAB"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-purple-500"}),e.jsx("span",{children:"LAN"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Type:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-500"}),e.jsx("span",{children:"Static"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsx("span",{children:"DHCP"})]})]})]}),e.jsx("div",{className:"hidden min-[1000px]:block overflow-x-auto",children:e.jsxs(n,{children:[e.jsxs(n.Head,{children:[e.jsx(n.HeadCell,{className:"w-12",children:"Status"}),e.jsx(n.HeadCell,{children:"Device"}),e.jsx(n.HeadCell,{children:"IP Address"}),e.jsx(n.HeadCell,{className:"hidden lg:table-cell",children:"MAC Address"}),e.jsx(n.HeadCell,{className:"hidden xl:table-cell",children:"Vendor"}),e.jsx(n.HeadCell,{className:"w-12",children:"Network"}),e.jsx(n.HeadCell,{className:"w-12",children:"Type"}),e.jsx(n.HeadCell,{className:"w-24",children:"Last Seen"}),e.jsx(n.HeadCell,{children:"Actions"})]}),e.jsx(n.Body,{className:"divide-y",children:N.map(s=>e.jsxs(n.Row,{className:s.is_online?"":"opacity-50",children:[e.jsxs(n.Cell,{children:[e.jsx("div",{className:"hidden xl-custom:block",children:e.jsx(m,{color:s.is_online?"success":"gray",size:"sm",children:s.is_online?"ONLINE":"OFFLINE"})}),e.jsx("div",{className:"xl-custom:hidden",children:e.jsx(w,{content:s.is_online?"Online":"Offline",placement:"top",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${s.is_online?"bg-green-500":"bg-gray-400"}`})})})]}),e.jsx(n.Cell,{className:"font-medium max-w-[200px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-yellow-500 hover:text-yellow-400 flex-shrink-0",title:s.favorite?"Unfavorite":"Favorite",onClick:()=>L(s),children:s.favorite?"★":"☆"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 flex-shrink-0",title:"Edit nickname",onClick:()=>T(s),children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx(Y,{text:s.nickname||s.hostname||"Unknown",maxLength:20})]})}),e.jsx(n.Cell,{className:"font-mono text-sm",children:s.ip_address}),e.jsx(n.Cell,{className:"font-mono text-sm hidden lg:table-cell",children:s.mac_address}),e.jsx(n.Cell,{className:"text-sm text-gray-600 hidden xl:table-cell",children:s.vendor||"—"}),e.jsxs(n.Cell,{children:[e.jsx("div",{className:"hidden xl-custom:block",children:e.jsx(m,{color:s.network==="homelab"?"info":"purple",size:"sm",children:s.network.toUpperCase()})}),e.jsx("div",{className:"xl-custom:hidden",children:e.jsx(w,{content:s.network.toUpperCase(),placement:"top",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${s.network==="homelab"?"bg-blue-500":"bg-purple-500"}`})})})]}),e.jsxs(n.Cell,{children:[e.jsx("div",{className:"hidden xl-custom:block",children:e.jsx(m,{color:s.is_dhcp?"warning":"gray",size:"sm",children:s.is_dhcp?"DHCP":"Static"})}),e.jsx("div",{className:"xl-custom:hidden",children:e.jsx(w,{content:s.is_dhcp?"DHCP":"Static",placement:"top",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${s.is_dhcp?"bg-yellow-500":"bg-gray-500"}`})})})]}),e.jsx(n.Cell,{className:"text-sm whitespace-nowrap",children:R(s.last_seen)}),e.jsx(n.Cell,{children:e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[e.jsx(g,{size:"xs",color:"gray",onClick:()=>k(`/devices/${s.ip_address}`),children:"Details"}),e.jsx(g,{size:"xs",color:j(s)?"success":"failure",onClick:()=>O(s),children:j(s)?"Enable":"Disable"})]})})]},s.mac_address))})]})}),e.jsx("div",{className:"min-[1000px]:hidden space-y-3",children:N.map(s=>e.jsxs("div",{className:`p-4 rounded-lg border ${s.is_online?"bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700":"bg-gray-50 border-gray-200 dark:bg-gray-900 dark:border-gray-700 opacity-60"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-lg mb-1",children:s.hostname||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.ip_address})]}),e.jsx(m,{color:s.is_online?"success":"gray",size:"sm",children:s.is_online?"● Online":"○ Offline"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"MAC:"}),e.jsx("span",{className:"font-mono",children:s.mac_address})]}),s.vendor&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Vendor:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:s.vendor})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Network:"}),e.jsx(m,{color:s.network==="homelab"?"info":"purple",size:"sm",children:s.network.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Nickname:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:s.nickname||"—"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Type:"}),e.jsx(m,{color:s.is_dhcp?s.is_static?"success":"warning":"gray",size:"sm",children:s.is_static?"Static DHCP":s.is_dhcp?"Dynamic":"Static IP"})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 pt-1 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("span",{children:"Last seen:"}),e.jsx("span",{children:new Date(s.last_seen).toLocaleString()})]}),e.jsxs("div",{className:"pt-3",children:[e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(g,{size:"xs",color:"gray",onClick:()=>k(`/devices/${s.ip_address}`),className:"flex-1",children:"Details"}),e.jsx(g,{size:"xs",color:j(s)?"success":"failure",onClick:()=>O(s),className:"flex-1",children:j(s)?"Enable":"Disable"})]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(g,{size:"xs",color:"light",className:"flex-1",onClick:()=>T(s),children:"Edit Nickname"}),e.jsx(g,{size:"xs",color:s.favorite?"warning":"light",onClick:()=>L(s),children:s.favorite?"★ Favorite":"☆ Favorite"})]})]})]})]},s.mac_address))}),N.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No devices found matching your filters"}),e.jsx("div",{className:"mt-4 text-xs md:text-sm text-gray-500 text-center md:text-left",children:e.jsxs("p",{children:["Showing ",N.length," of ",z," devices",c!=="all"&&` (${c.toUpperCase()} network)`,e.jsxs("span",{className:"hidden sm:inline",children:[" • ","Auto-refreshing every 10 seconds"]})]})})]})]})]})]})}export{ie as Clients};
