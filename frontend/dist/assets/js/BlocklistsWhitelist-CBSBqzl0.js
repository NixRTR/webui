import{j as e,D as K,A as T,C as $,L as R,p as f,b as l,T as Q,S as V,B as S,v as X,o as F}from"./ui-vendor-BWxpC62h.js";import{u as Y,r as o}from"./react-vendor-DKKOAuGG.js";import{u as Z,S as P,N as z}from"./useMetrics-CKoVEceD.js";import{a as c}from"./index-ufCL5poE.js";import"./http-vendor-B9ygI19o.js";function ie(){const N=localStorage.getItem("access_token"),B=localStorage.getItem("username")||"Unknown",H=Y(),[j,b]=o.useState(!1),[_,L]=o.useState(!0),[D,n]=o.useState(null),[A,m]=o.useState(null),[r,k]=o.useState(null),[d,y]=o.useState(null),[x,v]=o.useState(null),[u,C]=o.useState(null),[w,E]=o.useState(""),[p,q]=o.useState("homelab"),{connectionStatus:O}=Z(N);o.useEffect(()=>{if(!N){H("/login");return}G()},[N]);const G=async()=>{L(!0),n(null);try{const[s,a,t,i]=await Promise.all([c.getBlocklists("homelab"),c.getBlocklists("lan"),c.getWhitelist("homelab"),c.getWhitelist("lan")]);k(s),y(a),v(t),C(i)}catch(s){n(s?.response?.data?.detail||s.message||"Failed to load configuration")}finally{L(!1)}},W=async(s,a)=>{n(null);try{const t=s==="homelab"?r:d;if(!t)return;const i={enable:a,blocklists:t.blocklists};s==="homelab"?(await c.updateBlocklists("homelab",i),k({...t,enable:a})):(await c.updateBlocklists("lan",i),y({...t,enable:a})),m(`Blocklists ${a?"enabled":"disabled"} for ${s.toUpperCase()}`)}catch(t){n(t?.response?.data?.detail||t.message||"Failed to update blocklists")}},I=async(s,a,t)=>{n(null);try{const i=s==="homelab"?r:d;if(!i)return;const h={...i.blocklists,[a]:{...i.blocklists[a],enable:t}},g={enable:i.enable,blocklists:h};s==="homelab"?(await c.updateBlocklists("homelab",g),k({...i,blocklists:h})):(await c.updateBlocklists("lan",g),y({...i,blocklists:h})),m(`Blocklist ${a} ${t?"enabled":"disabled"} for ${s.toUpperCase()}`)}catch(i){n(i?.response?.data?.detail||i.message||"Failed to update blocklist")}},J=async()=>{if(!w.trim()){n("Please enter a domain");return}n(null);try{const s=p==="homelab"?x:u;if(!s)return;const a=[...s.domains,w.trim()],t={domains:a};p==="homelab"?(await c.updateWhitelist("homelab",t),v({domains:a})):(await c.updateWhitelist("lan",t),C({domains:a})),E(""),m(`Domain added to ${p.toUpperCase()} whitelist`)}catch(s){n(s?.response?.data?.detail||s.message||"Failed to add domain")}},U=async(s,a)=>{n(null);try{const t=s==="homelab"?x:u;if(!t)return;const i=t.domains.filter(g=>g!==a),h={domains:i};s==="homelab"?(await c.updateWhitelist("homelab",h),v({domains:i})):(await c.updateWhitelist("lan",h),C({domains:i})),m(`Domain removed from ${s.toUpperCase()} whitelist`)}catch(t){n(t?.response?.data?.detail||t.message||"Failed to remove domain")}},M=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("username"),H("/login")};return _?e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(P,{onLogout:M,isOpen:j,onClose:()=>b(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(z,{hostname:"nixos-router",username:B,connectionStatus:O,onMenuClick:()=>b(!j)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"text-center text-gray-600 dark:text-gray-400",children:"Loading..."})})]})]}):e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(P,{onLogout:M,isOpen:j,onClose:()=>b(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(z,{hostname:"nixos-router",username:B,connectionStatus:O,onMenuClick:()=>b(!j)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(K,{className:"w-8 h-8 mr-3 text-blue-600 dark:text-blue-400"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"DNS Blocklists & Whitelist"})]}),D&&e.jsx(T,{color:"failure",className:"mb-4",onDismiss:()=>n(null),children:D}),A&&e.jsx(T,{color:"success",className:"mb-4",onDismiss:()=>m(null),children:A}),e.jsxs($,{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"DNS Blocklists"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"HOMELAB"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{children:"Master Enable"}),e.jsx(f,{checked:r?.enable||!1,onChange:s=>W("homelab",s)})]})]}),r&&Object.keys(r.blocklists).length>0?e.jsxs(l,{children:[e.jsxs(l.Head,{children:[e.jsx(l.HeadCell,{children:"Blocklist"}),e.jsx(l.HeadCell,{children:"Description"}),e.jsx(l.HeadCell,{children:"URL"}),e.jsx(l.HeadCell,{children:"Update Interval"}),e.jsx(l.HeadCell,{children:"Enabled"})]}),e.jsx(l.Body,{children:Object.entries(r.blocklists).map(([s,a])=>e.jsxs(l.Row,{children:[e.jsx(l.Cell,{className:"font-medium",children:s}),e.jsx(l.Cell,{children:a.description}),e.jsx(l.Cell,{className:"text-sm text-gray-500",children:a.url}),e.jsx(l.Cell,{children:a.updateInterval}),e.jsx(l.Cell,{children:e.jsx(f,{checked:a.enable,onChange:t=>I("homelab",s,t)})})]},s))})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No blocklists configured"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"LAN"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{children:"Master Enable"}),e.jsx(f,{checked:d?.enable||!1,onChange:s=>W("lan",s)})]})]}),d&&Object.keys(d.blocklists).length>0?e.jsxs(l,{children:[e.jsxs(l.Head,{children:[e.jsx(l.HeadCell,{children:"Blocklist"}),e.jsx(l.HeadCell,{children:"Description"}),e.jsx(l.HeadCell,{children:"URL"}),e.jsx(l.HeadCell,{children:"Update Interval"}),e.jsx(l.HeadCell,{children:"Enabled"})]}),e.jsx(l.Body,{children:Object.entries(d.blocklists).map(([s,a])=>e.jsxs(l.Row,{children:[e.jsx(l.Cell,{className:"font-medium",children:s}),e.jsx(l.Cell,{children:a.description}),e.jsx(l.Cell,{className:"text-sm text-gray-500",children:a.url}),e.jsx(l.Cell,{children:a.updateInterval}),e.jsx(l.Cell,{children:e.jsx(f,{checked:a.enable,onChange:t=>I("lan",s,t)})})]},s))})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No blocklists configured"})]})]}),e.jsxs($,{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"DNS Whitelist"}),e.jsxs("div",{className:"mb-6 flex space-x-2",children:[e.jsx(Q,{placeholder:"example.com",value:w,onChange:s=>E(s.target.value),className:"flex-1"}),e.jsxs(V,{value:p,onChange:s=>q(s.target.value),children:[e.jsx("option",{value:"homelab",children:"HOMELAB"}),e.jsx("option",{value:"lan",children:"LAN"})]}),e.jsxs(S,{onClick:J,children:[e.jsx(X,{className:"w-5 h-5 mr-2"}),"Add Domain"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"HOMELAB"}),x&&x.domains.length>0?e.jsx("div",{className:"space-y-2",children:x.domains.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded",children:[e.jsx("span",{children:s}),e.jsx(S,{size:"xs",color:"failure",onClick:()=>U("homelab",s),children:e.jsx(F,{className:"w-4 h-4"})})]},s))}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No domains whitelisted"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"LAN"}),u&&u.domains.length>0?e.jsx("div",{className:"space-y-2",children:u.domains.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded",children:[e.jsx("span",{children:s}),e.jsx(S,{size:"xs",color:"failure",onClick:()=>U("lan",s),children:e.jsx(F,{className:"w-4 h-4"})})]},s))}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No domains whitelisted"})]})]})]})})]})]})}export{ie as BlocklistsWhitelist};
