import{j as e,h as n,i as E,k as S,l as L,m as R,n as M,o as T,p as j,q as W,r as G,F as z,N as y,s as B,c as A,t as D,u as _,a as F}from"./ui-vendor-BVL8hT-S.js";import{j as $,r as t,L as g}from"./react-vendor-DKKOAuGG.js";import{a as v}from"./index-9dKHPhJj.js";function V({onLogout:l,isOpen:m,onClose:a}){const c=$(),[h,o]=t.useState(null),[d,u]=t.useState(!1);t.useEffect(()=>{(async()=>{try{const s=await v.getGitHubStats();o(s)}catch(s){console.error("Failed to fetch GitHub stats:",s),o({stars:0,forks:0})}})()},[]),t.useEffect(()=>{const f=async()=>{try{console.log("Checking CAKE status...");const i=await v.getCakeStatus();console.log("CAKE status response:",i),u(i.enabled)}catch(i){console.error("Failed to check CAKE status:",i),console.error("Error details:",i),u(!1)}};f();const s=setInterval(f,6e4);return()=>clearInterval(s)},[]);const r=()=>{window.innerWidth<1650&&a()};return e.jsxs(e.Fragment,{children:[m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 xl-custom:hidden",onClick:a}),e.jsx("div",{className:`
          fixed xl-custom:static inset-y-0 left-0 z-50
          transform transition-transform duration-300 ease-in-out
          xl-custom:transform-none
          ${m?"translate-x-0":"-translate-x-full xl-custom:translate-x-0"}
        `,children:e.jsx(n,{"aria-label":"Sidebar with navigation",className:"h-full",children:e.jsxs(n.Items,{children:[e.jsxs(n.ItemGroup,{children:[e.jsx(n.Item,{as:g,to:"/dashboard",icon:E,active:c.pathname==="/dashboard",onClick:r,children:"Dashboard"}),e.jsx(n.Item,{as:g,to:"/network",icon:S,active:c.pathname==="/network",onClick:r,children:"Network"}),e.jsx(n.Item,{as:g,to:"/devices",icon:L,active:c.pathname==="/devices",onClick:r,children:"Devices"}),e.jsx(n.Item,{as:g,to:"/device-usage",icon:S,active:c.pathname==="/device-usage",onClick:r,children:"Device Usage"}),e.jsx(n.Item,{as:g,to:"/system",icon:R,active:c.pathname==="/system",onClick:r,children:"System"}),e.jsx(n.Item,{as:g,to:"/speedtest",icon:M,active:c.pathname==="/speedtest",onClick:r,children:"Speedtest"}),d&&e.jsx(n.Item,{as:g,to:"/traffic-shaping",icon:T,active:c.pathname==="/traffic-shaping",onClick:r,children:"Traffic Shaping"})]}),e.jsxs(n.ItemGroup,{children:[e.jsx(n.Item,{as:g,to:"/system-info",icon:j,active:c.pathname==="/system-info",onClick:r,children:"System Info"}),e.jsx(n.Item,{icon:W,style:{cursor:"pointer"},onClick:()=>{r(),l()},children:"Logout"})]}),e.jsxs(n.ItemGroup,{children:[e.jsx(n.Item,{href:"/docs",target:"_blank",rel:"noopener noreferrer",icon:G,as:"a",onClick:r,children:"Documentation"}),e.jsx(n.Item,{href:"https://github.com/BeardedTek/nixos-router",target:"_blank",rel:"noopener noreferrer",icon:z,as:"a",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:"GitHub"}),h!==null&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap",children:["â­ ",h.stars," ðŸ´ ",h.forks]})]})}),e.jsx(n.Item,{href:"https://github.com/BeardedTek/nixos-router/issues",target:"_blank",rel:"noopener noreferrer",icon:j,as:"a",children:"Issues"})]})]})})})]})}function X({hostname:l,username:m,connectionStatus:a,onMenuClick:c}){const h=()=>{const d=document.documentElement;if(d.classList.contains("dark")){d.classList.remove("dark");try{localStorage.setItem("theme","light")}catch{}}else{d.classList.add("dark");try{localStorage.setItem("theme","dark")}catch{}}},o=()=>{switch(a){case"connected":return"success";case"connecting":return"warning";case"error":return"failure";default:return"gray"}};return e.jsxs(y,{fluid:!0,className:"border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:c,className:"p-2 text-gray-500 rounded-lg xl-custom:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600","aria-label":"Toggle menu",children:e.jsx(B,{className:"w-6 h-6"})}),e.jsx(y.Brand,{children:e.jsxs("span",{className:"flex items-center gap-2 self-center whitespace-nowrap text-xl font-semibold text-gray-900 dark:text-white",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 128 128",className:"w-6 h-6 dark:opacity-90 flex-shrink-0",preserveAspectRatio:"xMidYMid meet",children:[e.jsx("path",{fill:"#7EBAE4",d:"M50.732 43.771L20.525 96.428l-7.052-12.033 8.14-14.103-16.167-.042L2 64.237l3.519-6.15 23.013.073 8.27-14.352 13.93-.037zm2.318 42.094l60.409.003-6.827 12.164-16.205-.045 8.047 14.115-3.45 6.01-7.05.008-11.445-20.097-16.483-.034-6.996-12.124zm35.16-23.074l-30.202-52.66L71.888 10l8.063 14.148 8.12-14.072 6.897.002 3.532 6.143-11.57 20.024 8.213 14.386-6.933 12.16z",clipRule:"evenodd",fillRule:"evenodd"}),e.jsx("path",{fill:"#5277C3",d:"M39.831 65.463l30.202 52.66-13.88.131-8.063-14.148-8.12 14.072-6.897-.002-3.532-6.143 11.57-20.024-8.213-14.386 6.933-12.16zm35.08-23.207l-60.409-.003L21.33 30.09l16.204.045-8.047-14.115 3.45-6.01 7.051-.01 11.444 20.097 16.484.034 6.996 12.124zm2.357 42.216l30.207-52.658 7.052 12.034-8.141 14.102 16.168.043L126 64.006l-3.519 6.15-23.013-.073-8.27 14.352-13.93.037z",clipRule:"evenodd",fillRule:"evenodd"})]}),e.jsxs("span",{children:["NixOS Router (",l,")"]})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsx(A,{content:"Toggle theme",placement:"bottom",children:e.jsxs("button",{type:"button",onClick:h,className:"p-2 rounded-lg text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:focus:ring-gray-600","aria-label":"Toggle theme",title:"Toggle theme",children:[e.jsx("span",{className:"hidden dark:inline-block",children:e.jsx(D,{className:"w-5 h-5"})}),e.jsx("span",{className:"inline-block dark:hidden",children:e.jsx(_,{className:"w-5 h-5"})})]})}),e.jsxs(F,{color:o(),size:"sm",className:"md:text-base",children:[e.jsx("span",{className:"hidden sm:inline",children:a.charAt(0).toUpperCase()+a.slice(1)}),e.jsx("span",{className:"sm:hidden",children:"â—"})]}),e.jsxs("span",{className:"text-xs md:text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:"Logged in as: "}),e.jsx("strong",{children:m})]})]})]})}const O=`ws://${window.location.host}/ws`;function U(l){const[m,a]=t.useState("disconnected"),[c,h]=t.useState(null),o=t.useRef(null),d=t.useRef(null),u=t.useRef(0),r=t.useCallback(()=>{if(!(!l||o.current?.readyState===WebSocket.OPEN)){a("connecting");try{const s=new WebSocket(`${O}?token=${encodeURIComponent(l)}`);s.onopen=()=>{console.log("WebSocket connected"),a("connected"),u.current=0},s.onmessage=i=>{h(i)},s.onerror=i=>{console.error("WebSocket error:",i),a("error")},s.onclose=()=>{if(console.log("WebSocket disconnected"),a("disconnected"),o.current=null,l){const i=Math.min(1e3*Math.pow(2,u.current),3e4);u.current+=1,d.current=window.setTimeout(()=>{console.log(`Reconnecting WebSocket (attempt ${u.current})...`),r()},i)}},o.current=s}catch(s){console.error("Failed to create WebSocket:",s),a("error")}}},[l]),f=t.useCallback(s=>{o.current?.readyState===WebSocket.OPEN&&o.current.send(s)},[]);return t.useEffect(()=>(l&&r(),()=>{d.current&&clearTimeout(d.current),o.current&&o.current.close()}),[l,r]),{connectionStatus:m,lastMessage:c,sendMessage:f}}const P=60;function Q(l){const{connectionStatus:m,lastMessage:a}=U(l),[c,h]=t.useState(null),[o,d]=t.useState([]),[u,r]=t.useState([]),[f,s]=t.useState([]),[i,w]=t.useState([]),[C,N]=t.useState(new Map);return t.useEffect(()=>{if(a)try{const p=JSON.parse(a.data);if(p.type==="metrics"&&p.data){const x=p.data;h(x.system),d(x.interfaces),r(x.services),s(x.dhcp_clients),w(x.dns_stats),N(I=>{const k=new Map(I);return x.interfaces.forEach(b=>{const H=[...k.get(b.interface)||[],b].slice(-P);k.set(b.interface,H)}),k})}}catch(p){console.error("Failed to parse WebSocket message:",p)}},[a]),{connectionStatus:m,system:c,interfaces:o,services:u,dhcpClients:f,dnsStats:i,interfaceHistory:C}}export{X as N,V as S,Q as u};
