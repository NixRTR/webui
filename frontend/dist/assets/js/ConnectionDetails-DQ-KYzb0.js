import{j as e,C as ne,L as d,S as p,T as U,b as a,B as O,M as F,c as ie}from"./ui-vendor-Dv8JEsyA.js";import{i as de,u as ce,r as o,L as me}from"./react-vendor-DKKOAuGG.js";import{u as he,S as xe,N as ue}from"./useMetrics-BMP7VOaw.js";import{a as D}from"./index-BH8yc2N5.js";import{R as pe,L as ve,C as je,X as ge,Y as be,T as fe,a as Ce,b as E}from"./charts-_iF2RbR3.js";import"./http-vendor-B9ygI19o.js";function g(b){return/^(\d+)([mhdwMy])$/.test(b)}function Me({sourcePage:b}){const{ipAddress:r}=de(),v=localStorage.getItem("access_token"),K=localStorage.getItem("username")||"Unknown",G=ce(),[W,X]=o.useState([]),[I,T]=o.useState(!1),[w,R]=o.useState(!1),[n,Y]=o.useState(null),[q,J]=o.useState([]),[c,Q]=o.useState("1h"),[m,L]=o.useState(""),[_,V]=o.useState(5),[k,Z]=o.useState("raw"),[h,ee]=o.useState("1h"),[i,B]=o.useState(""),[j,P]=o.useState(null),[f,C]=o.useState("asc"),$=s=>["download_mb","download_mbps","upload_mb","upload_mbps"].includes(s),{connectionStatus:se}=he(v),te=async()=>{await D.logout(),G("/login")},A=async()=>{if(!(!v||!r))try{const s=h==="custom"&&i?i:h;if(h==="custom"&&!g(s))return;const t=await D.getClientConnections(r,s);X(t)}catch(s){console.error("Failed to fetch connections:",s)}};o.useEffect(()=>{A();const s=setInterval(A,5e3);return()=>clearInterval(s)},[v,r,h,i]);const H=async()=>{if(!(!v||!r||!n))try{const s=c==="custom"&&m?m:c;if(c==="custom"&&!g(s))return;const t=await D.getConnectionHistory(r,n.remoteIp,n.remotePort,s,k);J(t.data||[])}catch(s){console.error("Failed to fetch chart data:",s)}};o.useEffect(()=>{if(w&&n){H();const s=setInterval(H,_*1e3);return()=>clearInterval(s)}},[v,r,n,c,m,k,_,w]);const z=s=>{Y({remoteIp:s.remote_ip,remotePort:s.remote_port}),R(!0)},N=s=>{const t=s.split(".");if(t.length===4){const l=t[3].padStart(3,"0");return`${t[0]}.${t[1]}.${t[2]}.${l}`}return s},x=s=>{j===s?C(f==="asc"?"desc":"asc"):(P(s),C($(s)?"desc":"asc"))},S=[...W].sort((s,t)=>{if(!j){const le=N(s.remote_ip),re=N(t.remote_ip);return le.localeCompare(re)}let l=0;switch(j){case"ip":l=N(s.remote_ip).localeCompare(N(t.remote_ip));break;case"hostname":l=(s.hostname||"").localeCompare(t.hostname||"");break;case"download_mb":l=s.download_mb-t.download_mb;break;case"download_mbps":l=s.download_mbps-t.download_mbps;break;case"upload_mb":l=s.upload_mb-t.upload_mb;break;case"upload_mbps":l=s.upload_mbps-t.upload_mbps;break;default:return 0}return f==="asc"?l:-l}),u=s=>j!==s?null:f==="asc"?" ↑":" ↓",M=q.map(s=>({time:new Date(s.timestamp).toLocaleTimeString(),download:s.rx_mbps||0,upload:s.tx_mbps||0})),y=s=>{if(s===0||!s||isNaN(s))return"0.00 MB";const t=s*1024*1024;return t>=1024*1024*1024*1024?(t/1099511627776).toFixed(2)+" TB":t>=1024*1024*1024?(t/1073741824).toFixed(2)+" GB":t>=1024*1024?s.toFixed(2)+" MB":t>=1024?(t/1024).toFixed(2)+" KB":t.toFixed(0)+" B"},ae=b==="device-usage"?"Device Usage":"Devices",oe=({text:s,maxLength:t=25})=>!s||s.length<=t?e.jsx("span",{children:s||"—"}):e.jsx(ie,{content:s,placement:"top",children:e.jsx("span",{className:"cursor-help truncate block max-w-[250px]",children:s})});return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(xe,{onLogout:te,isOpen:I,onClose:()=>T(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(ue,{hostname:"nixos-router",username:K,connectionStatus:se,onMenuClick:()=>T(!I)}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 bg-gray-50 dark:bg-gray-900",children:[e.jsxs("div",{className:"mb-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(me,{to:`/${b}`,className:"hover:text-gray-900 dark:hover:text-gray-100",children:ae}),e.jsx("span",{className:"mx-2",children:"›"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:r})]}),e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold mb-4 md:mb-6",children:["Connection Details - ",r]}),e.jsxs(ne,{children:[e.jsxs("div",{className:"mb-4 flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{className:"min-w-[150px]",children:[e.jsx(d,{htmlFor:"table-range",value:"Time Period"}),e.jsxs(p,{id:"table-range",value:h,onChange:s=>{ee(s.target.value),s.target.value!=="custom"&&B("")},children:[e.jsx("option",{value:"1m",children:"1 minute"}),e.jsx("option",{value:"5m",children:"5 minutes"}),e.jsx("option",{value:"10m",children:"10 minutes"}),e.jsx("option",{value:"30m",children:"30 minutes"}),e.jsx("option",{value:"1h",children:"1 hour"}),e.jsx("option",{value:"3h",children:"3 hours"}),e.jsx("option",{value:"6h",children:"6 hours"}),e.jsx("option",{value:"12h",children:"12 hours"}),e.jsx("option",{value:"1d",children:"1 day"}),e.jsx("option",{value:"1w",children:"1 week"}),e.jsx("option",{value:"1M",children:"1 month"}),e.jsx("option",{value:"1y",children:"1 year"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),h==="custom"&&e.jsxs("div",{className:"min-w-[150px]",children:[e.jsx(d,{htmlFor:"table-custom",value:"Custom Range"}),e.jsx(U,{id:"table-custom",placeholder:"e.g., 45m, 2h, 3d",value:i,onChange:s=>B(s.target.value),color:i&&!g(i)?"failure":void 0,helperText:i&&!g(i)?"Format: 1m, 5m, 1h, 1d, 1w, 1M, 1y":void 0})]})]}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs(a,{children:[e.jsxs(a.Head,{children:[e.jsxs(a.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>x("ip"),children:["IP Address : Port",u("ip")]}),e.jsxs(a.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>x("hostname"),children:["Hostname",u("hostname")]}),e.jsxs(a.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>x("download_mb"),children:["Download",u("download_mb")]}),e.jsxs(a.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 hidden lg:table-cell",onClick:()=>x("download_mbps"),children:["Peak DL Mbit/s",u("download_mbps")]}),e.jsxs(a.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>x("upload_mb"),children:["Upload",u("upload_mb")]}),e.jsxs(a.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 hidden lg:table-cell",onClick:()=>x("upload_mbps"),children:["Peak UL Mbit/s",u("upload_mbps")]}),e.jsx(a.HeadCell,{children:"Actions"})]}),e.jsx(a.Body,{className:"divide-y",children:S.map(s=>e.jsxs(a.Row,{children:[e.jsxs(a.Cell,{className:"font-mono text-sm",children:[s.remote_ip,":",s.remote_port]}),e.jsx(a.Cell,{className:"max-w-[250px]",children:e.jsx(oe,{text:s.hostname||"",maxLength:25})}),e.jsx(a.Cell,{className:"text-sm",children:y(s.download_mb)}),e.jsxs(a.Cell,{className:"text-sm hidden lg:table-cell",children:[s.download_mbps.toFixed(2)," Mbit/s"]}),e.jsx(a.Cell,{className:"text-sm",children:y(s.upload_mb)}),e.jsxs(a.Cell,{className:"text-sm hidden lg:table-cell",children:[s.upload_mbps.toFixed(2)," Mbit/s"]}),e.jsx(a.Cell,{children:e.jsx(O,{size:"xs",color:"blue",onClick:()=>z(s),children:"Chart"})})]},`${s.remote_ip}:${s.remote_port}`))})]})}),e.jsxs("div",{className:"md:hidden",children:[e.jsxs("div",{className:"mb-4 flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(d,{htmlFor:"mobile-sort-field",value:"Sort By",className:"text-xs mb-1"}),e.jsxs(p,{id:"mobile-sort-field",sizing:"sm",value:j||"ip",onChange:s=>{const t=s.target.value;P(t),C($(t)?"desc":"asc")},children:[e.jsx("option",{value:"ip",children:"IP Address : Port"}),e.jsx("option",{value:"hostname",children:"Hostname"}),e.jsx("option",{value:"download_mb",children:"Download"}),e.jsx("option",{value:"download_mbps",children:"Peak Download Mbit/s"}),e.jsx("option",{value:"upload_mb",children:"Upload"}),e.jsx("option",{value:"upload_mbps",children:"Peak Upload Mbit/s"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(d,{htmlFor:"mobile-sort-direction",value:"Direction",className:"text-xs mb-1"}),e.jsxs(p,{id:"mobile-sort-direction",sizing:"sm",value:f,onChange:s=>C(s.target.value),children:[e.jsx("option",{value:"asc",children:"Ascending"}),e.jsx("option",{value:"desc",children:"Descending"})]})]})]}),e.jsx("div",{className:"space-y-3",children:S.map(s=>e.jsxs("div",{className:"p-4 rounded-lg border bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700",children:[e.jsxs("div",{className:"font-semibold text-lg mb-2 font-mono",children:[s.remote_ip,":",s.remote_port]}),s.hostname&&e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:s.hostname}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Download"}),e.jsx("div",{children:y(s.download_mb)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.download_mbps.toFixed(2)," Mbit/s"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Upload"}),e.jsx("div",{children:y(s.upload_mb)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.upload_mbps.toFixed(2)," Mbit/s"]})]})]}),e.jsx(O,{size:"xs",color:"blue",onClick:()=>z(s),className:"w-full",children:"Chart"})]},`${s.remote_ip}:${s.remote_port}`))})]}),S.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No connections found for this time period."})]}),e.jsxs(F,{show:w,onClose:()=>R(!1),size:"xl",children:[e.jsxs(F.Header,{children:["Connection - ",n?`${n.remoteIp}:${n.remotePort}`:""]}),e.jsx(F.Body,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"min-w-[120px]",children:[e.jsx(d,{htmlFor:"chart-range",value:"Time Range",className:"text-xs mb-1"}),e.jsxs(p,{id:"chart-range",sizing:"sm",value:c,onChange:s=>{Q(s.target.value),s.target.value!=="custom"&&L("")},children:[e.jsx("option",{value:"1m",children:"1 minute"}),e.jsx("option",{value:"5m",children:"5 minutes"}),e.jsx("option",{value:"10m",children:"10 minutes"}),e.jsx("option",{value:"30m",children:"30 minutes"}),e.jsx("option",{value:"1h",children:"1 hour"}),e.jsx("option",{value:"3h",children:"3 hours"}),e.jsx("option",{value:"6h",children:"6 hours"}),e.jsx("option",{value:"12h",children:"12 hours"}),e.jsx("option",{value:"1d",children:"1 day"}),e.jsx("option",{value:"1w",children:"1 week"}),e.jsx("option",{value:"1M",children:"1 month"}),e.jsx("option",{value:"1y",children:"1 year"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),c==="custom"&&e.jsxs("div",{className:"min-w-[100px]",children:[e.jsx(d,{htmlFor:"chart-custom",value:"Custom",className:"text-xs mb-1"}),e.jsx(U,{id:"chart-custom",sizing:"sm",placeholder:"e.g., 45m",value:m,onChange:s=>L(s.target.value),color:m&&!g(m)?"failure":void 0})]}),e.jsxs("div",{className:"min-w-[120px]",children:[e.jsx(d,{htmlFor:"chart-interval",value:"Interval",className:"text-xs mb-1"}),e.jsxs(p,{id:"chart-interval",sizing:"sm",value:k,onChange:s=>Z(s.target.value),children:[e.jsx("option",{value:"raw",children:"Raw"}),e.jsx("option",{value:"1m",children:"1 minute"}),e.jsx("option",{value:"5m",children:"5 minutes"}),e.jsx("option",{value:"1h",children:"1 hour"})]})]}),e.jsxs("div",{className:"min-w-[120px]",children:[e.jsx(d,{htmlFor:"chart-refresh",value:"Update Every",className:"text-xs mb-1"}),e.jsxs(p,{id:"chart-refresh",sizing:"sm",value:_,onChange:s=>V(Number(s.target.value)),children:[e.jsx("option",{value:1,children:"1 second"}),e.jsx("option",{value:5,children:"5 seconds"}),e.jsx("option",{value:10,children:"10 seconds"}),e.jsx("option",{value:30,children:"30 seconds"}),e.jsx("option",{value:60,children:"1 minute"})]})]})]}),M.length>0?e.jsx(pe,{width:"100%",height:300,children:e.jsxs(ve,{data:M,children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ge,{dataKey:"time",tick:{fontSize:12},interval:Math.floor(M.length/8)}),e.jsx(be,{tick:{fontSize:12},label:{value:"Mbit/s",angle:-90,position:"insideLeft"}}),e.jsx(fe,{}),e.jsx(Ce,{}),e.jsx(E,{type:"monotone",dataKey:"download",stroke:"#3b82f6",name:"Download (Mbit/s)",strokeWidth:2,dot:!1,isAnimationActive:!1}),e.jsx(E,{type:"monotone",dataKey:"upload",stroke:"#10b981",name:"Upload (Mbit/s)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No connection data available for this time range."})]})})]})]})]})]})}export{Me as ConnectionDetails};
