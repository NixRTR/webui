import{j as e,a as p,C as Se,T as ve,H as De,S as re,b as r,c as Le,d as b,D as Pe,e as F,B as h,f as He,M as K,g as ze}from"./ui-vendor-H-3CurRd.js";import{u as Te,a as i}from"./react-vendor-DIDCmA_u.js";import{u as Ae,S as Oe,N as Me}from"./useMetrics-BfELKp6-.js";import{a as v}from"./index-C3neANUc.js";import{H as $e}from"./HostnameEditModal-ByvmimBC.js";import{T as D}from"./TruncatedCell-CmoRKVhh.js";import"./http-vendor-B9ygI19o.js";function Ye(){const d=localStorage.getItem("access_token"),ne=localStorage.getItem("username")||"Unknown",_=Te(),[k,le]=i.useState(""),[L,oe]=i.useState("all"),[P,ce]=i.useState("all"),[x,E]=i.useState("all"),[H,C]=i.useState([]),[ie,u]=i.useState([]),[de,f]=i.useState([]),[Q,W]=i.useState(!1),[I,me]=i.useState("ip"),[U,X]=i.useState("asc"),[xe,z]=i.useState(!1),[c,R]=i.useState(null),[T,V]=i.useState(null),[N,Y]=i.useState(new Map),[he,A]=i.useState(!1),[w,Z]=i.useState(null),[pe,ge]=i.useState([]),{connectionStatus:ue}=Ae(d);i.useEffect(()=>{d&&v.getDhcpNetworks().then(ge).catch(()=>{})},[d]);const fe=async()=>{await v.logout(),_("/login")},J=async s=>{if(d)try{A(!0),V(s);const a=await v.getDevicePortScan(s);R(a),Y(t=>new Map(t).set(s.toLowerCase(),a.scan_status)),z(!0)}catch(a){a.response?.status===404?(V(s),R(null),z(!0)):(console.error("Failed to fetch port scan:",a),alert("Failed to load port scan results"))}finally{A(!1)}},S=async s=>{if(d)try{A(!0);const a=await v.triggerDevicePortScan(s);a.status==="queued"||a.status==="in_progress"?(Y(t=>new Map(t).set(s.toLowerCase(),"pending")),setTimeout(()=>{J(s)},2e3)):alert(a.message||"Failed to trigger scan")}catch(a){console.error("Failed to trigger port scan:",a),alert("Failed to trigger port scan")}finally{A(!1)}},je=s=>{const a=s.mac_address.toLowerCase(),t=N.get(a),l=t==="pending"||t==="in_progress",n=t==="completed",o=t==="failed";return s.is_online?l?e.jsx(b,{content:"Port scan in progress",children:e.jsxs(h,{size:"xs",color:"gray",disabled:!0,children:[e.jsx(ze,{className:"w-3 h-3 mr-1"}),"Scanning..."]})}):o?e.jsx(b,{content:"Last scan failed - click to retry",children:e.jsx(h,{size:"xs",color:"failure",onClick:()=>S(s.mac_address),children:"Ports (Failed)"})}):e.jsx(b,{content:n?"View port scan results":"Scan ports",children:e.jsxs(h,{size:"xs",color:"gray",onClick:()=>{n?J(s.mac_address):S(s.mac_address)},children:["Ports",n&&c?` (${c.ports.length})`:""]})}):e.jsx(b,{content:"Device is offline",children:e.jsx(h,{size:"xs",color:"gray",disabled:!0,children:"Ports"})})};i.useEffect(()=>{const s=async()=>{if(d)try{const t=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${d}`}});if(t.ok){const l=await t.json();C(l);const n=l.filter(g=>g.is_online),o=new Map,m=10;for(let g=0;g<n.length;g+=m){const Ce=n.slice(g,g+m);await Promise.allSettled(Ce.map(async G=>{try{const B=await v.getDevicePortScan(G.mac_address);o.set(G.mac_address.toLowerCase(),B.scan_status)}catch(B){B.response?.status!==404&&console.debug(`Failed to fetch port scan for ${G.mac_address}:`,B)}}))}Y(o)}}catch(t){console.error("Failed to fetch devices:",t)}};s();const a=setInterval(s,2e4);return()=>clearInterval(a)},[d]),i.useEffect(()=>{const s=async()=>{if(d)try{const t=await fetch("/api/devices/blocked",{headers:{Authorization:`Bearer ${d}`}});if(t.ok){const l=await t.json();u(l.ipv4||[]),f((l.macs||[]).map(n=>n.toLowerCase()))}}catch{}};s();const a=setInterval(s,2e4);return()=>clearInterval(a)},[d]);const O=s=>s.mac_address&&de.includes(s.mac_address.toLowerCase())?!0:s.ip_address&&ie.includes(s.ip_address),ee=async s=>{if(!d)return;const a=!s.favorite;C(t=>t.map(l=>l.mac_address===s.mac_address?{...l,favorite:a}:l));try{await fetch("/api/devices/override",{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({mac_address:s.mac_address,favorite:a})});const t=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${d}`}});t.ok&&C(await t.json())}catch{C(t=>t.map(l=>l.mac_address===s.mac_address?{...l,favorite:!a}:l))}},se=s=>{Z(s)},ye=async()=>{if(d)try{const s=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${d}`}});s.ok&&C(await s.json())}catch(s){console.error("Failed to refetch devices:",s)}},ae=async s=>{if(!d)return;const a=O(s),t=a?"/api/devices/unblock":"/api/devices/block",l={mac_address:s.mac_address};s.ip_address&&s.ip_address.includes(".")&&(l.ip_address=s.ip_address),a?(s.ip_address&&u(n=>n.filter(o=>o!==s.ip_address)),f(n=>n.filter(o=>o!==s.mac_address.toLowerCase()))):(f(n=>Array.from(new Set([...n,s.mac_address.toLowerCase()]))),l.ip_address&&u(n=>Array.from(new Set([...n,l.ip_address]))));try{if((await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify(l)})).ok){await new Promise(m=>setTimeout(m,100));const o=await fetch("/api/devices/blocked",{headers:{Authorization:`Bearer ${d}`}});if(o.ok){const m=await o.json();u(m.ipv4||[]),f((m.macs||[]).map(g=>g.toLowerCase()))}else console.warn("Failed to refetch blocked list after block/unblock operation")}else a?(s.ip_address&&u(o=>Array.from(new Set([...o,s.ip_address]))),f(o=>Array.from(new Set([...o,s.mac_address.toLowerCase()])))):(s.ip_address&&u(o=>o.filter(m=>m!==s.ip_address)),f(o=>o.filter(m=>m!==s.mac_address.toLowerCase())))}catch{a?(s.ip_address&&u(n=>Array.from(new Set([...n,s.ip_address]))),f(n=>Array.from(new Set([...n,s.mac_address.toLowerCase()])))):(s.ip_address&&u(n=>n.filter(o=>o!==s.ip_address)),f(n=>n.filter(o=>o!==s.mac_address.toLowerCase())))}},we=H.filter(s=>{const a=!k||(s.hostname||"").toLowerCase().includes(k.toLowerCase())||s.ip_address.includes(k)||s.mac_address.includes(k)||s.vendor?.toLowerCase().includes(k.toLowerCase()),t=L==="all"||L==="online"&&s.is_online||L==="offline"&&!s.is_online,l=P==="all"||P==="dhcp"&&s.is_dhcp||P==="static"&&!s.is_dhcp,n=x==="all"||s.network===x;return a&&t&&l&&n}),q=x==="all"?H:H.filter(s=>s.network===x),be=q.filter(s=>s.is_online).length,ke=q.filter(s=>!s.is_online).length,te=q.length,M=s=>s.split(".").map(a=>a.padStart(3,"0")).join("."),j=s=>{I===s?X(U==="asc"?"desc":"asc"):(me(s),X("asc"))},y=s=>I!==s?null:U==="asc"?" ↑":" ↓",$=[...we].sort((s,a)=>{let t=0;switch(I){case"ip":{const l=M(s.ip_address),n=M(a.ip_address);t=l.localeCompare(n);break}case"device":t=(s.hostname||"").toLowerCase().localeCompare((a.hostname||"").toLowerCase());break;case"mac":t=s.mac_address.localeCompare(a.mac_address);break;case"vendor":{const l=s.vendor||"￿",n=a.vendor||"￿";t=l.toLowerCase().localeCompare(n.toLowerCase());break}case"network":t=s.network.localeCompare(a.network);break;case"status":t=(a.is_online?1:0)-(s.is_online?1:0);break;case"type":t=(a.is_dhcp?1:0)-(s.is_dhcp?1:0);break;case"lastSeen":{const l=new Date(s.last_seen).getTime(),n=new Date(a.last_seen).getTime();t=l-n;break}default:t=M(s.ip_address).localeCompare(M(a.ip_address))}return U==="asc"?t:-t}),Ne=s=>{const a=new Date(s),t=new Date,l=new Date(t.getFullYear(),t.getMonth(),t.getDate());if(new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime()===l.getTime())return a.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});{const o=(a.getMonth()+1).toString().padStart(2,"0"),m=a.getDate().toString().padStart(2,"0"),g=a.getFullYear().toString().slice(-2);return`${o}/${m}/${g}`}},_e=s=>{if(!s.is_online)return;const a=s.mac_address.toLowerCase(),t=N.get(a);t==="pending"||t==="in_progress"||(t==="failed"?S(s.mac_address):J(s.mac_address))};return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Oe,{onLogout:fe,isOpen:Q,onClose:()=>W(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(Me,{hostname:"nixos-router",username:ne,connectionStatus:ue,onMenuClick:()=>W(!Q)}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 bg-gray-50 dark:bg-gray-900",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4 md:mb-6 gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Devices"}),e.jsxs("p",{className:"text-xs md:text-sm text-gray-500",children:["Showing ",$.length," of ",te," devices",x!=="all"&&` (${x.toUpperCase()} network)`,e.jsxs("span",{className:"hidden sm:inline",children:[" • ","Auto-refreshing every 20 seconds"]})]})]}),e.jsxs("div",{className:"flex gap-2 md:gap-4",children:[e.jsxs(p,{color:"success",size:"sm",className:"md:text-base",children:[be," Online"]}),e.jsxs(p,{color:"gray",size:"sm",className:"md:text-base",children:[ke," Offline"]}),e.jsxs(p,{color:"info",size:"sm",className:"md:text-base",children:[te," Total"]})]})]}),e.jsxs(Se,{children:[e.jsxs("div",{className:"min-[1000px]:sticky min-[1000px]:top-0 min-[1000px]:z-20 min-[1000px]:bg-white min-[1000px]:dark:bg-gray-800",children:[e.jsx("div",{className:"mb-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex space-x-1",role:"tablist",children:[e.jsx("button",{role:"tab","aria-selected":x==="all",onClick:()=>E("all"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${x==="all"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"All Networks"}),e.jsx("button",{role:"tab","aria-selected":x==="homelab",onClick:()=>E("homelab"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${x==="homelab"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"HOMELAB"}),e.jsx("button",{role:"tab","aria-selected":x==="lan",onClick:()=>E("lan"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${x==="lan"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"LAN"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsx("div",{children:e.jsx(ve,{icon:De,placeholder:"Search...",value:k,onChange:s=>le(s.target.value)})}),e.jsx("div",{children:e.jsxs(re,{value:L,onChange:s=>oe(s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"online",children:"Online Only"}),e.jsx("option",{value:"offline",children:"Offline Only"})]})}),e.jsx("div",{children:e.jsxs(re,{value:P,onChange:s=>ce(s.target.value),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"dhcp",children:"DHCP Only"}),e.jsx("option",{value:"static",children:"Static Only"})]})})]})]}),e.jsxs("div",{className:"xl-custom:hidden mb-4 flex flex-wrap gap-4 text-xs text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Network:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsx("span",{children:"HOMELAB"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-purple-500"}),e.jsx("span",{children:"LAN"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Type:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-500"}),e.jsx("span",{children:"Static"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsx("span",{children:"DHCP"})]})]})]}),e.jsx("div",{className:"hidden min-[1000px]:block overflow-x-auto",children:e.jsxs(r,{children:[e.jsxs(r.Head,{children:[e.jsxs(r.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>j("ip"),children:["IP Address",y("ip")]}),e.jsxs(r.HeadCell,{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>j("device"),children:["Device",y("device")]}),e.jsxs(r.HeadCell,{className:"hidden lg:table-cell cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>j("mac"),children:["MAC Address",y("mac")]}),e.jsxs(r.HeadCell,{className:"hidden xl:table-cell cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>j("vendor"),children:["Vendor",y("vendor")]}),e.jsxs(r.HeadCell,{className:"w-12 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>j("network"),children:["Network",y("network")]}),e.jsxs(r.HeadCell,{className:"w-12 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>j("status"),children:["Status",y("status")]}),e.jsxs(r.HeadCell,{className:"w-12 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>j("type"),children:["Type",y("type")]}),e.jsxs(r.HeadCell,{className:"w-24 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>j("lastSeen"),children:["Last Seen",y("lastSeen")]}),e.jsx(r.HeadCell,{children:"Actions"})]}),e.jsx(r.Body,{className:"divide-y",children:$.map(s=>e.jsxs(r.Row,{className:`whitespace-nowrap ${s.is_online?"":"opacity-50"}`,children:[e.jsx(r.Cell,{className:"font-mono text-sm min-w-0 max-w-[140px]",children:e.jsx(D,{value:s.ip_address})}),e.jsx(r.Cell,{className:"font-medium min-w-0 max-w-[200px]",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("button",{className:"text-yellow-500 hover:text-yellow-400 flex-shrink-0",title:s.favorite?"Unfavorite":"Favorite",onClick:()=>ee(s),children:s.favorite?"★":"☆"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 flex-shrink-0",title:"Edit hostname",onClick:()=>se(s),children:e.jsx(Le,{className:"w-4 h-4"})}),e.jsx(D,{value:s.hostname||"Unknown",className:"min-w-0"})]})}),e.jsx(r.Cell,{className:"font-mono text-sm hidden lg:table-cell min-w-0 max-w-[160px]",children:e.jsx(D,{value:s.mac_address})}),e.jsx(r.Cell,{className:"text-sm text-gray-600 dark:text-gray-400 hidden xl:table-cell min-w-0 max-w-[180px]",children:e.jsx(D,{value:s.vendor??"",emptyPlaceholder:"—"})}),e.jsxs(r.Cell,{className:"align-middle w-12",children:[e.jsx("div",{className:"hidden xl-custom:block",children:e.jsx(p,{color:s.network==="homelab"?"info":"purple",size:"sm",children:s.network.toUpperCase()})}),e.jsx("div",{className:"xl-custom:hidden flex items-center justify-center",children:e.jsx(b,{content:s.network.toUpperCase(),placement:"top",children:e.jsx("div",{className:`w-3 h-3 rounded-full flex-shrink-0 ${s.network==="homelab"?"bg-blue-500":"bg-purple-500"}`})})})]}),e.jsxs(r.Cell,{className:"align-middle w-12",children:[e.jsx("div",{className:"hidden xl-custom:block",children:e.jsx(p,{color:s.is_online?"success":"gray",size:"sm",children:s.is_online?"ONLINE":"OFFLINE"})}),e.jsx("div",{className:"xl-custom:hidden flex items-center justify-center",children:e.jsx(b,{content:s.is_online?"Online":"Offline",placement:"top",children:e.jsx("div",{className:`w-3 h-3 rounded-full flex-shrink-0 ${s.is_online?"bg-green-500":"bg-gray-400"}`})})})]}),e.jsxs(r.Cell,{className:"align-middle w-12",children:[e.jsx("div",{className:"hidden xl-custom:block",children:e.jsx(p,{color:s.is_dhcp?"warning":"gray",size:"sm",children:s.is_dhcp?"DHCP":"Static"})}),e.jsx("div",{className:"xl-custom:hidden flex items-center justify-center",children:e.jsx(b,{content:s.is_dhcp?"DHCP":"Static",placement:"top",children:e.jsx("div",{className:`w-3 h-3 rounded-full flex-shrink-0 ${s.is_dhcp?"bg-yellow-500":"bg-gray-500"}`})})})]}),e.jsx(r.Cell,{className:"text-sm min-w-0 max-w-[100px]",children:e.jsx(D,{value:Ne(s.last_seen)})}),e.jsx(r.Cell,{className:"whitespace-nowrap w-10",children:e.jsxs(Pe,{label:"",dismissOnClick:!0,renderTrigger:()=>e.jsx(h,{size:"xs",color:"gray",className:"px-2",children:e.jsx(He,{className:"w-4 h-4"})}),children:[e.jsx(F,{onClick:()=>_(`/devices/by-mac/${s.mac_address}`),children:"Details"}),e.jsx(F,{onClick:()=>_(`/devices/${s.ip_address}`),children:"Usage"}),e.jsx(F,{onClick:()=>ae(s),children:O(s)?"Enable":"Disable"}),e.jsx(F,{onClick:()=>_e(s),disabled:!s.is_online||N.get(s.mac_address.toLowerCase())==="pending"||N.get(s.mac_address.toLowerCase())==="in_progress",children:N.get(s.mac_address.toLowerCase())==="pending"||N.get(s.mac_address.toLowerCase())==="in_progress"?"Ports (scanning…)":"Ports"})]})})]},s.mac_address))})]})}),e.jsx("div",{className:"min-[1000px]:hidden space-y-3",children:$.map(s=>e.jsxs("div",{className:`p-4 rounded-lg border ${s.is_online?"bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700":"bg-gray-50 border-gray-200 dark:bg-gray-900 dark:border-gray-700 opacity-60"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-lg mb-1 text-gray-900 dark:text-white",children:s.hostname||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.ip_address})]}),e.jsx(p,{color:s.is_online?"success":"gray",size:"sm",children:s.is_online?"● Online":"○ Offline"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"MAC:"}),e.jsx("span",{className:"font-mono",children:s.mac_address})]}),s.vendor&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Vendor:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:s.vendor})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Network:"}),e.jsx(p,{color:s.network==="homelab"?"info":"purple",size:"sm",children:s.network.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Hostname:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:s.hostname||"—"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Type:"}),e.jsx(p,{color:s.is_dhcp?s.is_static?"success":"warning":"gray",size:"sm",children:s.is_static?"Static DHCP":s.is_dhcp?"Dynamic":"Static IP"})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 pt-1 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("span",{children:"Last seen:"}),e.jsx("span",{children:new Date(s.last_seen).toLocaleString()})]}),e.jsxs("div",{className:"pt-3",children:[e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(h,{size:"xs",color:"gray",onClick:()=>_(`/devices/by-mac/${s.mac_address}`),className:"flex-1",children:"Details"}),e.jsx(h,{size:"xs",color:"gray",onClick:()=>_(`/devices/${s.ip_address}`),className:"flex-1",children:"Usage"}),e.jsx(h,{size:"xs",color:O(s)?"success":"failure",onClick:()=>ae(s),className:"flex-1",children:O(s)?"Enable":"Disable"})]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(h,{size:"xs",color:"light",className:"flex-1",onClick:()=>se(s),children:"Edit hostname"}),e.jsx(h,{size:"xs",color:s.favorite?"warning":"light",onClick:()=>ee(s),children:s.favorite?"★ Favorite":"☆ Favorite"})]}),e.jsx("div",{className:"mt-2",children:je(s)})]})]})]},s.mac_address))}),$.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No devices found matching your filters"})]}),e.jsxs(K,{show:xe,onClose:()=>{z(!1),R(null),V(null)},size:"xl",children:[e.jsxs(K.Header,{children:["Port Scan Results",c?e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:[c.mac_address," (",c.ip_address,")"]}):T?e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:T}):null]}),e.jsx(K.Body,{children:he?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-gray-100"}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"Loading port scan results..."})]}):c?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(p,{color:c.scan_status==="completed"?"success":c.scan_status==="failed"?"failure":c.scan_status==="in_progress"?"warning":"gray",children:c.scan_status.toUpperCase()}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-400",children:["Started: ",new Date(c.scan_started_at).toLocaleString()]}),c.scan_completed_at&&e.jsxs("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-400",children:["Completed: ",new Date(c.scan_completed_at).toLocaleString()]})]}),e.jsx(h,{size:"xs",color:"gray",onClick:()=>{c&&S(c.mac_address)},children:"Refresh Scan"})]}),c.error_message&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded",children:e.jsxs("p",{className:"text-sm text-red-800 dark:text-red-200",children:[e.jsx("strong",{children:"Error:"})," ",c.error_message]})}),c.ports.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(r,{children:[e.jsxs(r.Head,{children:[e.jsx(r.HeadCell,{children:"Port"}),e.jsx(r.HeadCell,{children:"Protocol"}),e.jsx(r.HeadCell,{children:"State"}),e.jsx(r.HeadCell,{children:"Service"}),e.jsx(r.HeadCell,{children:"Version"}),e.jsx(r.HeadCell,{children:"Product"})]}),e.jsx(r.Body,{children:c.ports.map((s,a)=>e.jsxs(r.Row,{children:[e.jsx(r.Cell,{className:"font-mono",children:s.port}),e.jsx(r.Cell,{className:"uppercase",children:s.protocol}),e.jsx(r.Cell,{children:e.jsx(p,{color:s.state==="open"?"success":s.state==="closed"?"gray":s.state==="filtered"?"warning":"gray",size:"sm",children:s.state})}),e.jsx(r.Cell,{children:s.service_name||"—"}),e.jsx(r.Cell,{children:s.service_version||"—"}),e.jsx(r.Cell,{children:s.service_product||"—"})]},a))})]})}):c.scan_status==="completed"?e.jsx("p",{className:"text-center py-4 text-gray-600 dark:text-gray-400",children:"No open ports found"}):e.jsx("p",{className:"text-center py-4 text-gray-600 dark:text-gray-400",children:"Scan in progress or no results yet"})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"No port scan results available for this device."}),T&&e.jsx(h,{color:"gray",onClick:async()=>{const s=H.find(a=>a.mac_address.toLowerCase()===T.toLowerCase()&&a.is_online);s?await S(s.mac_address):z(!1)},children:"Start Port Scan"})]})})]}),w&&e.jsx($e,{show:!!w,onClose:()=>Z(null),currentHostname:w.hostname||"",dynamicDomain:pe.find(s=>s.network===w.network)?.dynamic_domain??null,network:w.network,macAddress:w.mac_address,ipAddress:w.ip_address,onSaved:ye})]})]})]})}export{Ye as Clients};
