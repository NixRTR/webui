import{j as e,L as r,S as K,B as j,T as o,h as De,i as ss,A as k,M as f,k as ye,l as ts,C as A,b as g,a as X,m as as,n as rs,d as ns,o as os,p as is,q as ls}from"./ui-vendor-CT-4tH1q.js";import{r as d,u as cs}from"./react-vendor-DKKOAuGG.js";import{u as ds,S as hs,N as ps}from"./useMetrics-DLt2o056.js";import{a as S}from"./index-BbUI9UcV.js";import"./http-vendor-B9ygI19o.js";function ms({onServiceSaved:Z}={}){const[$,Q]=d.useState(""),[a,E]=d.useState({}),[N,I]=d.useState(""),[ee,P]=d.useState(!1),[le,B]=d.useState(!1),[D,G]=d.useState(""),[_,q]=d.useState(""),[L,U]=d.useState(!1),[W,M]=d.useState(null),[se,m]=d.useState(!1),[v,te]=d.useState("custom"),w=[{value:"email",label:"Email (SMTP)",category:"Email"},{value:"discord",label:"Discord",category:"Chat"},{value:"slack",label:"Slack",category:"Chat"},{value:"telegram",label:"Telegram",category:"Chat"},{value:"matrix",label:"Matrix",category:"Chat"},{value:"mattermost",label:"Mattermost",category:"Chat"},{value:"rocketchat",label:"Rocket.Chat",category:"Chat"},{value:"msteams",label:"Microsoft Teams",category:"Chat"},{value:"googlechat",label:"Google Chat",category:"Chat"},{value:"zulip",label:"Zulip",category:"Chat"},{value:"line",label:"Line",category:"Chat"},{value:"pushover",label:"Pushover",category:"Push"},{value:"pushbullet",label:"Pushbullet",category:"Push"},{value:"gotify",label:"Gotify",category:"Push"},{value:"ntfy",label:"ntfy",category:"Push"},{value:"prowl",label:"Prowl",category:"Push"},{value:"join",label:"Join",category:"Push"},{value:"homeassistant",label:"Home Assistant",category:"Home Automation"},{value:"twilio",label:"Twilio (SMS)",category:"SMS"},{value:"awssns",label:"AWS SNS",category:"Cloud"},{value:"gcm",label:"Google Cloud Messaging",category:"Cloud"},{value:"fcm",label:"Firebase Cloud Messaging",category:"Cloud"},{value:"webhook",label:"Generic Webhook",category:"Webhook"},{value:"json",label:"JSON Webhook",category:"Webhook"},{value:"ifttt",label:"IFTTT",category:"Other"},{value:"xmpp",label:"XMPP",category:"Other"},{value:"kodi",label:"Kodi",category:"Other"},{value:"apprise",label:"Apprise API",category:"Other"}],p=s=>encodeURIComponent(s),C=()=>{if(!$)return;let s="";switch($){case"email":{const l=String(a.username||""),c=String(a.password||""),h=String(a.to||""),u=String(a.from||l);if(v!=="custom"){const b={gmail:"gmail.com",yahoo:"yahoo.com",hotmail:"hotmail.com",live:"live.com",fastmail:"fastmail.com",zoho:"zoho.com",yandex:"yandex.com",sendgrid:"sendgrid.com",qq:"qq.com",163:"163.com",custom:""}[v];if(v==="sendgrid"){const T=u||l;s=`mailto://${p(l)}:${p(c)}@${b}?from=${p(T)}`}else s=`mailto://${p(l)}:${p(c)}@${b}`}else{const y=String(a.smtpHost||""),b=String(a.port||"587");s=`${b==="465"?"mailtos":"mailto"}://${p(l)}:${p(c)}@${y}:${b}?to=${p(h)}&from=${p(u)}`}break}case"homeassistant":{const l=String(a.host||""),c=String(a.port||(a.useHttps?"443":"8123")),h=String(a.token||"");s=`${!!a.useHttps?"hassios":"hassio"}://${l}:${c}/${h}`;break}case"discord":{const l=String(a.webhookId||""),c=String(a.webhookToken||"");s=`discord://${l}/${c}`;break}case"slack":{const l=String(a.tokenA||""),c=String(a.tokenB||""),h=String(a.tokenC||"");s=`slack://${l}/${c}/${h}`;break}case"telegram":{const l=String(a.botToken||""),c=String(a.chatId||"");s=`tgram://${l}/${c}`;break}case"ntfy":{const l=String(a.topic||""),c=String(a.server||"ntfy.sh");if(a.username&&a.password){const h=String(a.username),u=String(a.password);s=`ntfy://${p(h)}:${p(u)}@${c}/${l}`}else s=`ntfy://${c}/${l}`;break}case"pushover":{const l=String(a.userKey||""),c=String(a.token||"");s=`pover://${l}@${c}`;break}case"pushbullet":{const l=String(a.token||""),c=String(a.deviceId||"");c?s=`pbul://${l}/${c}`:s=`pbul://${l}`;break}case"gotify":{const l=String(a.host||""),c=String(a.token||""),h=String(a.port||"80");s=`${!!a.useHttps?"gotifys":"gotify"}://${l}:${h}/${c}`;break}case"matrix":{const l=String(a.host||""),c=String(a.token||""),h=String(a.room||""),y=!!a.useHttps?"matrixs":"matrix";h?s=`${y}://${l}/${h}?token=${p(c)}`:s=`${y}://${l}?token=${p(c)}`;break}case"mattermost":{const l=String(a.host||""),c=String(a.token||""),h=String(a.channel||""),y=!!a.useHttps?"mmosts":"mmost";h?s=`${y}://${l}/${h}?token=${p(c)}`:s=`${y}://${l}?token=${p(c)}`;break}case"rocketchat":{const l=String(a.host||""),c=String(a.user||""),h=String(a.password||""),u=String(a.channel||""),b=!!a.useHttps?"rockets":"rocket";u?s=`${b}://${p(c)}:${p(h)}@${l}/${u}`:s=`${b}://${p(c)}:${p(h)}@${l}`;break}case"msteams":{const l=String(a.webhookUrl||"");l.startsWith("http")?s=`msteams://${l.replace(/^https?:\/\//,"")}`:s=`msteams://${l}`;break}case"googlechat":{const l=String(a.webhookUrl||"");l.startsWith("http")?s=`gchat://${l.replace(/^https?:\/\//,"")}`:s=`gchat://${l}`;break}case"zulip":{const l=String(a.host||""),c=String(a.botEmail||""),h=String(a.botKey||""),u=String(a.stream||""),y=String(a.topic||""),T=!!a.useHttps?"zulips":"zulip";let z=`bot=${p(c)}&key=${p(h)}`;u&&(z+=`&stream=${p(u)}`),y&&(z+=`&topic=${p(y)}`),s=`${T}://${l}?${z}`;break}case"line":{s=`line://${String(a.token||"")}`;break}case"prowl":{const l=String(a.apikey||""),c=String(a.providerKey||"");c?s=`prowl://${l}@${c}`:s=`prowl://${l}`;break}case"join":{const l=String(a.deviceId||""),c=String(a.apikey||"");s=`join://${l}?apikey=${p(c)}`;break}case"twilio":{const l=String(a.accountSid||""),c=String(a.authToken||""),h=String(a.fromNumber||""),u=String(a.toNumber||"");s=`twilio://${l}:${p(c)}@${h}/${u}`;break}case"awssns":{const l=String(a.region||"us-east-1"),c=String(a.topicArn||""),h=String(a.accessKeyId||""),u=String(a.secretAccessKey||"");s=`sns://${p(h)}:${p(u)}@${l}/${c}`;break}case"gcm":{const l=String(a.projectId||""),c=String(a.apiKey||""),h=String(a.registrationId||"");s=`gcm://${p(c)}@${l}/${h}`;break}case"fcm":{const l=String(a.projectId||""),c=String(a.apikey||""),h=String(a.deviceToken||"");s=`fcm://${p(c)}@${l}/${h}`;break}case"webhook":{const l=String(a.url||""),c=String(a.method||"POST").toUpperCase();l.startsWith("http")?s=`webhook${c==="GET"?"s":""}://${l.replace(/^https?:\/\//,"")}`:s=`webhook${c==="GET"?"s":""}://${l}`;break}case"json":{const l=String(a.url||"");l.startsWith("http")?s=`json://${l.replace(/^https?:\/\//,"")}`:s=`json://${l}`;break}case"ifttt":{const l=String(a.webhookId||""),c=String(a.eventName||"");s=`ifttt://${l}/${c}`;break}case"xmpp":{const l=String(a.user||""),c=String(a.password||""),h=String(a.host||""),u=String(a.target||"");u?s=`xmpp://${p(l)}:${p(c)}@${h}/${u}`:s=`xmpp://${p(l)}:${p(c)}@${h}`;break}case"kodi":{const l=String(a.host||""),c=String(a.port||"8080"),h=String(a.user||""),u=String(a.password||"");h&&u?s=`kodi://${p(h)}:${p(u)}@${l}:${c}`:s=`kodi://${l}:${c}`;break}case"apprise":{const l=String(a.host||""),c=String(a.port||"8000"),h=String(a.token||""),y=!!a.useHttps?"apprises":"apprise";h?s=`${y}://${l}:${c}/${h}`:s=`${y}://${l}:${c}`;break}}I(s),P(!1)},ae=async()=>{N&&(await navigator.clipboard.writeText(N),P(!0),setTimeout(()=>P(!1),2e3))},n=(s,l)=>{E(c=>({...c,[s]:l}))},Y=()=>{Q(""),E({}),I(""),P(!1)},ce=()=>{if(!$)return null;switch($){case"email":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"emailProvider",children:"Email Provider"}),e.jsxs(K,{id:"emailProvider",value:v,onChange:s=>{te(s.target.value),E({})},children:[e.jsx("option",{value:"custom",children:"Custom SMTP Server"}),e.jsx("option",{value:"gmail",children:"Gmail"}),e.jsx("option",{value:"yahoo",children:"Yahoo"}),e.jsx("option",{value:"hotmail",children:"Hotmail"}),e.jsx("option",{value:"live",children:"Live.com"}),e.jsx("option",{value:"fastmail",children:"Fastmail"}),e.jsx("option",{value:"zoho",children:"Zoho"}),e.jsx("option",{value:"yandex",children:"Yandex"}),e.jsx("option",{value:"sendgrid",children:"SendGrid"}),e.jsx("option",{value:"qq",children:"QQ Mail"}),e.jsx("option",{value:"163",children:"163 Mail"})]})]}),v==="gmail"&&e.jsx(k,{color:"info",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Note:"})," Google users using 2-Step Verification will be required to generate an"," ",e.jsx("a",{href:"https://myaccount.google.com/apppasswords",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 underline",children:"app password"})," ","that you can use in the password field."]})}),v==="yahoo"&&e.jsx(k,{color:"info",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Note:"})," Yahoo users will be required to generate an"," ",e.jsx("a",{href:"https://login.yahoo.com/account/security/app-passwords",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 underline",children:"app password"})," ","that you can use in the password field."]})}),v==="fastmail"&&e.jsx(k,{color:"info",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Note:"})," Fastmail users are required to generate a custom App password before connecting. You must assign the ",e.jsx("strong",{children:"SMTP"})," option to the new App you generate. This Fastmail plugin supports 116 domains - just make sure you identify the email address you're using when building the URL."]})}),v==="custom"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"smtpHost",children:"SMTP Host"}),e.jsx(o,{id:"smtpHost",type:"text",placeholder:"smtp.gmail.com",value:String(a.smtpHost||""),onChange:s=>n("smtpHost",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"port",children:"Port"}),e.jsx(o,{id:"port",type:"text",placeholder:"587",value:String(a.port||"587"),onChange:s=>n("port",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Use 465 for SSL/TLS, 587 for STARTTLS"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"to",children:"To (Recipient Email)"}),e.jsx(o,{id:"to",type:"email",placeholder:"recipient@example.com",value:String(a.to||""),onChange:s=>n("to",s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"username",children:v==="custom"?"Username":"Email Address"}),e.jsx(o,{id:"username",type:"text",placeholder:v==="custom"?"user@example.com":"user@provider.com",value:String(a.username||""),onChange:s=>n("username",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"password",children:v==="gmail"||v==="yahoo"||v==="fastmail"?"App Password":"Password"}),e.jsx(o,{id:"password",type:"password",placeholder:v==="gmail"||v==="yahoo"||v==="fastmail"?"App password (not your regular password)":"Your password",value:String(a.password||""),onChange:s=>n("password",s.target.value)})]}),v==="sendgrid"&&e.jsxs("div",{children:[e.jsx(r,{htmlFor:"from",children:"From Email (Required for SendGrid)"}),e.jsx(o,{id:"from",type:"email",placeholder:"noreply@your-validated-domain.com",value:String(a.from||""),onChange:s=>n("from",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Must use a validated domain from your SendGrid account"})]}),v==="custom"&&e.jsxs("div",{children:[e.jsx(r,{htmlFor:"from",children:"From (Sender Email - Optional)"}),e.jsx(o,{id:"from",type:"email",placeholder:"sender@example.com",value:String(a.from||""),onChange:s=>n("from",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Defaults to username if not provided"})]})]});case"homeassistant":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"host",children:"Home Assistant Host"}),e.jsx(o,{id:"host",type:"text",placeholder:"homeassistant.local",value:String(a.host||""),onChange:s=>n("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"port",children:"Port"}),e.jsx(o,{id:"port",type:"text",placeholder:"8123",value:String(a.port||""),onChange:s=>n("port",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Default: 8123 (HTTP) or 443 (HTTPS)"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"token",children:"Long-lived Access Token"}),e.jsx(o,{id:"token",type:"password",placeholder:"Enter access credential",value:String(a.token||""),onChange:s=>n("token",s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"useHttps",checked:!!a.useHttps,onChange:s=>n("useHttps",s.target.checked),className:"rounded"}),e.jsx(r,{htmlFor:"useHttps",children:"Use HTTPS"})]})]});case"discord":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"webhookId",children:"Webhook ID"}),e.jsx(o,{id:"webhookId",type:"text",placeholder:"123456789012345678",value:String(a.webhookId||""),onChange:s=>n("webhookId",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"webhookToken",children:"Webhook Token"}),e.jsx(o,{id:"webhookToken",type:"password",placeholder:"Enter webhook credential",value:String(a.webhookToken||""),onChange:s=>n("webhookToken",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get these from Discord: Server Settings → Integrations → Webhooks"})]})]});case"slack":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"tokenA",children:"Token A"}),e.jsx(o,{id:"tokenA",type:"password",placeholder:"Enter first credential",value:String(a.tokenA||""),onChange:s=>n("tokenA",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"tokenB",children:"Token B"}),e.jsx(o,{id:"tokenB",type:"password",placeholder:"Enter second credential",value:String(a.tokenB||""),onChange:s=>n("tokenB",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"tokenC",children:"Token C"}),e.jsx(o,{id:"tokenC",type:"password",placeholder:"Enter third credential",value:String(a.tokenC||""),onChange:s=>n("tokenC",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get credentials from Slack: Apps → Your App → OAuth & Permissions"})]})]});case"telegram":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"botToken",children:"Bot Token"}),e.jsx(o,{id:"botToken",type:"password",placeholder:"Enter bot credential from @BotFather",value:String(a.botToken||""),onChange:s=>n("botToken",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from @BotFather on Telegram"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"chatId",children:"Chat ID"}),e.jsx(o,{id:"chatId",type:"text",placeholder:"123456789",value:String(a.chatId||""),onChange:s=>n("chatId",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Your Telegram user ID or group ID"})]})]});case"ntfy":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"server",children:"Server"}),e.jsx(o,{id:"server",type:"text",placeholder:"ntfy.sh",value:String(a.server||"ntfy.sh"),onChange:s=>n("server",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Default: ntfy.sh (public server)"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"topic",children:"Topic"}),e.jsx(o,{id:"topic",type:"text",placeholder:"my-topic",value:String(a.topic||""),onChange:s=>n("topic",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Topic name (no spaces, use hyphens)"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"username",children:"Username (Optional)"}),e.jsx(o,{id:"username",type:"text",placeholder:"username",value:String(a.username||""),onChange:s=>n("username",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"password",children:"Password (Optional)"}),e.jsx(o,{id:"password",type:"password",placeholder:"password",value:String(a.password||""),onChange:s=>n("password",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Only required for private topics"})]})]});case"pushover":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"userKey",children:"User Key"}),e.jsx(o,{id:"userKey",type:"text",placeholder:"Enter user key",value:String(a.userKey||""),onChange:s=>n("userKey",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from pushover.net"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"token",children:"Application Token"}),e.jsx(o,{id:"token",type:"password",placeholder:"Enter application token",value:String(a.token||""),onChange:s=>n("token",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Create an application at pushover.net"})]})]});case"pushbullet":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"token",children:"Access Token"}),e.jsx(o,{id:"token",type:"password",placeholder:"Enter access token",value:String(a.token||""),onChange:s=>n("token",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from pushbullet.com → Settings → Access Tokens"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"deviceId",children:"Device ID (Optional)"}),e.jsx(o,{id:"deviceId",type:"text",placeholder:"device_iden",value:String(a.deviceId||""),onChange:s=>n("deviceId",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Leave empty to send to all devices"})]})]});case"gotify":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"host",children:"Gotify Server Host"}),e.jsx(o,{id:"host",type:"text",placeholder:"gotify.example.com",value:String(a.host||""),onChange:s=>n("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"port",children:"Port"}),e.jsx(o,{id:"port",type:"text",placeholder:"80",value:String(a.port||"80"),onChange:s=>n("port",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"token",children:"Application Token"}),e.jsx(o,{id:"token",type:"password",placeholder:"Enter application token",value:String(a.token||""),onChange:s=>n("token",s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"useHttps",checked:!!a.useHttps,onChange:s=>n("useHttps",s.target.checked),className:"rounded"}),e.jsx(r,{htmlFor:"useHttps",children:"Use HTTPS"})]})]});case"matrix":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"host",children:"Matrix Server"}),e.jsx(o,{id:"host",type:"text",placeholder:"matrix.example.com",value:String(a.host||""),onChange:s=>n("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"token",children:"Access Token"}),e.jsx(o,{id:"token",type:"password",placeholder:"Enter access token",value:String(a.token||""),onChange:s=>n("token",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"room",children:"Room ID (Optional)"}),e.jsx(o,{id:"room",type:"text",placeholder:"!roomid:example.com",value:String(a.room||""),onChange:s=>n("room",s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"useHttps",checked:!!a.useHttps,onChange:s=>n("useHttps",s.target.checked),className:"rounded"}),e.jsx(r,{htmlFor:"useHttps",children:"Use HTTPS"})]})]});case"mattermost":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"host",children:"Mattermost Server"}),e.jsx(o,{id:"host",type:"text",placeholder:"mattermost.example.com",value:String(a.host||""),onChange:s=>n("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"token",children:"Personal Access Token"}),e.jsx(o,{id:"token",type:"password",placeholder:"Enter access token",value:String(a.token||""),onChange:s=>n("token",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"channel",children:"Channel Name (Optional)"}),e.jsx(o,{id:"channel",type:"text",placeholder:"general",value:String(a.channel||""),onChange:s=>n("channel",s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"useHttps",checked:!!a.useHttps,onChange:s=>n("useHttps",s.target.checked),className:"rounded"}),e.jsx(r,{htmlFor:"useHttps",children:"Use HTTPS"})]})]});case"rocketchat":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"host",children:"Rocket.Chat Server"}),e.jsx(o,{id:"host",type:"text",placeholder:"rocketchat.example.com",value:String(a.host||""),onChange:s=>n("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"user",children:"Username"}),e.jsx(o,{id:"user",type:"text",placeholder:"bot_user",value:String(a.user||""),onChange:s=>n("user",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"password",children:"Password"}),e.jsx(o,{id:"password",type:"password",placeholder:"Enter password",value:String(a.password||""),onChange:s=>n("password",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"channel",children:"Channel (Optional)"}),e.jsx(o,{id:"channel",type:"text",placeholder:"#general",value:String(a.channel||""),onChange:s=>n("channel",s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"useHttps",checked:!!a.useHttps,onChange:s=>n("useHttps",s.target.checked),className:"rounded"}),e.jsx(r,{htmlFor:"useHttps",children:"Use HTTPS"})]})]});case"msteams":return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(r,{htmlFor:"webhookUrl",children:"Webhook URL"}),e.jsx(o,{id:"webhookUrl",type:"text",placeholder:"https://outlook.office.com/webhook/...",value:String(a.webhookUrl||""),onChange:s=>n("webhookUrl",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from Teams: Channel → Connectors → Incoming Webhook"})]})});case"googlechat":return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(r,{htmlFor:"webhookUrl",children:"Webhook URL"}),e.jsx(o,{id:"webhookUrl",type:"text",placeholder:"https://chat.googleapis.com/v1/spaces/...",value:String(a.webhookUrl||""),onChange:s=>n("webhookUrl",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from Google Chat: Space → Configure Webhooks"})]})});case"zulip":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"host",children:"Zulip Server"}),e.jsx(o,{id:"host",type:"text",placeholder:"zulip.example.com",value:String(a.host||""),onChange:s=>n("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"botEmail",children:"Bot Email"}),e.jsx(o,{id:"botEmail",type:"email",placeholder:"bot@example.com",value:String(a.botEmail||""),onChange:s=>n("botEmail",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"botKey",children:"Bot API Key"}),e.jsx(o,{id:"botKey",type:"password",placeholder:"Enter bot API key",value:String(a.botKey||""),onChange:s=>n("botKey",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"stream",children:"Stream Name (Optional)"}),e.jsx(o,{id:"stream",type:"text",placeholder:"general",value:String(a.stream||""),onChange:s=>n("stream",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"topic",children:"Topic (Optional)"}),e.jsx(o,{id:"topic",type:"text",placeholder:"notifications",value:String(a.topic||""),onChange:s=>n("topic",s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"useHttps",checked:!!a.useHttps,onChange:s=>n("useHttps",s.target.checked),className:"rounded"}),e.jsx(r,{htmlFor:"useHttps",children:"Use HTTPS"})]})]});case"line":return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(r,{htmlFor:"token",children:"Channel Access Token"}),e.jsx(o,{id:"token",type:"password",placeholder:"Enter channel access token",value:String(a.token||""),onChange:s=>n("token",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from Line Developers Console"})]})});case"prowl":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"apikey",children:"API Key"}),e.jsx(o,{id:"apikey",type:"password",placeholder:"Enter API key",value:String(a.apikey||""),onChange:s=>n("apikey",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from prowlapp.com"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"providerKey",children:"Provider Key (Optional)"}),e.jsx(o,{id:"providerKey",type:"password",placeholder:"Enter provider key",value:String(a.providerKey||""),onChange:s=>n("providerKey",s.target.value)})]})]});case"join":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"deviceId",children:"Device ID"}),e.jsx(o,{id:"deviceId",type:"text",placeholder:"device_iden",value:String(a.deviceId||""),onChange:s=>n("deviceId",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from joinjoaomgcd.app → My Devices"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"apikey",children:"API Key"}),e.jsx(o,{id:"apikey",type:"password",placeholder:"Enter API key",value:String(a.apikey||""),onChange:s=>n("apikey",s.target.value)})]})]});case"twilio":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"accountSid",children:"Account SID"}),e.jsx(o,{id:"accountSid",type:"text",placeholder:"ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",value:String(a.accountSid||""),onChange:s=>n("accountSid",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"authToken",children:"Auth Token"}),e.jsx(o,{id:"authToken",type:"password",placeholder:"Enter auth token",value:String(a.authToken||""),onChange:s=>n("authToken",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"fromNumber",children:"From Phone Number"}),e.jsx(o,{id:"fromNumber",type:"text",placeholder:"+1234567890",value:String(a.fromNumber||""),onChange:s=>n("fromNumber",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Your Twilio phone number (E.164 format)"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"toNumber",children:"To Phone Number"}),e.jsx(o,{id:"toNumber",type:"text",placeholder:"+1234567890",value:String(a.toNumber||""),onChange:s=>n("toNumber",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Recipient phone number (E.164 format)"})]})]});case"awssns":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"region",children:"AWS Region"}),e.jsx(o,{id:"region",type:"text",placeholder:"us-east-1",value:String(a.region||"us-east-1"),onChange:s=>n("region",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"topicArn",children:"Topic ARN"}),e.jsx(o,{id:"topicArn",type:"text",placeholder:"arn:aws:sns:us-east-1:123456789012:MyTopic",value:String(a.topicArn||""),onChange:s=>n("topicArn",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"accessKeyId",children:"Access Key ID"}),e.jsx(o,{id:"accessKeyId",type:"text",placeholder:"Enter access key ID",value:String(a.accessKeyId||""),onChange:s=>n("accessKeyId",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"secretAccessKey",children:"Secret Access Key"}),e.jsx(o,{id:"secretAccessKey",type:"password",placeholder:"Enter secret access key",value:String(a.secretAccessKey||""),onChange:s=>n("secretAccessKey",s.target.value)})]})]});case"gcm":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"projectId",children:"Project ID"}),e.jsx(o,{id:"projectId",type:"text",placeholder:"my-project-id",value:String(a.projectId||""),onChange:s=>n("projectId",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"apiKey",children:"API Key"}),e.jsx(o,{id:"apiKey",type:"password",placeholder:"Enter API key",value:String(a.apiKey||""),onChange:s=>n("apiKey",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"registrationId",children:"Registration ID"}),e.jsx(o,{id:"registrationId",type:"text",placeholder:"Enter registration ID",value:String(a.registrationId||""),onChange:s=>n("registrationId",s.target.value)})]})]});case"fcm":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"projectId",children:"Project ID"}),e.jsx(o,{id:"projectId",type:"text",placeholder:"my-project-id",value:String(a.projectId||""),onChange:s=>n("projectId",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"apikey",children:"Server Key"}),e.jsx(o,{id:"apikey",type:"password",placeholder:"Enter server key",value:String(a.apikey||""),onChange:s=>n("apikey",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"deviceToken",children:"Device Token"}),e.jsx(o,{id:"deviceToken",type:"text",placeholder:"Enter device token",value:String(a.deviceToken||""),onChange:s=>n("deviceToken",s.target.value)})]})]});case"webhook":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"url",children:"Webhook URL"}),e.jsx(o,{id:"url",type:"text",placeholder:"https://example.com/webhook",value:String(a.url||""),onChange:s=>n("url",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"method",children:"HTTP Method"}),e.jsxs(K,{id:"method",value:String(a.method||"POST"),onChange:s=>n("method",s.target.value),children:[e.jsx("option",{value:"POST",children:"POST"}),e.jsx("option",{value:"GET",children:"GET"}),e.jsx("option",{value:"PUT",children:"PUT"}),e.jsx("option",{value:"PATCH",children:"PATCH"})]})]})]});case"json":return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(r,{htmlFor:"url",children:"JSON Webhook URL"}),e.jsx(o,{id:"url",type:"text",placeholder:"https://example.com/webhook",value:String(a.url||""),onChange:s=>n("url",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"URL that accepts JSON POST requests"})]})});case"ifttt":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"webhookId",children:"Webhook ID"}),e.jsx(o,{id:"webhookId",type:"text",placeholder:"Enter webhook ID",value:String(a.webhookId||""),onChange:s=>n("webhookId",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from ifttt.com → My Applets → Webhooks → Settings"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"eventName",children:"Event Name"}),e.jsx(o,{id:"eventName",type:"text",placeholder:"notification",value:String(a.eventName||""),onChange:s=>n("eventName",s.target.value)})]})]});case"xmpp":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"host",children:"XMPP Server"}),e.jsx(o,{id:"host",type:"text",placeholder:"xmpp.example.com",value:String(a.host||""),onChange:s=>n("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"user",children:"Username (JID)"}),e.jsx(o,{id:"user",type:"text",placeholder:"user@example.com",value:String(a.user||""),onChange:s=>n("user",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"password",children:"Password"}),e.jsx(o,{id:"password",type:"password",placeholder:"Enter password",value:String(a.password||""),onChange:s=>n("password",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"target",children:"Target JID (Optional)"}),e.jsx(o,{id:"target",type:"text",placeholder:"recipient@example.com",value:String(a.target||""),onChange:s=>n("target",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Leave empty to send to yourself"})]})]});case"kodi":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"host",children:"Kodi Host"}),e.jsx(o,{id:"host",type:"text",placeholder:"192.168.1.100",value:String(a.host||""),onChange:s=>n("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"port",children:"Port"}),e.jsx(o,{id:"port",type:"text",placeholder:"8080",value:String(a.port||"8080"),onChange:s=>n("port",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"user",children:"Username (Optional)"}),e.jsx(o,{id:"user",type:"text",placeholder:"kodi",value:String(a.user||""),onChange:s=>n("user",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"password",children:"Password (Optional)"}),e.jsx(o,{id:"password",type:"password",placeholder:"Enter password",value:String(a.password||""),onChange:s=>n("password",s.target.value)})]})]});case"apprise":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"host",children:"Apprise API Host"}),e.jsx(o,{id:"host",type:"text",placeholder:"apprise.example.com",value:String(a.host||""),onChange:s=>n("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"port",children:"Port"}),e.jsx(o,{id:"port",type:"text",placeholder:"8000",value:String(a.port||"8000"),onChange:s=>n("port",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"token",children:"Token (Optional)"}),e.jsx(o,{id:"token",type:"password",placeholder:"Enter token",value:String(a.token||""),onChange:s=>n("token",s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"useHttps",checked:!!a.useHttps,onChange:s=>n("useHttps",s.target.checked),className:"rounded"}),e.jsx(r,{htmlFor:"useHttps",children:"Use HTTPS"})]})]});default:return null}},de=w.reduce((s,l)=>{const c=l.category||"Other";return s[c]||(s[c]=[]),s[c].push(l),s},{});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"serviceType",children:"Service Type"}),e.jsxs(K,{id:"serviceType",value:$,onChange:s=>{Q(s.target.value),E({}),I("")},children:[e.jsx("option",{value:"",children:"Select a service..."}),Object.entries(de).map(([s,l])=>e.jsx("optgroup",{label:s,children:l.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))},s))]})]}),$&&e.jsxs(e.Fragment,{children:[ce(),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(j,{onClick:C,color:"blue",children:"Generate URL"}),e.jsx(j,{onClick:Y,color:"gray",outline:!0,children:"Reset"})]})]}),N&&e.jsxs("div",{className:"mt-4",children:[e.jsx(r,{children:"Generated URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{type:"text",value:N,readOnly:!0,className:"font-mono text-sm"}),e.jsx(j,{onClick:ae,color:ee?"success":"gray",size:"sm",children:ee?e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-4 h-4 mr-1"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ss,{className:"w-4 h-4 mr-1"}),"Copy"]})}),e.jsx(j,{onClick:()=>{B(!0),G(""),q(""),M(null),m(!1)},color:"blue",size:"sm",children:"Save Service"})]}),e.jsx(k,{color:"info",className:"mt-2",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Note:"})," You can save this service to the database for easier management, or copy it to store in secrets.yaml."]})})]}),e.jsxs(f,{show:le,onClose:()=>B(!1),children:[e.jsx(f.Header,{children:"Save Apprise Service"}),e.jsx(f.Body,{children:e.jsxs("div",{className:"space-y-4",children:[W&&e.jsx(k,{color:"failure",children:W}),se&&e.jsx(k,{color:"success",children:"Service saved successfully!"}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"saveName",value:"Service Name *"}),e.jsx(o,{id:"saveName",value:D,onChange:s=>G(s.target.value),placeholder:"e.g., Discord Notifications",required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"saveDescription",value:"Description (optional)"}),e.jsx(ye,{id:"saveDescription",value:_,onChange:s=>q(s.target.value),placeholder:"Optional description for this service",rows:3,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"saveUrl",value:"Service URL"}),e.jsx(o,{id:"saveUrl",readOnly:!0,value:N,className:"mt-1 font-mono text-sm"})]})]})}),e.jsxs(f.Footer,{children:[e.jsx(j,{color:"blue",onClick:async()=>{if(!D.trim()){M("Service name is required");return}U(!0),M(null),m(!1);try{await S.createAppriseService({name:D.trim(),description:_.trim()||null,url:N}),m(!0),setTimeout(()=>{B(!1),G(""),q(""),m(!1),Z&&Z()},1500)}catch(s){M(s.response?.data?.detail||s.message||"Failed to save service")}finally{U(!1)}},disabled:L||!D.trim(),children:L?"Saving...":"Save"}),e.jsx(j,{color:"gray",onClick:()=>B(!1),children:"Cancel"})]})]})]})}const Se="{{ parameter_name }} is {{ current_value }} ({{ current_level | upper }})",je={name:"",enabled:!0,parameter_type:"",parameter_config:{},threshold_info:"",threshold_warning:"",threshold_failure:"",comparison_operator:"gt",duration_seconds:60,cooldown_seconds:300,apprise_service_indices:[],message_template:Se};function ys(){const Z=localStorage.getItem("access_token"),$=localStorage.getItem("username")||"Unknown",{connectionStatus:Q}=ds(Z),a=cs(),[E,N]=d.useState([]),[I,ee]=d.useState([]),[P,le]=d.useState([]),[B,D]=d.useState(!0),[G,_]=d.useState(null),[q,L]=d.useState(!1),[U,W]=d.useState({open:!1,items:[],ruleName:""}),[M,se]=d.useState(!1),[m,v]=d.useState(je),[te,w]=d.useState(null),[p,C]=d.useState(null),[ae,n]=d.useState(null),[Y,ce]=d.useState([]),[de,s]=d.useState(!1),[l,c]=d.useState(!1),[h,u]=d.useState(!1),[y,b]=d.useState(null),[T,z]=d.useState(""),[fe,ke]=d.useState(""),[he,be]=d.useState(""),[Ne,we]=d.useState(!0),[Ce,Te]=d.useState(!1),[Fe,re]=d.useState(null),[O,$e]=d.useState(""),[pe,_e]=d.useState(""),[me,He]=d.useState("info"),[Ae,Ee]=d.useState(!1),[ne,J]=d.useState(null),[Ue,oe]=d.useState(new Set),[Me,H]=d.useState(new Map);d.useEffect(()=>{(async()=>{try{D(!0);const[i,x,R]=await Promise.all([S.getNotificationRules(),S.getNotificationParameters(),S.getAppriseServices()]);N(i),ee(x),le(R)}catch(i){_(i?.response?.data?.detail||i.message||"Failed to load notifications")}finally{D(!1)}})(),ie()},[]);const ie=async()=>{try{const t=await S.getAppriseStatus();s(t.enabled);const i=await S.getAppriseServices();ce(i)}catch{s(!1)}},V=d.useMemo(()=>I.find(t=>t.type===m.parameter_type),[I,m.parameter_type]),Oe=()=>{v(je),w(null),C(null),n(null),L(!0)},Re=async()=>{await S.logout(),a("/login")},Ke=t=>{v({id:t.id,name:t.name,enabled:t.enabled,parameter_type:t.parameter_type,parameter_config:Object.fromEntries(Object.entries(t.parameter_config||{}).map(([i,x])=>[i,String(x??"")])),threshold_info:t.threshold_info!==null&&t.threshold_info!==void 0?String(t.threshold_info):"",threshold_warning:t.threshold_warning!==null&&t.threshold_warning!==void 0?String(t.threshold_warning):"",threshold_failure:t.threshold_failure!==null&&t.threshold_failure!==void 0?String(t.threshold_failure):"",comparison_operator:t.comparison_operator,duration_seconds:t.duration_seconds,cooldown_seconds:t.cooldown_seconds,apprise_service_indices:[...t.apprise_service_indices||[]],message_template:t.message_template||Se}),w(null),C(null),n(null),L(!0)},xe=()=>{L(!1),v(je),w(null),C(null),n(null)},F=(t,i)=>{v(x=>({...x,[t]:i}))},Ie=(t,i)=>{v(x=>({...x,parameter_config:{...x.parameter_config,[t]:i}}))},Be=t=>{v(i=>{const R=i.apprise_service_indices.includes(t)?i.apprise_service_indices.filter(ve=>ve!==t):[...i.apprise_service_indices,t].sort((ve,es)=>ve-es);return{...i,apprise_service_indices:R}})},ue=t=>{if(t===""||t===null||t===void 0)return;const i=Number(t);return Number.isNaN(i)?void 0:i},ge=async()=>{const t=await S.getNotificationRules();N(t)},Ge=async()=>{if(w(null),C(null),!m.parameter_type){w("Please select a parameter to monitor.");return}const t={name:m.name,enabled:m.enabled,parameter_type:m.parameter_type,parameter_config:m.parameter_config,threshold_info:ue(m.threshold_info),threshold_warning:ue(m.threshold_warning),threshold_failure:ue(m.threshold_failure),comparison_operator:m.comparison_operator,duration_seconds:m.duration_seconds,cooldown_seconds:m.cooldown_seconds,apprise_service_indices:m.apprise_service_indices,message_template:m.message_template||Se};try{m.id?(await S.updateNotificationRule(m.id,t),C("Notification rule updated.")):(await S.createNotificationRule(t),C("Notification rule created.")),await ge(),setTimeout(xe,600)}catch(i){w(i?.response?.data?.detail||i.message||"Failed to save notification rule")}},Le=async t=>{await S.updateNotificationRule(t.id,{enabled:!t.enabled}),await ge()},We=async t=>{window.confirm(`Delete notification "${t.name}"? This cannot be undone.`)&&(await S.deleteNotificationRule(t.id),await ge())},ze=async t=>{n(null);try{const i=await S.testNotificationRule(t.id);i.success?n(`Test sent (${i.level.toUpperCase()}): ${i.message}`):n(i.error||"Test failed to send")}catch(i){n(i?.response?.data?.detail||i.message||"Test failed")}},qe=async t=>{try{const i=await S.getNotificationHistory(t.id);W({open:!0,items:i.items,ruleName:t.name})}catch(i){_(i?.response?.data?.detail||i.message||"Failed to load history")}},Pe=t=>t?new Date(t).toLocaleString():"—",Ye=async()=>{if(!O.trim()){J({success:!1,message:"Message body is required"});return}Ee(!0),J(null);try{const t=await S.sendAppriseNotification(O,pe||void 0,me||void 0);J(t),t.success&&($e(""),_e(""),He("info"))}catch(t){J({success:!1,message:t.response?.data?.detail||t.message||"Failed to send notification"})}finally{Ee(!1)}},Je=async t=>{if(!O.trim()){H(i=>new Map(i).set(t,{success:!1,message:"Message body is required"}));return}oe(i=>new Set(i).add(t)),H(i=>{const x=new Map(i);return x.delete(t),x});try{const i=await S.sendAppriseNotificationToServiceById(t,O,pe||void 0,me||void 0);if(H(x=>new Map(x).set(t,i)),!i.success){const x=i.details?`${i.message}: ${i.details}`:i.message;H(R=>new Map(R).set(t,{success:!1,message:x,details:i.details}))}}catch(i){const x=i.response?.data?.detail||i.message||"Failed to send notification";H(R=>new Map(R).set(t,{success:!1,message:x}))}finally{oe(i=>{const x=new Set(i);return x.delete(t),x})}},Ve=async t=>{oe(i=>new Set(i).add(t));try{const i=await S.testAppriseServiceById(t);H(x=>new Map(x).set(t,i)),i.success||H(x=>new Map(x).set(t,{success:!1,message:i.message,details:i.details}))}catch(i){H(x=>new Map(x).set(t,{success:!1,message:i.response?.data?.detail||i.message}))}finally{oe(i=>{const x=new Set(i);return x.delete(t),x})}},Xe=async t=>{try{const i=await S.getAppriseService(t);b(i),z(i.name),ke(i.description||""),be(i.url),we(i.enabled),re(null),u(!0)}catch(i){_(i.response?.data?.detail||i.message||"Failed to load service")}},Ze=async()=>{if(y){if(!T.trim()){re("Service name is required");return}Te(!0),re(null);try{const t={name:T.trim(),description:fe.trim()||null,url:he.trim(),enabled:Ne};await S.updateAppriseService(y.id,t),u(!1),await ie()}catch(t){re(t.response?.data?.detail||t.message||"Failed to update service")}finally{Te(!1)}}},Qe=async t=>{if(confirm("Are you sure you want to delete this service? This action cannot be undone."))try{await S.deleteAppriseService(t),await ie()}catch(i){_(i.response?.data?.detail||i.message||"Failed to delete service")}};return B?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsx(ts,{size:"xl"})}):e.jsxs("div",{className:"flex h-screen",children:[e.jsx(hs,{onLogout:Re,isOpen:M,onClose:()=>se(!1)}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(ps,{hostname:"nixos-router",username:$,connectionStatus:Q,onMenuClick:()=>se(!M)}),e.jsxs("main",{className:"flex-1 overflow-y-auto bg-gray-50 p-6 dark:bg-gray-900",children:[e.jsxs("div",{className:"mx-auto flex max-w-7xl items-center justify-between pb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Notifications"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Automatically send Apprise notifications when monitored metrics cross thresholds."})]}),e.jsx(j,{onClick:Oe,children:"New Rule"})]}),G&&e.jsx(k,{color:"failure",className:"mb-4",onDismiss:()=>_(null),children:G}),e.jsxs(A,{className:"mb-6",children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("h2",{className:"text-xl font-semibold",children:"Configured Rules"})}),E.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No notifications configured yet. Click “New Rule” to begin."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(g,{children:[e.jsxs(g.Head,{children:[e.jsx(g.HeadCell,{children:"Name"}),e.jsx(g.HeadCell,{children:"Parameter"}),e.jsx(g.HeadCell,{children:"Thresholds"}),e.jsx(g.HeadCell,{children:"Status"}),e.jsx(g.HeadCell,{children:"Last Notification"}),e.jsx(g.HeadCell,{children:"Actions"})]}),e.jsx(g.Body,{className:"divide-y",children:E.map(t=>e.jsxs(g.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsxs(g.Cell,{children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:t.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:["#",t.id]})]}),e.jsxs(g.Cell,{children:[e.jsx("div",{className:"text-sm font-medium",children:t.parameter_type}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Duration ",t.duration_seconds,"s · Cooldown ",t.cooldown_seconds,"s"]})]}),e.jsx(g.Cell,{children:e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("span",{className:"font-semibold",children:"Info:"})," ",t.threshold_info??"—"," · ",e.jsx("span",{className:"font-semibold",children:"Warn:"})," ",t.threshold_warning??"—"," · ",e.jsx("span",{className:"font-semibold",children:"Fail:"})," ",t.threshold_failure??"—"]})}),e.jsx(g.Cell,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{color:t.enabled?"success":"gray",children:t.enabled?"Enabled":"Disabled"}),t.current_level&&e.jsx(X,{color:t.current_level==="failure"?"failure":"warning",children:t.current_level.toUpperCase()})]})}),e.jsxs(g.Cell,{children:[e.jsx("div",{className:"text-xs text-gray-500",children:Pe(t.last_notification_at)}),e.jsx("div",{className:"text-xs text-gray-400",children:t.last_notification_level??""})]}),e.jsx(g.Cell,{children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(j,{size:"xs",onClick:()=>Ke(t),children:"Edit"}),e.jsx(j,{size:"xs",color:"light",onClick:()=>Le(t),children:t.enabled?"Disable":"Enable"}),e.jsx(j,{size:"xs",color:"purple",onClick:()=>ze(t),children:"Test"}),e.jsx(j,{size:"xs",color:"info",onClick:()=>qe(t),children:"History"}),e.jsx(j,{size:"xs",color:"failure",onClick:()=>We(t),children:"Delete"})]})})]},t.id))})]})})]}),de&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Configured Services (",Y.length,")"]}),e.jsx(j,{color:"blue",onClick:()=>c(!0),children:"New Service"})]}),ne&&e.jsx(k,{color:ne.success?"success":"failure",icon:ne.success?De:as,className:"mb-4",onDismiss:()=>J(null),children:ne.message}),Y.length===0?e.jsx(k,{color:"info",icon:rs,children:'No notification services are configured. Use the "New Service" button to create a service.'}):e.jsxs(g,{children:[e.jsxs(g.Head,{children:[e.jsx(g.HeadCell,{children:"Name"}),e.jsx(g.HeadCell,{children:"Description"}),e.jsx(g.HeadCell,{children:"Status"}),e.jsx(g.HeadCell,{children:"Actions"})]}),e.jsx(g.Body,{className:"divide-y",children:Y.map(t=>{const i=Ue.has(t.id),x=Me.get(t.id);return e.jsxs(g.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx(g.Cell,{className:"whitespace-nowrap font-medium text-gray-900 dark:text-white",children:t.name}),e.jsx(g.Cell,{className:"text-gray-500 dark:text-gray-400",children:t.description||"-"}),e.jsx(g.Cell,{children:e.jsx(X,{color:t.enabled?"success":"gray",children:t.enabled?"Enabled":"Disabled"})}),e.jsx(g.Cell,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{size:"xs",color:"blue",onClick:()=>Je(t.id),disabled:i||!O.trim()||!t.enabled,children:i?"Sending...":x?.success?"Send Again":"Send"}),e.jsx(j,{size:"xs",color:"gray",onClick:()=>Ve(t.id),disabled:!t.enabled,children:"Test"}),e.jsx(j,{size:"xs",color:"gray",onClick:()=>Xe(t.id),children:e.jsx(ns,{className:"w-4 h-4"})}),e.jsx(j,{size:"xs",color:"failure",onClick:()=>Qe(t.id),disabled:!t.enabled,children:e.jsx(os,{className:"w-4 h-4"})})]})})]},t.id)})})]})]}),e.jsxs(A,{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Send Notification"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"apprise-title",value:"Title (optional)"}),e.jsx(o,{id:"apprise-title",type:"text",placeholder:"Notification title",value:pe,onChange:t=>_e(t.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"apprise-body",value:"Message Body *"}),e.jsx(ye,{id:"apprise-body",placeholder:"Enter your notification message...",value:O,onChange:t=>$e(t.target.value),rows:4,className:"mt-1",required:!0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"apprise-type",value:"Notification Type"}),e.jsxs(K,{id:"apprise-type",value:me,onChange:t=>He(t.target.value),className:"mt-1",children:[e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"warning",children:"Warning"}),e.jsx("option",{value:"failure",children:"Failure"})]})]}),e.jsx(j,{onClick:Ye,disabled:Ae||!O.trim(),className:"w-full sm:w-auto",children:Ae?"Sending...":"Send to All Services"})]})]}),e.jsxs(A,{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"How It Works"}),e.jsxs("div",{className:"space-y-3 text-gray-700 dark:text-gray-300",children:[e.jsxs("p",{children:["Apprise is integrated into the NixOS Router WebUI backend, allowing you to send notifications to multiple services configured in ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"router-config.nix"}),"."]}),e.jsx("p",{children:"Notifications can be sent to all configured services simultaneously, or to individual services."}),e.jsx("p",{children:e.jsx("strong",{children:"Notification Types:"})}),e.jsxs("ul",{className:"list-disc list-inside ml-4 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"info"})," - General information (default)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"success"})," - Success messages"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"warning"})," - Warning messages"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"failure"})," - Error/failure messages"]})]})]})]})]})]})]}),e.jsxs(f,{show:q,size:"4xl",onClose:xe,children:[e.jsx(f.Header,{children:m.id?"Edit Notification Rule":"Create Notification Rule"}),e.jsx(f.Body,{children:e.jsxs("div",{className:"space-y-4 max-h-[70vh] overflow-y-auto",children:[te&&e.jsx(k,{color:"failure",onDismiss:()=>w(null),children:te}),p&&e.jsx(k,{color:"success",onDismiss:()=>C(null),children:p}),ae&&e.jsx(k,{color:"info",onDismiss:()=>n(null),children:ae}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"name",value:"Name"}),e.jsx(o,{id:"name",value:m.name,onChange:t=>F("name",t.target.value),placeholder:"CPU usage alerts"})]}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx(r,{value:"Enabled"}),e.jsx(is,{checked:m.enabled,onChange:t=>F("enabled",t)})]}),e.jsxs("div",{children:[e.jsx(r,{value:"Comparison"}),e.jsxs(K,{value:m.comparison_operator,onChange:t=>F("comparison_operator",t.target.value),children:[e.jsx("option",{value:"gt",children:"Greater than (>=)"}),e.jsx("option",{value:"lt",children:"Less than (<=)"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"parameter",value:"Parameter"}),e.jsxs(K,{id:"parameter",value:m.parameter_type,onChange:t=>v(i=>({...i,parameter_type:t.target.value,parameter_config:{}})),children:[e.jsx("option",{value:"",children:"Select parameter"}),I.map(t=>e.jsx("option",{value:t.type,children:t.label},t.type))]}),V?.description&&e.jsx("p",{className:"text-xs text-gray-500",children:V.description})]}),V?.requires_config&&e.jsxs(A,{children:[e.jsx("h3",{className:"mb-2 text-sm font-semibold",children:"Parameter Settings"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:V.config_fields.map(t=>e.jsxs("div",{children:[e.jsx(r,{htmlFor:`config-${t.name}`,value:t.label}),t.field_type==="select"&&t.options?e.jsxs(K,{id:`config-${t.name}`,value:m.parameter_config[t.name]||"",onChange:i=>Ie(t.name,i.target.value),children:[e.jsx("option",{value:"",children:"Select..."}),t.options.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))]}):e.jsx(o,{id:`config-${t.name}`,value:m.parameter_config[t.name]||"",onChange:i=>Ie(t.name,i.target.value),placeholder:t.description}),t.description&&e.jsx("p",{className:"text-xs text-gray-500",children:t.description})]},t.name))})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"mb-2 text-sm font-semibold",children:"Thresholds"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(r,{value:"Info threshold"}),e.jsx(o,{value:m.threshold_info,onChange:t=>F("threshold_info",t.target.value),placeholder:"Optional"})]}),e.jsxs("div",{children:[e.jsx(r,{value:"Warning threshold"}),e.jsx(o,{value:m.threshold_warning,onChange:t=>F("threshold_warning",t.target.value),placeholder:"Optional"})]}),e.jsxs("div",{children:[e.jsx(r,{value:"Failure threshold"}),e.jsx(o,{value:m.threshold_failure,onChange:t=>F("threshold_failure",t.target.value),placeholder:"Optional"})]})]}),e.jsxs("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(r,{value:"Duration (seconds)"}),e.jsx(o,{type:"number",min:5,value:m.duration_seconds,onChange:t=>F("duration_seconds",Number(t.target.value))})]}),e.jsxs("div",{children:[e.jsx(r,{value:"Cooldown (seconds)"}),e.jsx(o,{type:"number",min:0,value:m.cooldown_seconds,onChange:t=>F("cooldown_seconds",Number(t.target.value))})]})]})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"mb-2 text-sm font-semibold",children:"Apprise Services"}),P.length===0?e.jsx("p",{className:"text-xs text-gray-500",children:"No Apprise services configured."}):e.jsx("div",{className:"grid gap-2 md:grid-cols-2",children:P.map(t=>e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-200",children:[e.jsx(ls,{checked:m.apprise_service_indices.includes(t.id),onChange:()=>Be(t.id)}),e.jsxs("span",{children:[e.jsx("span",{className:"font-semibold",children:t.name}),t.description&&e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:t.description})]})]},t.id))})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"messageTemplate",value:"Message Template"}),e.jsx(ye,{id:"messageTemplate",rows:4,value:m.message_template,onChange:t=>F("message_template",t.target.value)}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Available variables:"," ",(V?.variables||[]).map(t=>e.jsx(X,{color:"info",className:"mr-1",children:t},t))]})]})]})}),e.jsxs(f.Footer,{children:[e.jsx(j,{onClick:Ge,children:m.id?"Save Changes":"Create Rule"}),e.jsx(j,{color:"light",onClick:xe,children:"Cancel"})]})]}),e.jsxs(f,{show:U.open,onClose:()=>W({open:!1,items:[],ruleName:""}),children:[e.jsxs(f.Header,{children:["Notification History · ",U.ruleName]}),e.jsx(f.Body,{children:U.items.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No history recorded."}):e.jsx("div",{className:"space-y-3",children:U.items.map(t=>e.jsxs(A,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:Pe(t.timestamp)}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Value: ",t.value]})]}),e.jsx(X,{color:t.sent_successfully?"success":"failure",children:t.level.toUpperCase()})]}),t.message&&e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:t.message})]},t.id))})}),e.jsx(f.Footer,{children:e.jsx(j,{color:"light",onClick:()=>W({open:!1,items:[],ruleName:""}),children:"Close"})})]}),e.jsxs(f,{show:l,onClose:()=>c(!1),size:"6xl",children:[e.jsx(f.Header,{children:"Create New Apprise Service"}),e.jsx(f.Body,{className:"max-h-[80vh] overflow-y-auto",children:e.jsx("div",{children:e.jsx(ms,{onServiceSaved:()=>{c(!1),ie()}})})})]}),e.jsxs(f,{show:h,onClose:()=>u(!1),size:"lg",children:[e.jsx(f.Header,{children:"Edit Apprise Service"}),e.jsx(f.Body,{className:"max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-4",children:[Fe&&e.jsx(k,{color:"failure",children:Fe}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"editName",value:"Service Name *"}),e.jsx(o,{id:"editName",value:T,onChange:t=>z(t.target.value),required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"editDescription",value:"Description (optional)"}),e.jsx(o,{id:"editDescription",value:fe,onChange:t=>ke(t.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"editUrl",value:"Service URL *"}),e.jsx(o,{id:"editUrl",value:he,onChange:t=>be(t.target.value),required:!0,className:"mt-1 font-mono text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"editEnabled",checked:Ne,onChange:t=>we(t.target.checked),className:"w-4 h-4"}),e.jsx(r,{htmlFor:"editEnabled",value:"Enabled"})]})]})}),e.jsxs(f.Footer,{children:[e.jsx(j,{color:"blue",onClick:Ze,disabled:Ce||!T.trim()||!he.trim(),children:Ce?"Saving...":"Save"}),e.jsx(j,{color:"gray",onClick:()=>u(!1),children:"Cancel"})]})]})]})}export{ys as Notifications};
