import{j as e,M as k,e as l,f as C,g as S,h as I,i as H,k as T,l as W,N as L,m as E,c as R,n as D,o as Z,a as $}from"./ui-vendor-DPY0cfBY.js";import{r as t,j as F,L as p}from"./react-vendor-DKKOAuGG.js";import{a as O}from"./index-JsSu9NQ4.js";function B({show:r,onClose:d}){const[a,c]=t.useState(""),[m,n]=t.useState(!1),[s,o]=t.useState(null);t.useEffect(()=>{r?h():(c(""),o(null))},[r]);const h=async()=>{n(!0),o(null);try{const u=await O.getFastfetch();c(u.text)}catch(u){o(u.response?.data?.detail||u.message||"Failed to fetch system info"),c("")}finally{n(!1)}};return e.jsxs(k,{show:r,onClose:d,size:"xl",children:[e.jsx(k.Header,{children:"System Info"}),e.jsx(k.Body,{children:e.jsxs("div",{className:"space-y-4",children:[m&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading system information..."}),s&&e.jsxs("div",{className:"text-center py-8 text-red-500",children:["Error: ",s]}),!m&&!s&&a&&e.jsxs("div",{className:"flex gap-6 items-start",children:[e.jsx("div",{className:"flex-shrink-0 flex items-center justify-center",children:e.jsx("svg",{width:"100",height:"100",viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsxs("g",{fill:"#5277C3",className:"dark:fill-blue-400",children:[e.jsx("path",{d:"M50 10L55 20L50 30L45 20L50 10Z"}),e.jsx("path",{d:"M50 90L55 80L50 70L45 80L50 90Z"}),e.jsx("path",{d:"M10 50L20 45L30 50L20 55L10 50Z"}),e.jsx("path",{d:"M90 50L80 45L70 50L80 55L90 50Z"}),e.jsx("path",{d:"M25 25L30 15L40 25L30 35L25 25Z"}),e.jsx("path",{d:"M75 75L80 65L90 75L80 85L75 75Z"}),e.jsx("path",{d:"M25 75L30 65L40 75L30 85L25 75Z"}),e.jsx("path",{d:"M75 25L80 15L90 25L80 35L75 25Z"}),e.jsx("circle",{cx:"50",cy:"50",r:"6"})]})})}),e.jsx("div",{className:"flex-1",children:e.jsx("pre",{className:"font-mono text-sm whitespace-pre-wrap text-gray-800 dark:text-gray-200 bg-gray-50 dark:bg-gray-900 p-4 rounded-lg overflow-auto max-h-[60vh]",children:a})})]})]})})]})}function V({onLogout:r,isOpen:d,onClose:a}){const c=F(),[m,n]=t.useState(!1),s=()=>{window.innerWidth<1650&&a()};return e.jsxs(e.Fragment,{children:[d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 xl-custom:hidden",onClick:a}),e.jsx("div",{className:`
          fixed xl-custom:static inset-y-0 left-0 z-50
          transform transition-transform duration-300 ease-in-out
          xl-custom:transform-none
          ${d?"translate-x-0":"-translate-x-full xl-custom:translate-x-0"}
        `,children:e.jsx(l,{"aria-label":"Sidebar with navigation",className:"h-full",children:e.jsxs(l.Items,{children:[e.jsxs(l.ItemGroup,{children:[e.jsx(l.Item,{as:p,to:"/dashboard",icon:C,active:c.pathname==="/dashboard",onClick:s,children:"Dashboard"}),e.jsx(l.Item,{as:p,to:"/network",icon:S,active:c.pathname==="/network",onClick:s,children:"Network"}),e.jsx(l.Item,{as:p,to:"/devices",icon:I,active:c.pathname==="/devices",onClick:s,children:"Devices"}),e.jsx(l.Item,{as:p,to:"/device-usage",icon:S,active:c.pathname==="/device-usage",onClick:s,children:"Device Usage"}),e.jsx(l.Item,{as:p,to:"/system",icon:H,active:c.pathname==="/system",onClick:s,children:"System"})]}),e.jsxs(l.ItemGroup,{children:[e.jsx(l.Item,{icon:T,style:{cursor:"pointer"},onClick:()=>{s(),n(!0)},children:"System Info"}),e.jsx(l.Item,{icon:W,style:{cursor:"pointer"},onClick:()=>{s(),r()},children:"Logout"})]})]})})}),e.jsx(B,{show:m,onClose:()=>n(!1)})]})}function X({hostname:r,username:d,connectionStatus:a,onMenuClick:c}){const m=()=>{const s=document.documentElement;if(s.classList.contains("dark")){s.classList.remove("dark");try{localStorage.setItem("theme","light")}catch{}}else{s.classList.add("dark");try{localStorage.setItem("theme","dark")}catch{}}},n=()=>{switch(a){case"connected":return"success";case"connecting":return"warning";case"error":return"failure";default:return"gray"}};return e.jsxs(L,{fluid:!0,className:"border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:c,className:"p-2 text-gray-500 rounded-lg xl-custom:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600","aria-label":"Toggle menu",children:e.jsx(E,{className:"w-6 h-6"})}),e.jsx(L.Brand,{children:e.jsx("span",{className:"self-center whitespace-nowrap text-xl font-semibold",children:r})})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsx(R,{content:"Toggle theme",placement:"bottom",children:e.jsxs("button",{type:"button",onClick:m,className:"p-2 rounded-lg text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:focus:ring-gray-600","aria-label":"Toggle theme",title:"Toggle theme",children:[e.jsx("span",{className:"hidden dark:inline-block",children:e.jsx(D,{className:"w-5 h-5"})}),e.jsx("span",{className:"inline-block dark:hidden",children:e.jsx(Z,{className:"w-5 h-5"})})]})}),e.jsxs($,{color:n(),size:"sm",className:"md:text-base",children:[e.jsx("span",{className:"hidden sm:inline",children:a.charAt(0).toUpperCase()+a.slice(1)}),e.jsx("span",{className:"sm:hidden",children:"â—"})]}),e.jsxs("span",{className:"text-xs md:text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:"Logged in as: "}),e.jsx("strong",{children:d})]})]})]})}const U=`ws://${window.location.host}/ws`;function _(r){const[d,a]=t.useState("disconnected"),[c,m]=t.useState(null),n=t.useRef(null),s=t.useRef(null),o=t.useRef(0),h=t.useCallback(()=>{if(!(!r||n.current?.readyState===WebSocket.OPEN)){a("connecting");try{const i=new WebSocket(`${U}?token=${encodeURIComponent(r)}`);i.onopen=()=>{console.log("WebSocket connected"),a("connected"),o.current=0},i.onmessage=x=>{m(x)},i.onerror=x=>{console.error("WebSocket error:",x),a("error")},i.onclose=()=>{if(console.log("WebSocket disconnected"),a("disconnected"),n.current=null,r){const x=Math.min(1e3*Math.pow(2,o.current),3e4);o.current+=1,s.current=window.setTimeout(()=>{console.log(`Reconnecting WebSocket (attempt ${o.current})...`),h()},x)}},n.current=i}catch(i){console.error("Failed to create WebSocket:",i),a("error")}}},[r]),u=t.useCallback(i=>{n.current?.readyState===WebSocket.OPEN&&n.current.send(i)},[]);return t.useEffect(()=>(r&&h(),()=>{s.current&&clearTimeout(s.current),n.current&&n.current.close()}),[r,h]),{connectionStatus:d,lastMessage:c,sendMessage:u}}const z=60;function Y(r){const{connectionStatus:d,lastMessage:a}=_(r),[c,m]=t.useState(null),[n,s]=t.useState([]),[o,h]=t.useState([]),[u,i]=t.useState([]),[x,b]=t.useState([]),[v,w]=t.useState(new Map);return t.useEffect(()=>{if(a)try{const f=JSON.parse(a.data);if(f.type==="metrics"&&f.data){const g=f.data;m(g.system),s(g.interfaces),h(g.services),i(g.dhcp_clients),b(g.dns_stats),w(N=>{const j=new Map(N);return g.interfaces.forEach(y=>{const M=[...j.get(y.interface)||[],y].slice(-z);j.set(y.interface,M)}),j})}}catch(f){console.error("Failed to parse WebSocket message:",f)}},[a]),{connectionStatus:d,system:c,interfaces:n,services:o,dhcpClients:u,dnsStats:x,interfaceHistory:v}}export{X as N,V as S,Y as u};
