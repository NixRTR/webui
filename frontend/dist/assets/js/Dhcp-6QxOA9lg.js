import{j as e,w as Qe,B as r,A as C,L as i,S as Re,a as j,s as We,t as Xe,u as Ee,C as Ye,n as _e,b as a,d as M,o as P,M as l,q as Fe,T as c,v as Ze}from"./ui-vendor-CT-4tH1q.js";import{u as es,r as t}from"./react-vendor-DKKOAuGG.js";import{u as ss,S as as,N as ts}from"./useMetrics-DLt2o056.js";import{a as o}from"./index-BbUI9UcV.js";import"./http-vendor-B9ygI19o.js";function ds(){const z=localStorage.getItem("access_token"),Ae=localStorage.getItem("username")||"Unknown",me=es(),[he,ue]=t.useState(!1),[S,Me]=t.useState([]),[Pe,je]=t.useState(!0),[ve,m]=t.useState(null),[D,ze]=t.useState("all"),[h,Ie]=t.useState(null),[H,ge]=t.useState(!1),[Le,Ne]=t.useState(!1),[v,I]=t.useState(null),[fe,L]=t.useState("homelab"),[T,O]=t.useState(!0),[g,q]=t.useState(""),[N,B]=t.useState(""),[U,V]=t.useState("1h"),[$,G]=t.useState(""),[J,K]=t.useState(""),[R,x]=t.useState(!1),[we,f]=t.useState(null),[Te,ye]=t.useState(!1),[Oe,pe]=t.useState(!1),[d,ke]=t.useState(null),[E,be]=t.useState([]),[_,Q]=t.useState(null),[w,W]=t.useState(""),[y,X]=t.useState(""),[p,Y]=t.useState(""),[Z,ee]=t.useState(""),[se,ae]=t.useState(!0),[Ce,u]=t.useState(null),[qe,k]=t.useState(!1),[Be,b]=t.useState(!1),[te,re]=t.useState(null),[le,ne]=t.useState(null),{connectionStatus:Ue}=ss(z);t.useEffect(()=>{if(!z){me("/login");return}ie(),Se()},[z,D]);const Se=async()=>{try{const s=await o.getDhcpServiceStatus();Ie(s)}catch(s){console.error("Failed to fetch DHCP service status:",s)}},F=async s=>{ge(!0);try{await o.controlDhcpService(s),setTimeout(()=>{Se()},1e3)}catch(n){m(n?.response?.data?.detail||n.message||`Failed to ${s} DHCP service`)}finally{ge(!1)}},ie=async()=>{je(!0),m(null);try{const s=D==="all"?void 0:D,n=await o.getDhcpNetworks(s);Me(n)}catch(s){m(s?.response?.data?.detail||s.message||"Failed to load DHCP networks")}finally{je(!1)}},A=async s=>{try{const n=await o.getDhcpReservations(s);be(n)}catch(n){m(n?.response?.data?.detail||n.message||"Failed to load DHCP reservations")}},Ve=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("username"),me("/login")},oe=s=>{s?(I(s),L(s.network),O(s.enabled),q(s.start),B(s.end),V(s.lease_time),G(s.dns_servers?.join(", ")||""),K(s.dynamic_domain||"")):(I(null),L("homelab"),O(!0),q(""),B(""),V("1h"),G(""),K("")),f(null),Ne(!0)},de=()=>{Ne(!1),I(null),f(null)},$e=async()=>{f(null),x(!0);try{if(!g.trim()||!N.trim()){f("Start and end IP addresses are required"),x(!1);return}const s=$.trim()?$.split(",").map(n=>n.trim()).filter(n=>n):null;if(v){const n={enabled:T,start:g.trim(),end:N.trim(),lease_time:U.trim(),dns_servers:s,dynamic_domain:J.trim()||null};await o.updateDhcpNetwork(v.id,n)}else{const n={network:fe,enabled:T,start:g.trim(),end:N.trim(),lease_time:U.trim(),dns_servers:s,dynamic_domain:J.trim()||null};await o.createDhcpNetwork(n)}await ie(),de()}catch(s){f(s?.response?.data?.detail||s.message||"Failed to save network")}finally{x(!1)}},Ge=async()=>{if(te)try{await o.deleteDhcpNetwork(te.id),await ie(),k(!1),re(null)}catch(s){m(s?.response?.data?.detail||s.message||"Failed to delete network")}},De=async s=>{ke(s),await A(s.id),ye(!0)},He=()=>{ye(!1),ke(null),be([])},ce=s=>{s?(Q(s),W(s.hostname),X(s.hw_address),Y(s.ip_address),ee(s.comment||""),ae(s.enabled)):(Q(null),W(""),X(""),Y(""),ee(""),ae(!0)),u(null),pe(!0)},xe=()=>{pe(!1),Q(null),u(null),d&&A(d.id)},Je=async()=>{if(d){u(null),x(!0);try{if(!w.trim()){u("Hostname is required"),x(!1);return}if(!y.trim()){u("MAC address is required"),x(!1);return}if(!p.trim()){u("IP address is required"),x(!1);return}if(_){const s={hostname:w.trim(),hw_address:y.trim(),ip_address:p.trim(),comment:Z.trim()||null,enabled:se};await o.updateDhcpReservation(_.id,s)}else{const s={network_id:d.id,hostname:w.trim(),hw_address:y.trim(),ip_address:p.trim(),comment:Z.trim()||null,enabled:se};await o.createDhcpReservation(d.id,s)}await A(d.id),xe()}catch(s){u(s?.response?.data?.detail||s.message||"Failed to save reservation")}finally{x(!1)}}},Ke=async()=>{if(le)try{await o.deleteDhcpReservation(le.id),d&&await A(d.id),b(!1),ne(null)}catch(s){m(s?.response?.data?.detail||s.message||"Failed to delete reservation")}};return Pe?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading DHCP networks..."})]})}):e.jsxs("div",{className:"flex h-screen",children:[e.jsx(as,{onLogout:Ve,isOpen:he,onClose:()=>ue(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(ts,{hostname:"nixos-router",username:Ae,connectionStatus:Ue,onMenuClick:()=>ue(!he)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Qe,{className:"w-8 h-8 text-gray-900 dark:text-white"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"DHCP Management"})]}),e.jsx(r,{color:"blue",onClick:()=>oe(),children:"New Network"})]}),ve&&e.jsx(C,{color:"failure",className:"mb-6",onDismiss:()=>m(null),children:ve}),e.jsxs("div",{className:"mb-4 flex flex-col md:flex-row justify-between items-start md:items-end gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"networkFilter",value:"Filter by Network"}),e.jsxs(Re,{id:"networkFilter",value:D,onChange:s=>ze(s.target.value),className:"mt-1 w-48",children:[e.jsx("option",{value:"all",children:"All Networks"}),e.jsx("option",{value:"homelab",children:"HOMELAB"}),e.jsx("option",{value:"lan",children:"LAN"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(i,{value:"DHCP Service"}),e.jsxs("div",{className:"flex gap-2 items-center flex-wrap",children:[h&&e.jsx(j,{color:h.is_active?"success":"gray",size:"sm",children:h.is_active?"Running":h.is_enabled?"Stopped":"Disabled"}),e.jsx(r,{size:"xs",color:"success",onClick:()=>F("start"),disabled:H||(h?.is_active??!1),title:"Start Service",children:e.jsx(We,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"failure",onClick:()=>F("stop"),disabled:H||!(h?.is_active??!1),title:"Stop Service",children:e.jsx(Xe,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"warning",onClick:()=>F("reload"),disabled:H||!(h?.is_active??!1),title:"Reload Service",children:e.jsx(Ee,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"purple",onClick:()=>F("restart"),disabled:H,title:"Restart Service",children:e.jsx(Ee,{className:"w-4 h-4"})})]})]})]}),e.jsxs(Ye,{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["DHCP Networks (",S.length,")"]}),S.length===0?e.jsx(C,{color:"info",icon:_e,children:"No DHCP networks configured. Create a network to get started."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden min-[1000px]:block overflow-x-auto",children:e.jsxs(a,{children:[e.jsxs(a.Head,{children:[e.jsx(a.HeadCell,{children:"Network"}),e.jsx(a.HeadCell,{children:"IP Range"}),e.jsx(a.HeadCell,{children:"Lease Time"}),e.jsx(a.HeadCell,{children:"DNS Servers"}),e.jsx(a.HeadCell,{children:"Dynamic Domain"}),e.jsx(a.HeadCell,{children:"Status"}),e.jsx(a.HeadCell,{children:"Actions"})]}),e.jsx(a.Body,{className:"divide-y",children:S.map(s=>e.jsxs(a.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx(a.Cell,{children:e.jsx(j,{color:"blue",children:s.network})}),e.jsxs(a.Cell,{className:"font-mono text-sm text-gray-900 dark:text-white",children:[s.start," - ",s.end]}),e.jsx(a.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.lease_time}),e.jsx(a.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.dns_servers?.join(", ")||"-"}),e.jsx(a.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.dynamic_domain||"-"}),e.jsx(a.Cell,{children:e.jsx(j,{color:s.enabled?"success":"gray",children:s.enabled?"Enabled":"Disabled"})}),e.jsx(a.Cell,{children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(r,{size:"xs",color:"blue",onClick:()=>De(s),children:"Reservations"}),e.jsx(r,{size:"xs",color:"gray",onClick:()=>oe(s),children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"failure",onClick:()=>{re(s),k(!0)},children:e.jsx(P,{className:"w-4 h-4"})})]})})]},s.id))})]})}),e.jsx("div",{className:"min-[1000px]:hidden space-y-3",children:S.map(s=>e.jsxs("div",{className:"p-4 rounded-lg border bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(j,{color:"blue",size:"sm",className:"mb-2",children:s.network}),e.jsxs("div",{className:"font-mono text-sm text-gray-900 dark:text-white",children:[s.start," - ",s.end]})]}),e.jsx(j,{color:s.enabled?"success":"gray",size:"sm",children:s.enabled?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"space-y-2 text-sm mb-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Lease Time:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:s.lease_time})]}),s.dns_servers&&s.dns_servers.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"DNS Servers:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-mono text-xs",children:s.dns_servers.join(", ")})]}),s.dynamic_domain&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Dynamic Domain:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:s.dynamic_domain})]})]}),e.jsx("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(r,{size:"xs",color:"blue",onClick:()=>De(s),className:"flex-1 min-w-[100px]",children:"Reservations"}),e.jsx(r,{size:"xs",color:"gray",onClick:()=>oe(s),className:"flex-1 min-w-[80px]",children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"failure",onClick:()=>{re(s),k(!0)},className:"flex-1 min-w-[80px]",children:e.jsx(P,{className:"w-4 h-4"})})]})})]},s.id))})]})]}),e.jsxs(l,{show:Le,onClose:de,size:"lg",children:[e.jsx(l.Header,{children:v?"Edit DHCP Network":"Create DHCP Network"}),e.jsx(l.Body,{className:"max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-4",children:[we&&e.jsx(C,{color:"failure",children:we}),!v&&e.jsxs("div",{children:[e.jsx(i,{htmlFor:"networkNetwork",value:"Network *"}),e.jsxs(Re,{id:"networkNetwork",value:fe,onChange:s=>L(s.target.value),className:"mt-1",required:!0,children:[e.jsx("option",{value:"homelab",children:"HOMELAB"}),e.jsx("option",{value:"lan",children:"LAN"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{id:"networkEnabled",checked:T,onChange:s=>O(s.target.checked)}),e.jsx(i,{htmlFor:"networkEnabled",value:"Enabled"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"networkStart",value:"IP Range Start *"}),e.jsx(c,{id:"networkStart",value:g,onChange:s=>q(s.target.value),placeholder:"192.168.2.100",required:!0,className:"mt-1 font-mono"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"networkEnd",value:"IP Range End *"}),e.jsx(c,{id:"networkEnd",value:N,onChange:s=>B(s.target.value),placeholder:"192.168.2.200",required:!0,className:"mt-1 font-mono"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"networkLeaseTime",value:"Lease Time *"}),e.jsx(c,{id:"networkLeaseTime",value:U,onChange:s=>V(s.target.value),placeholder:"1h, 1d, or 86400",required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"networkDnsServers",value:"DNS Servers (comma-separated)"}),e.jsx(c,{id:"networkDnsServers",value:$,onChange:s=>G(s.target.value),placeholder:"192.168.2.1, 8.8.8.8",className:"mt-1 font-mono"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"networkDynamicDomain",value:"Dynamic DNS Domain (optional)"}),e.jsx(c,{id:"networkDynamicDomain",value:J,onChange:s=>K(s.target.value),placeholder:"dhcp.homelab.local",className:"mt-1"})]})]})}),e.jsxs(l.Footer,{children:[e.jsx(r,{color:"blue",onClick:$e,disabled:R||!g.trim()||!N.trim(),children:R?"Saving...":v?"Update":"Create"}),e.jsx(r,{color:"gray",onClick:de,children:"Cancel"})]})]}),e.jsxs(l,{show:Te,onClose:He,size:"6xl",children:[e.jsxs(l.Header,{children:["Reservations - ",d?.network.toUpperCase()]}),e.jsxs(l.Body,{className:"max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Static IP Reservations (",E.length,")"]}),e.jsxs(r,{size:"sm",color:"blue",onClick:()=>ce(),children:[e.jsx(Ze,{className:"w-4 h-4 mr-1"}),"New Reservation"]})]}),E.length===0?e.jsx(C,{color:"info",icon:_e,children:"No reservations configured for this network."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden min-[1000px]:block overflow-x-auto",children:e.jsxs(a,{children:[e.jsxs(a.Head,{children:[e.jsx(a.HeadCell,{children:"Hostname"}),e.jsx(a.HeadCell,{children:"MAC Address"}),e.jsx(a.HeadCell,{children:"IP Address"}),e.jsx(a.HeadCell,{children:"Comment"}),e.jsx(a.HeadCell,{children:"Status"}),e.jsx(a.HeadCell,{children:"Actions"})]}),e.jsx(a.Body,{className:"divide-y",children:E.map(s=>e.jsxs(a.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx(a.Cell,{className:"font-medium text-gray-900 dark:text-white",children:s.hostname}),e.jsx(a.Cell,{className:"font-mono text-sm text-gray-500 dark:text-gray-400",children:s.hw_address}),e.jsx(a.Cell,{className:"font-mono text-sm text-gray-900 dark:text-white",children:s.ip_address}),e.jsx(a.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.comment||"-"}),e.jsx(a.Cell,{children:e.jsx(j,{color:s.enabled?"success":"gray",children:s.enabled?"Enabled":"Disabled"})}),e.jsx(a.Cell,{children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(r,{size:"xs",color:"gray",onClick:()=>ce(s),children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"failure",onClick:()=>{ne(s),b(!0)},children:e.jsx(P,{className:"w-4 h-4"})})]})})]},s.id))})]})}),e.jsx("div",{className:"min-[1000px]:hidden space-y-3",children:E.map(s=>e.jsxs("div",{className:"p-3 rounded-lg border bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("div",{className:"flex justify-between items-start mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:s.hostname}),e.jsx(j,{color:s.enabled?"success":"gray",size:"sm",children:s.enabled?"Enabled":"Disabled"})]})}),e.jsxs("div",{className:"space-y-1 text-sm mb-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"MAC Address:"}),e.jsx("span",{className:"font-mono text-xs text-gray-900 dark:text-gray-100 break-all",children:s.hw_address})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"IP Address:"}),e.jsx("span",{className:"font-mono text-xs text-gray-900 dark:text-gray-100",children:s.ip_address})]}),s.comment&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Comment:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 text-xs",children:s.comment})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700 flex gap-2",children:[e.jsx(r,{size:"xs",color:"gray",onClick:()=>ce(s),className:"flex-1",children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"failure",onClick:()=>{ne(s),b(!0)},className:"flex-1",children:e.jsx(P,{className:"w-4 h-4"})})]})]},s.id))})]})]}),e.jsx(l.Footer,{children:e.jsx(r,{color:"gray",onClick:He,children:"Close"})})]}),e.jsxs(l,{show:Oe,onClose:xe,size:"lg",children:[e.jsx(l.Header,{children:_?"Edit Reservation":"Create Reservation"}),e.jsx(l.Body,{className:"max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-4",children:[Ce&&e.jsx(C,{color:"failure",children:Ce}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"reservationHostname",value:"Hostname *"}),e.jsx(c,{id:"reservationHostname",value:w,onChange:s=>W(s.target.value),placeholder:"desktop",required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"reservationHwAddress",value:"MAC Address *"}),e.jsx(c,{id:"reservationHwAddress",value:y,onChange:s=>X(s.target.value),placeholder:"11:22:33:44:55:66",required:!0,className:"mt-1 font-mono"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"reservationIpAddress",value:"IP Address *"}),e.jsx(c,{id:"reservationIpAddress",value:p,onChange:s=>Y(s.target.value),placeholder:"192.168.2.50",required:!0,className:"mt-1 font-mono"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"reservationComment",value:"Comment (optional)"}),e.jsx(c,{id:"reservationComment",value:Z,onChange:s=>ee(s.target.value),className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{id:"reservationEnabled",checked:se,onChange:s=>ae(s.target.checked)}),e.jsx(i,{htmlFor:"reservationEnabled",value:"Enabled"})]})]})}),e.jsxs(l.Footer,{children:[e.jsx(r,{color:"blue",onClick:Je,disabled:R||!w.trim()||!y.trim()||!p.trim(),children:R?"Saving...":_?"Update":"Create"}),e.jsx(r,{color:"gray",onClick:xe,children:"Cancel"})]})]}),e.jsxs(l,{show:qe,onClose:()=>k(!1),size:"md",children:[e.jsx(l.Header,{children:"Delete DHCP Network"}),e.jsx(l.Body,{children:e.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:["Are you sure you want to delete the DHCP network for ",e.jsx("strong",{children:te?.network}),"? This will also delete all reservations for this network."]})}),e.jsxs(l.Footer,{children:[e.jsx(r,{color:"failure",onClick:Ge,children:"Delete"}),e.jsx(r,{color:"gray",onClick:()=>k(!1),children:"Cancel"})]})]}),e.jsxs(l,{show:Be,onClose:()=>b(!1),size:"md",children:[e.jsx(l.Header,{children:"Delete Reservation"}),e.jsx(l.Body,{children:e.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:["Are you sure you want to delete the reservation for ",e.jsx("strong",{children:le?.hostname}),"?"]})}),e.jsxs(l.Footer,{children:[e.jsx(r,{color:"failure",onClick:Ke,children:"Delete"}),e.jsx(r,{color:"gray",onClick:()=>b(!1),children:"Cancel"})]})]})]})})]})]})}export{ds as Dhcp};
