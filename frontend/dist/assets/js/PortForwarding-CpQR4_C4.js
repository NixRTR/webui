import{j as e,D as W,B as n,w as X,A as U,C as Y,b as a,a as Z,c as $,v as ee,M as r,L as h,S as se,T as k}from"./ui-vendor-CLzVGpw3.js";import{u as te,a as t}from"./react-vendor-4URc7N9U.js";import{u as ae,S as z,N as _}from"./useMetrics-BMv_ct_G.js";import{a as j}from"./index-CBx8CmZy.js";import"./http-vendor-B9ygI19o.js";function de(){const g=localStorage.getItem("access_token"),D=localStorage.getItem("username")||"Unknown",m=te(),[d,c]=t.useState(!1),[F,q]=t.useState([]),[G,R]=t.useState(!0),[H,o]=t.useState(null),[E,i]=t.useState(null),[J,x]=t.useState(!1),[f,I]=t.useState(null),[p,P]=t.useState("both"),[v,w]=t.useState(""),[y,C]=t.useState(""),[S,b]=t.useState(""),[M,A]=t.useState(!1),[K,u]=t.useState(!1),[l,O]=t.useState(null),{connectionStatus:T}=ae(g);t.useEffect(()=>{if(!g){m("/login");return}N()},[g,m]);const N=async()=>{R(!0),o(null);try{const s=await j.getPortForwardingRules();q(s)}catch(s){o(s?.response?.data?.detail||s.message||"Failed to load port forwarding rules")}finally{R(!1)}},B=s=>{s?(I(s),P(s.proto),w(s.externalPort.toString()),C(s.destination),b(s.destinationPort.toString())):(I(null),P("both"),w(""),C(""),b("")),x(!0)},Q=async()=>{A(!0),o(null),i(null);try{if(f){const s={proto:p,externalPort:parseInt(v),destination:y,destinationPort:parseInt(S)};await j.updatePortForwardingRule(f.index,s),i("Port forwarding rule updated successfully")}else{const s={proto:p,externalPort:parseInt(v),destination:y,destinationPort:parseInt(S)};await j.createPortForwardingRule(s),i("Port forwarding rule added successfully")}x(!1),await N()}catch(s){o(s?.response?.data?.detail||s.message||"Failed to save port forwarding rule")}finally{A(!1)}},V=async()=>{if(l)try{await j.deletePortForwardingRule(l.index),i("Port forwarding rule deleted successfully"),u(!1),O(null),await N()}catch(s){o(s?.response?.data?.detail||s.message||"Failed to delete port forwarding rule")}},L=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("username"),m("/login")};return G?e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(z,{onLogout:L,isOpen:d,onClose:()=>c(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(_,{hostname:"nixos-router",username:D,connectionStatus:T,onMenuClick:()=>c(!d)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"text-center text-gray-600 dark:text-gray-400",children:"Loading..."})})]})]}):e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(z,{onLogout:L,isOpen:d,onClose:()=>c(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(_,{hostname:"nixos-router",username:D,connectionStatus:T,onMenuClick:()=>c(!d)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{className:"w-8 h-8 mr-3 text-blue-600 dark:text-blue-400"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Port Forwarding"})]}),e.jsxs(n,{onClick:()=>B(),children:[e.jsx(X,{className:"w-5 h-5 mr-2"}),"Add Rule"]})]}),H&&e.jsx(U,{color:"failure",className:"mb-4",onDismiss:()=>o(null),children:H}),E&&e.jsx(U,{color:"success",className:"mb-4",onDismiss:()=>i(null),children:E}),e.jsx(Y,{children:F.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:'No port forwarding rules configured. Click "Add Rule" to create one.'}):e.jsxs(a,{children:[e.jsxs(a.Head,{children:[e.jsx(a.HeadCell,{children:"Protocol"}),e.jsx(a.HeadCell,{children:"External Port"}),e.jsx(a.HeadCell,{children:"Destination"}),e.jsx(a.HeadCell,{children:"Destination Port"}),e.jsx(a.HeadCell,{children:"Actions"})]}),e.jsx(a.Body,{className:"divide-y",children:F.map(s=>e.jsxs(a.Row,{children:[e.jsx(a.Cell,{children:e.jsx(Z,{color:"blue",children:s.proto.toUpperCase()})}),e.jsx(a.Cell,{children:s.externalPort}),e.jsx(a.Cell,{children:s.destination}),e.jsx(a.Cell,{children:s.destinationPort}),e.jsx(a.Cell,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(n,{size:"xs",onClick:()=>B(s),children:e.jsx($,{className:"w-4 h-4"})}),e.jsx(n,{size:"xs",color:"failure",onClick:()=>{O(s),u(!0)},children:e.jsx(ee,{className:"w-4 h-4"})})]})})]},s.index))})]})})]})})]}),e.jsxs(r,{show:J,onClose:()=>x(!1),children:[e.jsx(r.Header,{children:f?"Edit Port Forwarding Rule":"Add Port Forwarding Rule"}),e.jsx(r.Body,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"proto",children:"Protocol"}),e.jsxs(se,{id:"proto",value:p,onChange:s=>P(s.target.value),children:[e.jsx("option",{value:"both",children:"Both (TCP & UDP)"}),e.jsx("option",{value:"tcp",children:"TCP"}),e.jsx("option",{value:"udp",children:"UDP"})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"externalPort",children:"External Port"}),e.jsx(k,{id:"externalPort",type:"number",value:v,onChange:s=>w(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"destination",children:"Destination IP"}),e.jsx(k,{id:"destination",type:"text",value:y,onChange:s=>C(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"destinationPort",children:"Destination Port"}),e.jsx(k,{id:"destinationPort",type:"number",value:S,onChange:s=>b(s.target.value)})]})]})}),e.jsxs(r.Footer,{children:[e.jsx(n,{onClick:Q,disabled:M,children:M?"Saving...":"Save"}),e.jsx(n,{color:"gray",onClick:()=>x(!1),children:"Cancel"})]})]}),e.jsxs(r,{show:K,onClose:()=>u(!1),size:"md",children:[e.jsx(r.Header,{children:"Delete Port Forwarding Rule"}),e.jsxs(r.Body,{children:[e.jsx("p",{children:"Are you sure you want to delete this port forwarding rule?"}),l&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-100 dark:bg-gray-800 rounded",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Protocol:"})," ",l.proto.toUpperCase()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"External Port:"})," ",l.externalPort]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Destination:"})," ",l.destination,":",l.destinationPort]})]})]}),e.jsxs(r.Footer,{children:[e.jsx(n,{color:"failure",onClick:V,children:"Delete"}),e.jsx(n,{color:"gray",onClick:()=>u(!1),children:"Cancel"})]})]})]})}export{de as PortForwarding};
