import{j as e,G as i,I as A,J as M,e as $,K as G,z as W,N as T,y as P,x as z,r as B,E as O,D as U,u as _,O as F,Q as q,R as J,U as D,V as K,d as V,W as X,X as Y,a as Q}from"./ui-vendor-VTmJiFxm.js";import{k as Z,a as s,L as j}from"./react-vendor-DIDCmA_u.js";import{a as ee}from"./index-B6_SmPvs.js";function oe({onLogout:o,isOpen:b,onClose:r}){const a=Z(),[m,n]=s.useState(null),[c,d]=s.useState(!1),[y,x]=s.useState(!1),[k,l]=s.useState(!1),[u,v]=s.useState(!1);s.useEffect(()=>{(async()=>{try{const f=await ee.getGitHubStats();n(f)}catch(f){console.error("Failed to fetch GitHub stats:",f),n({stars:0,forks:0})}})()},[]);const g=()=>{window.innerWidth<1650&&r()},h=t=>a.pathname===t,p=(t,f)=>h(t)?!0:f?f.some(L=>a.pathname.startsWith(L.path)||(L.path.includes("?")?!1:a.pathname===L.path)):!1,C=[{path:"/network",label:"Charts"},{path:"/devices",label:"Devices"},{path:"/device-usage",label:"Usage"}],w=[{path:"/system",label:"Charts"},{path:"/settings/worker-status",label:"Worker Status"},{path:"/speedtest",label:"Speedtest"},{path:"/system-info",label:"System Info"}],S=[{id:"system",label:"System Log"},{id:"dnsmasq-lan",label:"LAN DNS/DHCP"},{id:"dnsmasq-homelab",label:"HOMELAB DNS/DHCP"},{id:"nginx",label:"Nginx"},{id:"router-webui-backend",label:"WebUI Backend"},{id:"router-webui-celery-parallel",label:"Parallel Celery Worker"},{id:"router-webui-celery-sequential",label:"Sequential Celery Worker"},{id:"router-webui-celery-aggregation",label:"Aggregation Celery Worker"},{id:"postgresql",label:"Database"},{id:"sshd",label:"SSH"}],H=[{path:"/settings/cake",label:"CAKE",icon:P},{path:"/settings/dhcp",label:"DHCP",icon:z},{path:"/settings/dns",label:"DNS",icon:B},{path:"/settings/blocklists-whitelist",label:"Blocklists",icon:O},{path:"/settings/port-forwarding",label:"Port Forwarding",icon:U},{path:"/settings/dyndns",label:"Dynamic DNS",icon:_},{path:"/settings/apprise",label:"Apprise",icon:W}],N=["/network","/devices","/device-usage"].some(t=>a.pathname===t||t!=="/network"&&a.pathname.startsWith(t)),E=a.pathname==="/system"||a.pathname==="/system-info"||a.pathname==="/speedtest"||a.pathname==="/settings/worker-status"||a.pathname.startsWith("/system/logs"),R=a.pathname.startsWith("/system/logs"),I=p("/settings",H);return s.useEffect(()=>{N&&d(!0)},[N]),s.useEffect(()=>{E&&x(!0)},[E]),s.useEffect(()=>{R&&l(!0)},[R]),s.useEffect(()=>{I&&v(!0)},[I]),e.jsxs(e.Fragment,{children:[b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 xl-custom:hidden",onClick:r}),e.jsx("div",{className:`
          fixed xl-custom:static inset-y-0 left-0 z-50
          transform transition-transform duration-300 ease-in-out
          xl-custom:transform-none
          ${b?"translate-x-0":"-translate-x-full xl-custom:translate-x-0"}
        `,children:e.jsx(i,{"aria-label":"Sidebar with navigation",className:"h-full",children:e.jsxs(i.Items,{children:[e.jsxs(i.ItemGroup,{children:[e.jsx(i.Item,{as:j,to:"/dashboard",icon:A,active:a.pathname==="/dashboard",onClick:g,children:"Dashboard"}),e.jsxs("li",{children:[e.jsxs("button",{type:"button",onClick:()=>d(!c),className:`flex items-center w-full p-2 rounded-lg ${N?"text-blue-600 bg-blue-50 dark:text-blue-500 dark:bg-gray-700":"text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"}`,children:[e.jsx(M,{className:"w-5 h-5 mr-3"}),e.jsx("span",{children:"Network"})]}),c&&e.jsx("ul",{className:"ml-6 mt-2 space-y-1",children:C.map(t=>e.jsx("li",{children:e.jsx(j,{to:t.path,onClick:g,className:`flex items-center p-2 rounded-lg text-sm ${h(t.path)?"text-blue-600 bg-blue-50 dark:text-blue-500 dark:bg-gray-700":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:t.label})},t.path))})]}),e.jsxs("li",{children:[e.jsxs("button",{type:"button",onClick:()=>x(!y),className:`flex items-center w-full p-2 rounded-lg ${E?"text-blue-600 bg-blue-50 dark:text-blue-500 dark:bg-gray-700":"text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"}`,children:[e.jsx($,{className:"w-5 h-5 mr-3"}),e.jsx("span",{children:"System"})]}),y&&e.jsxs("ul",{className:"ml-6 mt-2 space-y-1",children:[w.map(t=>e.jsx("li",{children:e.jsx(j,{to:t.path,onClick:g,className:`flex items-center p-2 rounded-lg text-sm ${h(t.path)?"text-blue-600 bg-blue-50 dark:text-blue-500 dark:bg-gray-700":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:t.label})},t.path)),e.jsxs("li",{children:[e.jsxs("button",{type:"button",onClick:()=>l(!k),className:`flex items-center w-full p-2 rounded-lg text-sm ${R?"text-blue-600 bg-blue-50 dark:text-blue-500 dark:bg-gray-700":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Logs"]}),k&&e.jsx("ul",{className:"ml-4 mt-1 space-y-1",children:S.map(t=>e.jsx("li",{children:e.jsx(j,{to:`/system/logs?service=${t.id}`,onClick:g,className:`flex items-center p-2 rounded-lg text-sm ${a.pathname==="/system/logs"&&new URLSearchParams(a.search).get("service")===t.id?"text-blue-600 bg-blue-50 dark:text-blue-500 dark:bg-gray-700":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:t.label})},t.id))})]})]})]}),e.jsx(i.Item,{as:j,to:"/notifications",icon:W,active:a.pathname==="/notifications",onClick:g,children:"Notifications"}),e.jsxs("li",{children:[e.jsxs("button",{type:"button",onClick:()=>v(!u),className:`flex items-center w-full p-2 rounded-lg ${I?"text-blue-600 bg-blue-50 dark:text-blue-500 dark:bg-gray-700":"text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"}`,children:[e.jsx(T,{className:"w-5 h-5 mr-3"}),e.jsx("span",{children:"Settings"})]}),u&&e.jsx("ul",{className:"ml-6 mt-2 space-y-1",children:H.map(t=>{const f=t.icon;return e.jsx("li",{children:e.jsxs(j,{to:t.path,onClick:g,className:`flex items-center p-2 rounded-lg text-sm ${h(t.path)?"text-blue-600 bg-blue-50 dark:text-blue-500 dark:bg-gray-700":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),t.label]})},t.path)})})]})]}),e.jsx(i.ItemGroup,{children:e.jsx("div",{className:"my-2 border-t border-gray-200 dark:border-gray-700"})}),e.jsx(i.ItemGroup,{children:e.jsx(i.Item,{icon:F,style:{cursor:"pointer"},onClick:()=>{g(),o()},children:"Logout"})}),e.jsx(i.ItemGroup,{children:e.jsx("div",{className:"my-2 border-t border-gray-200 dark:border-gray-700"})}),e.jsxs(i.ItemGroup,{children:[e.jsx(i.Item,{href:"/docs",target:"_blank",rel:"noopener noreferrer",icon:q,as:"a",onClick:g,children:"Documentation"}),e.jsx(i.Item,{href:"https://github.com/NixRTR/nixos-router",target:"_blank",rel:"noopener noreferrer",icon:J,as:"a",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:"GitHub"}),m!==null&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap",children:["â­ ",m.stars," ðŸ´ ",m.forks]})]})})]})]})})})]})}function ce({hostname:o,username:b,connectionStatus:r,onMenuClick:a}){const m=()=>{const c=document.documentElement;if(c.classList.contains("dark")){c.classList.remove("dark");try{localStorage.setItem("theme","light")}catch{}}else{c.classList.add("dark");try{localStorage.setItem("theme","dark")}catch{}}},n=()=>{switch(r){case"connected":return"success";case"connecting":return"warning";case"error":return"failure";default:return"gray"}};return e.jsxs(D,{fluid:!0,className:"border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:a,className:"p-2 text-gray-500 rounded-lg xl-custom:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600","aria-label":"Toggle menu",children:e.jsx(K,{className:"w-6 h-6"})}),e.jsx(D.Brand,{children:e.jsxs("span",{className:"flex items-center gap-2 self-center whitespace-nowrap text-xl font-semibold text-gray-900 dark:text-white",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 128 128",className:"w-6 h-6 dark:opacity-90 flex-shrink-0",preserveAspectRatio:"xMidYMid meet",children:[e.jsx("path",{fill:"#7EBAE4",d:"M50.732 43.771L20.525 96.428l-7.052-12.033 8.14-14.103-16.167-.042L2 64.237l3.519-6.15 23.013.073 8.27-14.352 13.93-.037zm2.318 42.094l60.409.003-6.827 12.164-16.205-.045 8.047 14.115-3.45 6.01-7.05.008-11.445-20.097-16.483-.034-6.996-12.124zm35.16-23.074l-30.202-52.66L71.888 10l8.063 14.148 8.12-14.072 6.897.002 3.532 6.143-11.57 20.024 8.213 14.386-6.933 12.16z",clipRule:"evenodd",fillRule:"evenodd"}),e.jsx("path",{fill:"#5277C3",d:"M39.831 65.463l30.202 52.66-13.88.131-8.063-14.148-8.12 14.072-6.897-.002-3.532-6.143 11.57-20.024-8.213-14.386 6.933-12.16zm35.08-23.207l-60.409-.003L21.33 30.09l16.204.045-8.047-14.115 3.45-6.01 7.051-.01 11.444 20.097 16.484.034 6.996 12.124zm2.357 42.216l30.207-52.658 7.052 12.034-8.141 14.102 16.168.043L126 64.006l-3.519 6.15-23.013-.073-8.27 14.352-13.93.037z",clipRule:"evenodd",fillRule:"evenodd"})]}),e.jsxs("span",{children:["NixOS Router (",o,")"]})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsx(V,{content:"Toggle theme",placement:"bottom",children:e.jsxs("button",{type:"button",onClick:m,className:"p-2 rounded-lg text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:focus:ring-gray-600","aria-label":"Toggle theme",title:"Toggle theme",children:[e.jsx("span",{className:"hidden dark:inline-block",children:e.jsx(X,{className:"w-5 h-5"})}),e.jsx("span",{className:"inline-block dark:hidden",children:e.jsx(Y,{className:"w-5 h-5"})})]})}),e.jsxs(Q,{color:n(),size:"sm",className:"md:text-base",children:[e.jsx("span",{className:"hidden sm:inline",children:r.charAt(0).toUpperCase()+r.slice(1)}),e.jsx("span",{className:"sm:hidden",children:"â—"})]}),e.jsxs("span",{className:"text-xs md:text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:"Logged in as: "}),e.jsx("strong",{children:b})]})]})]})}const te=`ws://${window.location.host}/ws`;function se(o){const[b,r]=s.useState("disconnected"),[a,m]=s.useState(null),n=s.useRef(null),c=s.useRef(null),d=s.useRef(0),y=s.useRef(()=>{}),x=s.useCallback(()=>{if(!(!o||n.current?.readyState===WebSocket.OPEN)){r("connecting");try{const l=new WebSocket(`${te}?token=${encodeURIComponent(o)}`);l.onopen=()=>{console.log("WebSocket connected"),r("connected"),d.current=0},l.onmessage=u=>{m(u)},l.onerror=u=>{console.error("WebSocket error:",u),r("error")},l.onclose=()=>{if(console.log("WebSocket disconnected"),r("disconnected"),n.current=null,o){const u=Math.min(1e3*Math.pow(2,d.current),3e4);d.current+=1,c.current=window.setTimeout(()=>{console.log(`Reconnecting WebSocket (attempt ${d.current})...`),y.current()},u)}},n.current=l}catch(l){console.error("Failed to create WebSocket:",l),r("error")}}},[o]);s.useEffect(()=>{y.current=x},[x]);const k=s.useCallback(l=>{n.current?.readyState===WebSocket.OPEN&&n.current.send(l)},[]);return s.useEffect(()=>(o&&x(),()=>{c.current&&clearTimeout(c.current),n.current&&n.current.close()}),[o,x]),{connectionStatus:b,lastMessage:a,sendMessage:k}}const ae=60;function ie(o){const{connectionStatus:b,lastMessage:r}=se(o),[a,m]=s.useState(null),[n,c]=s.useState([]),[d,y]=s.useState([]),[x,k]=s.useState([]),[l,u]=s.useState([]),[v,g]=s.useState(new Map);return s.useEffect(()=>{if(r)try{const h=JSON.parse(r.data);if(h.type==="metrics"&&h.data){const p=h.data;m(p.system),c(p.interfaces),y(p.services),k(p.dhcp_clients),u(p.dns_stats),g(C=>{const w=new Map(C);return p.interfaces.forEach(S=>{const N=[...w.get(S.interface)||[],S].slice(-ae);w.set(S.interface,N)}),w})}}catch(h){console.error("Failed to parse WebSocket message:",h)}},[r]),{connectionStatus:b,system:a,interfaces:n,services:d,dhcpClients:x,dnsStats:l,interfaceHistory:v}}export{ce as N,oe as S,ie as u};
