import{j as e,y as q,A as O,C as h,L as i,S as G,T as r,B as x,p as f}from"./ui-vendor-BWxpC62h.js";import{u as J,r as o}from"./react-vendor-DKKOAuGG.js";import{u as Q,S as U,N as K}from"./useMetrics-CKoVEceD.js";import{a as v}from"./index-ufCL5poE.js";import"./http-vendor-B9ygI19o.js";function te(){const y=localStorage.getItem("access_token"),k=localStorage.getItem("username")||"Unknown",N=J(),[j,b]=o.useState(!1),[_,S]=o.useState(!0),[A,C]=o.useState(!1),[T,l]=o.useState(null),[w,m]=o.useState(null),[d,F]=o.useState(!0),[H,I]=o.useState(8001),[P,z]=o.useState(0),[s,a]=o.useState({}),[c,M]=o.useState(null),[E,L]=o.useState(!1),{connectionStatus:$}=Q(y);o.useEffect(()=>{if(!y){N("/login");return}B()},[y]);const B=async()=>{S(!0),l(null);try{const t=await v.getAppriseConfig();F(t.enable),I(t.port),z(t.attachSize);const n={email:{enable:!1,smtpHost:"smtp.gmail.com",smtpPort:587,username:"",to:"",from:""},homeAssistant:{enable:!1,host:"homeassistant.local",port:8123,useHttps:!1},discord:{enable:!1},slack:{enable:!1},telegram:{enable:!1,chatId:""},ntfy:{enable:!1,topic:"router-notifications",server:""}},u={};["email","homeAssistant","discord","slack","telegram","ntfy"].forEach(g=>{t.services&&t.services[g]?u[g]={...n[g],...t.services[g]}:u[g]={...n[g]}}),a(u)}catch(t){l(t?.response?.data?.detail||t.message||"Failed to load Apprise configuration")}finally{S(!1)}},R=async()=>{C(!0),l(null),m(null);try{const t={};s.email&&(t.email={enable:s.email.enable||!1,smtpHost:s.email.smtpHost||"smtp.gmail.com",smtpPort:s.email.smtpPort||587,username:s.email.username||"",to:s.email.to||""},s.email.from&&(t.email.from=s.email.from)),s.homeAssistant&&(t.homeAssistant={enable:s.homeAssistant.enable||!1,host:s.homeAssistant.host||"homeassistant.local",port:s.homeAssistant.port||8123},s.homeAssistant.useHttps!==void 0&&s.homeAssistant.useHttps!==null&&(t.homeAssistant.useHttps=s.homeAssistant.useHttps)),s.discord&&(t.discord={enable:s.discord.enable||!1}),s.slack&&(t.slack={enable:s.slack.enable||!1}),s.telegram&&(t.telegram={enable:s.telegram.enable||!1,chatId:s.telegram.chatId||""}),s.ntfy&&(t.ntfy={enable:s.ntfy.enable||!1,topic:s.ntfy.topic||"router-notifications"},s.ntfy.server&&(t.ntfy.server=s.ntfy.server));const n={enable:d,port:H,attachSize:P,services:t};await v.updateAppriseConfig(n),m("Apprise configuration saved successfully"),await B()}catch(t){l(t?.response?.data?.detail||t.message||"Failed to save Apprise configuration")}finally{C(!1)}},D=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("username"),N("/login")},p=async t=>{M(t),l(null);try{const n=await v.testAppriseServiceByName(t);n.success?(m(`Test notification sent to ${t}`),setTimeout(()=>m(null),5e3)):(l(`Failed to send test to ${t}: ${n.message}`),setTimeout(()=>l(null),5e3))}catch(n){const u=n?.response?.data?.detail||n.message||"Failed to send test notification";l(`Failed to send test to ${t}: ${u}`),setTimeout(()=>l(null),5e3)}finally{M(null)}},W=async()=>{L(!0),l(null);try{const t=await v.testAllAppriseServices();t.success?(m("Test notification sent to all enabled services"),setTimeout(()=>m(null),5e3)):(l(`Failed to send test: ${t.message}`),setTimeout(()=>l(null),5e3))}catch(t){const n=t?.response?.data?.detail||t.message||"Failed to send test notification";l(`Failed to send test: ${n}`),setTimeout(()=>l(null),5e3)}finally{L(!1)}};return _?e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(U,{onLogout:D,isOpen:j,onClose:()=>b(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(K,{hostname:"nixos-router",username:k,connectionStatus:$,onMenuClick:()=>b(!j)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"text-center text-gray-600 dark:text-gray-400",children:"Loading..."})})]})]}):e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(U,{onLogout:D,isOpen:j,onClose:()=>b(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(K,{hostname:"nixos-router",username:k,connectionStatus:$,onMenuClick:()=>b(!j)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(q,{className:"w-8 h-8 mr-3 text-blue-600 dark:text-blue-400"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Apprise Notifications"})]}),T&&e.jsx(O,{color:"failure",className:"mb-4",onDismiss:()=>l(null),children:T}),w&&e.jsx(O,{color:"success",className:"mb-4",onDismiss:()=>m(null),children:w}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"enable",className:"mb-2 block",children:"Enable Apprise"}),e.jsxs(G,{id:"enable",value:d?"true":"false",onChange:t=>F(t.target.value==="true"),children:[e.jsx("option",{value:"true",children:"Enabled"}),e.jsx("option",{value:"false",children:"Disabled"})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"port",className:"mb-2 block",children:"Port"}),e.jsx(r,{id:"port",type:"number",value:H,onChange:t=>I(parseInt(t.target.value)||8001)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"attachSize",className:"mb-2 block",children:"Maximum Attachment Size (MB)"}),e.jsx(r,{id:"attachSize",type:"number",value:P,onChange:t=>z(parseInt(t.target.value)||0)}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Set to 0 to disable attachments"})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Notification Services"}),e.jsx(x,{onClick:W,disabled:E||!d,color:"gray",size:"sm",children:E?"Testing...":"Test All"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Configure individual notification services. Secrets (passwords, tokens) are stored in secrets/secrets.yaml."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Email (SMTP)"}),e.jsx(f,{checked:s.email?.enable||!1,onChange:t=>{a({...s,email:{...s.email,enable:t}})}})]}),s.email?.enable&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email-smtpHost",children:"SMTP Host"}),e.jsx(r,{id:"email-smtpHost",value:s.email?.smtpHost||"",onChange:t=>{a({...s,email:{...s.email,smtpHost:t.target.value}})},placeholder:"smtp.gmail.com"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email-smtpPort",children:"SMTP Port"}),e.jsx(r,{id:"email-smtpPort",type:"number",value:s.email?.smtpPort||"",onChange:t=>{a({...s,email:{...s.email,smtpPort:parseInt(t.target.value)||587}})},placeholder:"587"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email-username",children:"Username"}),e.jsx(r,{id:"email-username",value:s.email?.username||"",onChange:t=>{a({...s,email:{...s.email,username:t.target.value}})},placeholder:"your-email@gmail.com"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email-to",children:"To"}),e.jsx(r,{id:"email-to",value:s.email?.to||"",onChange:t=>{a({...s,email:{...s.email,to:t.target.value}})},placeholder:"recipient@example.com"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email-from",children:"From (optional)"}),e.jsx(r,{id:"email-from",value:s.email?.from||"",onChange:t=>{a({...s,email:{...s.email,from:t.target.value}})},placeholder:"your-email@gmail.com"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:'Password stored in sops secrets as "apprise-email-password"'})]})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Home Assistant"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{onClick:()=>p("homeAssistant"),disabled:c==="homeAssistant"||!s.homeAssistant?.enable||!d,color:"gray",size:"xs",children:c==="homeAssistant"?"Testing...":"Test"}),e.jsx(f,{checked:s.homeAssistant?.enable||!1,onChange:t=>{a({...s,homeAssistant:{...s.homeAssistant,enable:t}})}})]})]}),s.homeAssistant?.enable&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"ha-host",children:"Host"}),e.jsx(r,{id:"ha-host",value:s.homeAssistant?.host||"",onChange:t=>{a({...s,homeAssistant:{...s.homeAssistant,host:t.target.value}})},placeholder:"homeassistant.local"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"ha-port",children:"Port"}),e.jsx(r,{id:"ha-port",type:"number",value:s.homeAssistant?.port||"",onChange:t=>{a({...s,homeAssistant:{...s.homeAssistant,port:parseInt(t.target.value)||8123}})},placeholder:"8123"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{checked:s.homeAssistant?.useHttps||!1,onChange:t=>{a({...s,homeAssistant:{...s.homeAssistant,useHttps:t}})}}),e.jsx(i,{htmlFor:"ha-useHttps",children:"Use HTTPS"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:'Access token stored in sops secrets as "apprise-homeassistant-token"'})]})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Discord"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{onClick:()=>p("discord"),disabled:c==="discord"||!s.discord?.enable||!d,color:"gray",size:"xs",children:c==="discord"?"Testing...":"Test"}),e.jsx(f,{checked:s.discord?.enable||!1,onChange:t=>{a({...s,discord:{...s.discord,enable:t}})}})]})]}),s.discord?.enable&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Webhook ID and token stored in sops secrets:",e.jsx("br",{}),'- "apprise-discord-webhook-id"',e.jsx("br",{}),'- "apprise-discord-webhook-token"']})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Slack"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{onClick:()=>p("slack"),disabled:c==="slack"||!s.slack?.enable||!d,color:"gray",size:"xs",children:c==="slack"?"Testing...":"Test"}),e.jsx(f,{checked:s.slack?.enable||!1,onChange:t=>{a({...s,slack:{...s.slack,enable:t}})}})]})]}),s.slack?.enable&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Tokens stored in sops secrets:",e.jsx("br",{}),'- "apprise-slack-token-a"',e.jsx("br",{}),'- "apprise-slack-token-b"',e.jsx("br",{}),'- "apprise-slack-token-c"']})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Telegram"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{onClick:()=>p("telegram"),disabled:c==="telegram"||!s.telegram?.enable||!d,color:"gray",size:"xs",children:c==="telegram"?"Testing...":"Test"}),e.jsx(f,{checked:s.telegram?.enable||!1,onChange:t=>{a({...s,telegram:{...s.telegram,enable:t}})}})]})]}),s.telegram?.enable&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"telegram-chatId",children:"Chat ID"}),e.jsx(r,{id:"telegram-chatId",value:s.telegram?.chatId||"",onChange:t=>{a({...s,telegram:{...s.telegram,chatId:t.target.value}})},placeholder:"123456789"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:'Bot token stored in sops secrets as "apprise-telegram-bot-token"'})]})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"ntfy"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{onClick:()=>p("ntfy"),disabled:c==="ntfy"||!s.ntfy?.enable||!d,color:"gray",size:"xs",children:c==="ntfy"?"Testing...":"Test"}),e.jsx(f,{checked:s.ntfy?.enable||!1,onChange:t=>{a({...s,ntfy:{...s.ntfy,enable:t}})}})]})]}),s.ntfy?.enable&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"ntfy-topic",children:"Topic"}),e.jsx(r,{id:"ntfy-topic",value:s.ntfy?.topic||"",onChange:t=>{a({...s,ntfy:{...s.ntfy,topic:t.target.value}})},placeholder:"router-notifications"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"ntfy-server",children:"Server (optional)"}),e.jsx(r,{id:"ntfy-server",value:s.ntfy?.server||"",onChange:t=>{a({...s,ntfy:{...s.ntfy,server:t.target.value}})},placeholder:"https://ntfy.sh"})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Username and password stored in sops secrets:",e.jsx("br",{}),'- "apprise-ntfy-username"',e.jsx("br",{}),'- "apprise-ntfy-password"']})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(x,{onClick:R,disabled:A,children:A?"Saving...":"Save Configuration"})})]})})]})})]})]})}export{te as AppriseConfig};
