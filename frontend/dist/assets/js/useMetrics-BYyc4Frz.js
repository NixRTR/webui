import{j as e,M as j,e as l,f as M,g as b,h as H,i as L,k as W,l as E,N as k,m as R,c as T,n as D,o as $,a as F}from"./ui-vendor-DPY0cfBY.js";import{r as t,j as O,L as p}from"./react-vendor-DKKOAuGG.js";import{a as U}from"./index-Qx1jH_ne.js";function _({show:r,onClose:d}){const[n,c]=t.useState(""),[u,a]=t.useState(!1),[s,o]=t.useState(null);t.useEffect(()=>{r?h():(c(""),o(null))},[r]);const h=async()=>{a(!0),o(null);try{const m=await U.getFastfetch();c(m.image)}catch(m){o(m.response?.data?.detail||m.message||"Failed to fetch system info"),c("")}finally{a(!1)}};return e.jsxs(j,{show:r,onClose:d,size:"xl",children:[e.jsx(j.Header,{children:"System Info"}),e.jsx(j.Body,{children:e.jsxs("div",{className:"space-y-4",children:[u&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading system information..."}),s&&e.jsxs("div",{className:"text-center py-8 text-red-500",children:["Error: ",s]}),!u&&!s&&n&&e.jsx("div",{className:"overflow-auto max-h-[70vh] w-full flex justify-center",children:e.jsx("img",{src:`data:image/webp;base64,${n}`,alt:"System Information",className:"max-w-full h-auto rounded-lg"})})]})})]})}function X({onLogout:r,isOpen:d,onClose:n}){const c=O(),[u,a]=t.useState(!1),s=()=>{window.innerWidth<1650&&n()};return e.jsxs(e.Fragment,{children:[d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 xl-custom:hidden",onClick:n}),e.jsx("div",{className:`
          fixed xl-custom:static inset-y-0 left-0 z-50
          transform transition-transform duration-300 ease-in-out
          xl-custom:transform-none
          ${d?"translate-x-0":"-translate-x-full xl-custom:translate-x-0"}
        `,children:e.jsx(l,{"aria-label":"Sidebar with navigation",className:"h-full",children:e.jsxs(l.Items,{children:[e.jsxs(l.ItemGroup,{children:[e.jsx(l.Item,{as:p,to:"/dashboard",icon:M,active:c.pathname==="/dashboard",onClick:s,children:"Dashboard"}),e.jsx(l.Item,{as:p,to:"/network",icon:b,active:c.pathname==="/network",onClick:s,children:"Network"}),e.jsx(l.Item,{as:p,to:"/devices",icon:H,active:c.pathname==="/devices",onClick:s,children:"Devices"}),e.jsx(l.Item,{as:p,to:"/device-usage",icon:b,active:c.pathname==="/device-usage",onClick:s,children:"Device Usage"}),e.jsx(l.Item,{as:p,to:"/system",icon:L,active:c.pathname==="/system",onClick:s,children:"System"})]}),e.jsxs(l.ItemGroup,{children:[e.jsx(l.Item,{icon:W,style:{cursor:"pointer"},onClick:()=>{s(),a(!0)},children:"System Info"}),e.jsx(l.Item,{icon:E,style:{cursor:"pointer"},onClick:()=>{s(),r()},children:"Logout"})]})]})})}),e.jsx(_,{show:u,onClose:()=>a(!1)})]})}function Y({hostname:r,username:d,connectionStatus:n,onMenuClick:c}){const u=()=>{const s=document.documentElement;if(s.classList.contains("dark")){s.classList.remove("dark");try{localStorage.setItem("theme","light")}catch{}}else{s.classList.add("dark");try{localStorage.setItem("theme","dark")}catch{}}},a=()=>{switch(n){case"connected":return"success";case"connecting":return"warning";case"error":return"failure";default:return"gray"}};return e.jsxs(k,{fluid:!0,className:"border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:c,className:"p-2 text-gray-500 rounded-lg xl-custom:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600","aria-label":"Toggle menu",children:e.jsx(R,{className:"w-6 h-6"})}),e.jsx(k.Brand,{children:e.jsx("span",{className:"self-center whitespace-nowrap text-xl font-semibold",children:r})})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsx(T,{content:"Toggle theme",placement:"bottom",children:e.jsxs("button",{type:"button",onClick:u,className:"p-2 rounded-lg text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:focus:ring-gray-600","aria-label":"Toggle theme",title:"Toggle theme",children:[e.jsx("span",{className:"hidden dark:inline-block",children:e.jsx(D,{className:"w-5 h-5"})}),e.jsx("span",{className:"inline-block dark:hidden",children:e.jsx($,{className:"w-5 h-5"})})]})}),e.jsxs(F,{color:a(),size:"sm",className:"md:text-base",children:[e.jsx("span",{className:"hidden sm:inline",children:n.charAt(0).toUpperCase()+n.slice(1)}),e.jsx("span",{className:"sm:hidden",children:"â—"})]}),e.jsxs("span",{className:"text-xs md:text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:"Logged in as: "}),e.jsx("strong",{children:d})]})]})]})}const z=`ws://${window.location.host}/ws`;function B(r){const[d,n]=t.useState("disconnected"),[c,u]=t.useState(null),a=t.useRef(null),s=t.useRef(null),o=t.useRef(0),h=t.useCallback(()=>{if(!(!r||a.current?.readyState===WebSocket.OPEN)){n("connecting");try{const i=new WebSocket(`${z}?token=${encodeURIComponent(r)}`);i.onopen=()=>{console.log("WebSocket connected"),n("connected"),o.current=0},i.onmessage=f=>{u(f)},i.onerror=f=>{console.error("WebSocket error:",f),n("error")},i.onclose=()=>{if(console.log("WebSocket disconnected"),n("disconnected"),a.current=null,r){const f=Math.min(1e3*Math.pow(2,o.current),3e4);o.current+=1,s.current=window.setTimeout(()=>{console.log(`Reconnecting WebSocket (attempt ${o.current})...`),h()},f)}},a.current=i}catch(i){console.error("Failed to create WebSocket:",i),n("error")}}},[r]),m=t.useCallback(i=>{a.current?.readyState===WebSocket.OPEN&&a.current.send(i)},[]);return t.useEffect(()=>(r&&h(),()=>{s.current&&clearTimeout(s.current),a.current&&a.current.close()}),[r,h]),{connectionStatus:d,lastMessage:c,sendMessage:m}}const P=60;function q(r){const{connectionStatus:d,lastMessage:n}=B(r),[c,u]=t.useState(null),[a,s]=t.useState([]),[o,h]=t.useState([]),[m,i]=t.useState([]),[f,N]=t.useState([]),[v,w]=t.useState(new Map);return t.useEffect(()=>{if(n)try{const x=JSON.parse(n.data);if(x.type==="metrics"&&x.data){const g=x.data;u(g.system),s(g.interfaces),h(g.services),i(g.dhcp_clients),N(g.dns_stats),w(I=>{const y=new Map(I);return g.interfaces.forEach(S=>{const C=[...y.get(S.interface)||[],S].slice(-P);y.set(S.interface,C)}),y})}}catch(x){console.error("Failed to parse WebSocket message:",x)}},[n]),{connectionStatus:d,system:c,interfaces:a,services:o,dhcpClients:m,dnsStats:f,interfaceHistory:v}}export{Y as N,X as S,q as u};
