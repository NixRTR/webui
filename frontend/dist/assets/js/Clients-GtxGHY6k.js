import{j as e,a as d,C as Y,T as R,H as q,S as C,b as n,c as y,d as G,B as x}from"./ui-vendor-9U_t4tWK.js";import{u as K,r as c}from"./react-vendor-DKKOAuGG.js";import{u as Q,S as W,N as X}from"./useMetrics-CRDhnpnK.js";import{a as Z}from"./index-CqfEgk5W.js";import"./http-vendor-B9ygI19o.js";function ne(){const i=localStorage.getItem("access_token"),A=localStorage.getItem("username")||"Unknown",w=K(),[m,z]=c.useState(""),[u,L]=c.useState("all"),[g,H]=c.useState("all"),[b,B]=c.useState("all"),[p,h]=c.useState([]),[$,j]=c.useState([]),[F,k]=c.useState([]),[S,v]=c.useState(!1),{connectionStatus:E}=Q(i),I=async()=>{await Z.logout(),w("/login")};c.useEffect(()=>{const s=async()=>{if(i)try{const a=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${i}`}});if(a.ok){const t=await a.json();h(t)}}catch(a){console.error("Failed to fetch devices:",a)}};s();const l=setInterval(s,1e4);return()=>clearInterval(l)},[i]),c.useEffect(()=>{const s=async()=>{if(i)try{const a=await fetch("/api/devices/blocked",{headers:{Authorization:`Bearer ${i}`}});if(a.ok){const t=await a.json();j(t.ipv4||[]),k((t.macs||[]).map(r=>r.toLowerCase()))}}catch{}};s();const l=setInterval(s,1e4);return()=>clearInterval(l)},[i]);const f=s=>s.mac_address&&F.includes(s.mac_address.toLowerCase())?!0:s.ip_address&&$.includes(s.ip_address),D=async s=>{if(!i)return;const l=!s.favorite;h(a=>a.map(t=>t.mac_address===s.mac_address?{...t,favorite:l}:t));try{await fetch("/api/devices/override",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({mac_address:s.mac_address,favorite:l})});const a=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${i}`}});a.ok&&h(await a.json())}catch{h(a=>a.map(t=>t.mac_address===s.mac_address?{...t,favorite:!l}:t))}},O=async s=>{if(!i)return;const l=s.nickname||"",a=window.prompt("Set nickname for this device:",l);if(a!==null){h(t=>t.map(r=>r.mac_address===s.mac_address?{...r,nickname:a}:r));try{await fetch("/api/devices/override",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({mac_address:s.mac_address,nickname:a})});const t=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${i}`}});t.ok&&h(await t.json())}catch{}}},T=async s=>{if(!i)return;const l=f(s),a=l?"/api/devices/unblock":"/api/devices/block",t={mac_address:s.mac_address};s.ip_address&&s.ip_address.includes(".")&&(t.ip_address=s.ip_address),l?(j(r=>r.filter(o=>o!==s.ip_address)),k(r=>r.filter(o=>o!==s.mac_address.toLowerCase()))):t.ip_address&&(j(r=>Array.from(new Set([...r,t.ip_address]))),k(r=>Array.from(new Set([...r,s.mac_address.toLowerCase()]))));try{await fetch(a,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify(t)})}catch{j(l?o=>Array.from(new Set([...o,s.ip_address])):o=>o.filter(_=>_!==s.ip_address))}},N=p.filter(s=>{const l=!m||s.hostname?.toLowerCase().includes(m.toLowerCase())||s.ip_address.includes(m)||s.mac_address.includes(m)||s.vendor?.toLowerCase().includes(m.toLowerCase()),a=u==="all"||u==="online"&&s.is_online||u==="offline"&&!s.is_online,t=g==="all"||g==="dhcp"&&s.is_dhcp||g==="static"&&!s.is_dhcp,r=b==="all"||s.network===b;return l&&a&&t&&r}),M=p.filter(s=>s.is_online).length,P=p.filter(s=>!s.is_online).length,U=s=>{const l=new Date(s),a=new Date,t=new Date(a.getFullYear(),a.getMonth(),a.getDate());if(new Date(l.getFullYear(),l.getMonth(),l.getDate()).getTime()===t.getTime())return l.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});{const o=(l.getMonth()+1).toString().padStart(2,"0"),_=l.getDate().toString().padStart(2,"0"),J=l.getFullYear().toString().slice(-2);return`${o}/${_}/${J}`}},V=({text:s,maxLength:l=20})=>s.length<=l?e.jsx("span",{children:s}):e.jsx(y,{content:s,placement:"top",children:e.jsx("span",{className:"cursor-help truncate block max-w-[200px]",children:s})});return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(W,{onLogout:I,isOpen:S,onClose:()=>v(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(X,{hostname:"nixos-router",username:A,connectionStatus:E,onMenuClick:()=>v(!S)}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 bg-gray-50 dark:bg-gray-900",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4 md:mb-6 gap-3",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Devices"}),e.jsxs("div",{className:"flex gap-2 md:gap-4",children:[e.jsxs(d,{color:"success",size:"sm",className:"md:text-base",children:[M," Online"]}),e.jsxs(d,{color:"gray",size:"sm",className:"md:text-base",children:[P," Offline"]}),e.jsxs(d,{color:"info",size:"sm",className:"md:text-base",children:[p.length," Total"]})]})]}),e.jsxs(Y,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[e.jsx("div",{children:e.jsx(R,{icon:q,placeholder:"Search...",value:m,onChange:s=>z(s.target.value)})}),e.jsx("div",{children:e.jsxs(C,{value:u,onChange:s=>L(s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"online",children:"Online Only"}),e.jsx("option",{value:"offline",children:"Offline Only"})]})}),e.jsx("div",{children:e.jsxs(C,{value:g,onChange:s=>H(s.target.value),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"dhcp",children:"DHCP Only"}),e.jsx("option",{value:"static",children:"Static Only"})]})}),e.jsx("div",{children:e.jsxs(C,{value:b,onChange:s=>B(s.target.value),children:[e.jsx("option",{value:"all",children:"All Networks"}),e.jsx("option",{value:"homelab",children:"HOMELAB"}),e.jsx("option",{value:"lan",children:"LAN"})]})})]}),e.jsxs("div",{className:"xl-custom:hidden mb-4 flex flex-wrap gap-4 text-xs text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Network:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsx("span",{children:"HOMELAB"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-purple-500"}),e.jsx("span",{children:"LAN"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Type:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-500"}),e.jsx("span",{children:"Static"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsx("span",{children:"DHCP"})]})]})]}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs(n,{children:[e.jsxs(n.Head,{children:[e.jsx(n.HeadCell,{className:"w-12",children:"Status"}),e.jsx(n.HeadCell,{children:"Device"}),e.jsx(n.HeadCell,{children:"IP Address"}),e.jsx(n.HeadCell,{className:"hidden lg:table-cell",children:"MAC Address"}),e.jsx(n.HeadCell,{className:"hidden xl:table-cell",children:"Vendor"}),e.jsx(n.HeadCell,{className:"w-12",children:"Network"}),e.jsx(n.HeadCell,{className:"w-12",children:"Type"}),e.jsx(n.HeadCell,{className:"w-24",children:"Last Seen"}),e.jsx(n.HeadCell,{children:"Actions"})]}),e.jsx(n.Body,{className:"divide-y",children:N.map(s=>e.jsxs(n.Row,{className:s.is_online?"":"opacity-50",children:[e.jsxs(n.Cell,{children:[e.jsx("div",{className:"hidden xl-custom:block",children:e.jsx(d,{color:s.is_online?"success":"gray",size:"sm",children:s.is_online?"ONLINE":"OFFLINE"})}),e.jsx("div",{className:"xl-custom:hidden",children:e.jsx(y,{content:s.is_online?"Online":"Offline",placement:"top",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${s.is_online?"bg-green-500":"bg-gray-400"}`})})})]}),e.jsx(n.Cell,{className:"font-medium max-w-[200px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-yellow-500 hover:text-yellow-400 flex-shrink-0",title:s.favorite?"Unfavorite":"Favorite",onClick:()=>D(s),children:s.favorite?"★":"☆"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 flex-shrink-0",title:"Edit nickname",onClick:()=>O(s),children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx(V,{text:s.nickname||s.hostname||"Unknown",maxLength:20})]})}),e.jsx(n.Cell,{className:"font-mono text-sm",children:s.ip_address}),e.jsx(n.Cell,{className:"font-mono text-sm hidden lg:table-cell",children:s.mac_address}),e.jsx(n.Cell,{className:"text-sm text-gray-600 hidden xl:table-cell",children:s.vendor||"—"}),e.jsxs(n.Cell,{children:[e.jsx("div",{className:"hidden xl-custom:block",children:e.jsx(d,{color:s.network==="homelab"?"info":"purple",size:"sm",children:s.network.toUpperCase()})}),e.jsx("div",{className:"xl-custom:hidden",children:e.jsx(y,{content:s.network.toUpperCase(),placement:"top",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${s.network==="homelab"?"bg-blue-500":"bg-purple-500"}`})})})]}),e.jsxs(n.Cell,{children:[e.jsx("div",{className:"hidden xl-custom:block",children:e.jsx(d,{color:s.is_dhcp?"warning":"gray",size:"sm",children:s.is_dhcp?"DHCP":"Static"})}),e.jsx("div",{className:"xl-custom:hidden",children:e.jsx(y,{content:s.is_dhcp?"DHCP":"Static",placement:"top",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${s.is_dhcp?"bg-yellow-500":"bg-gray-500"}`})})})]}),e.jsx(n.Cell,{className:"text-sm whitespace-nowrap",children:U(s.last_seen)}),e.jsx(n.Cell,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(x,{size:"xs",color:"gray",onClick:()=>w(`/devices/${s.ip_address}`),children:"Details"}),e.jsx(x,{size:"xs",color:f(s)?"success":"failure",onClick:()=>T(s),children:f(s)?"Enable":"Disable"})]})})]},s.mac_address))})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:N.map(s=>e.jsxs("div",{className:`p-4 rounded-lg border ${s.is_online?"bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700":"bg-gray-50 border-gray-200 dark:bg-gray-900 dark:border-gray-700 opacity-60"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-lg mb-1",children:s.hostname||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.ip_address})]}),e.jsx(d,{color:s.is_online?"success":"gray",size:"sm",children:s.is_online?"● Online":"○ Offline"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"MAC:"}),e.jsx("span",{className:"font-mono",children:s.mac_address})]}),s.vendor&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Vendor:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:s.vendor})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Network:"}),e.jsx(d,{color:s.network==="homelab"?"info":"purple",size:"sm",children:s.network.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Nickname:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:s.nickname||"—"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Type:"}),e.jsx(d,{color:s.is_dhcp?s.is_static?"success":"warning":"gray",size:"sm",children:s.is_static?"Static DHCP":s.is_dhcp?"Dynamic":"Static IP"})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 pt-1 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("span",{children:"Last seen:"}),e.jsx("span",{children:new Date(s.last_seen).toLocaleString()})]}),e.jsxs("div",{className:"pt-3",children:[e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(x,{size:"xs",color:"gray",onClick:()=>w(`/devices/${s.ip_address}`),className:"flex-1",children:"Details"}),e.jsx(x,{size:"xs",color:f(s)?"success":"failure",onClick:()=>T(s),className:"flex-1",children:f(s)?"Enable":"Disable"})]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(x,{size:"xs",color:"light",className:"flex-1",onClick:()=>O(s),children:"Edit Nickname"}),e.jsx(x,{size:"xs",color:s.favorite?"warning":"light",onClick:()=>D(s),children:s.favorite?"★ Favorite":"☆ Favorite"})]})]})]})]},s.mac_address))}),N.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No devices found matching your filters"}),e.jsx("div",{className:"mt-4 text-xs md:text-sm text-gray-500 text-center md:text-left",children:e.jsxs("p",{children:["Showing ",N.length," of ",p.length," devices",e.jsxs("span",{className:"hidden sm:inline",children:[" • ","Auto-refreshing every 10 seconds"]})]})})]})]})]})]})}export{ne as Clients};
