import{j as e,G as W,A as O,C as h,L as i,S as q,T as r,B as x,s as f}from"./ui-vendor-H-3CurRd.js";import{u as J,a as o}from"./react-vendor-DIDCmA_u.js";import{u as Q,S as U,N as K}from"./useMetrics-BfELKp6-.js";import{a as v}from"./index-C3neANUc.js";import"./http-vendor-B9ygI19o.js";function te(){const y=localStorage.getItem("access_token"),N=localStorage.getItem("username")||"Unknown",k=J(),[j,b]=o.useState(!1),[_,A]=o.useState(!0),[S,C]=o.useState(!1),[T,l]=o.useState(null),[w,d]=o.useState(null),[m,F]=o.useState(!0),[H,I]=o.useState(8001),[P,z]=o.useState(0),[s,a]=o.useState({}),[c,M]=o.useState(null),[E,L]=o.useState(!1),{connectionStatus:$}=Q(y);o.useEffect(()=>{if(!y){k("/login");return}B()},[y,k]);const B=async()=>{A(!0),l(null);try{const t=await v.getAppriseConfig();F(t.enable),I(t.port),z(t.attachSize);const n={email:{enable:!1,smtpHost:"smtp.gmail.com",smtpPort:587,username:"",to:"",from:""},homeAssistant:{enable:!1,host:"homeassistant.local",port:8123,useHttps:!1},discord:{enable:!1},slack:{enable:!1},telegram:{enable:!1,chatId:""},ntfy:{enable:!1,topic:"router-notifications",server:""}},u={};["email","homeAssistant","discord","slack","telegram","ntfy"].forEach(p=>{t.services&&t.services[p]?u[p]={...n[p],...t.services[p]}:u[p]={...n[p]}}),a(u)}catch(t){l(t?.response?.data?.detail||t.message||"Failed to load Apprise configuration")}finally{A(!1)}},G=async()=>{C(!0),l(null),d(null);try{const t={};t.email={enable:s.email?.enable||!1},s.email?.smtpHost&&(t.email.smtpHost=s.email.smtpHost),s.email?.smtpPort&&(t.email.smtpPort=s.email.smtpPort),s.email?.username&&(t.email.username=s.email.username),s.email?.to&&(t.email.to=s.email.to),s.email?.from&&(t.email.from=s.email.from),t.homeAssistant={enable:s.homeAssistant?.enable||!1},s.homeAssistant?.host&&(t.homeAssistant.host=s.homeAssistant.host),s.homeAssistant?.port&&(t.homeAssistant.port=s.homeAssistant.port),s.homeAssistant?.useHttps!==void 0&&s.homeAssistant?.useHttps!==null&&(t.homeAssistant.useHttps=s.homeAssistant.useHttps),t.discord={enable:s.discord?.enable||!1},t.slack={enable:s.slack?.enable||!1},t.telegram={enable:s.telegram?.enable||!1},s.telegram?.chatId&&(t.telegram.chatId=s.telegram.chatId),t.ntfy={enable:s.ntfy?.enable||!1},s.ntfy?.topic&&(t.ntfy.topic=s.ntfy.topic),s.ntfy?.server&&(t.ntfy.server=s.ntfy.server);const n={enable:m,port:H,attachSize:P,services:t};await v.updateAppriseConfig(n),d("Apprise configuration saved successfully"),await B()}catch(t){l(t?.response?.data?.detail||t.message||"Failed to save Apprise configuration")}finally{C(!1)}},D=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("username"),k("/login")},g=async t=>{M(t),l(null);try{const n=await v.testAppriseServiceByName(t);n.success?(d(`Test notification sent to ${t}`),setTimeout(()=>d(null),5e3)):(l(`Failed to send test to ${t}: ${n.message}`),setTimeout(()=>l(null),5e3))}catch(n){const u=n?.response?.data?.detail||n.message||"Failed to send test notification";l(`Failed to send test to ${t}: ${u}`),setTimeout(()=>l(null),5e3)}finally{M(null)}},R=async()=>{L(!0),l(null);try{const t=await v.testAllAppriseServices();t.success?(d("Test notification sent to all enabled services"),setTimeout(()=>d(null),5e3)):(l(`Failed to send test: ${t.message}`),setTimeout(()=>l(null),5e3))}catch(t){const n=t?.response?.data?.detail||t.message||"Failed to send test notification";l(`Failed to send test: ${n}`),setTimeout(()=>l(null),5e3)}finally{L(!1)}};return _?e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(U,{onLogout:D,isOpen:j,onClose:()=>b(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(K,{hostname:"nixos-router",username:N,connectionStatus:$,onMenuClick:()=>b(!j)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"text-center text-gray-600 dark:text-gray-400",children:"Loading..."})})]})]}):e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(U,{onLogout:D,isOpen:j,onClose:()=>b(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(K,{hostname:"nixos-router",username:N,connectionStatus:$,onMenuClick:()=>b(!j)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(W,{className:"w-8 h-8 mr-3 text-blue-600 dark:text-blue-400"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Apprise Notifications"})]}),T&&e.jsx(O,{color:"failure",className:"mb-4",onDismiss:()=>l(null),children:T}),w&&e.jsx(O,{color:"success",className:"mb-4",onDismiss:()=>d(null),children:w}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"enable",className:"mb-2 block",children:"Enable Apprise"}),e.jsxs(q,{id:"enable",value:m?"true":"false",onChange:t=>F(t.target.value==="true"),children:[e.jsx("option",{value:"true",children:"Enabled"}),e.jsx("option",{value:"false",children:"Disabled"})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"port",className:"mb-2 block",children:"Port"}),e.jsx(r,{id:"port",type:"number",value:H,onChange:t=>I(parseInt(t.target.value)||8001)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"attachSize",className:"mb-2 block",children:"Maximum Attachment Size (MB)"}),e.jsx(r,{id:"attachSize",type:"number",value:P,onChange:t=>z(parseInt(t.target.value)||0)}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Set to 0 to disable attachments"})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Notification Services"}),e.jsx(x,{onClick:R,disabled:E||!m,color:"gray",size:"sm",children:E?"Testing...":"Test All"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Configure individual notification services. Secrets (passwords, tokens) are stored in secrets/secrets.yaml."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Email (SMTP)"}),e.jsx(f,{checked:s.email?.enable||!1,onChange:t=>{a({...s,email:{...s.email,enable:t}})}})]}),s.email?.enable&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email-smtpHost",children:"SMTP Host"}),e.jsx(r,{id:"email-smtpHost",value:s.email?.smtpHost||"",onChange:t=>{a({...s,email:{...s.email,smtpHost:t.target.value}})},placeholder:"smtp.gmail.com"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email-smtpPort",children:"SMTP Port"}),e.jsx(r,{id:"email-smtpPort",type:"number",value:s.email?.smtpPort||"",onChange:t=>{a({...s,email:{...s.email,smtpPort:parseInt(t.target.value)||587}})},placeholder:"587"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email-username",children:"Username"}),e.jsx(r,{id:"email-username",value:s.email?.username||"",onChange:t=>{a({...s,email:{...s.email,username:t.target.value}})},placeholder:"your-email@gmail.com"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email-to",children:"To"}),e.jsx(r,{id:"email-to",value:s.email?.to||"",onChange:t=>{a({...s,email:{...s.email,to:t.target.value}})},placeholder:"recipient@example.com"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email-from",children:"From (optional)"}),e.jsx(r,{id:"email-from",value:s.email?.from||"",onChange:t=>{a({...s,email:{...s.email,from:t.target.value}})},placeholder:"your-email@gmail.com"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:'Password stored in sops secrets as "apprise-email-password"'})]})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Home Assistant"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{onClick:()=>g("homeAssistant"),disabled:c==="homeAssistant"||!s.homeAssistant?.enable||!m,color:"gray",size:"xs",children:c==="homeAssistant"?"Testing...":"Test"}),e.jsx(f,{checked:s.homeAssistant?.enable||!1,onChange:t=>{a({...s,homeAssistant:{...s.homeAssistant,enable:t}})}})]})]}),s.homeAssistant?.enable&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"ha-host",children:"Host"}),e.jsx(r,{id:"ha-host",value:s.homeAssistant?.host||"",onChange:t=>{a({...s,homeAssistant:{...s.homeAssistant,host:t.target.value}})},placeholder:"homeassistant.local"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"ha-port",children:"Port"}),e.jsx(r,{id:"ha-port",type:"number",value:s.homeAssistant?.port||"",onChange:t=>{a({...s,homeAssistant:{...s.homeAssistant,port:parseInt(t.target.value)||8123}})},placeholder:"8123"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{checked:s.homeAssistant?.useHttps||!1,onChange:t=>{a({...s,homeAssistant:{...s.homeAssistant,useHttps:t}})}}),e.jsx(i,{htmlFor:"ha-useHttps",children:"Use HTTPS"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:'Access token stored in sops secrets as "apprise-homeassistant-token"'})]})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Discord"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{onClick:()=>g("discord"),disabled:c==="discord"||!s.discord?.enable||!m,color:"gray",size:"xs",children:c==="discord"?"Testing...":"Test"}),e.jsx(f,{checked:s.discord?.enable||!1,onChange:t=>{a({...s,discord:{...s.discord,enable:t}})}})]})]}),s.discord?.enable&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Webhook ID and token stored in sops secrets:",e.jsx("br",{}),'- "apprise-discord-webhook-id"',e.jsx("br",{}),'- "apprise-discord-webhook-token"']})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Slack"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{onClick:()=>g("slack"),disabled:c==="slack"||!s.slack?.enable||!m,color:"gray",size:"xs",children:c==="slack"?"Testing...":"Test"}),e.jsx(f,{checked:s.slack?.enable||!1,onChange:t=>{a({...s,slack:{...s.slack,enable:t}})}})]})]}),s.slack?.enable&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Tokens stored in sops secrets:",e.jsx("br",{}),'- "apprise-slack-token-a"',e.jsx("br",{}),'- "apprise-slack-token-b"',e.jsx("br",{}),'- "apprise-slack-token-c"']})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Telegram"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{onClick:()=>g("telegram"),disabled:c==="telegram"||!s.telegram?.enable||!m,color:"gray",size:"xs",children:c==="telegram"?"Testing...":"Test"}),e.jsx(f,{checked:s.telegram?.enable||!1,onChange:t=>{a({...s,telegram:{...s.telegram,enable:t}})}})]})]}),s.telegram?.enable&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"telegram-chatId",children:"Chat ID"}),e.jsx(r,{id:"telegram-chatId",value:s.telegram?.chatId||"",onChange:t=>{a({...s,telegram:{...s.telegram,chatId:t.target.value}})},placeholder:"123456789"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:'Bot token stored in sops secrets as "apprise-telegram-bot-token"'})]})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"ntfy"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{onClick:()=>g("ntfy"),disabled:c==="ntfy"||!s.ntfy?.enable||!m,color:"gray",size:"xs",children:c==="ntfy"?"Testing...":"Test"}),e.jsx(f,{checked:s.ntfy?.enable||!1,onChange:t=>{a({...s,ntfy:{...s.ntfy,enable:t}})}})]})]}),s.ntfy?.enable&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"ntfy-topic",children:"Topic"}),e.jsx(r,{id:"ntfy-topic",value:s.ntfy?.topic||"",onChange:t=>{a({...s,ntfy:{...s.ntfy,topic:t.target.value}})},placeholder:"router-notifications"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"ntfy-server",children:"Server (optional)"}),e.jsx(r,{id:"ntfy-server",value:s.ntfy?.server||"",onChange:t=>{a({...s,ntfy:{...s.ntfy,server:t.target.value}})},placeholder:"https://ntfy.sh"})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Username and password stored in sops secrets:",e.jsx("br",{}),'- "apprise-ntfy-username"',e.jsx("br",{}),'- "apprise-ntfy-password"']})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(x,{onClick:G,disabled:S,children:S?"Saving...":"Save Configuration"})})]})})]})})]})]})}export{te as AppriseConfig};
