import{j as e,C as F,B as h,u as I,t as O,s as T,f as q}from"./ui-vendor-VTmJiFxm.js";import{u as z,j as U,a as t,L as $}from"./react-vendor-DIDCmA_u.js";import{u as W,S as _,N as M}from"./useMetrics-CGyDbOB5.js";import{a as y}from"./index-B6_SmPvs.js";import"./http-vendor-B9ygI19o.js";const G="",w=[{id:"system",label:"System Log"},{id:"dnsmasq-lan",label:"LAN DNS/DHCP"},{id:"dnsmasq-homelab",label:"HOMELAB DNS/DHCP"},{id:"nginx",label:"Nginx"},{id:"router-webui-backend",label:"WebUI Backend"},{id:"router-webui-celery-parallel",label:"Parallel Celery Worker"},{id:"router-webui-celery-sequential",label:"Sequential Celery Worker"},{id:"router-webui-celery-aggregation",label:"Aggregation Celery Worker"},{id:"postgresql",label:"Database"},{id:"sshd",label:"SSH"}];function Y(){const l=localStorage.getItem("access_token"),N=localStorage.getItem("username")||"Unknown",S=z(),[k]=U(),s=k.get("service")||"",[v,b]=t.useState(!1),[i,c]=t.useState(""),[d,p]=t.useState(!1),[j,o]=t.useState(null),[u,g]=t.useState(!1),x=t.useRef(null),m=t.useRef(null),{connectionStatus:C}=W(l),f=t.useCallback(async(a=500)=>{if(!(!s||!l)){p(!0),o(null);try{const n=await y.getLogs(s,a);c(n)}catch(n){const r=n instanceof Error?n.message:"Failed to load logs";o(r),c("")}finally{p(!1)}}},[s,l]);t.useEffect(()=>{s?f():(c(""),o(null))},[s,f]),t.useEffect(()=>{if(!u||!s||!l)return;c("");const a=new AbortController;x.current=a;const n=`${G}/api/logs?service=${encodeURIComponent(s)}&lines=200&follow=true`;return(async()=>{try{const r=await fetch(n,{headers:{Authorization:`Bearer ${l}`},signal:a.signal});if(!r.ok||!r.body){o(`HTTP ${r.status}`);return}o(null);const H=r.body.getReader(),A=new TextDecoder;for(;;){const{done:P,value:B}=await H.read();if(P)break;c(D=>D+A.decode(B,{stream:!0}))}}catch(r){r.name!=="AbortError"&&o(r.message)}finally{g(!1)}})(),()=>{a.abort(),x.current=null}},[u,s,l]),t.useEffect(()=>{m.current&&i&&(m.current.scrollTop=m.current.scrollHeight)},[i]);const L=async()=>{await y.logout(),S("/login")},E=()=>{x.current&&x.current.abort(),g(!1)},R=w.find(a=>a.id===s)?.label||s;return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(_,{onLogout:L,isOpen:v,onClose:()=>b(!1)}),e.jsxs("div",{className:"flex flex-1 flex-col min-w-0",children:[e.jsx(M,{hostname:"nixos-router",username:N,connectionStatus:C,onMenuClick:()=>b(!0)}),e.jsx("main",{className:"flex-1 overflow-auto p-4",children:e.jsx("div",{className:"mx-auto max-w-full",children:e.jsxs(F,{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Logs"}),s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:R}),e.jsxs(h,{size:"xs",onClick:()=>f(),disabled:d||u,children:[e.jsx(I,{className:"mr-1 h-4 w-4"}),"Refresh"]}),u?e.jsxs(h,{size:"xs",color:"failure",onClick:E,children:[e.jsx(O,{className:"mr-1 h-4 w-4"}),"Stop"]}):e.jsxs(h,{size:"xs",color:"success",onClick:()=>g(!0),disabled:d,children:[e.jsx(T,{className:"mr-1 h-4 w-4"}),"Follow"]})]}),j&&e.jsx("p",{className:"mb-2 text-sm text-red-600 dark:text-red-400",children:j}),d&&!i&&e.jsxs("div",{className:"flex items-center gap-2 py-4",children:[e.jsx(q,{size:"sm"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Loading logs..."})]}),e.jsx("pre",{ref:m,className:"max-h-[70vh] overflow-auto rounded bg-gray-900 p-3 text-xs text-gray-100 font-mono whitespace-pre-wrap break-words",children:i||(d?"":"No log output.")})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Select a log source"}),e.jsx("ul",{className:"mt-2 space-y-1",children:w.map(a=>e.jsx("li",{children:e.jsx($,{to:`/system/logs?service=${a.id}`,className:"text-blue-600 hover:underline dark:text-blue-400",children:a.label})},a.id))})]})]})})})]})]})}export{Y as Logs};
