import{j as s,a as c,C as M,T as U,H as V,S as k,b as r,B as h}from"./ui-vendor-D-qqm1E2.js";import{u as J,r as o}from"./react-vendor-DKKOAuGG.js";import{u as R,S as q,N as G}from"./useMetrics-C2INNNRD.js";import{a as K}from"./index-BaCGhgyP.js";import"./http-vendor-B9ygI19o.js";function ee(){const n=localStorage.getItem("access_token"),z=localStorage.getItem("username")||"Unknown",N=J(),[x,A]=o.useState(""),[u,D]=o.useState("all"),[g,B]=o.useState("all"),[w,H]=o.useState("all"),[f,m]=o.useState([]),[T,p]=o.useState([]),[L,_]=o.useState([]),[b,C]=o.useState(!1),{connectionStatus:I}=R(n),P=async()=>{await K.logout(),N("/login")};o.useEffect(()=>{const e=async()=>{if(n)try{const t=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${n}`}});if(t.ok){const a=await t.json();m(a)}}catch(t){console.error("Failed to fetch devices:",t)}};e();const i=setInterval(e,1e4);return()=>clearInterval(i)},[n]),o.useEffect(()=>{const e=async()=>{if(n)try{const t=await fetch("/api/devices/blocked",{headers:{Authorization:`Bearer ${n}`}});if(t.ok){const a=await t.json();p(a.ipv4||[]),_((a.macs||[]).map(l=>l.toLowerCase()))}}catch{}};e();const i=setInterval(e,1e4);return()=>clearInterval(i)},[n]);const j=e=>e.mac_address&&L.includes(e.mac_address.toLowerCase())?!0:e.ip_address&&T.includes(e.ip_address),S=async e=>{if(!n)return;const i=!e.favorite;m(t=>t.map(a=>a.mac_address===e.mac_address?{...a,favorite:i}:a));try{await fetch("/api/devices/override",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({mac_address:e.mac_address,favorite:i})});const t=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${n}`}});t.ok&&m(await t.json())}catch{m(t=>t.map(a=>a.mac_address===e.mac_address?{...a,favorite:!i}:a))}},v=async e=>{if(!n)return;const i=e.nickname||"",t=window.prompt("Set nickname for this device:",i);if(t!==null){m(a=>a.map(l=>l.mac_address===e.mac_address?{...l,nickname:t}:l));try{await fetch("/api/devices/override",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({mac_address:e.mac_address,nickname:t})});const a=await fetch("/api/devices/all",{headers:{Authorization:`Bearer ${n}`}});a.ok&&m(await a.json())}catch{}}},O=async e=>{if(!n)return;const i=j(e),t=i?"/api/devices/unblock":"/api/devices/block",a={mac_address:e.mac_address};e.ip_address&&e.ip_address.includes(".")&&(a.ip_address=e.ip_address),i?(p(l=>l.filter(d=>d!==e.ip_address)),_(l=>l.filter(d=>d!==e.mac_address.toLowerCase()))):a.ip_address&&(p(l=>Array.from(new Set([...l,a.ip_address]))),_(l=>Array.from(new Set([...l,e.mac_address.toLowerCase()]))));try{await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(a)})}catch{p(i?d=>Array.from(new Set([...d,e.ip_address])):d=>d.filter(F=>F!==e.ip_address))}},y=f.filter(e=>{const i=!x||e.hostname?.toLowerCase().includes(x.toLowerCase())||e.ip_address.includes(x)||e.mac_address.includes(x)||e.vendor?.toLowerCase().includes(x.toLowerCase()),t=u==="all"||u==="online"&&e.is_online||u==="offline"&&!e.is_online,a=g==="all"||g==="dhcp"&&e.is_dhcp||g==="static"&&!e.is_dhcp,l=w==="all"||e.network===w;return i&&t&&a&&l}),$=f.filter(e=>e.is_online).length,E=f.filter(e=>!e.is_online).length;return s.jsxs("div",{className:"flex h-screen",children:[s.jsx(q,{onLogout:P,isOpen:b,onClose:()=>C(!1)}),s.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[s.jsx(G,{hostname:"nixos-router",username:z,connectionStatus:I,onMenuClick:()=>C(!b)}),s.jsxs("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 bg-gray-50 dark:bg-gray-900",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4 md:mb-6 gap-3",children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Devices"}),s.jsxs("div",{className:"flex gap-2 md:gap-4",children:[s.jsxs(c,{color:"success",size:"sm",className:"md:text-base",children:[$," Online"]}),s.jsxs(c,{color:"gray",size:"sm",className:"md:text-base",children:[E," Offline"]}),s.jsxs(c,{color:"info",size:"sm",className:"md:text-base",children:[f.length," Total"]})]})]}),s.jsxs(M,{children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[s.jsx("div",{children:s.jsx(U,{icon:V,placeholder:"Search...",value:x,onChange:e=>A(e.target.value)})}),s.jsx("div",{children:s.jsxs(k,{value:u,onChange:e=>D(e.target.value),children:[s.jsx("option",{value:"all",children:"All Status"}),s.jsx("option",{value:"online",children:"Online Only"}),s.jsx("option",{value:"offline",children:"Offline Only"})]})}),s.jsx("div",{children:s.jsxs(k,{value:g,onChange:e=>B(e.target.value),children:[s.jsx("option",{value:"all",children:"All Types"}),s.jsx("option",{value:"dhcp",children:"DHCP Only"}),s.jsx("option",{value:"static",children:"Static Only"})]})}),s.jsx("div",{children:s.jsxs(k,{value:w,onChange:e=>H(e.target.value),children:[s.jsx("option",{value:"all",children:"All Networks"}),s.jsx("option",{value:"homelab",children:"HOMELAB"}),s.jsx("option",{value:"lan",children:"LAN"})]})})]}),s.jsx("div",{className:"hidden md:block",children:s.jsxs(r,{children:[s.jsxs(r.Head,{children:[s.jsx(r.HeadCell,{children:"Status"}),s.jsx(r.HeadCell,{children:"Device"}),s.jsx(r.HeadCell,{children:"IP Address"}),s.jsx(r.HeadCell,{children:"MAC Address"}),s.jsx(r.HeadCell,{children:"Vendor"}),s.jsx(r.HeadCell,{children:"Network"}),s.jsx(r.HeadCell,{children:"Type"}),s.jsx(r.HeadCell,{children:"Last Seen"}),s.jsx(r.HeadCell,{children:"Actions"})]}),s.jsx(r.Body,{className:"divide-y",children:y.map(e=>s.jsxs(r.Row,{className:e.is_online?"":"opacity-50",children:[s.jsx(r.Cell,{children:s.jsx(c,{color:e.is_online?"success":"gray",size:"sm",children:e.is_online?"Online":"Offline"})}),s.jsx(r.Cell,{className:"font-medium",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{className:"text-yellow-500 hover:text-yellow-400",title:e.favorite?"Unfavorite":"Favorite",onClick:()=>S(e),children:e.favorite?"★":"☆"}),s.jsx("span",{children:e.nickname||e.hostname||"Unknown"}),s.jsx(h,{size:"xs",color:"light",onClick:()=>v(e),children:"Edit"})]})}),s.jsx(r.Cell,{children:e.ip_address}),s.jsx(r.Cell,{className:"font-mono text-sm",children:e.mac_address}),s.jsx(r.Cell,{className:"text-sm text-gray-600",children:e.vendor||"—"}),s.jsx(r.Cell,{children:s.jsx(c,{color:e.network==="homelab"?"info":"purple",children:e.network.toUpperCase()})}),s.jsx(r.Cell,{children:s.jsx(c,{color:e.is_dhcp?e.is_static?"success":"warning":"gray",children:e.is_static?"Static DHCP":e.is_dhcp?"Dynamic DHCP":"Static IP"})}),s.jsx(r.Cell,{className:"text-sm",children:new Date(e.last_seen).toLocaleString()}),s.jsx(r.Cell,{children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx(h,{size:"xs",color:"gray",onClick:()=>N(`/devices/${e.ip_address}`),children:"Details"}),s.jsx(h,{size:"xs",color:j(e)?"success":"failure",onClick:()=>O(e),children:j(e)?"Enable":"Disable"})]})})]},e.mac_address))})]})}),s.jsx("div",{className:"md:hidden space-y-3",children:y.map(e=>s.jsxs("div",{className:`p-4 rounded-lg border ${e.is_online?"bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700":"bg-gray-50 border-gray-200 dark:bg-gray-900 dark:border-gray-700 opacity-60"}`,children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-semibold text-lg mb-1",children:e.hostname||"Unknown"}),s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.ip_address})]}),s.jsx(c,{color:e.is_online?"success":"gray",size:"sm",children:e.is_online?"● Online":"○ Offline"})]}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500",children:"MAC:"}),s.jsx("span",{className:"font-mono",children:e.mac_address})]}),e.vendor&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500",children:"Vendor:"}),s.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:e.vendor})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-500",children:"Network:"}),s.jsx(c,{color:e.network==="homelab"?"info":"purple",size:"sm",children:e.network.toUpperCase()})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-500",children:"Nickname:"}),s.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:e.nickname||"—"})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-500",children:"Type:"}),s.jsx(c,{color:e.is_dhcp?e.is_static?"success":"warning":"gray",size:"sm",children:e.is_static?"Static DHCP":e.is_dhcp?"Dynamic":"Static IP"})]}),s.jsxs("div",{className:"flex justify-between text-xs text-gray-500 pt-1 border-t border-gray-200 dark:border-gray-700",children:[s.jsx("span",{children:"Last seen:"}),s.jsx("span",{children:new Date(e.last_seen).toLocaleString()})]}),s.jsxs("div",{className:"pt-3",children:[s.jsxs("div",{className:"flex gap-2 mb-2",children:[s.jsx(h,{size:"xs",color:"gray",onClick:()=>N(`/devices/${e.ip_address}`),className:"flex-1",children:"Details"}),s.jsx(h,{size:"xs",color:j(e)?"success":"failure",onClick:()=>O(e),className:"flex-1",children:j(e)?"Enable":"Disable"})]}),s.jsxs("div",{className:"mt-2 flex gap-2",children:[s.jsx(h,{size:"xs",color:"light",className:"flex-1",onClick:()=>v(e),children:"Edit Nickname"}),s.jsx(h,{size:"xs",color:e.favorite?"warning":"light",onClick:()=>S(e),children:e.favorite?"★ Favorite":"☆ Favorite"})]})]})]})]},e.mac_address))}),y.length===0&&s.jsx("div",{className:"text-center py-8 text-gray-500",children:"No devices found matching your filters"}),s.jsx("div",{className:"mt-4 text-xs md:text-sm text-gray-500 text-center md:text-left",children:s.jsxs("p",{children:["Showing ",y.length," of ",f.length," devices",s.jsxs("span",{className:"hidden sm:inline",children:[" • ","Auto-refreshing every 10 seconds"]})]})})]})]})]})]})}export{ee as Clients};
