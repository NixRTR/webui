import{j as e,B as u,C as f,P as H,S as C,L as F,T as O,b as a}from"./ui-vendor-BkP_2RY2.js";import{u as K,r}from"./react-vendor-DKKOAuGG.js";import{C as U}from"./CustomTooltip-CfUFz5KE.js";import{u as W,S as G,N as X}from"./useMetrics-CNZIkBmk.js";import{a as Y}from"./index-DhR-YBuW.js";import{R as Z,L as q,C as J,X as Q,Y as V,T as ee,a as se,b as k}from"./charts-_iF2RbR3.js";import"./http-vendor-B9ygI19o.js";const te=[{value:1,label:"1 hour"},{value:3,label:"3 hours"},{value:6,label:"6 hours"},{value:12,label:"12 hours"},{value:24,label:"1 day"},{value:168,label:"1 week"},{value:336,label:"2 weeks"},{value:720,label:"1 month"},{value:2160,label:"3 months"},{value:4320,label:"6 months"},{value:8760,label:"1 year"}],ae=[10,25,50,100];function me(){const n=localStorage.getItem("access_token"),_=localStorage.getItem("username")||"Unknown",P=K(),[v,b]=r.useState(!1),{connectionStatus:I}=W(n),[m,T]=r.useState(24),[z,D]=r.useState([]),[o,x]=r.useState(1),[h,y]=r.useState(25),[S,p]=r.useState(""),[$,g]=r.useState(!1),[c,E]=r.useState(null),[t,N]=r.useState({is_running:!1}),d=r.useRef(null),L=async()=>{await Y.logout(),P("/login")};r.useEffect(()=>{const s=async()=>{if(n)try{const i=await fetch(`/api/speedtest/chart-data?hours=${m}`,{headers:{Authorization:`Bearer ${n}`}});if(i.ok){const j=await i.json();D(j.data||[])}}catch(i){console.error("Error fetching chart data:",i)}};s();const l=setInterval(s,3e4);return()=>clearInterval(l)},[n,m]),r.useEffect(()=>{(async()=>{if(n)try{const l=new Date,i=new Date(l.getTime()-m*60*60*1e3),j=await fetch(`/api/speedtest/history?start_time=${i.toISOString()}&end_time=${l.toISOString()}&page=${o}&page_size=${h}`,{headers:{Authorization:`Bearer ${n}`}});if(j.ok){const B=await j.json();E(B)}}catch(l){console.error("Error fetching table data:",l)}})()},[n,m,o,h]),r.useEffect(()=>{if(t.is_running){const s=async()=>{try{const l=await fetch("/api/speedtest/status",{headers:{Authorization:`Bearer ${n}`}});if(l.ok){const i=await l.json();N(i),!i.is_running&&t.is_running&&window.location.reload()}}catch(l){console.error("Error polling status:",l)}};return d.current=window.setInterval(s,1e3),()=>{d.current&&clearInterval(d.current)}}else d.current&&(clearInterval(d.current),d.current=null)},[t.is_running,n]);const M=async()=>{if(n)try{(await fetch("/api/speedtest/trigger",{method:"POST",headers:{Authorization:`Bearer ${n}`}})).ok&&N({is_running:!0,progress:0})}catch(s){console.error("Error triggering speedtest:",s)}},R=s=>{s==="custom"?g(!0):(y(parseInt(s)),x(1),g(!1),p(""))},w=()=>{const s=parseInt(S);s>=1&&s<=200&&(y(s),x(1),g(!1),p(""))},A=s=>new Date(s).toLocaleString();return e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(G,{isOpen:v,onClose:()=>b(!1),onLogout:L}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(X,{hostname:"nixos-router",username:_,connectionStatus:I,onMenuClick:()=>b(!v)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Speedtest"}),e.jsx(u,{onClick:M,disabled:t.is_running,color:"blue",children:t.is_running?"Running...":"Run Speedtest"})]}),t.is_running&&e.jsx(f,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Speedtest in Progress"}),e.jsxs("div",{className:"flex justify-center items-center space-x-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative w-32 h-32 mx-auto",children:[e.jsxs("svg",{className:"transform -rotate-90",viewBox:"0 0 120 120",children:[e.jsx("circle",{cx:"60",cy:"60",r:"50",fill:"none",stroke:"#e5e7eb",strokeWidth:"10"}),e.jsx("circle",{cx:"60",cy:"60",r:"50",fill:"none",stroke:"#3b82f6",strokeWidth:"10",strokeDasharray:`${2*Math.PI*50}`,strokeDashoffset:`${2*Math.PI*50*(1-(t.progress||0)/100)}`,strokeLinecap:"round"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:t.download_mbps?`${t.download_mbps.toFixed(1)}`:"--"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Mbps"})]})})]}),e.jsx("div",{className:"mt-2 text-sm font-medium",children:"Download"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative w-32 h-32 mx-auto",children:[e.jsxs("svg",{className:"transform -rotate-90",viewBox:"0 0 120 120",children:[e.jsx("circle",{cx:"60",cy:"60",r:"50",fill:"none",stroke:"#e5e7eb",strokeWidth:"10"}),e.jsx("circle",{cx:"60",cy:"60",r:"50",fill:"none",stroke:"#10b981",strokeWidth:"10",strokeDasharray:`${2*Math.PI*50}`,strokeDashoffset:`${2*Math.PI*50*(1-(t.progress||0)/100)}`,strokeLinecap:"round"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:t.upload_mbps?`${t.upload_mbps.toFixed(1)}`:"--"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Mbps"})]})})]}),e.jsx("div",{className:"mt-2 text-sm font-medium",children:"Upload"})]}),t.ping_ms&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl font-bold",children:t.ping_ms.toFixed(1)}),e.jsx("div",{className:"text-sm text-gray-500",children:"ms"}),e.jsx("div",{className:"mt-2 text-sm font-medium",children:"Ping"})]})]}),t.progress!==void 0&&e.jsxs("div",{className:"mt-4",children:[e.jsx(H,{progress:t.progress,color:"blue"}),e.jsx("div",{className:"text-sm text-gray-500 mt-2 text-center",children:t.current_phase||"Starting..."})]})]})}),e.jsxs(f,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Speedtest Results"}),e.jsx(C,{value:m,onChange:s=>{T(parseInt(s.target.value)),x(1)},className:"w-48",children:te.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsx(Z,{width:"100%",height:400,children:e.jsxs(q,{data:z,children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"timestamp",tickFormatter:s=>new Date(s).toLocaleTimeString()}),e.jsx(V,{label:{value:"Mbps",angle:-90,position:"insideLeft"}}),e.jsx(ee,{content:e.jsx(U,{})}),e.jsx(se,{}),e.jsx(k,{type:"monotone",dataKey:"download_mbps",stroke:"#3b82f6",name:"Download",dot:!1}),e.jsx(k,{type:"monotone",dataKey:"upload_mbps",stroke:"#10b981",name:"Upload",dot:!1})]})})]}),e.jsxs(f,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Test History"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{htmlFor:"page-size",children:"Results per page:"}),$?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{id:"custom-page-size",type:"number",min:"1",max:"200",value:S,onChange:s=>p(s.target.value),onKeyPress:s=>{s.key==="Enter"&&w()},className:"w-20"}),e.jsx(u,{size:"sm",onClick:w,children:"Apply"}),e.jsx(u,{size:"sm",color:"gray",onClick:()=>{g(!1),p("")},children:"Cancel"})]}):e.jsxs(C,{id:"page-size",value:h.toString(),onChange:s=>R(s.target.value),className:"w-32",children:[ae.map(s=>e.jsx("option",{value:s.toString(),children:s},s)),e.jsx("option",{value:"custom",children:"Custom"})]})]})]}),e.jsxs(a,{children:[e.jsxs(a.Head,{children:[e.jsx(a.HeadCell,{children:"Timestamp"}),e.jsx(a.HeadCell,{children:"Download (Mbps)"}),e.jsx(a.HeadCell,{children:"Upload (Mbps)"}),e.jsx(a.HeadCell,{children:"Ping (ms)"}),e.jsx(a.HeadCell,{children:"Server"})]}),e.jsx(a.Body,{className:"divide-y",children:c?.results.map(s=>e.jsxs(a.Row,{children:[e.jsx(a.Cell,{children:A(s.timestamp)}),e.jsx(a.Cell,{children:s.download_mbps.toFixed(2)}),e.jsx(a.Cell,{children:s.upload_mbps.toFixed(2)}),e.jsx(a.Cell,{children:s.ping_ms.toFixed(2)}),e.jsx(a.Cell,{children:s.server_name||"-"})]},s.id))})]}),c&&c.total_pages>1&&e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(o-1)*h+1," to ",Math.min(o*h,c.total)," of ",c.total," results"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{size:"sm",color:"gray",disabled:o===1,onClick:()=>x(o-1),children:"Previous"}),e.jsx(u,{size:"sm",color:"gray",disabled:o===c.total_pages,onClick:()=>x(o+1),children:"Next"})]})]})]})]})})]})]})}export{me as Speedtest};
