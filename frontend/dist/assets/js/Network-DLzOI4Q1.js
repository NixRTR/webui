import{j as e,L as u,S as N,T as D,C as O,a as T}from"./ui-vendor-BVL8hT-S.js";import{u as F,r as a}from"./react-vendor-DKKOAuGG.js";import{u as B,S as E,N as H}from"./useMetrics-CHtIqUNb.js";import{a as U}from"./index-9dKHPhJj.js";import{C as K}from"./CustomTooltip-h6IVXsCv.js";import{R as W,L as _,C as X,X as Y,Y as $,T as G,a as J,b as w}from"./charts-B4vmDJji.js";import"./http-vendor-B9ygI19o.js";function te(){const i=localStorage.getItem("access_token"),y=localStorage.getItem("username")||"Unknown",k=F(),[n,C]=a.useState("1h"),[l,S]=a.useState(""),[m,L]=a.useState(10),[p,g]=a.useState([]),[f,j]=a.useState(!1),c=a.useRef(""),{connectionStatus:R}=B(i),A=async()=>{await U.logout(),k("/login")};a.useEffect(()=>{const s=async()=>{if(i)try{const r=n==="custom"?l:n;if(!r||n==="custom"&&!l){g([]),c.current="";return}const d=await fetch(`/api/bandwidth/history?range=${r}`,{headers:{Authorization:`Bearer ${i}`}});if(d.ok){const o=await d.json(),x=["ppp0","br1","br0"],v=o.filter(h=>x.includes(h.interface)).sort((h,z)=>x.indexOf(h.interface)-x.indexOf(z.interface)),b=JSON.stringify(v);b!==c.current&&(g(v),c.current=b)}}catch(r){console.error("Failed to fetch bandwidth history:",r)}};c.current="",s();const t=setInterval(s,m*1e3);return()=>clearInterval(t)},[n,l,m,i]);const I=s=>({ppp0:"WAN",br0:"HOMELAB",br1:"LAN"})[s]||s,M=s=>({ppp0:"info",br0:"success",br1:"purple"})[s]||"gray";return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(E,{onLogout:A,isOpen:f,onClose:()=>j(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(H,{hostname:"nixos-router",username:y,connectionStatus:R,onMenuClick:()=>j(!f)}),e.jsx("div",{className:"sticky top-0 z-10 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 md:px-6 py-3 shadow-sm",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-3",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Network Bandwidth"}),e.jsxs("div",{className:"flex flex-wrap gap-2 md:gap-4 items-end",children:[e.jsxs("div",{className:"min-w-[120px]",children:[e.jsx(u,{htmlFor:"global-range",value:"Time Range",className:"text-xs mb-1"}),e.jsxs(N,{id:"global-range",sizing:"sm",value:n,onChange:s=>C(s.target.value),children:[e.jsx("option",{value:"10m",children:"10 minutes"}),e.jsx("option",{value:"30m",children:"30 minutes"}),e.jsx("option",{value:"1h",children:"1 hour"}),e.jsx("option",{value:"3h",children:"3 hours"}),e.jsx("option",{value:"6h",children:"6 hours"}),e.jsx("option",{value:"12h",children:"12 hours"}),e.jsx("option",{value:"1d",children:"1 day"}),e.jsx("option",{value:"3d",children:"3 days"}),e.jsx("option",{value:"7d",children:"7 days"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),n==="custom"&&e.jsxs("div",{className:"min-w-[100px]",children:[e.jsx(u,{htmlFor:"global-custom",value:"Custom",className:"text-xs mb-1"}),e.jsx(D,{id:"global-custom",sizing:"sm",placeholder:"e.g., 45m",value:l,onChange:s=>S(s.target.value)})]}),e.jsxs("div",{className:"min-w-[120px]",children:[e.jsx(u,{htmlFor:"global-refresh",value:"Update Every",className:"text-xs mb-1"}),e.jsxs(N,{id:"global-refresh",sizing:"sm",value:m,onChange:s=>L(Number(s.target.value)),children:[e.jsx("option",{value:1,children:"1 second"}),e.jsx("option",{value:5,children:"5 seconds"}),e.jsx("option",{value:10,children:"10 seconds"}),e.jsx("option",{value:30,children:"30 seconds"}),e.jsx("option",{value:60,children:"1 minute"})]})]})]})]})}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"grid grid-cols-1 gap-6",children:p.map(s=>{const t=s.data.map(o=>({time:new Date(o.timestamp).toLocaleTimeString(),download:o.rx_mbps||0,upload:o.tx_mbps||0})),r=t.length>0?t[t.length-1].download:0,d=t.length>0?t[t.length-1].upload:0;return e.jsxs(O,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:I(s.interface)}),e.jsx(T,{color:M(s.interface),size:"sm",children:s.interface})]}),e.jsx(W,{width:"100%",height:250,children:e.jsxs(_,{data:t,children:[e.jsx(X,{strokeDasharray:"3 3"}),e.jsx(Y,{dataKey:"time",tick:{fontSize:12},interval:Math.floor(t.length/8)}),e.jsx($,{tick:{fontSize:12},label:{value:"Mbit/s",angle:-90,position:"insideLeft"}}),e.jsx(G,{content:e.jsx(K,{})}),e.jsx(J,{}),e.jsx(w,{type:"monotone",dataKey:"download",stroke:"#3b82f6",name:"Download (Mbit/s)",strokeWidth:2,dot:!1,isAnimationActive:!1}),e.jsx(w,{type:"monotone",dataKey:"upload",stroke:"#10b981",name:"Upload (Mbit/s)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400 text-center",children:["Current: ",e.jsxs("strong",{className:"text-blue-600",children:["↓ ",r.toFixed(2)," Mbps"]})," / ",e.jsxs("strong",{className:"text-green-600",children:["↑ ",d.toFixed(2)," Mbps"]})," • ",t.length," points"]})]},s.interface)})}),p.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No bandwidth data available for this time range."})})]})]})]})}export{te as Network};
