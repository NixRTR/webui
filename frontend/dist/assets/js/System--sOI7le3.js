import{j as e,L as R,S as $,T as re,C as x,a as ne}from"./ui-vendor-Ch5Bctwu.js";import{u as ie,r}from"./react-vendor-DKKOAuGG.js";import{C as p}from"./CustomTooltip-DUfFl4fS.js";import{u as oe,S as le,N as ce}from"./useMetrics-BY-vmHmO.js";import{a as de}from"./index-BCFYf4Rp.js";import{R as j,L as y,C as v,X as b,Y as N,T as k,b as h,a as me}from"./charts-B4vmDJji.js";import"./http-vendor-B9ygI19o.js";function ye(){const o=localStorage.getItem("access_token"),E=localStorage.getItem("username")||"Unknown",U=ie(),[_,A]=r.useState(!1),[i,J]=r.useState("30m"),[c,P]=r.useState(""),[m,X]=r.useState(10),[z,I]=r.useState([]),[T,M]=r.useState([]),[F,O]=r.useState([]),[Y,K]=r.useState([]),[G,B]=r.useState([]),[H,V]=r.useState([]),S=r.useRef(""),D=r.useRef(""),L=r.useRef(""),w=r.useRef(""),C=r.useRef(""),{connectionStatus:q}=oe(o),Q=async()=>{await de.logout(),U("/login")};r.useEffect(()=>{const t=async()=>{if(o)try{const s=i==="custom"?c:i;if(!s||i==="custom"&&!c){I([]),M([]),O([]),S.current="",D.current="",L.current="";return}const n=await fetch(`/api/system/history?range=${s}`,{headers:{Authorization:`Bearer ${o}`}});if(n.ok){const l=await n.json(),d=JSON.stringify(l.data);d!==S.current&&(I(l.data),M(l.data),O(l.data),S.current=d,D.current=d,L.current=d)}}catch(s){console.error("Failed to fetch system history:",s)}};S.current="",D.current="",L.current="",t();const a=setInterval(t,m*1e3);return()=>clearInterval(a)},[i,c,m,o]),r.useEffect(()=>{const t=async()=>{if(o)try{const s=i==="custom"?c:i;if(!s||i==="custom"&&!c){K([]),w.current="";return}const n=await fetch(`/api/system/disk-io/history?range=${s}`,{headers:{Authorization:`Bearer ${o}`}});if(n.ok){const d=(await n.json()).filter(ae=>!ae.device.match(/\d$/)),W=JSON.stringify(d);W!==w.current&&(K(d),w.current=W)}}catch(s){console.error("Failed to fetch disk I/O history:",s)}};w.current="",t();const a=setInterval(t,m*1e3);return()=>clearInterval(a)},[i,c,m,o]),r.useEffect(()=>{const t=async()=>{if(o)try{const s=i==="custom"?c:i;if(!s||i==="custom"&&!c){B([]),C.current="";return}const n=await fetch(`/api/system/temperatures/history?range=${s}`,{headers:{Authorization:`Bearer ${o}`}});if(n.ok){const l=await n.json(),d=JSON.stringify(l);d!==C.current&&(B(l),C.current=d)}}catch(s){console.error("Failed to fetch temperature history:",s)}};C.current="",t();const a=setInterval(t,m*1e3);return()=>clearInterval(a)},[i,c,m,o]),r.useEffect(()=>{const t=async()=>{if(o)try{const s=await fetch("/api/system/clients",{headers:{Authorization:`Bearer ${o}`}});if(s.ok){const n=await s.json();V(n)}}catch(s){console.error("Failed to fetch client stats:",s)}};t();const a=setInterval(t,m*1e3);return()=>clearInterval(a)},[m,o]);const Z=t=>t.startsWith("nvme")?`NVMe ${t}`:t.startsWith("sd")?`Disk ${t.toUpperCase()}`:t,u=r.useMemo(()=>z.map(t=>({time:new Date(t.timestamp).toLocaleTimeString(),cpu:t.cpu_percent||0})),[z]),g=r.useMemo(()=>T.map(t=>({time:new Date(t.timestamp).toLocaleTimeString(),memory:t.memory_percent||0})),[T]),f=r.useMemo(()=>F.map(t=>({time:new Date(t.timestamp).toLocaleTimeString(),load:t.load_avg_1m||0})),[F]),ee=u.length>0?u[u.length-1].cpu:0,te=g.length>0?g[g.length-1].memory:0,se=f.length>0?f[f.length-1].load:0;return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(le,{onLogout:Q,isOpen:_,onClose:()=>A(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(ce,{hostname:"nixos-router",username:E,connectionStatus:q,onMenuClick:()=>A(!_)}),e.jsx("div",{className:"sticky top-0 z-10 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 md:px-6 py-3 shadow-sm",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-3",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"System Monitoring"}),e.jsxs("div",{className:"flex flex-wrap gap-2 md:gap-4 items-end",children:[e.jsxs("div",{className:"min-w-[120px]",children:[e.jsx(R,{htmlFor:"global-range",value:"Time Range",className:"text-xs mb-1"}),e.jsxs($,{id:"global-range",sizing:"sm",value:i,onChange:t=>J(t.target.value),children:[e.jsx("option",{value:"10m",children:"10 minutes"}),e.jsx("option",{value:"30m",children:"30 minutes"}),e.jsx("option",{value:"1h",children:"1 hour"}),e.jsx("option",{value:"3h",children:"3 hours"}),e.jsx("option",{value:"6h",children:"6 hours"}),e.jsx("option",{value:"12h",children:"12 hours"}),e.jsx("option",{value:"1d",children:"1 day"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),i==="custom"&&e.jsxs("div",{className:"min-w-[100px]",children:[e.jsx(R,{htmlFor:"global-custom",value:"Custom",className:"text-xs mb-1"}),e.jsx(re,{id:"global-custom",sizing:"sm",placeholder:"e.g., 45m",value:c,onChange:t=>P(t.target.value)})]}),e.jsxs("div",{className:"min-w-[120px]",children:[e.jsx(R,{htmlFor:"global-refresh",value:"Update Every",className:"text-xs mb-1"}),e.jsxs($,{id:"global-refresh",sizing:"sm",value:m,onChange:t=>X(Number(t.target.value)),children:[e.jsx("option",{value:1,children:"1 second"}),e.jsx("option",{value:5,children:"5 seconds"}),e.jsx("option",{value:10,children:"10 seconds"}),e.jsx("option",{value:30,children:"30 seconds"}),e.jsx("option",{value:60,children:"1 minute"})]})]})]})]})}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 bg-gray-50 dark:bg-gray-900",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(x,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"CPU Usage"}),e.jsx(j,{width:"100%",height:250,children:e.jsxs(y,{data:u,children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"time",tick:{fontSize:12}}),e.jsx(N,{domain:[0,100],tick:{fontSize:12},label:{value:"%",angle:-90,position:"insideLeft"}}),e.jsx(k,{content:e.jsx(p,{})}),e.jsx(h,{type:"monotone",dataKey:"cpu",stroke:"#3b82f6",strokeWidth:2,dot:!1,name:"CPU",isAnimationActive:!1})]})}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400 text-center",children:["Current: ",e.jsxs("strong",{children:[ee.toFixed(1),"%"]})," • ",u.length," points"]})]}),e.jsxs(x,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Memory Usage"}),e.jsx(j,{width:"100%",height:250,children:e.jsxs(y,{data:g,children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"time",tick:{fontSize:12}}),e.jsx(N,{domain:[0,100],tick:{fontSize:12},label:{value:"%",angle:-90,position:"insideLeft"}}),e.jsx(k,{content:e.jsx(p,{})}),e.jsx(h,{type:"monotone",dataKey:"memory",stroke:"#10b981",strokeWidth:2,dot:!1,name:"Memory",isAnimationActive:!1})]})}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400 text-center",children:["Current: ",e.jsxs("strong",{children:[te.toFixed(1),"%"]})," • ",g.length," points"]})]}),e.jsxs(x,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Load Average"}),e.jsx(j,{width:"100%",height:250,children:e.jsxs(y,{data:f,children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"time",tick:{fontSize:12}}),e.jsx(N,{tick:{fontSize:12},label:{value:"Load (1m)",angle:-90,position:"insideLeft"}}),e.jsx(k,{content:e.jsx(p,{})}),e.jsx(h,{type:"monotone",dataKey:"load",stroke:"#f59e0b",strokeWidth:2,dot:!1,name:"Load",isAnimationActive:!1})]})}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400 text-center",children:["Current: ",e.jsx("strong",{children:se.toFixed(2)})," • ",f.length," points"]})]}),Y.map(t=>{const a=t.data.map(l=>({time:new Date(l.timestamp).toLocaleTimeString(),read_mbps:l.read_mbps,write_mbps:l.write_mbps})),s=a.length>0?a[a.length-1].read_mbps:0,n=a.length>0?a[a.length-1].write_mbps:0;return e.jsxs(x,{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Disk I/O - ",Z(t.device)]}),e.jsx(j,{width:"100%",height:250,children:e.jsxs(y,{data:a,children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"time",tick:{fontSize:12}}),e.jsx(N,{tick:{fontSize:12},label:{value:"MB/s",angle:-90,position:"insideLeft"}}),e.jsx(k,{content:e.jsx(p,{})}),e.jsx(me,{}),e.jsx(h,{type:"monotone",dataKey:"read_mbps",stroke:"#3b82f6",strokeWidth:2,dot:!1,name:"Read (MB/s)",isAnimationActive:!1}),e.jsx(h,{type:"monotone",dataKey:"write_mbps",stroke:"#ef4444",strokeWidth:2,dot:!1,name:"Write (MB/s)",isAnimationActive:!1})]})}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400 text-center",children:["Current: ",e.jsxs("strong",{className:"text-blue-600",children:["↓ ",s.toFixed(2)," MB/s"]})," / ",e.jsxs("strong",{className:"text-red-600",children:["↑ ",n.toFixed(2)," MB/s"]})," • ",a.length," points"]})]},t.device)}),G.map(t=>{const a=t.data.map(n=>({time:new Date(n.timestamp).toLocaleTimeString(),temperature:n.temperature_c})),s=a.length>0?a[a.length-1].temperature:0;return e.jsxs(x,{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Temperature - ",t.sensor_name]}),e.jsx(j,{width:"100%",height:250,children:e.jsxs(y,{data:a,children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"time",tick:{fontSize:12}}),e.jsx(N,{tick:{fontSize:12},label:{value:"°C",angle:-90,position:"insideLeft"}}),e.jsx(k,{content:e.jsx(p,{})}),e.jsx(h,{type:"monotone",dataKey:"temperature",stroke:s>=80?"#ef4444":s>=70?"#f59e0b":"#10b981",strokeWidth:2,dot:!1,name:"Temperature",isAnimationActive:!1})]})}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400 text-center",children:["Current: ",e.jsxs("strong",{className:s>=80?"text-red-600":s>=70?"text-yellow-600":"text-green-600",children:[s.toFixed(1),"°C"]})," • ",a.length," points"]})]},t.sensor_name)})]}),H.length>0&&e.jsxs(x,{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Network Clients"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:H.map(t=>e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h4",{className:"font-semibold text-lg uppercase",children:t.network}),e.jsxs(ne,{color:t.network==="homelab"?"info":"purple",children:[t.total_clients," Total"]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"DHCP Clients:"}),e.jsx("span",{className:"font-semibold",children:t.dhcp_clients})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Static Clients:"}),e.jsx("span",{className:"font-semibold",children:t.static_clients})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Online:"}),e.jsx("span",{className:"font-semibold text-green-600",children:t.online_clients})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Offline:"}),e.jsx("span",{className:"font-semibold text-gray-500",children:t.offline_clients})]})]})]},t.network))})]})]})]})]})}export{ye as System};
