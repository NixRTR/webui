import{j as e,C as t,P as b,a as i,b as a}from"./ui-vendor-XgbUf-17.js";import{u as F,a as k}from"./react-vendor-DIDCmA_u.js";import{u as D,S as H,N as M}from"./useMetrics-Dl5kKmhV.js";import{a as U}from"./index-Bpa95oHH.js";import"./http-vendor-B9ygI19o.js";function R(){const p=localStorage.getItem("access_token"),u=localStorage.getItem("username")||"Unknown",d=F(),[m,x]=k.useState(!1),{connectionStatus:j,system:r,interfaces:g,services:f}=D(p),v=async()=>{await U.logout(),d("/login")},N=s=>{const c=Math.floor(s/86400),o=Math.floor(s%86400/3600),n=Math.floor(s%3600/60);return`${c}d ${o}h ${n}m`},h=s=>(s/1073741824).toFixed(2)+" GB",y=g.filter(s=>["ppp0","br0","br1"].includes(s.interface)),_=s=>{switch(s){case"ppp0":return"WAN";case"br0":return"HOMELAB";case"br1":return"LAN";default:return s}},C=s=>{switch(s){case"ppp0":return"info";case"br0":return"success";case"br1":return"purple";default:return"gray"}};return e.jsxs("div",{className:"flex h-screen",children:[e.jsx(H,{onLogout:v,isOpen:m,onClose:()=>x(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(M,{hostname:"nixos-router",username:u,connectionStatus:j,onMenuClick:()=>x(!m)}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Dashboard"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs(t,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"CPU Usage"}),e.jsxs("div",{className:"text-3xl font-bold mb-2",children:[r?.cpu_percent.toFixed(1),"%"]}),e.jsx(b,{progress:r?.cpu_percent||0,color:(r?.cpu_percent||0)>80?"red":(r?.cpu_percent||0)>60?"yellow":"blue"})]}),e.jsxs(t,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Memory Usage"}),e.jsxs("div",{className:"text-3xl font-bold mb-2",children:[r?.memory_percent.toFixed(1),"%"]}),e.jsx(b,{progress:r?.memory_percent||0,color:(r?.memory_percent||0)>80?"red":(r?.memory_percent||0)>60?"yellow":"blue"}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:r&&`${(r.memory_used_mb/1024).toFixed(1)} / ${(r.memory_total_mb/1024).toFixed(1)} GB`})]}),e.jsxs(t,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Load Average"}),e.jsx("div",{className:"text-3xl font-bold mb-2",children:r?.load_avg_1m.toFixed(2)}),e.jsxs("div",{className:"text-sm text-gray-500",children:["5min: ",r?.load_avg_5m.toFixed(2)," | 15min: ",r?.load_avg_15m.toFixed(2)]})]}),e.jsxs(t,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Uptime"}),e.jsx("div",{className:"text-2xl font-bold",children:r&&N(r.uptime_seconds)})]})]}),e.jsxs(t,{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Network Interfaces"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:y.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold",children:_(s.interface)}),e.jsx(i,{color:C(s.interface),size:"sm",children:s.interface})]}),e.jsx(i,{color:"success",size:"sm",children:"UP"})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"↓ Download:"}),e.jsxs("span",{className:"font-mono",children:[s.rx_rate_mbps?.toFixed(2)||"0.00"," Mbps"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"↑ Upload:"}),e.jsxs("span",{className:"font-mono",children:[s.tx_rate_mbps?.toFixed(2)||"0.00"," Mbps"]})]}),e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"font-mono text-xs",children:["↓",h(s.rx_bytes)," ↑",h(s.tx_bytes)]})]})]})]},s.interface))})]}),e.jsxs(t,{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Services Status"}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[[{name:"Homelab DNS/DHCP",serviceId:"dnsmasq-homelab"},{name:"LAN DNS/DHCP",serviceId:"dnsmasq-lan"},{name:"SSH",serviceId:"sshd"},{name:"Frontend",serviceId:"nginx"},{name:"Backend",serviceId:"router-webui-backend"}],[{name:"Database",serviceId:"postgresql"},{name:"REDIS",serviceId:"redis"},{name:"Worker #1",serviceId:"router-webui-celery-aggregation"},{name:"Worker #2",serviceId:"router-webui-celery-parallel"},{name:"Worker #3",serviceId:"router-webui-celery-sequential"}]].map((s,c)=>e.jsx("div",{children:e.jsxs(a,{children:[e.jsxs(a.Head,{children:[e.jsx(a.HeadCell,{children:"Service"}),e.jsx(a.HeadCell,{children:"Status"}),e.jsx(a.HeadCell,{children:"PID"}),e.jsx(a.HeadCell,{children:"CPU"}),e.jsx(a.HeadCell,{children:"Memory"})]}),e.jsx(a.Body,{className:"divide-y",children:s.map(({name:o,serviceId:n})=>{const l=f.find(S=>S.service_name===n),w=l?l.is_active?"Running":l.is_enabled?"Stopped":"Disabled":"Not Found",I=l?l.is_active?"success":l.is_enabled?"failure":"gray":"gray";return e.jsxs(a.Row,{className:"cursor-pointer",onClick:()=>d(`/system/logs?service=${encodeURIComponent(n)}`),children:[e.jsx(a.Cell,{className:"font-medium",children:o}),e.jsx(a.Cell,{children:e.jsx(i,{color:I,children:w})}),e.jsx(a.Cell,{children:l?.pid||"-"}),e.jsxs(a.Cell,{children:[l?.cpu_percent?.toFixed(1)||"-","%"]}),e.jsxs(a.Cell,{children:[l?.memory_mb?.toFixed(0)||"-"," MB"]})]},n)})})]})},c))})]})]})]})]})}export{R as Dashboard};
