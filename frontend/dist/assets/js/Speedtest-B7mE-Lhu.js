import{j as e,B as p,C as y,e as X,f as Y,g as Z,P as q,S as I,L as J,T as Q,b as a}from"./ui-vendor-BKd5efyT.js";import{u as V,r}from"./react-vendor-DKKOAuGG.js";import{C as W}from"./CustomTooltip-6wie0y-t.js";import{u as ee,S as se,N as te}from"./useMetrics-B_0df1xE.js";import{a as ae}from"./index-WCxfyE5R.js";import{R as re,L as ne,C as ie,X as le,Y as oe,T as ce,a as de,b as P}from"./charts-_iF2RbR3.js";import"./http-vendor-B9ygI19o.js";const ue=[{value:1,label:"1 hour"},{value:3,label:"3 hours"},{value:6,label:"6 hours"},{value:12,label:"12 hours"},{value:24,label:"1 day"},{value:168,label:"1 week"},{value:336,label:"2 weeks"},{value:720,label:"1 month"},{value:2160,label:"3 months"},{value:4320,label:"6 months"},{value:8760,label:"1 year"}],me=[10,25,50,100];function ve(){const n=localStorage.getItem("access_token"),E=localStorage.getItem("username")||"Unknown",R=V(),[w,S]=r.useState(!1),{connectionStatus:A}=ee(n),[d,H]=r.useState(24),[L,_]=r.useState([]),[l,g]=r.useState(1),[u,N]=r.useState(25),[C,f]=r.useState(""),[B,j]=r.useState(!1),[m,k]=r.useState(null),[t,z]=r.useState({is_running:!1}),[M,T]=r.useState(!1),x=r.useRef(null),F=async()=>{await ae.logout(),R("/login")};r.useEffect(()=>{const s=async()=>{if(n)try{const o=await fetch(`/api/speedtest/chart-data?hours=${d}`,{headers:{Authorization:`Bearer ${n}`}});if(o.ok){const h=await o.json();_(h.data||[])}}catch(o){console.error("Error fetching chart data:",o)}};s();const i=setInterval(s,3e4);return()=>clearInterval(i)},[n,d]),r.useEffect(()=>{(async()=>{if(n)try{const i=new Date,o=new Date(i.getTime()-d*60*60*1e3),h=await fetch(`/api/speedtest/history?start_time=${o.toISOString()}&end_time=${i.toISOString()}&page=${l}&page_size=${u}`,{headers:{Authorization:`Bearer ${n}`}});if(h.ok){const b=await h.json();k(b)}}catch(i){console.error("Error fetching table data:",i)}})()},[n,d,l,u]),r.useEffect(()=>{if(t.is_running){const s=async()=>{try{const i=await fetch("/api/speedtest/status",{headers:{Authorization:`Bearer ${n}`}});if(i.ok){const o=await i.json();if(z(o),!o.is_running&&t.is_running){const h=async()=>{try{const c=await fetch(`/api/speedtest/chart-data?hours=${d}`,{headers:{Authorization:`Bearer ${n}`}});if(c.ok){const v=await c.json();_(v.data||[])}}catch(c){console.error("Error fetching chart data:",c)}},b=async()=>{try{const c=new Date,v=new Date(c.getTime()-d*60*60*1e3),D=await fetch(`/api/speedtest/history?start_time=${v.toISOString()}&end_time=${c.toISOString()}&page=${l}&page_size=${u}`,{headers:{Authorization:`Bearer ${n}`}});if(D.ok){const G=await D.json();k(G)}}catch(c){console.error("Error fetching table data:",c)}};h(),b()}}}catch(i){console.error("Error polling status:",i)}};return x.current=window.setInterval(s,1e3),()=>{x.current&&clearInterval(x.current)}}else x.current&&(clearInterval(x.current),x.current=null)},[t.is_running,n,d,l,u]);const O=async()=>{if(n)try{(await fetch("/api/speedtest/trigger",{method:"POST",headers:{Authorization:`Bearer ${n}`}})).ok&&(z({is_running:!0,progress:0}),T(!0))}catch(s){console.error("Error triggering speedtest:",s)}},U=s=>{s==="custom"?j(!0):(N(parseInt(s)),g(1),j(!1),f(""))},$=()=>{const s=parseInt(C);s>=1&&s<=200&&(N(s),g(1),j(!1),f(""))},K=s=>new Date(s).toLocaleString();return e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(se,{isOpen:w,onClose:()=>S(!1),onLogout:F}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(te,{hostname:"nixos-router",username:E,connectionStatus:A,onMenuClick:()=>S(!w)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Speedtest"}),e.jsx(p,{onClick:O,disabled:t.is_running,color:"blue",children:t.is_running?"Running...":"Run Speedtest"})]}),(t.is_running||M)&&e.jsxs(y,{className:"relative",children:[e.jsx("button",{onClick:()=>T(!1),className:"absolute top-4 right-4 p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":"Close results",children:e.jsx(X,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center pr-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-6",children:t.is_running?"Speedtest in Progress":"Speedtest Results"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Download"}),e.jsx(Y,{className:`w-5 h-5 text-blue-600 dark:text-blue-400 ${t.is_running&&t.current_phase==="download"?"animate-pulse drop-shadow-lg":""}`,style:t.is_running&&t.current_phase==="download"?{filter:"drop-shadow(0 0 8px rgba(59, 130, 246, 0.8))",animation:"pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite"}:{}})]}),e.jsx("div",{className:`text-5xl font-bold text-blue-600 dark:text-blue-400 ${t.is_running&&t.current_phase==="download"?"drop-shadow-lg":""}`,style:t.is_running&&t.current_phase==="download"?{filter:"drop-shadow(0 0 12px rgba(59, 130, 246, 0.6))",animation:"pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite"}:{},children:t.download_mbps?`${t.download_mbps.toFixed(2)}`:"--"}),e.jsx("div",{className:"text-lg text-gray-500 dark:text-gray-400 mt-1",children:"Mbps"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Upload"}),e.jsx(Z,{className:`w-5 h-5 text-green-600 dark:text-green-400 ${t.is_running&&t.current_phase==="upload"?"animate-pulse drop-shadow-lg":""}`,style:t.is_running&&t.current_phase==="upload"?{filter:"drop-shadow(0 0 8px rgba(16, 185, 129, 0.8))",animation:"pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite"}:{}})]}),e.jsx("div",{className:`text-5xl font-bold text-green-600 dark:text-green-400 ${t.is_running&&t.current_phase==="upload"?"drop-shadow-lg":""}`,style:t.is_running&&t.current_phase==="upload"?{filter:"drop-shadow(0 0 12px rgba(16, 185, 129, 0.6))",animation:"pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite"}:{},children:t.upload_mbps?`${t.upload_mbps.toFixed(2)}`:"--"}),e.jsx("div",{className:"text-lg text-gray-500 dark:text-gray-400 mt-1",children:"Mbps"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:"Ping"}),e.jsx("div",{className:"text-5xl font-bold text-gray-700 dark:text-gray-300",children:t.ping_ms?`${t.ping_ms.toFixed(2)}`:"--"}),e.jsx("div",{className:"text-lg text-gray-500 dark:text-gray-400 mt-1",children:"ms"})]})]}),t.is_running&&t.progress!==void 0&&e.jsxs("div",{className:"mt-4",children:[e.jsx(q,{progress:t.progress,color:"blue"}),e.jsx("div",{className:"text-sm text-gray-500 mt-2 text-center",children:t.current_phase||"Starting..."})]})]})]}),e.jsxs(y,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Speedtest Results"}),e.jsx(I,{value:d,onChange:s=>{H(parseInt(s.target.value)),g(1)},className:"w-48",children:ue.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsx(re,{width:"100%",height:400,children:e.jsxs(ne,{data:L,children:[e.jsx(ie,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"timestamp",tickFormatter:s=>new Date(s).toLocaleTimeString()}),e.jsx(oe,{label:{value:"Mbps",angle:-90,position:"insideLeft"}}),e.jsx(ce,{content:e.jsx(W,{})}),e.jsx(de,{}),e.jsx(P,{type:"monotone",dataKey:"download_mbps",stroke:"#3b82f6",name:"Download",dot:!1}),e.jsx(P,{type:"monotone",dataKey:"upload_mbps",stroke:"#10b981",name:"Upload",dot:!1})]})})]}),e.jsxs(y,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Test History"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{htmlFor:"page-size",children:"Results per page:"}),B?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{id:"custom-page-size",type:"number",min:"1",max:"200",value:C,onChange:s=>f(s.target.value),onKeyPress:s=>{s.key==="Enter"&&$()},className:"w-20"}),e.jsx(p,{size:"sm",onClick:$,children:"Apply"}),e.jsx(p,{size:"sm",color:"gray",onClick:()=>{j(!1),f("")},children:"Cancel"})]}):e.jsxs(I,{id:"page-size",value:u.toString(),onChange:s=>U(s.target.value),className:"w-32",children:[me.map(s=>e.jsx("option",{value:s.toString(),children:s},s)),e.jsx("option",{value:"custom",children:"Custom"})]})]})]}),e.jsxs(a,{children:[e.jsxs(a.Head,{children:[e.jsx(a.HeadCell,{children:"Timestamp"}),e.jsx(a.HeadCell,{children:"Download (Mbps)"}),e.jsx(a.HeadCell,{children:"Upload (Mbps)"}),e.jsx(a.HeadCell,{children:"Ping (ms)"}),e.jsx(a.HeadCell,{children:"Server"})]}),e.jsx(a.Body,{className:"divide-y",children:m?.results.map(s=>e.jsxs(a.Row,{children:[e.jsx(a.Cell,{children:K(s.timestamp)}),e.jsx(a.Cell,{children:s.download_mbps.toFixed(2)}),e.jsx(a.Cell,{children:s.upload_mbps.toFixed(2)}),e.jsx(a.Cell,{children:s.ping_ms.toFixed(2)}),e.jsx(a.Cell,{children:s.server_name||"-"})]},s.id))})]}),m&&m.total_pages>1&&e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(l-1)*u+1," to ",Math.min(l*u,m.total)," of ",m.total," results"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{size:"sm",color:"gray",disabled:l===1,onClick:()=>g(l-1),children:"Previous"}),e.jsx(p,{size:"sm",color:"gray",disabled:l===m.total_pages,onClick:()=>g(l+1),children:"Next"})]})]})]})]})})]})]})}export{ve as Speedtest};
